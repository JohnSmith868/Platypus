/*!
* @license Platypus
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
this.platypus=this.platypus||{},function(){"use strict";platypus.version="NEXT",platypus.buildDate="Tue, 18 Aug 2015 14:18:31 GMT"}(),platypus.Game=function(){"use strict";var a=null,b=null,c={},d=function(a,b){b["fade-to-black"]=function(b,c,d){var e=document.createElement("div"),f=b.canvas;f.appendChild(e),e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.zIndex="12",e.style.opacity="0",e.style.background="#000",a.get(e.style).to({opacity:0},500).to({opacity:1},500).call(function(a){c(),d()}).wait(500).to({opacity:0},500).call(function(a){f.removeChild(e),e=null})},b.crossfade=function(b,c,d){var e=0,f=null,g=!0,h=null;for(c(),h=b.loadedScene.layers,e=0;e<h.length;e++)h[e].element&&(f=h[e].element.style,f.opacity="0",g?(a.get(f).to({opacity:0},5).to({opacity:1},1e3).call(d),g=!1):a.get(f).to({opacity:0},5).to({opacity:1},1e3));g&&d()}},e=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="text",c.onload=function(){var d=null;if(200===c.status)try{d=JSON.parse(c.responseText)}catch(e){console.warn('Error parsing "'+a+'": '+e.message)}else console.warn('Error opening "'+a+'": '+c.description);b(d)},c.send()},f=function(a,b){var c=0,d="",g=0,h=function(c){g-=1,g||b(a)},i=function(a,b,c){f(a[b],function(d){a[b]=d,c(d)})};if(a){if(Array.isArray(a)){if(g=a.length)for(c=0;c<a.length;c++)i(a,c,h);else b(a);return}if("object"==typeof a){if(a.src&&a.src.length>5&&".json"===a.src.substring(a.src.length-5).toLowerCase())f(a.src,function(c){a.src!==c&&(a=c),b(a)});else{for(d in a)a.hasOwnProperty(d)&&(g+=1);if(g)for(d in a)a.hasOwnProperty(d)&&i(a,d,h);else b(a)}return}if("string"==typeof a&&a.length>5&&".json"===a.substring(a.length-5).toLowerCase())return void e(a,function(a){"object"==typeof a?f(a,b):b(a)})}b(a)},g=function(c,d,e){var g=this,h=function(f){var h=null;if(c=f,console.log("Game config loaded.",c),platypus.game=g,g.currentScene=null,g.loaded=null,g.settings=c,d)g.stage=d;else if(b){try{h=document.getElementById(c.global.canvas)}catch(i){console.warn('Stage not provided and canvas ID "'+c.global.canvas+'" not found in HTML wrapper.')}g.stage=new b(h)}else console.warn("Platypus requires a CreateJS Stage for rendering.");g.loadScene(c.global.initialScene),e&&e(g),a&&c.global.tickerOn!==!1&&(g.tickHandler=function(a){g.tick(a)},a.timingMode="raf",a.setFPS(c.global.fps||60),a.addEventListener("tick",g.tickHandler)),window&&(window.getEntityById=function(a){return g.getEntityById(a)},window.getEntitiesByType=function(a){return g.getEntitiesByType(a)})};return c?void("string"==typeof c?f(c,h):h(c)):(console.warn("No game definition is supplied. Game not created."),null)},h=g.prototype;return window.createjs&&(window.createjs.Ticker&&(a=window.createjs.Ticker),window.createjs.Tween&&d(window.createjs.Tween,c),window.createjs.Stage&&(b=window.createjs.Stage)),h.tick=function(a){this.loadedScene&&this.loadedScene.trigger("tick",a),this.currentScene&&this.currentScene.trigger("tick",a)},h.loadScene=function(a,b,d,e){var f=this,g=this.loaded,h=function(){f.loaded||f.loadNextScene(a,d)},i=function(){g&&g!==f.loaded||f.completeSceneTransition(d)};return this.leavingScene&&this.leavingScene.destroy(),this.inTransition=!0,this.leavingScene=this.currentScene,e?void this.loadNextScene(a):(this.loadedScene&&(this.loadedScene.destroy(),this.loadedScene=null),void(c[b]?c[b](this,h,i):(h(),i())))},h.loadNextScene=function(a,b){var c=null;c="string"==typeof a?this.settings.scenes[a]:a,this.loaded=a,this.loadedScene=new platypus.Scene(c,this.stage),console.log("Scene loaded: "+a),this.loadedScene.trigger("scene-loaded",b)},h.completeSceneTransition=function(a){var b=this.loaded;this.loadedScene&&(this.currentScene=this.loadedScene,this.loadedScene=null,this.loaded=!1,this.inTransition=!1,this.leavingScene&&(this.leavingScene.destroy(),this.leavingScene=!1),console.log("Scene live: "+b),this.currentScene.trigger("scene-live",a))},h.getEntityById=function(a){return this.currentScene?this.currentScene.getEntityById(a):null},h.getEntitiesByType=function(a){return this.currentScene?this.currentScene.getEntitiesByType(a):[]},h.destroy=function(){this.tickHandler&&a.removeEventListener("tick",this.tickHandler)},g}(),platypus.Messenger=function(){"use strict";var a=function(){this.messages={},this.loopCheck=[],this.unbindLater=[]},b=a.prototype;return b.toString=function(){return"[messenger Object]"},b.bind=function(a,b,c){this.messages[a]||(this.messages[a]=[]),this.messages[a].push({callback:b,scope:c})},b.unbind=function(a,b,c){var d=!1,e=0;if(this.loopCheck.length)for(e=0;e<this.loopCheck.length;e++)if(this.loopCheck[e]===a){d=!0;break}d?this.unbindLater.push({event:a,callback:b,scope:c}):this.safelyUnbind(a,b,c)},b.safelyUnbind=function(a,b,c){var d=0;for(this.messages[a]||(this.messages[a]=[]),d=0;d<this.messages[a].length;d++)if(this.messages[a][d].callback===b&&this.messages[a][d].scope===c){this.messages[a].splice(d,1);break}},b.trigger=function(a,b,c){var d=0,e=0;if("string"==typeof a)return this.triggerEvent(a,b,c);if(Array.isArray(a)){for(d=0;d<a.length;d++)e+=this.trigger(a[d],b,c);return e}return a.event?this.triggerEvent(a.event,a.message||b,a.debug||c):(console.warn('Event incorrectly formatted: must be string, array, or object containing an "event" property.',a),0)},b.triggerEvent=function(a,b,c){var d=0,e=0,f=0;if(this.debug||c||b&&b.debug){for(this.messages[a]&&this.messages[a].length?console.log('Entity "'+this.type+'": Event "'+a+'" has '+this.messages[a].length+" subscriber"+(this.messages[a].length>1?"s":"")+".",b):console.warn('Entity "'+this.type+'": Event "'+a+'" has no subscribers.',b),d=0;d<this.loopCheck.length;d++)if(this.loopCheck[d]===a){if(f+=1,f>5)throw"Endless loop detected for '"+a+"'.";console.warn("Event '"+a+"' is nested inside another '"+a+"' event.")}d=0}if(this.loopCheck.push(a),this.messages[a])for(d=0;d<this.messages[a].length;d++)this.messages[a][d].callback.call(this.messages[a][d].scope||this,b,c);if(this.loopCheck.length=this.loopCheck.length-1,!this.loopCheck.length&&this.unbindLater.length){for(e=0;e<this.unbindLater.length;e++)this.safelyUnbind(this.unbindLater[e].event,this.unbindLater[e].callback,this.unbindLater[e].scope);this.unbindLater.length=0}return d},b.getMessageIds=function(){return Object.keys(this.messages)},b.copyEventHandlers=function(a){return this.messages[a]||null},a}(),platypus.Scene=function(){"use strict";var a=function(a,b){var c=0,d="",e=a.layers,f=!0,g=!1,h=null,i=null;for(this.id=a.id,this.storedMessages=[],this.stage=b,this.layers=[],c=0;c<e.length;c++){if(g=e[c],h={stage:this.stage,parent:this},g.properties)for(d in g.properties)g.properties.hasOwnProperty(d)&&(h[d]=g.properties[d]);if(g.type&&(g=platypus.game.settings.entities[g.type]),f=!0,g.filter){if(g.filter.includes){f=!1;for(d in g.filter.includes)g.filter.includes.hasOwnProperty(d)&&platypus.supports[g.filter.includes[d]]&&(f=!0)}if(g.filter.excludes)for(d in g.filter.excludes)g.filter.excludes.hasOwnProperty(d)&&platypus.supports[g.filter.excludes[d]]&&(f=!1)}f&&this.layers.push(new platypus.Entity(g,{properties:h}))}for(i=this.storedMessages,this.storedMessages=!1,c=0;c<i.length;c++)this.trigger(i[c].message,i[c].value);i.length=0,this.time=(new Date).getTime(),this.timeElapsed={name:"",time:0}},b=a.prototype;return b.trigger=function(a,b){var c=0,d=0;if(this.storedMessages)this.storedMessages.push({message:a,value:b});else{for("tick"===a&&(d=(new Date).getTime(),this.timeElapsed.name="Non-Engine",this.timeElapsed.time=d-this.time,this.trigger("time-elapsed",this.timeElapsed),this.time=d),c=0;c<this.layers.length;c++)this.layers[c].trigger(a,b);"tick"===a&&(d=(new Date).getTime(),this.timeElapsed.name="Engine Total",this.timeElapsed.time=d-this.time,this.trigger("time-elapsed",this.timeElapsed),this.time=d)}},b.getEntityById=function(a){var b=0,c=null;for(b=0;b<this.layers.length;b++){if(this.layers[b].id===a)return this.layers[b];if(this.layers[b].getEntityById&&(c=this.layers[b].getEntityById(a)))return c}return void 0},b.getEntitiesByType=function(a){var b=0,c=null,d=[];for(b=0;b<this.layers.length;b++)this.layers[b].type===a&&d.push(this.layers[b]),this.layers[b].getEntitiesByType(a)&&(c=this.layers[b].getEntitiesByType(a),c&&(d=d.concat(c)));return d},b.destroy=function(){var a=0;for(a=0;a<this.layers.length;a++)this.layers[a].destroy();this.layers.length=0},a}(),platypus.Vector=function(){"use strict";var a=function(a,b,c){this.matrix=[0,0,0],this.set(a,b,c)},b=a.prototype;return Object.defineProperty(b,"x",{get:function(){return this.matrix[0]},set:function(a){this.matrix[0]=a}}),Object.defineProperty(b,"y",{get:function(){return this.matrix[1]},set:function(a){this.matrix[1]=a}}),Object.defineProperty(b,"z",{get:function(){return this.matrix[2]},set:function(a){this.matrix[2]=a}}),b.toString=function(){return"["+this.matrix.join(",")+"]"},b.forEach=function(a,b){var c=0,d=b||this.matrix.length;for(c=0;d>c;c++)a(this.matrix[c],c,this.matrix)},b.set=function(a,b,c){var d=null,e=function(a,b,c){c[b]=d[b]};return a&&Array.isArray(a)?d=a:a&&a.matrix?d=a.matrix:(this.x=a||0,this.y=b||0,this.z=c||0),d&&(this.matrix.length=d.length,this.forEach(e,b)),this},b.copyValues=function(a){return this.set(a)},b.magnitude=function(a){var b=0,c=function(a){b+=Math.pow(a,2)};return this.forEach(c,a),Math.sqrt(b)},b.getAngle=function(){var a=this.magnitude(2),b=0;return 0!==a&&(b=Math.acos(this.x/a),this.y<0&&(b=2*Math.PI-b)),b},b.getUnit=function(){return new platypus.Vector(this).normalize()},b.getInverse=function(){return new platypus.Vector(this).multiply(-1)},b.normalize=function(){var a=this.magnitude();return 0===a?this.multiply(0):this.multiply(1/a)},b.cross=function(){var a=function(a,b,c,d){return a*d-b*c};return function(b){var c=a(this.y,this.z,b.y,b.z),d=-a(this.x,this.z,b.x,b.z),e=a(this.x,this.y,b.x,b.y);return this.x=c,this.y=d,this.z=e,this}}(),b.getCrossProduct=function(a){return new platypus.Vector(this).cross(a)},b.rotate=function(b,c){var d=c,e=Math.cos(b),f=Math.sin(b),g=1-e,h=0,i=0,j=0;return d?"x"===d?d=new a(1,0,0):"y"===d?d=new a(0,1,0):"z"===d&&(d=new a(0,0,1)):d=new a(0,0,1),h=d.x,i=d.y,j=d.z,this.multiply([[e+h*h*g,h*i*g-j*f,h*j*g+i*f],[i*h*g+j*f,e+i*i*g,i*j*g-h*f],[j*h*g-i*f,j*i*g+h*f,e+j*j*g]])},b.multiply=function(a,b){var c=0,d=0,e=null,f=function(b,c,d){d[c]=b*a},g=0;if(Array.isArray(a))for(e=this.matrix.slice(),g=b||a.length,c=0;g>c;c++)for(this.matrix[c]=0,d=0;g>d;d++)this.matrix[c]+=e[d]*a[c][d];else this.forEach(f,b);return this},b.add=function(a,b,c){var d=a,e=0,f=function(a,b,c){c[b]+=d[b]};return Array.isArray(d)?e=b||0:d.matrix?(d=d.matrix,e=b||0):d=[a||0,b||0,c||0],this.forEach(f,e),this},b.addVector=function(a,b){return this.add(a,b)},b.subtractVector=function(a,b){return this.add(a.getInverse(),b)},b.scale=function(a,b){return this.multiply(a,b)},b.dot=function(a,b){var c=0,d=function(b,d){c+=b*(a.matrix[d]||0)};return this.forEach(d,b),c},b.angleTo=function(a){var b=this.getUnit(),c=a.getUnit();return Math.acos(b.dot(c))},b.signedAngleTo=function(a,b){var c=this.getUnit(),d=a.getUnit();return c.getCrossProduct(d).dot(b)<0?-Math.acos(c.dot(d)):Math.acos(c.dot(d))},b.scalarProjection=function(a){var b=0;return b="number"==typeof a?a:this.angleTo(a),this.magnitude(2)*Math.cos(b)},b.copy=function(){return new platypus.Vector(this)},a.assign=function(){var a=function(a,b,c,d){var e=null,f=!1;"string"==typeof a&&"undefined"!=typeof b[a]&&(e=b[a],delete b[a],f=!0),Object.defineProperty(b,a,{get:function(){return c.matrix[d]},set:function(a){c.matrix[d]=a},enumerable:!0}),f&&(b[a]=e)};return function(b,c){var d=0;if(b&&c){if(!b[c]){for(b[c]=new platypus.Vector,d=2;d<arguments.length;d++)arguments[d]!==c&&a(arguments[d],b,b[c],d-2);return}return b[c]}return null}}(),a}(),platypus.AABB=function(){"use strict";var a=function(a,b,c,d){this.empty=!0,this.setAll(a,b,c,d)},b=a.prototype;return b.setAll=function(a,b,c,d){return this.empty=!1,this.x=a,this.y=b,this.resize(c,d),this},b.set=function(a){return this.empty=a.empty,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.halfWidth=a.halfWidth,this.halfHeight=a.halfHeight,this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this},b.reset=function(){return this.empty=!0,this},b.resize=function(a,b){this.width=a||0,this.height=b||0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,isNaN(this.x)?this.empty=!0:(this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x),isNaN(this.y)?this.empty=!0:(this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y)},b.include=function(a){return a&&(this.empty?this.set(a):(this.left>a.left&&(this.left=a.left),this.right<a.right&&(this.right=a.right),this.top>a.top&&(this.top=a.top),this.bottom<a.bottom&&(this.bottom=a.bottom),this.width=this.right-this.left,this.height=this.bottom-this.top,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.x=this.left+this.halfWidth,this.y=this.top+this.halfHeight)),this},b.move=function(a,b){return this.moveX(a),this.moveY(b),this},b.moveX=function(a){return this.x=a,this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x,this},b.moveY=function(a){return this.y=a,this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y,this},b.moveXBy=function(a){return this.x+=a,this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x,this},b.moveYBy=function(a){return this.y+=a,this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y,this},b.getCopy=function(){return new a(this.x,this.y,this.width,this.height)},b.matches=function(a,b,c,d){return!(this.x!==a||this.y!==b||this.width!==c||this.height!==d)},b.contains=function(a){return!(a.top<this.top||a.bottom>this.bottom||a.left<this.left||a.right>this.right)},b.containsVector=function(a){return!(a.y<this.top||a.y>this.bottom||a.x<this.left||a.x>this.right)},b.intersects=function(a){return!(a.bottom<this.top||a.top>this.bottom||a.right<this.left||a.left>this.right)},a}(),function(){"use strict";var a=navigator.userAgent.toLowerCase(),b=document.createElement("audio"),c={touch:"undefined"!==window.ontouchstart,iPod:a.search("ipod")>-1,iPhone:a.search("iphone")>-1,iPad:a.search("ipad")>-1,safari:a.search("safari")>-1,ie:a.search("msie")>-1||a.search("trident")>-1,firefox:a.search("firefox")>-1,android:a.search("android")>-1,chrome:a.search("chrome")>-1,silk:a.search("silk")>-1,iPhone4:!1,iPad2:!1,iOS:!1,mobile:!1,desktop:!1,audioAPI:!1,ogg:!0,m4a:!0,mp3:!0};c.iPhone4=c.iPhone&&480===window.screen.height,c.iPad2=c.iPad&&(!window.devicePixelRatio||1===window.devicePixelRatio),c.iOS=c.iPod||c.iPhone||c.iPad,c.mobile=c.iOS||c.android||c.silk,c.desktop=!c.mobile,c.audioAPI=!c.iOS||!c.iPad2&&!c.iPhone4,!b.canPlayType||b.canPlayType&&""!==b.canPlayType('audio/ogg; codecs="vorbis"')||(c.ogg=!1,(c.ie||!b.canPlayType||""===b.canPlayType("audio/mp4"))&&(c.m4a=!1)),window.createjs&&createjs.Sound&&(createjs.HTMLAudioPlugin&&(createjs.HTMLAudioPlugin.enableIOS=!0),c.audioAPI?c.ie?(createjs.FlashPlugin.swfPath="./",createjs.Sound.registerPlugins([createjs.FlashPlugin,createjs.HTMLAudioPlugin])):createjs.Sound.initializeDefaultPlugins():createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]),c.audioAPI="[WebAudioPlugin]"===createjs.Sound.activePlugin.toString()),platypus.supports=c}(),platypus.CollisionData=function(){"use strict";var a=function(a,b,c,d,e,f,g,h,i){this.occurred=a||!1,this.direction=b||null,this.position=c||null,this.deltaMovement=d||null,this.aABB=e||null,this.thisShape=f||null,this.thatShape=g||null,this.vector=h||null,this.stuck=i||0},b=a.prototype;return b.copy=function(a){this.occurred=a.occurred,this.direction=a.direction,this.position=a.position,this.deltaMovement=a.deltaMovement,this.aABB=a.aABB,this.thisShape=a.thisShape,this.thatShape=a.thatShape,this.vector=a.vector,this.stuck=a.stuck},b.clear=function(){this.occurred=!1,this.direction=null,this.position=null,this.deltaMovement=null,this.aABB=null,this.thisShape=null,this.thatShape=null,this.vector=null,this.stuck=0},a}(),platypus.CollisionDataContainer=function(){"use strict";var a=function(){this.xData=[new platypus.CollisionData,new platypus.CollisionData],this.yData=[new platypus.CollisionData,new platypus.CollisionData],this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},b=a.prototype;return b.getXEntry=function(a){return this.xData[a]},b.getYEntry=function(a){return this.yData[a]},b.tryToAddX=function(a){return a.deltaMovement<this.xDeltaMovement?(this.xDeltaMovement=a.deltaMovement,this.xData[0].copy(a),this.xCount=1,!0):a.deltaMovement===this.xDeltaMovement?(this.ensureRoomX(),this.xData[this.xCount].copy(a),this.xCount+=1,!0):!1},b.tryToAddY=function(a){return a.deltaMovement<this.yDeltaMovement?(this.yDeltaMovement=a.deltaMovement,this.yData[0].copy(a),this.yCount=1,!0):a.deltaMovement===this.yDeltaMovement?(this.ensureRoomY(),this.yData[this.yCount].copy(a),this.yCount+=1,!0):!1},b.ensureRoomX=function(){var a=0,b=2*this.xData.length;if(this.xData.length<=this.xCount)for(a=this.xData.length;b>a;a++)this.xData[a]=new platypus.CollisionData},b.ensureRoomY=function(){var a=0,b=2*this.yData.length;if(this.yData.length<=this.yCount)for(a=this.yData.length;b>a;a++)this.yData[a]=new platypus.CollisionData},b.reset=function(){this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},a}(),platypus.CollisionShape=function(){"use strict";var a=function(a,b,c){var d=b.regX,e=b.regY,f=0,g=0;switch(this.owner=a,this.collisionType=c,this.width=b.width||b.radius||0,this.height=b.height||b.radius||0,this.radius=b.radius||0,"number"!=typeof d&&(d=this.width/2),"number"!=typeof e&&(e=this.height/2),platypus.Vector.assign(this,"offset","offsetX","offsetY"),this.offsetX=b.offsetX||this.width/2-d,this.offsetY=b.offsetY||this.height/2-e,platypus.Vector.assign(this,"position","x","y"),a?(this.x=a.x+this.offsetX,this.y=a.y+this.offsetY):(this.x=b.x+this.offsetX,this.y=b.y+this.offsetY),this.type=b.type||"rectangle",this.subType="",this.aABB=void 0,this.type){case"circle":f=g=2*this.radius;break;case"rectangle":f=this.width,g=this.height}platypus.Vector.assign(this,"size","width","height"),this.width=f,this.height=g,this.aABB=new platypus.AABB(this.x,this.y,f,g)},b=a.prototype;return b.update=function(a,b){this.x=a+this.offsetX,this.y=b+this.offsetY,this.aABB.move(this.x,this.y)},b.moveX=function(a){this.x=a,this.aABB.moveX(this.x)},b.moveY=function(a){this.y=a,this.aABB.moveY(this.y)},b.getAABB=function(){return this.aABB},b.setXWithEntityX=function(a){this.x=a+this.offsetX,this.aABB.moveX(this.x)},b.setYWithEntityY=function(a){this.y=a+this.offsetY,this.aABB.moveY(this.y)},b.destroy=function(){this.aABB=void 0},b.multiply=function(a){this.position.subtractVector(this.owner.position),this.position.multiply(a),this.offset.multiply(a),this.size.multiply(a),this.position.addVector(this.owner.position),this.width=Math.abs(this.width),this.height=Math.abs(this.height),this.aABB.setAll(this.x,this.y,this.width,this.height)},a}(),platypus.Entity=function(){"use strict";var a={},b=function(b,c){var d=this,e=0,f=null,g=b||{},h=g.components||[],i=g.properties||{},j=c||{},k=j.properties||{};for(platypus.Messenger.call(d),d.components=[],d.type=g.id||"none",d.id=c.id||k.id,d.id||(a[d.type]||(a[d.type]=0),d.id=d.type+"-"+a[d.type],a[d.type]+=1),this.setProperty(i),this.setProperty(k),this.bind("set-property",function(a){d.setProperty(a)}),d.state||(d.state={}),d.lastState={},e=0;e<h.length;e++)f=h[e],platypus.components[f.type]?d.addComponent(new platypus.components[f.type](d,f)):console.warn("Component '"+f.type+"' is not defined.",f);d.triggerEvent("load")},c=b.prototype=new platypus.Messenger;return c.toString=function(){return"[entity "+this.type+"]"},c.addComponent=function(a){return this.components.push(a),this.triggerEvent("component-added",a),a},c.removeComponent=function(a){var b=0;if("string"==typeof a){for(b=0;b<this.components.length;b++)if(this.components[b].type===a)return a=this.components[b],this.components.splice(b,1),this.triggerEvent("component-removed",a),a.destroy(),a}else for(b=0;b<this.components.length;b++)if(this.components[b]===a)return this.components.splice(b,1),this.triggerEvent("component-removed",a),a.destroy(),a;return!1},c.setProperty=function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},c.destroy=function(){var a=0;for(a=0;a<this.components.length;a++)this.components[a].destroy();this.components.length=0},b}(),function(){"use strict";var a=function(a,b,c){Object.defineProperty(b,a,{get:function(){return c[a]},set:function(b){c[a]=b},enumerable:!0})};platypus.components={},platypus.createComponentClass=function(b,c){var d=function(d,e){var f="",g="",h="",i="";if(c&&c.call(this),this.owner=d,this.listener={events:[],messages:[]},this.publicMethods={},this.type=b.id,b.properties)for(f in b.properties)b.properties.hasOwnProperty(f)&&("undefined"!=typeof e[f]?this[f]=e[f]:"undefined"!=typeof this.owner[f]?this[f]=this.owner[f]:this[f]=b.properties[f]);if(b.publicProperties)for(f in b.publicProperties)b.publicProperties.hasOwnProperty(f)&&(a(f,this,d),"undefined"!=typeof e[f]?this[f]=e[f]:"undefined"!=typeof this.owner[f]?this[f]=this.owner[f]:this[f]=b.publicProperties[f]);if(b.events)for(g in b.events)if(b.events.hasOwnProperty(g)&&(this.addEventListener(g,b.events[g]),e.aliases))for(i in e.aliases)e.aliases.hasOwnProperty(i)&&e.aliases[i]===g&&this.addEventListener(i,b.events[g]);if(b.publicMethods)for(g in b.publicMethods)if(b.publicMethods.hasOwnProperty(g)){if(h=g,e.aliases)for(i in e.aliases)e.aliases.hasOwnProperty(i)&&e.aliases[i]===g&&(h=i);this.addMethod(h,b.publicMethods[g])}this.constructor&&this.constructor(e)},e=null,f=d.prototype;if(c&&(f=d.prototype=new c),f.constructor=b.constructor,b.methods)for(e in b.methods)b.methods.hasOwnProperty(e)&&("destroy"===e?f._destroy=b.methods[e]:f[e]=b.methods[e]);if(b.publicMethods)for(e in b.publicMethods)b.publicMethods.hasOwnProperty(e)&&(f[e]=b.publicMethods[e]);f.toString=function(){return"[component "+this.type+"]"},f.destroy=function(){var a="";this._destroy&&this._destroy();for(a in this.publicMethods)this.publicMethods.hasOwnProperty(a)&&this.removeMethod(a);this.removeEventListeners()},f.removeEventListeners=function(a){var b=0,c=null,d=null;if(a)for(c=a,b=0;b<c.length;b++)this.removeEventListener(c[b]);else for(c=this.listener.events,d=this.listener.messages,b=0;b<c.length;b++)this.removeEventListener(c[b],d[b])},f.addEventListener=function(a,b){this.listener.events.push(a),this.listener.messages.push(b),this.owner.bind(a,b,this)},f.addMethod=function(a,b){var c=this;this.owner[a]?console.warn(this.owner.type+': Entity already has a method called "'+a+'". Method not added.'):(this.owner[a]=function(){return b.apply(c,arguments)},this.publicMethods[a]=b)},f.removeEventListener=function(a,b){var c=0,d=this.listener.events,e=this.listener.messages;for(c=0;c<d.length;c++)d[c]!==a||b&&e[c]!==b||this.owner.unbind(a,e[c],this)},f.removeMethod=function(a){this.owner[a]?delete this.owner[a]:console.warn(this.owner.type+': Entity does not have a method called "'+a+'".'),delete this.publicMethods[a]},platypus.components[b.id]=d}}(),function(){"use strict";var a=new window.springroll.ApplicationPlugin,b=null;a.setup=function(){},a.preload=function(a){var c=null;this.options.debug&&(this.config.debug=!0),c=this.game=new platypus.Game(this.config,this.display.stage),b=function(a){c.tick({delta:a})},this.on("update",b),a()},a.teardown=function(){this.off("update",b),this.game.destroy(),delete this.game}}(),function(){"use strict";var a=new platypus.Vector;return platypus.createComponentClass({id:"AIChaser",properties:{accelerate:!1,chasing:!0},publicProperties:{speed:.3},constructor:function(a){this.target=this.owner.target||null,this.offset=new platypus.Vector(0,0)},events:{load:function(){return this.owner.addMover?void(this.direction=this.owner.addMover({vector:[this.speed,0,0],event:"chase",accelerator:this.accelerate}).vector):void console.warn('The "AIChaser" component requires a "Mover" component to function correctly.')},"handle-ai":function(){var b=a,c=0,d=!1;this.target&&this.chasing&&(b.set(this.offset).add(this.target.position).subtractVector(this.owner.position),c=b.magnitude(2),c&&(d=!0,this.direction.set(b).normalize().multiply(this.speed))),d!==this.owner.state.chasing&&(this.owner.state.chasing=d,this.owner.triggerEvent("chase",d))},"set-target":function(a){this.target=a,this.offset.x=0,this.offset.y=0},"set-target-offset":function(a){this.offset.x=a.x,this.offset.y=a.y},"start-chasing":function(a){a&&(this.target=a),this.chasing=!0},"stop-chasing":function(){this.chasing=!1}},methods:{destroy:function(){this.target=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"AIPacer",properties:{movement:"both",direction:null},constructor:function(a){this.lastDirection="",this.currentDirection=this.direction||("horizontal"===this.movement?"left":"up")},events:{"handle-ai":function(){this.currentDirection!==this.lastDirection&&(this.lastDirection=this.currentDirection,this.owner.triggerEvent("stop"),this.owner.triggerEvent("go-"+this.currentDirection))},"turn-around":function(a){("both"===this.movement||"horizontal"===this.movement)&&(a.x>0?this.currentDirection="left":a.x<0&&(this.currentDirection="right")),("both"===this.movement||"vertical"===this.movement)&&(a.y>0?this.currentDirection="up":a.y<0&&(this.currentDirection="down"))}}})}(),function(){"use strict";var a=function(a,b){var c=0,d=!1;for(c=0;c<b.length;c++)if(b[c].id===a.id){d=!0;break}d||b.push(a)},b=function(a){return{id:a.item.id,data:a.item.data,asset:a.result}},c=function(a){return{id:a.manifestData.id,data:a.manifestData.data,asset:a.content}};return platypus.createComponentClass({id:"AssetLoader",properties:{automatic:!0,assets:null,cache:!0,crossOrigin:"",progressBar:"",useXHR:!0},constructor:function(a){this.assets||(this.assets=platypus.game.settings.assets),this.owner.assets={},this.progress=0,this.total=0,this["interface"]=null},events:{load:function(){this.automatic&&this.owner.triggerEvent("load-assets")},"load-assets":function(){var a=this,b=function(b){var c=a["interface"](b),d=a.owner.assets[c.id]={data:c.data,asset:c.asset};a.cache&&(platypus.assets[c.id]=d),a.progress+=1,a.owner.trigger("file-load",{asset:c.asset,complete:a.progress===a.total,data:c.data,fraction:a.progress/a.total,progress:a.progress,total:a.total}),a.progress===a.total&&a.owner.triggerEvent("complete")};window.springroll&&window.springroll.Application&&window.springroll.Application.instance?this.springRollLoad(b):window.createjs&&window.createjs.LoadQueue?this.createJSLoad(b):console.warn("AssetLoader: Must have SpringRoll or PreloadJS loaded to load assets.")}},methods:{destroy:function(){delete this.owner.assets},createJSLoad:function(c){var d=0,e=[],f=new window.createjs.LoadQueue(this.useXHR,"",this.crossOrigin);for(this["interface"]=b,f.addEventListener("fileload",c),d=0;d<this.assets.length;d++)"string"==typeof this.assets[d].src&&a(this.assets[d],e);window.createjs.Sound&&f.installPlugin(window.createjs.Sound),platypus.assets=platypus.assets||{},this.total=e.length,f.loadManifest(e)},springRollLoad:function(b){var d=0,e=[],f=window.springroll.Application.instance.loader;for(this["interface"]=c,d=0;d<this.assets.length;d++)"string"==typeof this.assets[d].src&&a(this.assets[d],e);for(platypus.assets=platypus.assets||{},this.total=e.length,d=0;d<e.length;d++)f.load(e[d].src,b,null,0,e[d])}}})}(),function(){"use strict";var a={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1,next:!1,events:!1},b=function(a,b){return a.time-b.time},c=function(){var a=window.springroll.Application.instance.voPlayer;this.play=function(b,c){var d=c.complete;return a.play(b,function(){d(!1)},function(){d(!0)}),this},this.stop=this.pause=function(){a.stop()},this.unpause=function(){},Object.defineProperty(this,"position",{get:function(){return a.playing?a.getElapsed():0}})},d=function(){var a=window.springroll.Application.instance.sound;this.play=function(b,c){return a.play(b,c)}},e=function(c){var d=0,e="",f="",g=null;if("string"==typeof c)e=c,g={};else if(Array.isArray(c)){if("string"==typeof c[0])e=c[0],g={next:[]};else{e=c[0].sound,g={};for(f in c[0])c[0].hasOwnProperty(f)&&(g[f]=c[0][f]);g.next?g.next=g.next.slice():g.next=[]}for(d=1;d<c.length;d++)g.next.push(c[d])}else e=c.sound,g={interrupt:c.interrupt,delay:c.delay,offset:c.offset,loop:c.loop,volume:c.volume,pan:c.pan,startTime:c.startTime,duration:c.duration,mute:c.mute,paused:c.paused,next:c.next,events:c.events};return function(c){var d=0,f=this,h=null,i=!1,j=!1;if(c=c||g,c.stop)this.stopAudio(e,c.playthrough);else if(i=c.next||g.next||a.next,j=c.events||g.events||a.events,h=this.player.play(e,{interrupt:c.interrupt||g.interrupt||a.interrupt,delay:c.delay||g.delay||a.delay,loop:c.loop||g.loop||a.loop,offset:c.offset||g.offset||a.offset,volume:"undefined"!=typeof c.volume?c.volume:"undefined"!=typeof g.volume?g.volume:a.volume,pan:c.pan||g.pan||a.pan,mute:c.mute||g.mute||a.mute,paused:c.paused||g.paused||a.paused,complete:function(a){h&&(a?f.onComplete(h):f.onComplete(h,i))}})){if(j){for(h.sequenceEvents=[],d=0;d<j.length;d++)h.sequenceEvents.push({event:j[d].event,time:j[d].time||0,message:j[d].message});h.sequenceEvents.sort(b)}h.soundId=e,this.activeAudioClips.push(h)}}},f=function(a,b,c){var d=a.replace(/ /g,"").split(",");return"default"===a?function(b){return c.call(this),a}:function(b){var e=0;for(e=0;e<d.length;e++)if(!b[d[e]])return!1;return c.call(this),a}};return platypus.createComponentClass({id:"Audio",properties:{audioMap:null,forcePlayThrough:!0,voiceOver:!1,priority:0},constructor:function(a){var b="",g=null;if(this.activeAudioClips=[],this.state=this.owner.state,this.stateChange=!1,this.currentState=!1,this.voiceOver?this.player=new c:this.player=new d,a.audioMap){this.checkStates=[];for(b in a.audioMap)a.audioMap.hasOwnProperty(b)&&(g=e(a.audioMap[b]),this.addEventListener(b,g),this.checkStates.push(f(b,a.audioMap[b],g)))}this.paused=!1},events:{"handle-render":function(){var a=this,b=0,c=null;if(!this.paused&&(this.getAllClips(function(b){a.checkTimeEvents(b)}),this.stateChange)){if(this.checkStates)for(this.currentState&&this.stopAudio(this.currentState.soundId,this.forcePlaythrough),this.currentState=!1,b=0;b<this.checkStates.length;b++)if(c=this.checkStates[b].call(this,this.state)){this.currentState=c;break}this.stateChange=!1}},"logical-state":function(){this.stateChange=!0},"toggle-mute":function(a){this.handleClip(a,function(a){a&&(a.options.mute=!a.options.mute)})},"stop-audio":function(a){a?"string"==typeof a?this.stopAudio(a):this.stopAudio(a.audioId||!1,a.playthrough||!1):this.stopAudio()},"mute-audio":function(a){this.handleClip(a,function(a){a&&(a.unmuted=a.volume,a.volume=0)})},"unmute-audio":function(a){this.handleClip(a,function(a){a&&(a.volume=a.unmuted,delete a.unmuted)})},"pause-audio":function(a){this.handleClip(a,function(a){a&&a.pause()})},"unpause-audio":function(a){this.handleClip(a,function(a){a&&a.unpause()})},"set-volume":function(a){var b=0,c=function(a){a.volume=b};"number"==typeof a?(b=a,this.getAllClips(c)):a.volume&&(b=a.volume,this.handleClip(a.soundId,c))}},methods:{handleClip:function(a,b){"string"==typeof a?this.getClipById(a,b):this.getAllClips(b)},getClipById:function(a,b){var c=0,d=this.activeAudioClips;for(c=0;c<d.length;c++)if(d[c].soundId===a)return b&&b(d[c]),d[c];return b&&b(null),null},getAllClips:function(a){var b=0,c=this.activeAudioClips;if(a)for(b=0;b<c.length;b++)a(c[b]);return c},stopAudio:function(a,b){var c=0,d=this.activeAudioClips,e=this,f=function(a){e.stopAudioInstance(a.currentTarget)};if(a)for(c=d.length-1;c>=0;c--)d[c].soundId===a&&(b?d[c].addEventListener("loop",f):(d[c].stop(),d.splice(c,1)));else if(b)for(c=0;c<d.length;c++)d[c].addEventListener("loop",f);else{for(c=0;c<this.activeAudioClips.length;c++)d[c].stop();d.length=0;
}},stopAudioInstance:function(a){var b=0,c=this.activeAudioClips;for(b=c.length-1;b>=0;b--)c[b]===a&&(c[b].stop(),c.splice(b,1))},checkTimeEvents:function(a,b){var c=a.sequenceEvents,d=0;if(c&&c.length)for(d=a.position;c.length&&(b||c[0].time<=d);)this.owner.trigger(c[0].event,c[0].message),c.splice(0,1)},onComplete:function(a,b){if(this.removeClip(a),this.checkTimeEvents(a,!0),this.owner.triggerEvent("clip-complete"),b&&b.length)if("string"==typeof b)e(b).call(this);else{var c=b.slice();c.splice(0,1),c.length>0?e(b[0]).call(this,{next:c}):e(b[0]).call(this)}else this.owner.triggerEvent("sequence-complete")},removeClip:function(a){var b=0;for(b=0;b<this.activeAudioClips.length;b++)if(this.activeAudioClips[b]===a){this.activeAudioClips.splice(b,1);break}},destroy:function(){this.stopAudio()}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Camera",properties:{width:0,height:0,overflow:!1,stretch:!1,transitionX:400,transitionY:600,transitionAngle:600,threshold:1,rotate:!1,x:0,y:0},publicProperties:{canvas:null,worldWidth:0,worldHeight:0},constructor:function(a){this.viewport=new platypus.AABB(0,0,0,0),this.worldCamera={viewport:new platypus.AABB(this.x,this.y,this.width,this.height),orientation:a.orientation||0},this.message={viewport:new platypus.AABB,scaleX:0,scaleY:0,orientation:0},this.worldIsLoaded=!1,this.following=void 0,this.state="static",this.boundingBox=new platypus.AABB(this.worldCamera.viewport.x,this.worldCamera.viewport.y,this.worldCamera.viewport.width/2,this.worldCamera.viewport.height/2),this.lastX=this.worldCamera.viewport.x,this.lastY=this.worldCamera.viewport.y,this.lastOrientation=this.worldCamera.orientation,this.forwardX=0,this.forwardY=0,this.forwardAngle=0,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=0,this.offsetY=0,this.offsetAngle=0,this.forwardFollower={x:this.lastX,y:this.lastY,orientation:this.lastOrientation},this.lastFollow={entity:null,mode:null,offsetX:0,offsetY:0,begin:0},this.xMagnitude=0,this.yMagnitude=0,this.xWaveLength=0,this.yWaveLength=0,this.xShakeTime=0,this.yShakeTime=0,this.shakeTime=0,this.shakeIncrementor=0,this.direction=!0,this.stationary=!1,this.viewportUpdate=!1,this.parentContainer=this.owner.container||this.owner.stage,this.container=new createjs.Container,this.parentContainer.addChild(this.container)},events:{load:function(){this.resize()},"render-world":function(a){this.world=a.world},"child-entity-added":function(a){this.viewportUpdate=!0,this.worldIsLoaded&&a.triggerEvent("camera-loaded",{width:this.worldWidth,height:this.worldHeight})},"world-loaded":function(a){this.worldIsLoaded=!0,this.worldWidth=a.width,this.worldHeight=a.height,a.camera&&this.follow(a.camera),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-loaded",a)},tick:function(a){var b=0,c=null,d=null,e=window.devicePixelRatio||1,f=[],g=this.message,h=g.viewport;for("following"===this.state&&this.followingFunction(this.following,a.delta)&&(this.viewportUpdate=!0),this.parentContainer===this.owner.stage&&(this.owner.width=this.parentContainer.canvas.width,this.owner.height=this.parentContainer.canvas.height),(this.owner.width!==this.lastWidth||this.owner.height!==this.lastHeight)&&(this.resize(),this.lastWidth=this.owner.width,this.lastHeight=this.owner.height),this.viewportUpdate?(this.viewportUpdate=!1,this.stationary=!1,h.set(this.worldCamera.viewport),this.shakeIncrementor<this.shakeTime&&(this.viewportUpdate=!0,this.shakeIncrementor+=a.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.shakeIncrementor<this.xShakeTime&&h.moveX(h.x+Math.sin(this.shakeIncrementor/this.xWaveLength*(2*Math.PI))*this.xMagnitude),this.shakeIncrementor<this.yShakeTime&&h.moveY(h.y+Math.sin(this.shakeIncrementor/this.yWaveLength*(2*Math.PI))*this.yMagnitude)),g.scaleX=this.windowPerWorldUnitWidth,g.scaleY=this.windowPerWorldUnitHeight,g.orientation=this.worldCamera.orientation,this.world.setTransform(h.halfWidth*g.scaleX*e,h.halfHeight*g.scaleY*e,g.scaleX*e,g.scaleY*e,180*(g.orientation||0)/Math.PI,0,0,h.x,h.y),this.owner.trigger("camera-update",g),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",g)):this.stationary||(this.owner.trigger("camera-stationary",g),this.stationary=!0),this.container.addChild(this.world),b=0;b<this.world.children.length;b++)c=this.world.children[b],c.visible&&"entity-managed"!==c.name&&(d=c.getTransformedBounds(),d&&(d.x+d.width<h.left||d.x>h.right||d.y+d.height<h.top||d.y>h.bottom)&&(c.visible=!1,f.push(c)));for(this.container.updateCache(),b=0;b<f.length;b++)f[b].visible=!0;this.lastFollow.begin&&this.lastFollow.begin<(new Date).getTime()&&this.follow(this.lastFollow)},resize:function(){this.resize()},relocate:function(a){this.move(a.x,a.y)&&(this.viewportUpdate=!0)},orientationchange:function(){this.resize()},follow:function(a){this.follow(a)},shake:function(a){var b=a||{},c=b.xMagnitude||0,d=b.yMagnitude||0,e=b.xFrequency||0,f=b.yFrequency||0,g=b.time||0;this.viewportUpdate=!0,this.shakeIncrementor=0,this.xMagnitude=c,this.yMagnitude=d,0===e?(this.xWaveLength=1,this.xShakeTime=0):(this.xWaveLength=1e3/e,this.xShakeTime=Math.ceil(g/this.xWaveLength)*this.xWaveLength),0===f?(this.yWaveLength=1,this.yShakeTime=0):(this.yWaveLength=1e3/f,this.yShakeTime=Math.ceil(g/this.yWaveLength)*this.yWaveLength),this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function(a){switch(a.time?(this.lastFollow.begin||(this.lastFollow.entity=this.following,this.lastFollow.mode=this.mode,this.lastFollow.offsetX=this.offsetX,this.lastFollow.offsetY=this.offsetY),this.lastFollow.begin=(new Date).getTime()+a.time):this.lastFollow.begin&&(this.lastFollow.begin=0),this.mode=a.mode,a.mode){case"locked":this.state="following",this.following=a.entity,this.followingFunction=this.lockedFollow,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0;break;case"forward":this.state="following",this.followFocused=!1,this.following=a.entity,this.lastX=a.entity.x||0,this.lastY=a.entity.y||0,this.lastOrientation=a.entity.orientation||0,this.forwardX=a.movementX||this.transitionX/10,this.forwardY=a.movementY||this.transitionY/10,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following",this.following=a.entity,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.boundingBox.setAll(a.x,a.y,a.width,a.height),this.followingFunction=this.boundingFollow;break;default:this.state="static",this.following=void 0,this.followingFunction=void 0,a&&"number"==typeof a.x&&"number"==typeof a.y&&(this.move(a.x,a.y,a.orientation||0),this.viewportUpdate=!0)}a.begin&&(a.begin=0)},move:function(a,b,c){var d=this.moveX(a);return d=this.moveY(b)||d,this.rotate&&(d=this.reorient(c||0)||d),d},moveX:function(a){var b=this.worldCamera.viewport;return Math.abs(b.x-a)>this.threshold?(this.worldWidth&&0!==this.worldWidth&&this.worldWidth<b.width?b.moveX(this.worldWidth/2):this.worldWidth&&0!==this.worldWidth&&a+b.halfWidth>this.worldWidth?b.moveX(this.worldWidth-b.halfWidth):this.worldWidth&&0!==this.worldWidth&&a<b.halfWidth?b.moveX(b.halfWidth):b.moveX(a),!0):!1},moveY:function(a){var b=this.worldCamera.viewport;return Math.abs(b.y-a)>this.threshold?(this.worldHeight&&0!==this.worldHeight&&this.worldHeight<b.height?b.moveY(this.worldHeight/2):this.worldHeight&&0!==this.worldHeight&&a+b.halfHeight>this.worldHeight?b.moveY(this.worldHeight-b.halfHeight):this.worldHeight&&0!==this.worldHeight&&a<b.halfHeight?b.moveY(b.halfHeight):b.moveY(a),!0):!1},reorient:function(a){return Math.abs(this.worldCamera.orientation-a)>1e-4?(this.worldCamera.orientation=a,!0):!1},lockedFollow:function(){var a=Math.min,b=function(a,b,c){return c*b+(1-c)*a},c=function(b,c){return b?a(c/b,1):1};return function(a,d,e){var f=b(this.worldCamera.viewport.x,a.x,c(this.transitionX,d)),g=b(this.worldCamera.viewport.y,a.y,c(this.transitionY,d));return this.rotate?this.move(f,g,b(this.worldCamera.orientation,-(a.orientation||0),c(this.transitionAngle,d))):this.move(f,g,0)}}(),forwardFollow:function(a,b){var c=this.forwardFollower,d=15/b,e=!1,f=a.x+this.offsetX,g=a.y+this.offsetY,h=(a.orientation||0)+this.offsetAngle;return this.followFocused&&this.lastX===f&&this.lastY===g?this.lockedFollow(c,b):(this.averageOffsetX*=.9,this.averageOffsetY*=.9,this.averageOffsetX+=.1*(f-this.lastX)*d,this.averageOffsetY+=.1*(g-this.lastY)*d,Math.abs(this.averageOffsetX)>this.worldCamera.viewport.width/(2*this.forwardX)&&(this.averageOffsetX=0),Math.abs(this.averageOffsetY)>this.worldCamera.viewport.height/(2*this.forwardY)&&(this.averageOffsetY=0),this.rotate&&(this.averageOffsetAngle*=.9,this.averageOffsetAngle+=.1*(h-this.lastOrientation)*d,Math.abs(this.averageOffsetAngle)>this.worldCamera.orientation/(2*this.forwardAngle)&&(this.averageOffsetAngle=0)),c.x=this.averageOffsetX*this.forwardX+f,c.y=this.averageOffsetY*this.forwardY+g,c.orientation=this.averageOffsetAngle*this.forwardAngle+h,this.lastX=f,this.lastY=g,this.lastOrientation=h,e=this.lockedFollow(c,b),this.followFocused||e||(this.followFocused=!0),e)},boundingFollow:function(a,b){var c=0,d=0,e=this.transitionX?Math.min(b/this.transitionX,1):1,f=1-e,g=this.transitionY?Math.min(b/this.transitionY,1):1,h=1-g;return this.boundingBox.move(this.worldCamera.viewport.x,this.worldCamera.viewport.y),a.x>this.boundingBox.right?c=a.x-this.boundingBox.halfWidth:a.x<this.boundingBox.left&&(c=a.x+this.boundingBox.halfWidth),a.y>this.boundingBox.bottom?d=a.y-this.boundingBox.halfHeight:a.y<this.boundingBox.top&&(d=a.y+this.boundingBox.halfHeight),0!==c&&(c=this.moveX(e*c+f*this.worldCamera.viewport.x)),0!==d&&(d=this.moveY(g*d+h*this.worldCamera.viewport.y)),c||d},resize:function(){var a=this.width/this.height,b=this.owner.width/this.owner.height;this.viewport.setAll(this.owner.width/2,this.owner.height/2,this.owner.width,this.owner.height),this.stretch||(b>a?this.overflow?this.worldCamera.viewport.resize(this.height*b,this.height):this.viewport.resize(this.viewport.height*a,this.viewport.height):this.overflow?this.worldCamera.viewport.resize(this.width,this.width/b):this.viewport.resize(this.viewport.width,this.viewport.width/a)),this.worldPerWindowUnitWidth=this.worldCamera.viewport.width/this.viewport.width,this.worldPerWindowUnitHeight=this.worldCamera.viewport.height/this.viewport.height,this.windowPerWorldUnitWidth=this.viewport.width/this.worldCamera.viewport.width,this.windowPerWorldUnitHeight=this.viewport.height/this.worldCamera.viewport.height,this.container.cache(0,0,this.viewport.width,this.viewport.height,1),this.container.x=this.viewport.x,this.container.y=this.viewport.y,this.container.regX=this.viewport.halfWidth,this.container.regY=this.viewport.halfHeight,this.viewportUpdate=!0},windowToWorld:function(a){var b=[];return b[0]=Math.round((a[0]-this.viewport.x)*this.worldPerWindowUnitWidth),b[1]=Math.round((a[1]-this.viewport.y)*this.worldPerWindowUnitHeight),b},worldToWindow:function(a){var b=[];return b[0]=Math.round(a[0]*this.windowPerWorldUnitWidth+this.viewport.x),b[1]=Math.round(a[1]*this.windowPerWorldUnitHeight+this.viewport.y),b},destroy:function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"CameraFollowMe",properties:{camera:{},mode:"forward",pause:!1},constructor:function(a){this.pauseGame=a.pause?{time:a.time}:null,this.camera={entity:this.owner,mode:this.camera.mode||this.mode,top:this.camera.top,left:this.camera.left,offsetX:this.camera.offsetX,offsetY:this.camera.offsetY,width:this.camera.width,height:this.camera.height,time:this.camera.time}},events:{"follow-me":function(a){var b=this.camera;a&&(b={entity:this.owner,mode:a.mode||this.camera.mode,top:a.top||this.camera.top,left:a.left||this.camera.left,offsetX:a.offsetX||this.camera.offsetX,offsetY:a.offsetY||this.camera.offsetY,width:a.width||this.camera.width,height:a.height||this.camera.height,time:a.time||this.camera.time}),this.pauseGame&&(this.owner.parent.trigger("pause-logic",this.pauseGame),this.owner.parent.trigger("pause-render",this.pauseGame)),this.owner.parent.trigger("follow",b)}}})}(),function(){"use strict";var a=function(a,b,c){var d=0,e=b.stuck;e&&(d=a.magnitude(),b.thatShape.owner&&Math.abs(e)>1&&(e*=.05),(!d||d>Math.abs(e))&&(b.vector.x&&(a.x=e,a.y=0),b.vector.y&&(a.x=0,a.y=e),c.stuckWith=new platypus.Vector(b.thatShape.x,b.thatShape.y)))},b=function(a,b,c){return"string"==typeof a?function(d){d.myType===c&&d.hitType===b&&this.owner.triggerEvent(a,d)}:Array.isArray(a)?function(d){var e=0;if(d.myType===c&&d.hitType===b)for(e=0;e<a.length;e++)this.owner.triggerEvent(a[e],d)}:function(d){var e=d.x,f=d.y;!d.entity||e||f||(e=d.entity.x-this.owner.x,f=d.entity.y-this.owner.y),d.myType===c&&d.hitType===b&&(f>0&&a.bottom&&this.owner.trigger(a.bottom,d),0>f&&a.top&&this.owner.trigger(a.top,d),e>0&&a.right&&this.owner.trigger(a.right,d),0>e&&a.left&&this.owner.trigger(a.left,d),a.all&&this.owner.trigger(a.all,d))}},c=function(b,c){c.collisionFunctions||(c.collisionFunctions={},c.getAABB=function(a){var b=null,d="";if(a)return c.collisionFunctions[a]?c.collisionFunctions[a].getAABB():null;b=c.aabb=c.aabb||new platypus.AABB,b.reset();for(d in c.collisionFunctions)c.collisionFunctions.hasOwnProperty(d)&&b.include(c.collisionFunctions[d].getAABB());return b},c.getPreviousAABB=function(a){return c.collisionFunctions[a]?c.collisionFunctions[a].getPreviousAABB():null},c.getShapes=function(a){return c.collisionFunctions[a]?c.collisionFunctions[a].getShapes():null},c.getPrevShapes=function(a){return c.collisionFunctions[a]?c.collisionFunctions[a].getPrevShapes():null},c.prepareCollision=function(a,b){var d="";for(d in c.collisionFunctions)c.collisionFunctions.hasOwnProperty(d)&&c.collisionFunctions[d].prepareCollision(a,b)},c.relocateEntity=function(b,d){var e=null;d.xCount&&(e=new platypus.Vector(0,0,0),a(e,d.getXEntry(0),c)),d.yCount&&(e=e||new platypus.Vector(0,0,0),a(e,d.getYEntry(0),c)),c.triggerEvent("relocate-entity",{position:b,unstick:e})},c.movePreviousX=function(a){var b="";for(b in c.collisionFunctions)c.collisionFunctions.hasOwnProperty(b)&&c.collisionFunctions[b].movePreviousX(a)},c.getCollisionTypes=function(){return c.collisionTypes},c.getSolidCollisions=function(){return c.solidCollisions}),c.collisionFunctions[b.collisionType]={getAABB:function(){return b.getAABB()},getPreviousAABB:function(){return b.getPreviousAABB()},getShapes:function(){return b.getShapes()},getPrevShapes:function(){return b.getPrevShapes()},prepareCollision:function(a,c){b.prepareCollision(a,c)},movePreviousX:function(a){b.movePreviousX(a)}}};return platypus.createComponentClass({id:"CollisionBasic",properties:{collisionType:"none",shapeType:"rectangle",ignoreOrientation:!1,regX:null,regY:null,width:0,height:0,radius:0,margin:0,shapes:null},publicProperties:{immobile:!1,bullet:!1,jumpThrough:!1},constructor:function(a){var d=0,e="",f=null,g=this.regX,h=this.regY,i=this.width,j=this.height,k=this.radius,l=this.margin.left||this.margin,m=this.margin.right||this.margin,n=this.margin.top||this.margin,o=this.margin.bottom||this.margin;for(null===g&&(g=this.regX=i/2),null===h&&(h=this.regY=j/2),platypus.Vector.assign(this.owner,"position","x","y","z"),platypus.Vector.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.aabb=new platypus.AABB,this.prevAABB=new platypus.AABB,this.shapes?f=this.shapes:"circle"===this.shapeType?(k=k||((i||0)+(j||0))/4,f=[{regX:(isNaN(g)?k:g)-(m-l)/2,regY:(isNaN(h)?k:h)-(o-n)/2,radius:k,width:2*k,height:2*k,type:this.shapeType}]):f=[{regX:(isNaN(g)?(i||0)/2:g)-(m-l)/2,regY:(isNaN(h)?(j||0)/2:h)-(o-n)/2,points:a.points,width:(i||0)+l+m,height:(j||0)+n+o,type:this.shapeType}],this.owner.collisionTypes=this.owner.collisionTypes||[],this.owner.collisionTypes.push(this.collisionType),this.shapes=[],this.prevShapes=[],this.entities=void 0,d=0;d<f.length;d++)this.shapes.push(new platypus.CollisionShape(this.owner,f[d],this.collisionType)),this.prevShapes.push(new platypus.CollisionShape(this.owner,f[d],this.collisionType)),this.prevAABB.include(this.prevShapes[d].getAABB()),this.aabb.include(this.shapes[d].getAABB());if(c(this,this.owner),this.owner.solidCollisions=this.owner.solidCollisions||{},this.owner.solidCollisions[this.collisionType]=[],a.solidCollisions)for(e in a.solidCollisions)a.solidCollisions.hasOwnProperty(e)&&(this.owner.solidCollisions[this.collisionType].push(e),this.owner.collides=!0,a.solidCollisions[e]&&this.addEventListener("hit-by-"+e,b(a.solidCollisions[e],"solid",this.collisionType)));if(this.owner.softCollisions=this.owner.softCollisions||{},this.owner.softCollisions[this.collisionType]=[],a.softCollisions)for(e in a.softCollisions)a.softCollisions.hasOwnProperty(e)&&(this.owner.softCollisions[this.collisionType].push(e),a.softCollisions[e]&&this.addEventListener("hit-by-"+e,b(a.softCollisions[e],"soft",this.collisionType)));this.stuck=!1},events:{"collide-on":function(){this.owner.parent.trigger("add-collision-entity",this.owner)},"collide-off":function(){this.owner.parent.trigger("remove-collision-entity",this.owner)},"relocate-entity":function(a){var b=a.unstick,c=0,d=0;for(b&&(c=b.magnitude()),this.move=null,a.relative?this.owner.position.set(this.owner.previousPosition).add(a.position):this.owner.position.set(a.position),this.stuck&&(c>0?this.owner.position.add(b):this.stuck=!1),this.aabb.reset(),d=0;d<this.shapes.length;d++)this.shapes[d].update(this.owner.x,this.owner.y),this.aabb.include(this.shapes[d].getAABB());this.owner.previousPosition.set(this.owner.position),c>0&&(this.stuck||(this.stuck=!0),this.move=this.owner.stuckWith.copy().add(-this.owner.x,-this.owner.y).normalize())},"handle-logic":function(){this.move&&this.owner.position.add(this.move)},"orientation-updated":function(a){var b=0;if(!this.ignoreOrientation)for(b=0;b<this.shapes.length;b++)this.shapes[b].multiply(a)}},methods:{getAABB:function(){return this.aabb},getPreviousAABB:function(){return this.prevAABB},getShapes:function(){return this.shapes},getPrevShapes:function(){return this.prevShapes},prepareCollision:function(a,b){var c=0,d=this.prevShapes;for(this.owner.x=a,this.owner.y=b,this.prevShapes=this.shapes,this.shapes=d,this.prevAABB.set(this.aabb),this.aabb.reset(),c=0;c<this.shapes.length;c++)this.shapes[c].update(this.owner.x,this.owner.y),this.aabb.include(this.shapes[c].getAABB())},movePreviousX:function(a){var b=0;for(this.prevAABB.moveX(a),b=0;b<this.prevShapes.length;b++)this.prevShapes[b].setXWithEntityX(a)},destroy:function(){var a=0;for(this.owner.parent.trigger("remove-collision-entity",this.owner),this.owner.collides=!1,delete this.aabb,delete this.prevAABB,a=0;a<this.owner.collisionTypes.length;a++)if(this.owner.collisionTypes[a]===this.collisionType){this.owner.collisionTypes.splice(a,1);break}this.owner.solidCollisions[this.collisionType]&&(this.owner.solidCollisions[this.collisionType].length=0,delete this.owner.solidCollisions[this.collisionType]),Object.keys(this.owner.solidCollisions).length>0&&(this.owner.collides=!0),this.owner.softCollisions[this.collisionType]&&(this.owner.softCollisions[this.collisionType].length=0,delete this.owner.softCollisions[this.collisionType]),delete this.owner.collisionFunctions[this.collisionType],this.shapes.length=0,this.prevShapes.length=0,delete this.entities,this.owner.collisionTypes.length&&this.owner.parent.trigger("add-collision-entity",this.owner)}}})}(),function(){"use strict";var a=function(a,b,c){return function(d){a.state[b]&&a.trigger(c,d)}},b=function(a,b,c){return function(d){a.state[b]||a.trigger(c,d)}};return platypus.createComponentClass({id:"CollisionFilter",properties:{collisions:{},state:""},constructor:function(c){var d="",e=this.collisions,f=this.state;if(e)if("!"===f[0]){f=f.substring(1);for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,b(this.owner,f,e[d]))}else for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,a(this.owner,f,e[d]))}})}(),function(){"use strict";var a=function(a,b){var c=0,d=0,e=a.length,f=!1;for(c=0;c<b.length;c++){for(f=!1,d=0;e>d;d++)if(b[c]===a[d]){f=!0;break}f||a.push(b[c])}return a};return platypus.createComponentClass({id:"CollisionGroup",constructor:function(a){var b=this;this.solidEntities=[],this.terrain=void 0,this.aabb=new platypus.AABB(this.owner.x,this.owner.y),this.prevAABB=new platypus.AABB(this.owner.x,this.owner.y),platypus.Vector.assign(this.owner,"position","x","y","z"),platypus.Vector.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.collisionGroup=this.owner.collisionGroup={getAllEntities:function(){var a=0,c=0,d=null;for(a=0;a<b.solidEntities.length;a++)d=b.solidEntities[a],c+=d!==b.owner&&d.collisionGroup?d.collisionGroup.getAllEntities():1;return c},getSize:function(){return b.solidEntities.length},getCollisionTypes:function(){return b.getCollisionTypes()},getSolidCollisions:function(){return b.getSolidCollisions()},getAABB:function(a){return b.getAABB(a)},getPreviousAABB:function(a){return b.getPreviousAABB(a)},getShapes:function(a){return b.getShapes(a)},getPrevShapes:function(a){return b.getPrevShapes(a)},prepareCollision:function(a,c){return b.prepareCollision(a,c)},relocateEntity:function(a,c){return b.relocateEntity(a,c)},movePreviousX:function(a){return b.movePreviousX(a)},getSolidEntities:function(){return b.solidEntities},jumpThrough:!1}},events:{"child-entity-added":function(a){this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"relocate-entity":function(){this.owner.previousPosition.set(this.owner.position),this.updateAABB()}},methods:{addCollisionEntity:function(a){var b=0,c=a.collisionTypes;if(c){for(b=0;b<c.length;b++)a.solidCollisions[c[b]].length&&!a.immobile&&(this.solidEntities[this.solidEntities.length]=a);this.updateAABB()}},removeCollisionEntity:function(a){var b=0,c=0,d=a.collisionTypes;if(d){for(c=0;c<d.length;c++)if(a.solidCollisions[d[c]].length)for(b in this.solidEntities)if(this.solidEntities[b]===a){this.solidEntities.splice(b,1);break}this.updateAABB()}},getCollisionTypes:function(){var b=0,c=null,d=[];for(b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),d=a(d,c.getCollisionTypes());return d},getSolidCollisions:function(){var b=0,c="",d=null,e={},f=null;for(b=0;b<this.solidEntities.length;b++){d=this.solidEntities[b],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),f=d.getSolidCollisions();for(c in f)f.hasOwnProperty(c)&&(e[c]=a(e[c]||[],f[c]))}return e},getAABB:function(a){var b=0,c=null,d=null;if(a){for(c=new platypus.AABB,b=0;b<this.solidEntities.length;b++)d=this.solidEntities[b],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),c.include(d.getAABB(a));return c}return this.aabb},getPreviousAABB:function(a){var b=0,c=null,d=null;if(a){for(c=new platypus.AABB,b=0;b<this.solidEntities.length;b++)d=this.solidEntities[b],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),c.include(d.getPreviousAABB(a));return c}return this.prevAABB},updateAABB:function(){var a=0;for(this.aabb.reset(),a=0;a<this.solidEntities.length;a++)this.aabb.include(this.solidEntities[a]!==this.owner&&this.solidEntities[a].getCollisionGroupAABB?this.solidEntities[a].getCollisionGroupAABB():this.solidEntities[a].getAABB())},getShapes:function(a){var b=0,c=null,d=[],e=null;for(b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),e=c.getShapes(a),e&&(d=d.concat(e));return d},getPrevShapes:function(a){var b=0,c=null,d=null,e=[];for(b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),d=c.getPrevShapes(a),d&&(e=e.concat(d));return e},prepareCollision:function(a,b){var c=0,d=null,e=0,f=0;for(c=0;c<this.solidEntities.length;c++)d=this.solidEntities[c],d.saveDX=d.x-d.previousX,d.saveDY=d.y-d.previousY,e=d.saveOX=this.owner.previousX-d.previousX,f=d.saveOY=this.owner.previousY-d.previousY,d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),d.prepareCollision(a-e,b-f)},movePreviousX:function(a){var b=null,c=0,d=0;for(d=0;d<this.solidEntities.length;d++)b=this.solidEntities[d],c=b.saveOX,b!==this.owner&&b.collisionGroup&&(b=b.collisionGroup),b.movePreviousX(a-c)},relocateEntity:function(a,b){var c=null,d=null,e=0;for(this.owner.saveDX-=a.x-this.owner.previousX,this.owner.saveDY-=a.y-this.owner.previousY,e=0;e<b.xCount;e++)if(b.getXEntry(e).thisShape.owner===this.owner){this.owner.saveDX=0;break}for(e=0;e<b.yCount;e++)if(b.getYEntry(e).thisShape.owner===this.owner){this.owner.saveDY=0;break}for(e=0;e<this.solidEntities.length;e++)c=d=this.solidEntities[e],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),c.relocateEntity(new platypus.Vector(a.x-d.saveOX,a.y-d.saveOY),b),d.x+=d.saveDX,d.y+=d.saveDY,d!==this.owner&&(d.x+=this.owner.saveDX,d.y+=this.owner.saveDY)},destroy:function(){this.solidEntities.length=0}},publicMethods:{getCollisionGroupAABB:function(){return this.getAABB()},getWorldEntities:function(){return this.owner.parent.getWorldEntities()},getWorldTerrain:function(){return this.owner.parent.getWorldTerrain()}}})}(),function(){"use strict";var a=[],b=0,c=[],d=function(a,b){return-1>a?(a=Math.abs(a)-2,b[a]):a},e=function(a,b,c,d,e){var f=0,g=0,h=[];for(g=0;e>g;g++)for(h[g]=[],f=0;d>f;f++)h[g][f]=a[b+f][c+g];return h},f=function(a,b,c,d,e){var f=0,g=0,h=[];for(g=0;e>g;g++)for(h[g]=[],f=0;d>f;f++)h[g][f]=a[b+f][c+g],a[b+f][c+g]=-1;return h},g=function(a,b,c,d,e,f){var g=0,h=0;for(h=0;f>h;h++)for(g=0;e>g;g++)a[c+g][d+h]=b[h][g];return a},h={diagonal:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-5,-4,-3,-2];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+i][c+j]=d(h[i][j],k);return a},"diagonal-inverse":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-3,-2,-5,-4];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+g-j-1]=d(h[i][j],k);return a},horizontal:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-2,-5,-4,-3];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+j]=d(h[j][i],k);return a},vertical:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-4,-3,-2,-5];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+i][c+g-j-1]=d(h[j][i],k);return a},"rotate-90":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-3,-4,-5,-2];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+g-j-1][c+i]=d(h[j][i],k);return a},"rotate-180":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-4,-5,-2,-3];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+g-j-1]=d(h[j][i],k);return a},"rotate-270":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-5,-2,-3,-4];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+j][c+f-i-1]=d(h[j][i],k);return a},translate:function(a,b,c,d,e,g,h){var i=f(a,b,c,d,e),j=0,k=0;for(k=0;e>k;k++)for(j=0;d>j;j++)a[b+j+g][c+k+h]=i[k][j];return a}};return platypus.createComponentClass({id:"CollisionTiles",publicProperties:{collisionMap:[],tileWidth:10,tileHeight:10},constructor:function(a){this.tileHalfWidth=this.tileWidth/2,this.tileHalfHeight=this.tileHeight/2},events:{transform:function(a){this.transform(a)},translate:function(a){this.translate(a)}},methods:{getShape:function(c,d,e){var f=null;return b<a.length?(f=a[b],b+=1,f.update(d*this.tileWidth+this.tileHalfWidth,e*this.tileHeight+this.tileHalfHeight)):(a.push(new platypus.CollisionShape(null,{x:d*this.tileWidth+this.tileHalfWidth,y:e*this.tileHeight+this.tileHalfHeight,type:"rectangle",width:this.tileWidth,height:this.tileHeight},"tiles")),f=a[b]),f},addShape:function(a,b,c,d){if(this.collisionMap[c][d]>-1)a.push(this.getShape(b,c,d));else if(this.collisionMap[c][d]<-1)switch(this.collisionMap[c][d]){case-2:b.bottom<=d*this.tileHeight&&a.push(this.getShape(b,c,d));break;case-3:b.left>=(c+1)*this.tileWidth&&a.push(this.getShape(b,c,d));break;case-4:b.top>=(d+1)*this.tileHeight&&a.push(this.getShape(b,c,d));break;case-5:b.right<=c*this.tileWidth&&a.push(this.getShape(b,c,d))}return a}},publicMethods:{getAABB:function(){return{left:0,top:0,right:this.tileWidth*this.collisionMap.length,bottom:this.tileHeight*this.collisionMap.length[0]}},isTile:function(a,b){return!(0>a||0>b||a>=this.collisionMap.length||b>=this.collisionMap[0].length||-1===this.collisionMap[a][b])},getTileShapes:function(a,d){var e=Math.max(Math.floor(a.left/this.tileWidth),0),f=Math.max(Math.floor(a.top/this.tileHeight),0),g=Math.min(Math.ceil(a.right/this.tileWidth),this.collisionMap.length),h=Math.min(Math.ceil(a.bottom/this.tileHeight),this.collisionMap[0].length),i=0,j=0,k=c;for(c.length=0,b=0,i=e;g>i;i++)for(j=f;h>j;j++)this.addShape(k,d,i,j);return k},transform:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.collisionMap[0].length,f=b.height||this.collisionMap.length,g=b.type||"horizontal";return h[g]?h[g](this.collisionMap,c,d,e,f):null},translate:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.collisionMap[0].length,f=b.height||this.collisionMap.length,g=b.dx||0,i=b.dy||0;return h.translate(this.collisionMap,c,d,e,f,g,i)},getCollisionMatrix:function(a,b,c,d){return e(this.collisionMap,a,b,c,d)},setCollisionMatrix:function(a,b,c,d,e){return g(this.collisionMap,a,b,c,d,e)}}})}(),function(){"use strict";var a=function(a,b){return function(){setTimeout(function(){var c=0,d=0;if(a.remove)if("string"==typeof a.remove)for(c=b.components.length-1;c>-1;c--)b.components[c].type===a.remove&&b.removeComponent(b.components[c]);else for(c=0;c<a.remove.length;c++)for(d=b.components.length-1;d>-1;d--)b.components[d].type===a.remove[c]&&b.removeComponent(b.components[d]);if(a.add)if(Array.isArray(a.add))for(c=0;c<a.add.length;c++)b.addComponent(new platypus.components[a.add[c].type](b,a.add[c]));else b.addComponent(new platypus.components[a.add.type](b,a.add));b.parent&&b.parent.triggerEvent("child-entity-updated",b)},1)}};return platypus.createComponentClass({id:"ComponentSwitcher",properties:{componentMap:null},constructor:function(b){var c="";if(this.componentMap)for(c in this.componentMap)this.componentMap.hasOwnProperty(c)&&this.addEventListener(c,a(this.componentMap[c],this.owner))}})}(),function(){"use strict";return platypus.createComponentClass({id:"Counter",publicProperties:{total:0},constructor:function(a){this.count=0,this.lastTotal=0,this.lastCount=0},events:{"handle-logic":function(){var a="",b=!1;this.total!==this.lastTotal&&(this.lastTotal=this.total,b=!0),this.count!==this.lastCount&&(this.lastCount=this.count,b=!0),b&&(a=this.total?String(this.count)+"/"+String(this.total):String(this.count),this.owner.triggerEvent("update-content",{text:a}))},"change-total":function(a){this.total=a},"change-count":function(a){this.count=a},"increment-count":function(){this.count+=1}}})}(),function(){"use strict";var a=function(a){return function(b,c){this.triggerOnChildren(a,b,c)}};return platypus.createComponentClass({id:"EntityContainer",constructor:function(a){var b=this,c="";if(this.entities=[],this.definedEntities=null,a.entities&&this.owner.entities?this.definedEntities=a.entities.concat(this.owner.entities):this.definedEntities=a.entities||this.owner.entities||null,this.owner.entities=b.entities,this.childEvents=[],a.childEvents)for(c in a.childEvents)a.childEvents.hasOwnProperty(c)&&this.addNewPublicEvent(a.childEvents[c]);this.addNewPrivateEvent("peer-entity-added"),this.addNewPrivateEvent("peer-entity-removed")},events:{load:function(){var a=0,b=this.definedEntities;if(this.definedEntities=null,b)for(a=0;a<b.length;a++)this.addEntity(b[a]);
},"add-entity":function(a){this.addEntity(a)},"remove-entity":function(a){this.removeEntity(a)},"child-entity-updated":function(a){this.updateChildEventListeners(a)}},methods:{addNewPublicEvent:function(b){var c=0;for(this.addNewPrivateEvent(b),c=0;c<this.childEvents.length;c++)if(this.childEvents[c]===b)return!1;this.childEvents.push(b),this.addEventListener(b,a(b))},addNewPrivateEvent:function(a){var b=0,c=0;if(this.messages[a])return!1;for(this.messages[a]=[],b=0;b<this.entities.length;b++)if(this.entities[b].messages[a])for(c=0;c<this.entities[b].messages[a].length;c++)this.addChildEventListener(this.entities[b],a,this.entities[b].messages[a][c].callback,this.entities[b].messages[a][c].scope)},updateChildEventListeners:function(a){this.removeChildEventListeners(a),this.addChildEventListeners(a)},addChildEventListeners:function(a){var b=0,c="";for(c in this.messages)if(this.messages.hasOwnProperty(c)&&a.messages[c])for(b=0;b<a.messages[c].length;b++)this.addChildEventListener(a,c,a.messages[c][b].callback,a.messages[c][b].scope)},removeChildEventListeners:function(a){var b=0,c=null,d=null,e=null;if(a.containerListener){for(c=a.containerListener.events,d=a.containerListener.messages,e=a.containerListener.scopes,b=0;b<c.length;b++)this.removeChildEventListener(a,c[b],d[b],e[b]);a.containerListener=null}},addChildEventListener:function(a,b,c,d){a.containerListener||(a.containerListener={events:[],messages:[],scopes:[]}),a.containerListener.events.push(b),a.containerListener.messages.push(c),a.containerListener.scopes.push(d),this.bind(b,c,d)},removeChildEventListener:function(a,b,c,d){var e=0,f=a.containerListener.events,g=a.containerListener.messages,h=a.containerListener.scopes;for(e=0;e<f.length;e++)f[e]!==b||c&&g[e]!==c||d&&h[e]!==d||this.unbind(b,g[e],h[e])},destroy:function(){var a=0;for(a=0;a<this.entities.length;a++)this.removeChildEventListeners(this.entities[a]),this.entities[a].destroy();this.entities.length=0}},publicMethods:{getEntityById:function(a){var b=0,c=null;for(b=0;b<this.entities.length;b++){if(this.entities[b].id===a)return this.entities[b];if(this.entities[b].getEntityById&&(c=this.entities[b].getEntityById(a)))return c}return void 0},getEntitiesByType:function(a){var b=0,c=null,d=[];for(b=0;b<this.entities.length;b++)this.entities[b].type===a&&d.push(this.entities[b]),this.entities[b].getEntitiesByType&&(c=this.entities[b].getEntitiesByType(a),c&&(d=d.concat(c)));return d},addEntity:function(a){var b=null,c=0;for(a instanceof platypus.Entity?b=a:(b=new platypus.Entity(a.id?a:platypus.game.settings.entities[a.type],a),this.owner.triggerEvent("entity-created",b)),b.parent=this.owner,b.triggerEvent("adopted",b),c=0;c<this.entities.length&&b.triggerEvent("peer-entity-added",this.entities[c]);c++);return this.triggerEventOnChildren("peer-entity-added",b),this.addChildEventListeners(b),this.entities.push(b),this.owner.triggerEvent("child-entity-added",b),b},removeEntity:function(a){var b=0;for(b=0;b<this.entities.length;b++)if(this.entities[b]===a)return this.removeChildEventListeners(a),this.entities.splice(b,1),this.triggerEventOnChildren("peer-entity-removed",a),this.owner.triggerEvent("child-entity-removed",a),a.destroy(),a.parent=null,a;return!1},triggerEventOnChildren:function(a,b,c){return this.messages[a]||this.addNewPrivateEvent(a),this.triggerEvent(a,b,c)},triggerOnChildren:function(a,b,c){return this.messages[a]||this.addNewPrivateEvent(a),this.trigger(a,b,c)}}},platypus.Messenger)}(),function(){"use strict";var a=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},b=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=0,g=2*Math.PI;return c?(f=Math.acos(d/c),0>e&&(f=g-f),f):f},c=[null,null,null,null,["east","south","west","north"],null,null,null,["east","southeast","south","southwest","west","northwest","north","northeast"],null,null,null,null,null,null,null,["east","east-southeast","southeast","south-southeast","south","south-southwest","southwest","west-southwest","west","west-northwest","northwest","north-northwest","north","north-northeast","northeast","east-northeast"]],d=["left-button","middle-button","right-button"],e=function(a,b){this.event=a,this.trigger=b,this.filters=!1,this.current=!1,this.last=!1,this.state=!1,this.stateSummary={pressed:!1,released:!1,triggered:!1,over:!1}},f=function(a){var b=0;return Array.isArray(a)?function(c){for(b=0;b<a.length;b++)a[b].state=!1}:function(b){a.state=!1}},g=function(a){var b=0;return Array.isArray(a)?function(c){for(b=0;b<a.length;b++)a[b].current=!0,a[b].state=!0,c&&"undefined"!=typeof c.over&&(a[b].over=c.over)}:function(b){a.current=!0,a.state=!0,b&&"undefined"!=typeof b.over&&(a.over=b.over)}},h=function(a,b,c,d){var f=a[b];return f||(f=a[b]=new e(b,c)),d&&f.setFilter(d),f},i=e.prototype;return i.update=function(){var a=0;if(this.current||this.last)if(this.stateSummary.pressed=this.current,this.stateSummary.released=!this.current&&this.last,this.stateSummary.triggered=this.current&&!this.last,this.stateSummary.over=this.over,this.filters)for(a=0;a<this.filters.length;a++)this.stateSummary[this.filters[a]]&&this.trigger(this.event,this.stateSummary);else this.trigger(this.event,this.stateSummary);this.last=this.current,this.current=this.state},i.setFilter=function(a){return this.filters?this.filters.push(a):this.filters=[a],this},i.isPressed=function(){return this.current},i.isTriggered=function(){return this.current&&!this.last},i.isReleased=function(){return!this.current&&this.last},platypus.createComponentClass({id:"EntityController",constructor:function(a){var b=0,c=0,d=0,e="",i=null,j=this,k=function(a,b){j.paused||j.owner.trigger(a,b)};if(this.paused=a.paused||!1,a&&a.controlMap){this.owner.controlMap=a.controlMap,this.actions={};for(e in a.controlMap)if(a.controlMap.hasOwnProperty(e)){if("string"==typeof a.controlMap[e])i=h(this.actions,a.controlMap[e],k);else if(i=[],Array.isArray(a.controlMap[e]))for(b=0;b<a.controlMap[e].length;b++)i[b]=h(this.actions,a.controlMap[e][b],k);else{d=0;for(c in a.controlMap[e])if(a.controlMap[e].hasOwnProperty(c))if("string"==typeof a.controlMap[e][c])i[d]=h(this.actions,a.controlMap[e][c],k,c),d+=1;else for(b=0;b<a.controlMap[e][c].length;b++)i[d]=h(this.actions,a.controlMap[e][c][b],k,c),d+=1}this.addEventListener(e+":up",f(i)),this.addEventListener(e+":down",g(i))}}a.joystick&&(this.joystick={},this.joystick.directions=a.joystick.directions||4,this.joystick.handleEdge=a.joystick.handleEdge||!1,this.joystick.innerRadius=a.joystick.innerRadius||0,this.joystick.outerRadius=a.joystick.outerRadius||1/0)},events:{"handle-controller":function(){var a="";if(this.actions)for(a in this.actions)this.actions.hasOwnProperty(a)&&this.actions[a].update()},mousedown:function(a){this.owner.trigger("mouse:"+d[a.event.button||0]+":down",a.event),this.joystick&&(this.owner.trigger("joystick:down",a.event),this.handleJoy(a))},pressup:function(a){this.owner.trigger("mouse:"+d[a.event.button||0]+":up",a.event),this.joystick&&(this.owner.trigger("joystick:up",a.event),this.handleJoy(a))},pressmove:function(a){this.actions["mouse:left-button"]&&this.actions["mouse:left-button"].over!==a.over&&(this.actions["mouse:left-button"].over=a.over),this.actions["mouse:middle-button"]&&this.actions["mouse:middle-button"].over!==a.over&&(this.actions["mouse:middle-button"].over=a.over),this.actions["mouse:right-button"]&&this.actions["mouse:right-button"].over!==a.over&&(this.actions["mouse:right-button"].over=a.over),this.joystick&&this.handleJoy(a)},"pause-controls":function(){this.paused=!0},"unpause-controls":function(){this.paused=!1}},methods:{handleJoy:function(d){var e=Math.PI/(this.joystick.directions/2),f=a(this.owner,d),g=0,h="",i="";f>this.joystick.outerRadius||f<this.joystick.innerRadius||this.paused||(g=b(this.owner,d,f),h=c[this.joystick.directions][Math.floor((g+e/2)%(2*Math.PI)/e)],this.joystick.handleEdge&&(e=Math.PI/this.joystick.directions,i=c[2*this.joystick.directions][Math.floor((g+e/2)%(2*Math.PI)/e)],i!==h&&this.owner.trigger(i.replace(h,"").replace("-",""),d)),this.owner.trigger(h,d),this.owner.trigger("joystick-orientation",g))}}})}(),function(){"use strict";var a=!1,b=null,c=function(){a=!1,b.className=b.className.replace(/ full-screen/g,""),platypus.game.bindings.resize.callback()},d=function(){a?(document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen&&document.exitFullscreen(),c()):(a=!0,b.className+=" full-screen",b.webkitRequestFullscreen?(!platypus.supports.safari||platypus.supports.chrome)&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):b.mozRequestFullScreen?b.mozRequestFullScreen():b.requestFullscreen&&b.requestFullscreen(),platypus.game.bindings.resize.callback())};return document.addEventListener("fullscreenchange",function(a){document.fullscreenElement||c()}),document.addEventListener("webkitfullscreenchange",function(a){document.webkitFullscreenElement||c()}),document.addEventListener("mozfullscreenchange",function(a){document.mozFullScreenElement||c()}),platypus.createComponentClass({id:"Fullscreen",constructor:function(a){b||(b=platypus.game.containerElement)},events:{"toggle-fullscreen":d}})}(),function(){"use strict";var a={entity:null,type:null,x:0,y:0,hitType:null,myType:null},b=new platypus.CollisionDataContainer,c=function(a,b){return a.left>=b.right||a.right<=b.left||a.top>=b.bottom||a.bottom<=b.top?!1:!0},d=function(a,b){var c=0,d=0,e=null,f=null,g=0,h=0,i=null,j=0;if("rectangle"===a.type&&"rectangle"===b.type)return!0;if("circle"===a.type&&"circle"===b.type){if(c=Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),d=Math.pow(a.radius+b.radius,2),d>=c)return!0}else if("circle"===a.type&&"rectangle"===b.type||"rectangle"===a.type&&"circle"===b.type){if("circle"===a.type?(e=a,f=b):(e=b,f=a),i=f.getAABB(),g=Math.abs(e.x-f.x),h=Math.abs(e.y-f.y),g>=i.halfWidth+e.radius)return!1;if(h>=i.halfHeight+e.radius)return!1;if(g<i.halfWidth)return!0;if(h<i.halfHeight)return!0;if(j=Math.pow(g-i.halfWidth,2)+Math.pow(h-i.halfHeight,2),j<Math.pow(e.radius,2))return!0}return!1};return platypus.createComponentClass({id:"HandlerCollision",constructor:function(a){this.entitiesByType={},this.entitiesByTypeLive={},this.allEntities=[],this.solidEntitiesLive=[],this.softEntitiesLive=[],this.allEntitiesLive=[],this.groupsLive=[],this.nonColliders=[],this.terrain=void 0,this.aabb=new platypus.AABB(this.owner.x,this.owner.y),this.prevAABB=new platypus.AABB(this.owner.x,this.owner.y),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.updateLiveList=!0,this.cameraLogicAABB=new platypus.AABB(0,0),this.cameraCollisionAABB=new platypus.AABB(0,0),this.timeElapsed={name:"Col",time:0}},events:{"child-entity-added":function(a){a.collideOff||this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"check-collision-group":function(a){var b=(new Date).getTime();a.camera&&this.checkCamera(a.camera),this.timeElapsed.name="Col-Cam",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time,this.prepareCollisions(a),this.timeElapsed.name="Col-Prep",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time,this.checkGroupCollisions(),this.timeElapsed.name="Col-Group",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time,this.checkSolidCollisions(),this.timeElapsed.name="Col-Solid",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time,this.resolveNonCollisions(a),this.timeElapsed.name="Col-None",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time,this.checkSoftCollisions(a),this.timeElapsed.name="Col-Soft",this.timeElapsed.time=(new Date).getTime()-b,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),b+=this.timeElapsed.time}},methods:{addCollisionEntity:function(a){var b=0,c=a.collisionTypes;if("tile-layer"===a.type||"collision-layer"===a.type)this.terrain=a,this.updateLiveList=!0;else if(c){for(b=0;b<c.length;b++)this.entitiesByType[c[b]]||(this.entitiesByType[c[b]]=[],this.entitiesByTypeLive[c[b]]=[]),this.entitiesByType[c[b]][this.entitiesByType[c[b]].length]=a;a.immobile||(this.allEntities[this.allEntities.length]=a),this.updateLiveList=!0}},removeCollisionEntity:function(a){var b=0,c=0,d=0,e=a.collisionTypes;if(e){for(c=0;c<e.length;c++)for(b in this.entitiesByType[e[c]])if(this.entitiesByType[e[c]][b]===a){this.entitiesByType[e[c]].splice(b,1);break}if(!a.immobile)for(d=0;d<this.allEntities.length;d++)if(this.allEntities[d]===a){this.allEntities.splice(d,1);break}this.updateLiveList=!0}},checkCamera:function(){var a=function(a,b){return a.collisionGroup.getAllEntities()-b.collisionGroup.getAllEntities()};return function(b,d){var e=0,f=0,g=0,h=null,i=null,j=null,k=null,l=null,m=b.width,n=b.height,o=b.left+m/2,p=b.top+n/2,q=b.buffer,r=null,s=null,t=c,u=this.cameraLogicAABB,v=this.cameraCollisionAABB,w=null;if(m+=2*q,n+=2*q,this.updateLiveList||!u.matches(o,p,m,n)){for(u.setAll(o,p,m,n),this.updateLiveList=!1,i=this.allEntitiesLive,i.length=0,k=this.solidEntitiesLive,k.length=0,j=this.softEntitiesLive,j.length=0,l=this.groupsLive,l.length=0,g=this.allEntities.length,e=0;g>e;e++)if(s=this.allEntities[e],s.alwaysOn||s.checkCollision||t(s.getAABB(),u)){if(s.checkCollision=!1,i[i.length]=s,w=s.collisionTypes,s!==this.owner)for(f=0;f<w.length;f++)if(s.solidCollisions[w[f]].length){k[k.length]=s;break}for(f=0;f<w.length;f++)if(s.softCollisions[w[f]].length){j[j.length]=s;break}s.collisionGroup&&l.push(s)}l.sort(a),v.setAll(o,p,m+2*q,n+2*q);for(e in this.entitiesByType)if(this.entitiesByType.hasOwnProperty(e))for(r=this.entitiesByType[e],h=this.entitiesByTypeLive[e],h.length=0,g=r.length,f=0;g>f;f++)s=r[f],(s.alwaysOn||t(s.getAABB(),v))&&(h[h.length]=s)}}}(),prepareCollisions:function(a){var b=0,c=null;for(this.nonColliders.length=0,b=this.allEntitiesLive.length-1;b>-1;b--)c=this.allEntitiesLive[b],c.triggerEvent("prepare-for-collision",a),c.collides||this.nonColliders.push(c)},resolveNonCollisions:function(a){var b=0,c=null,d={position:new platypus.Vector,relative:!1};for(b=this.nonColliders.length-1;b>-1;b--)c=this.nonColliders[b],d.position.set(c.position),c.trigger("relocate-entity",d)},checkGroupCollisions:function(){var c=function(b,c,d,e,f,g,h,i){a.entity=c,a.myType=d,a.type=e,a.x=f,a.y=g,a.direction=i,a.hitType=h,b.triggerEvent("hit-by-"+e,a),c&&(a.entity=b,a.type=d,a.myType=e,a.x=-f,a.y=-g,a.direction=i.getInverse(),a.hitType=h,c.triggerEvent("hit-by-"+d,a))};return function(){var a=0,d=0,e=this.groupsLive,f=new platypus.Vector,g=null;for(a=e.length-1;a>-1;a--)if(e[a].collisionGroup.getSize()>1){for(b.reset(),f.set(0,0,0),f=this.checkSolidEntityCollision(e[a],e[a].collisionGroup,b,f),d=0;d<b.xCount;d++)g=b.getXEntry(d),c(g.thisShape.owner,g.thatShape.owner,g.thisShape.collisionType,g.thatShape.collisionType,g.direction,0,"solid",g.vector);for(d=0;d<b.yCount;d++)g=b.getYEntry(d),c(g.thisShape.owner,g.thatShape.owner,g.thisShape.collisionType,g.thatShape.collisionType,0,g.direction,"solid",g.vector)}}}(),checkSolidCollisions:function(){var c=function(b,c,d,e,f,g,h,i){a.entity=c,a.myType=d,a.type=e,a.x=f,a.y=g,a.direction=i,a.hitType=h,b.triggerEvent("hit-by-"+e,a),c&&(a.entity=b,a.type=d,a.myType=e,a.x=-f,a.y=-g,a.direction=i.getInverse(),a.hitType=h,c.triggerEvent("hit-by-"+d,a))};return function(){var a=0,d=0,e=null,f=this.solidEntitiesLive,g=new platypus.Vector;for(a=f.length-1;a>-1;a--){for(b.reset(),g.set(0,0,0),g=this.checkSolidEntityCollision(f[a],f[a],b,g),d=0;d<b.xCount;d++)e=b.getXEntry(d),c(e.thisShape.owner,e.thatShape.owner,e.thisShape.collisionType,e.thatShape.collisionType,e.direction,0,"solid",e.vector);for(d=0;d<b.yCount;d++)e=b.getYEntry(d),c(e.thisShape.owner,e.thatShape.owner,e.thisShape.collisionType,e.thatShape.collisionType,0,e.direction,"solid",e.vector)}}}(),checkSolidEntityCollision:function(a,b,c,d){var e=0,f=0,g=0,h=d,i=a.x-a.previousX,j=a.y-a.previousY,k=null,l=0,m=0,n=1/0,o=1/0,p=b.getCollisionTypes(),q=!1;if(b.getSolidEntities&&(q=b.getSolidEntities()),h.set(a.position),i||j){if(a.bullet){for(g=0;g<p.length;g++)k=b.getAABB(p[g]),n=Math.min(n,k.width),o=Math.min(o,k.height);e=Math.ceil(Math.max(Math.abs(i)/n,Math.abs(j)/o)),e=Math.min(e,100),l=i/e,m=j/e}else e=1,l=i,m=j;for(f=0;e>f;f++){if(b.prepareCollision(a.previousX+l,a.previousY+m),h.set(a.position),h=this.processCollisionStep(a,b,q,c,h,l,m,p),h.x===a.previousX&&h.y===a.previousY){b.relocateEntity(h,c);break}b.relocateEntity(h,c)}}return h},processCollisionStep:function(){var a=new platypus.AABB,b=function(a,b,c,d,e){var f=0,g=c.getAABB(d);if(c===a)return!1;if(c.jumpThrough&&b.bottom>g.top)return!1;if(a.jumpThrough&&g.bottom>b.top)return!1;if(e)for(f=0;f<e.length;f++)if(c===e[f])return!1;return!0};return function(d,e,f,g,h,i,j,k){var l=0,m=0,n=0,o=0,p=!1,q=[],r=null,s=null,t=null,u=null,v="",w=null,x=this.getWorldEntities(),y=null,z=this.getWorldTerrain(),A=e.getSolidCollisions();for(l=0;l<k.length;l++)for(q[l]=[],t=k[l],r=e.getPreviousAABB(t),s=e.getAABB(t),a.reset(),a.include(s),a.include(r),m=0;m<A[t].length;m++)if(v=A[t][m],x[v]){for(y=x[v],n=0;n<y.length;n++)if(u=y[n],b(d,r,u,v,f)&&c(a,u.getAABB(v))){for(w=u.getShapes(v),o=0;o<w.length;o++)q[l].push(w[o]);p=!0}}else if(z&&"tiles"===v)for(w=z.getTileShapes(a,r),o=0;o<w.length;o++)q[l].push(w[o]),p=!0;return p&&(h=this.resolveCollisionPosition(d,e,h,q,g,k,i,j)),h}}(),resolveCollisionPosition:function(){var a=new platypus.CollisionData;return function(b,c,d,e,f,g,h,i){var j=0;if(0!==h)for(j=0;j<g.length;j++)a.clear(),a=this.findMinAxisMovement(b,c,g[j],"x",e[j],a),a.occurred&&f.tryToAddX(a);if(f.xCount>0?(a.copy(f.getXEntry(0)),d.x=b.previousX+a.deltaMovement*a.direction):d.x=b.x,c.movePreviousX(d.x),0!==i)for(j=0;j<g.length;j++)a.clear(),a=this.findMinAxisMovement(b,c,g[j],"y",e[j],a),a.occurred&&f.tryToAddY(a);return f.yCount>0?(a.copy(f.getYEntry(0)),d.y=b.previousY+a.deltaMovement*a.direction):d.y=b.y,d}}(),findMinAxisMovement:function(){var a=new platypus.CollisionData;return function(b,c,d,e,f,g){var h=0,i=c.getShapes(d),j=c.getPrevShapes(d);for(h=0;h<i.length;h++)a.clear(),a=this.findMinShapeMovementCollision(j[h],i[h],e,f,a),a.occurred&&!g.occurred?g.copy(a):a.occurred&&g.occurred&&a.deltaMovement<g.deltaMovement&&g.copy(a);return g}}(),findMinShapeMovementCollision:function(){var a=function(a,b,c,d,e,f,g){a.occurred=!0,a.direction=b,a.position=c,a.deltaMovement=Math.abs(c-d),a.aABB=f.getAABB(),a.thisShape=e,a.thatShape=f,a.vector=g.copy()},b=function(){var a=new platypus.Vector,b={position:0,contactVector:a},c=function(a,b){return Math.sqrt(Math.pow(b,2)-Math.pow(a,2))},d=function(a,b,c){var d=a-b;return d-d/Math.abs(d)*c},e=function(a,b,c){return"x"===a?c.halfWidth+b.halfWidth:"y"===a?c.halfHeight+b.halfHeight:void 0},f=function(b,e,f,g,h){var i=0;return"x"===b?e.y>=f.aABB.top&&e.y<=f.aABB.bottom?f.aABB.halfWidth+e.radius:(a.y=d(e.y,f.y,f.aABB.halfHeight),i=f.aABB.halfWidth+c(a.y,e.radius),g===e?(a.x=-d(e.x-h*i,f.x,f.aABB.halfWidth)/2,a.y=-a.y):a.x=d(e.x,f.x-h*i,f.aABB.halfWidth)/2,a.normalize(),i):"y"===b?e.x>=f.aABB.left&&e.x<=f.aABB.right?f.aABB.halfHeight+e.radius:(a.x=d(e.x,f.x,f.aABB.halfWidth),i=f.aABB.halfHeight+c(a.x,e.radius),g===e?(a.x=-a.x,a.y=-d(e.y-h*i,f.y,f.aABB.halfWidth)/2):a.y=d(e.y,f.y-h*i,f.aABB.halfWidth)/2,a.normalize(),i):void 0},g=function(a,b,d){return"x"===a?c(b.y-d.y,b.radius+d.radius):"y"===a?c(b.x-d.x,b.radius+d.radius):void 0};return function(c,d,h,i){if("rectangle"===h.type){if("rectangle"===i.type)return b.position=i[c]-d*e(c,h.getAABB(),i.getAABB()),a.x=0,a.y=0,a[c]=d,b;if("circle"===i.type)return a.x=0,a.y=0,a[c]=d,b.position=i[c]-d*f(c,i,h,h,d),b}else if("circle"===h.type){if("rectangle"===i.type)return a.x=0,a.y=0,a[c]=d,b.position=i[c]-d*f(c,h,i,h,d),b;if("circle"===i.type)return b.position=i[c]-d*g(c,h,i),a.x=i.x-h.x,a.y=i.y-h.y,a[c]=i[c]-b.position,a.normalize(),b}}}();return function(e,f,g,h,i){var j=0,k=e[g],l=f[g],m=e,n=l>k?1:-1,o=l,p=null,q=l;if(k!==l)for("x"===g?m.moveX(l):"y"===g&&m.moveY(l),j=0;j<h.length;j++)o=l,c(m.getAABB(),h[j].getAABB())&&d(m,h[j])&&(p=b(g,n,m,h[j]),o=p.position,n>0?q>o&&(k>o&&(o=k),q=o,a(i,n,q,k,f,h[j],p.contactVector)):o>q&&(o>k&&(o=k),q=o,a(i,n,q,k,f,h[j],p.contactVector)));return i}}(),checkSoftCollisions:function(a){var b=0,c=function(a){return function(b){a.trigger("hit-by-"+b.type,b)}};for(b=0;b<this.softEntitiesLive.length;b++)this.checkEntityForSoftCollisions(this.softEntitiesLive[b],this.getWorldEntities(),c(this.softEntitiesLive[b]))},checkEntityForSoftCollisions:function(b,e,f){var g=null,h=a,i=0,j=0,k=0,l=0,m=0,n=c,o=null,p=null,q=null,r=null,s=null,t=!1;for(h.x=0,h.y=0,i=0;i<b.collisionTypes.length;i++)for(o=b.softCollisions[b.collisionTypes[i]],l=0;l<o.length;l++)if(q=o[l],p=e[q])for(m=0;m<p.length;m++)if(t=!1,g=p[m],g!==b&&n(b.getAABB(b.collisionTypes[i]),g.getAABB(q)))for(r=b.getShapes(b.collisionTypes[i]),s=g.getShapes(q),j=0;j<r.length;j++){for(k=0;k<s.length&&(d(r[j],s[k])&&(h.entity=g,h.type=q,h.myType=b.collisionTypes[i],h.shape=s[k],h.hitType="soft",f(h),t=!0),!t);k++);if(t)break}},destroy:function(){var a="";this.allEntities.length=0,this.allEntitiesLive.length=0,this.softEntitiesLive.length=0,this.solidEntitiesLive.length=0;for(a in this.entitiesByType)this.entitiesByType.hasOwnProperty(a)&&(this.entitiesByType[a].length=0)}},publicMethods:{getWorldEntities:function(){return this.entitiesByTypeLive},getWorldTerrain:function(){return this.terrain},getEntityCollisions:function(a,b){var c=[];return this.checkEntityForSoftCollisions(a,b||this.entitiesByTypeLive,function(a){var b="",d={};for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);c.push(d)}),c}}})}(),function(){"use strict";var a={kc0:"unknown",kc8:"backspace",kc9:"tab",kc12:"numpad-5-shift",kc13:"enter",kc16:"shift",kc17:"ctrl",kc18:"alt",kc19:"pause",kc20:"caps-lock",kc27:"esc",kc32:"space",kc33:"page-up",kc34:"page-down",kc35:"end",kc36:"home",kc37:"left-arrow",kc38:"up-arrow",kc39:"right-arrow",kc40:"down-arrow",kc42:"numpad-multiply",kc43:"numpad-add",kc44:"print-screen",kc45:"insert",kc46:"delete",kc47:"numpad-division",kc48:"0",kc49:"1",kc50:"2",kc51:"3",kc52:"4",kc53:"5",kc54:"6",kc55:"7",kc56:"8",kc57:"9",kc59:"semicolon",kc61:"equals",kc65:"a",kc66:"b",kc67:"c",kc68:"d",kc69:"e",kc70:"f",kc71:"g",kc72:"h",kc73:"i",kc74:"j",kc75:"k",kc76:"l",kc77:"m",kc78:"n",kc79:"o",kc80:"p",kc81:"q",kc82:"r",kc83:"s",kc84:"t",kc85:"u",kc86:"v",kc87:"w",kc88:"x",kc89:"y",kc90:"z",kc91:"left-windows-start",kc92:"right-windows-start",kc93:"windows-menu",kc96:"back-quote",kc106:"numpad-multiply",kc107:"numpad-add",kc109:"numpad-minus",kc110:"numpad-period",kc111:"numpad-division",kc112:"f1",kc113:"f2",kc114:"f3",kc115:"f4",kc116:"f5",kc117:"f6",kc118:"f7",kc119:"f8",kc120:"f9",kc121:"f10",kc122:"f11",kc123:"f12",kc144:"num-lock",kc145:"scroll-lock",kc186:"semicolon",kc187:"equals",kc188:"comma",kc189:"hyphen",kc190:"period",kc191:"forward-slash",kc192:"back-quote",kc219:"open-bracket",kc220:"back-slash",kc221:"close-bracket",kc222:"quote"};return platypus.createComponentClass({id:"HandlerController",constructor:function(a){var b=this;this.callbackKeyUp=null,this.callbackKeyDown=null,platypus.game.settings.debug?(this.callbackKeyDown=function(a){b.keyDown(a)},this.callbackKeyUp=function(a){b.keyUp(a)}):(this.callbackKeyDown=function(a){b.keyDown(a),a.preventDefault()},this.callbackKeyUp=function(a){b.keyUp(a),a.preventDefault()}),window.addEventListener("keydown",this.callbackKeyDown,!0),window.addEventListener("keyup",this.callbackKeyUp,!0)},events:{tick:function(a){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-controller",a)}},methods:{keyDown:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":down",b)},keyUp:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":up",b)},destroy:function(){window.removeEventListener("keydown",this.callbackKeyDown),window.removeEventListener("keyup",this.callbackKeyUp)}}})}(),function(){"use strict";var a=function(a){var b=null,c=!1;for(b in a.state)a.state[b]!==a.lastState[b]&&(a.lastState[b]=a.state[b],c=!0);return c};return platypus.createComponentClass({id:"HandlerLogic",publicProperties:{buffer:-1,stepLength:5,maxStepsPerTick:100},constructor:function(a){this.entities=[],this.activeEntities=this.entities,this.paused=0,this.leftoverTime=0,this.camera={left:0,top:0,width:0,height:0,buffer:this.buffer,active:!1},this.message={delta:this.stepLength,tick:null,camera:this.camera,movers:this.activeEntities},this.timeElapsed={name:"Logic",time:0}},events:{"child-entity-added":function(a){var b=0,c=a.getMessageIds();for(b=0;b<c.length;b++)if("handle-logic"===c[b]||"handle-post-collision-logic"===c[b]){this.entities.push(a),this.updateNeeded=this.camera.active;break}},"child-entity-removed":function(a){var b=0;for(b=this.entities.length-1;b>-1;b--)if(this.entities[b]===a){this.entities.splice(b,1);break}},"pause-logic":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-logic":function(){this.paused=0},"camera-update":function(a){this.camera.left=a.viewport.left,this.camera.top=a.viewport.top,this.camera.width=a.viewport.width,this.camera.height=a.viewport.height,-1===this.camera.buffer&&(this.camera.buffer=this.camera.width/10),this.camera.active=!0,this.updateNeeded=!0},tick:function(b){var c=0,d=0,e=0,f=null,g=(new Date).getTime();if(this.leftoverTime+=b.delta,e=Math.floor(this.leftoverTime/this.stepLength)||1,this.message.delta=this.stepLength,this.leftoverTime=Math.max(this.leftoverTime-e*this.stepLength,0),this.paused>0&&(this.paused-=b.delta,this.paused<0&&(this.paused=0)),!this.paused){for(this.message.tick=b,this.activeEntities===this.entities&&(this.message.movers=this.activeEntities=[]),this.activeEntities.length=0,d=this.entities.length-1;d>-1;d--)f=this.entities[d],(f.alwaysOn||"undefined"==typeof f.x||f.x>=this.camera.left-this.camera.buffer&&f.x<=this.camera.left+this.camera.width+this.camera.buffer&&f.y>=this.camera.top-this.camera.buffer&&f.y<=this.camera.top+this.camera.height+this.camera.buffer)&&this.activeEntities.push(f);for(e=Math.min(e,this.maxStepsPerTick),c=0;e>c;c++){for(this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-ai",this.message),d=this.activeEntities.length-1;d>-1;d--)f=this.activeEntities[d],f.triggerEvent("handle-logic",this.message)&&(f.checkCollision=!0);if(this.timeElapsed.name="Logic",this.timeElapsed.time=(new Date).getTime()-g,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),g+=this.timeElapsed.time,this.owner.triggerEvent("check-collision-group",this.message)){for(this.timeElapsed.name="Collision",this.timeElapsed.time=(new Date).getTime()-g,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),g+=this.timeElapsed.time,d=this.activeEntities.length-1;d>-1;d--)f=this.activeEntities[d],f.triggerEvent("handle-post-collision-logic",this.message),a(f)&&f.triggerEvent("logical-state",f.state);this.timeElapsed.name="Collision Logic",this.timeElapsed.time=(new Date).getTime()-g,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed),g+=this.timeElapsed.time}else for(d=this.activeEntities.length-1;d>-1;d--)f=this.activeEntities[d],a(f)&&f.triggerEvent("logical-state",f.state)}}this.timeElapsed.time=(new Date).getTime()-g,platypus.game.currentScene.trigger("time-elapsed",this.timeElapsed)}}})}(),function(){"use strict";var a=window.devicePixelRatio||1;return platypus.createComponentClass({id:"HandlerRenderCreateJS",constructor:function(a){this.container=new createjs.Container,this.camera={x:0,y:0},a.acceptInput&&(this.click=a.acceptInput.click,this.cameraMovementMovesMouse=a.acceptInput.camera,this.hover=a.acceptInput.hover,(this.click||this.hover)&&(this.addInputs(),this.addEventListener())),this.renderMessage={delta:0,container:this.container}},events:{load:function(){this.owner.triggerEvent("render-world",{world:this.container})},"child-entity-added":function(a){a.triggerEvent("handle-render-load",this.renderMessage)},"pause-render":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-render":function(){this.paused=0},tick:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=null,e=this.renderMessage;if(e.delta=b.delta,this.paused>0&&(this.paused-=b.delta,this.paused<0&&(this.paused=0)),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-render",e),this.container){for(c=this.container.children.length-1;c>-1;c--)d=this.container.children[c],d.visible&&(d.paused&&!this.paused?d.paused=!1:this.paused&&(d.paused=!0));this.container.reorder&&(this.container.reorder=!1,this.container.sortChildren(a))}}}(),"camera-update":function(a){this.camera.x=a.viewport.left,this.camera.y=a.viewport.top,this.moveMouse&&this.moveMouse()}},methods:{addInputs:function(){var b=function(b,c){return function(d){b.owner.trigger(c,{event:d.nativeEvent,cjsEvent:d,x:d.stageX*a/b.container.scaleX+b.camera.x,y:d.stageY*a/b.container.scaleY+b.camera.y,entity:b.owner}),b.cameraMovementMovesMouse&&("mousedown"===c?b.moveMouse=function(){var c=d.stageX*a/b.container.scaleX+b.camera.x,e=d.stageY*a/b.container.scaleY+b.camera.y;b.owner.trigger("pressmove",{event:d.nativeEvent,x:c,y:e,entity:b.owner}),console.log("mousemove: "+c+", "+e)}:"pressup"===c&&(b.moveMouse=null,console.log("mouseup")))}};return function(){var a=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null;this.click&&(a=b(this,"mousedown"),g=b(this,"pressmove"),h=b(this,"pressup"),i=b(this,"click"),j=b(this,"dblclick"),this.container.addEventListener("mousedown",a),this.container.addEventListener("pressmove",g),this.container.addEventListener("pressup",h),this.container.addEventListener("click",i),this.container.addEventListener("dblclick",j)),this.hover&&(c=b(this,"mouseover"),d=b(this,"mouseout"),e=b(this,"rollover"),f=b(this,"rollout"),this.container.addEventListener("mouseover",c),this.container.addEventListener("mouseout",d),this.container.addEventListener("rollover",e),this.container.addEventListener("rollout",f)),this.removeInputListeners=function(){this.click&&(this.container.removeEventListener("mousedown",a),this.container.removeEventListener("pressmove",g),this.container.removeEventListener("pressup",h),this.container.removeEventListener("click",i),this.container.removeEventListener("dblclick",j)),this.hover&&(this.container.removeEventListener("mouseover",c),this.container.removeEventListener("mouseout",d),this.container.removeEventListener("rollover",e),this.container.removeEventListener("rollout",f)),this.removeInputListeners=null}}}(),destroy:function(){this.removeStageListeners&&this.removeStageListeners(),this.container=null}},publicMethods:{getWorldPointFromScreen:function(b){return{x:b.x*a/this.container.scaleX+this.camera.x,y:b.y*a/this.container.scaleY+this.camera.y}}}})}(),function(){"use strict";var a=function(a,b,c,d,e,f){var g=0,h=0,i=0,j=a.slice();if("horizontal"===f){for(h=e-1;h>=0;h--)for(g=h*d,i=0;(h+1)*d>g;g++,i++)j.splice((h+1)*b+i,0,c[g]);return j}return"vertical"===f?a.concat(c):void 0},b=function(a,b,c,d){var e=0,f=0,g=a.slice(),h=null;for(e=0;e<b.length;e++){h={};for(f in b[e])b[e].hasOwnProperty(f)&&(h[f]=b[e][f]);"horizontal"===d?h.x+=c:"vertical"===d&&(h.y+=c),g.push(h)}return g},c=function(c,d,e){var f=0,g=0;for(c.tilewidth||c.tileheight?(c.tilewidth!==d.tilewidth||c.tileheight!==d.tileheight)&&console.warn("Tiled-Loader: Your map has segments with different tile sizes. All tile sizes must match. Segment: "+d):(c.tilewidth=d.tilewidth,
c.tileheight=d.tileheight),"horizontal"===e?0===c.height?c.height=d.height:c.height!==d.height&&console.warn("Tiled-Loader: You are trying to merge segments with different heights. All segments need to have the same height. Level: "+c+" Segment: "+d):"vertical"===e&&(0===c.width?c.width=d.width:c.width!==d.width&&console.warn("Tiled-Loader: You are trying to merge segments with different widths. All segments need to have the same width. Level: "+c+" Segment: "+d)),f=0;f<d.layers.length;f++)if(c.layers[f])c.layers[f].type===d.layers[f].type?c.layers[f].data&&d.layers[f].data?"horizontal"===e?(c.layers[f].data=a(c.layers[f].data,c.width,d.layers[f].data,d.width,c.height,e),c.layers[f].width+=d.width):"vertical"===e&&(c.layers[f].data=a(c.layers[f].data,c.height,d.layers[f].data,d.height,c.width,e),c.layers[f].height+=d.height):c.layers[f].objects&&d.layers[f].objects&&("horizontal"===e?c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.width*c.tilewidth,e):"vertical"===e&&(c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.height*c.tileheight,e))):console.warn("Tiled-Loader: The layers in your level segments do not match. Level: "+c+" Segment: "+d);else{c.layers[f]={};for(g in d.layers[f])d.layers[f].hasOwnProperty(g)&&(c.layers[f][g]=d.layers[f][g])}"horizontal"===e?c.width+=d.width:"vertical"===e&&(c.height+=d.height);for(f in d)d.hasOwnProperty(f)&&!c[f]&&(c[f]=d[f])},d=function(a){var b=0,d=0,e=platypus.game.settings.levels,f={height:0,width:0,layers:[]},g={height:0,width:0,layers:[]},h=a[b].length;for(b=0;b<a.length;b++){for(h!==a[b].length&&console.warn("Tiled-Loader: Your map is not square. Maps must have an equal number of segments in every row."),f={height:0,width:0,layers:[]},d=0;d<a[b].length;d++)"string"==typeof a[b][d]?c(f,e[a[b][d]],"horizontal"):c(f,a[b][d],"horizontal");c(g,f,"vertical")}return g};return platypus.createComponentClass({id:"LevelBuilder",properties:{useUniques:!0},constructor:function(a){this.levelTemplate=this.owner.levelTemplate||a.levelTemplate,this.levelPieces=this.owner.levelPieces||a.levelPieces,this.levelMessage={level:null,persistentData:null}},events:{"scene-loaded":function(a){var b=null,c=null,e="",f=0,g=0,h=0;if(this.levelMessage.persistentData=a,this.levelTemplate=a.levelTemplate||this.levelTemplate,this.useUniques=a.useUniques||this.useUniques,c=a.levelPieces||this.levelPieces,this.levelPieces={},c)for(e in c)if(c.hasOwnProperty(e))if("string"==typeof c[e])this.levelPieces[e]=c[e];else if(c[e].length)for(this.levelPieces[e]=[],f=0;f<c[e].length;f++)this.levelPieces[e].push(c[e][f]);else console.warn("Level Builder: Level pieces of incorrect type: "+c[e]);if(this.levelTemplate)if("string"==typeof this.levelTemplate)this.levelMessage.level=[this.getLevelPiece(this.levelTemplate)];else if(this.levelTemplate.length)for(this.levelMessage.level=[],g=0;g<this.levelTemplate.length;g++)if(b=this.levelTemplate[g],"string"==typeof b)this.levelMessage.level[g]=this.getLevelPiece(b);else if(b.length)for(this.levelMessage.level[g]=[],h=0;h<b.length;h++)this.levelMessage.level[g][h]=this.getLevelPiece(b[h]);else console.warn("Level Builder: Template row is neither a string or array. What is it?");else console.warn("Level Builder: Template is neither a string or array. What is it?");else console.warn("Level Builder: There is no level template.");this.levelMessage.level&&(this.levelMessage.level=d(this.levelMessage.level),this.owner.triggerEvent("load-level",this.levelMessage))}},methods:{getLevelPiece:function(a){var b=this.levelPieces[a]||a,c=null,d=0;if(b){if("string"==typeof b)return this.useUniques?(c=b,this.levelPieces[a]=null,c):b;if(b.length)return d=Math.floor(Math.random()*b.length),this.useUniques?this.levelPieces[a].splice(d,1)[0]:b[d];console.warn("Level Builder: There are no MORE level pieces of type: "+a)}else console.warn("Level Builder: There are no level pieces of type: "+a);return null},destroy:function(){this.levelMessage.level=null,this.levelMessage.persistentData=null,this.levelMessage=null}},publicMethods:{mergeLevels:function(a){return d(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicAngularMovement",constructor:function(a){this.angle=0,this.v=[0,0],this.maxV=this.owner.maxVelocity||a.maxVelocity||3,this.a=this.owner.acceleration||a.acceleration||.01,this.moving=!1,this.piOverTwo=Math.PI/2,this.visualOffset=a.visualOrientationOffset||0,this.owner.orientation=this.owner.orientation||this.visualOffset},events:{"handle-logic":function(a){var b=a.delta,c=0;this.moving&&(this.v[0]+=this.a*Math.cos(this.angle)*b,this.v[1]+=this.a*Math.sin(this.angle)*b,0===this.v[0]?c=this.v[1]>0?this.piOverTwo:this.v[1]<0?-this.piOverTwo:this.angle:(c=Math.atan(this.v[1]/this.v[0]),this.v[0]<0&&(c=Math.PI+c)),this.v[0]>=0?this.v[0]=Math.min(this.v[0],this.maxV*Math.cos(c)):this.v[0]=Math.max(this.v[0],this.maxV*Math.cos(c)),this.v[1]>=0?this.v[1]=Math.min(this.v[1],this.maxV*Math.sin(c)):this.v[1]=Math.max(this.v[1],this.maxV*Math.sin(c)),this.owner.x+=this.v[0],this.owner.y+=this.v[1],this.owner.orientation=c+this.visualOffset)},"set-angle":function(a){this.angle=a},move:function(){this.moving=!0},stop:function(){this.moving=!1},"set-max-velocity":function(a){this.maxV=a}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicAttachedEntity",constructor:function(a){var b=this.owner.randomizedXRange||a.randomizedXRange||0,c=this.owner.randomizedYRange||a.randomizedYRange||0;this.entityType=this.owner.entityType||a.entityType,this.entityProperties=this.owner.entityProperties||a.entityProperties||{x:0,y:0,z:0},this.offsetX=this.owner.offsetX||a.offsetX||0,this.offsetY=this.owner.offsetY||a.offsetY||0,this.offsetX+=Math.floor(Math.random()*(b+1)),this.offsetY+=Math.floor(Math.random()*(c+1)),this.attachedEntity=null},events:{adopted:function(a){this.entityProperties.x=this.owner.x+this.offsetX,this.entityProperties.y=this.owner.y+this.offsetY,this.entityProperties.z=this.owner.z+1,this.entityProperties.orientation=this.owner.orientation,this.attachedEntity=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities[this.entityType],{properties:this.entityProperties})),this.owner.triggerEvent("entity-created",this.attachedEntity)},"handle-logic":function(a){this.attachedEntity&&!this.attachedEntity.components.length?this.attachedEntity=null:this.attachedEntity&&(this.attachedEntity.x=this.owner.x+this.offsetX,this.attachedEntity.y=this.owner.y+this.offsetY,this.attachedEntity.orientation=this.owner.orientation)}},methods:{destroy:function(){this.entityProperties=null,this.attachedEntity&&this.attachedEntity.parent&&this.attachedEntity.parent.removeEntity(this.attachedEntity),this.attachedEntity=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicButton",constructor:function(a){this.state=this.owner.state,this.state.released=!0,this.state.pressed=!1,this.toggle=!!a.toggle,"pressed"===a.state&&(this.state.released=!1,this.state.pressed=!0)},events:{mousedown:function(){this.toggle||this.updateState("pressed")},pressup:function(){this.toggle?this.state.pressed?this.updateState("released"):this.updateState("pressed"):this.updateState("released")},"handle-logic":function(){}},methods:{updateState:function(a){this.state.released&&"pressed"===a?(this.state.pressed=!0,this.state.released=!1,this.owner.triggerEvent(a,this.state)):this.state.pressed&&"released"===a&&(this.state.pressed=!1,this.state.released=!0,this.owner.triggerEvent(a,this.state))}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCarrier",constructor:function(a){},events:{load:function(a){this.owner.trigger("add-collision-entity",this.owner)||(this.owner.addComponent(new platypus.components.CollisionGroup(this.owner,{})),this.owner.trigger("add-collision-entity",this.owner))},"carry-me":function(a){this.owner.trigger("add-collision-entity",a.entity)},"release-me":function(a){this.owner.trigger("remove-collision-entity",a.entity)}}})}(),function(){"use strict";var a=function(a){var b=function(a,b){return b&&!a.message?{event:a.event,message:b,delay:a.delay,repeat:a.repeat}:a};return a.singleInstance?function(c){var d=0,e=!0;for(d=0;d<this.queue.length;d++)this.queue[d].event===a.event&&(e=!1);e&&(this.queue.push(b(a,c)),this.queueTimes.push(a.delay))}:function(c){this.queue.push(b(a,c)),this.queueTimes.push(a.delay)}},b=function(a){return function(){var b=0;for(b=this.queue.length-1;b>-1;b--)this.queue[b]===a&&(this.queueTimes.splice(b,1),this.queue.splice(b,1))}};return platypus.createComponentClass({id:"LogicDelayMessage",constructor:function(c){var d="";if(this.queueTimes=[],this.queue=[],c.events)for(d in c.events)c.events.hasOwnProperty(d)&&(this.addEventListener(d,a(c.events[d])),c.events[d].cancelEvent&&this.addEventListener(c.events[d].cancelEvent,b(c.events[d])))},events:{"handle-logic":function(a){var b=0;for(b=this.queue.length-1;b>-1;b--)this.queueTimes[b]-=a.delta,this.queueTimes[b]<=0&&(this.owner.trigger(this.queue[b].event,this.queue[b].message),this.queue[b]&&(this.queue[b].repeat?this.queueTimes[b]+=this.queue[b].delay:(this.queueTimes.splice(b,1),this.queue.splice(b,1))))}},methods:{destroy:function(){this.queueTimes.length=0,this.queue.length=0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDestroyMe",properties:{delay:0},publicProperties:{destroyed:!1},events:{"handle-logic":function(a){var b=a.delta;this.destroyed&&!this.owner.state.paused&&(this.delay-=b,this.delay<=0&&this.owner.parent.removeEntity(this.owner))},"destroy-me":function(){this.destroyed=!0}}})}(),function(){"use strict";var a=function(a){return function(b){this[a]="undefined"==typeof b||b&&b.pressed!==!1}},b=function(){},c={x:function(a,b){a!==b&&(a>180&&180>=b||180>=a&&b>180)&&this.owner.triggerEvent("transform","vertical")},y:function(a,b){a!==b&&(a>90&&270>=a&&(90>=b||b>270)||(90>=a||a>270)&&b>90&&270>=b)&&this.owner.triggerEvent("transform","horizontal")},z:function(a,b){a!==b&&this.owner.triggerEvent("replace-transform","rotate-"+a)}};return platypus.createComponentClass({id:"LogicDirectionalMovement",properties:{axis:"y",heading:0,speed:.3},constructor:function(a){var d=this;isNaN(this.speed)||(this.speed=[this.speed,0,0]),this.initialVector=new platypus.Vector(this.speed),this.reorient=c[this.axis],this.reorient||(this.reorient=b),this.paused=!1,a.pause&&("string"==typeof a.pause?this.pausers=[a.pause]:this.pausers=a.pause,this.addEventListener("logical-state",function(b){var c=0,e=!1;if(a.pause){for(c=0;c<d.pausers.length;c++)e=e||b[d.pausers[c]];this.paused=e}})),this.state=this.owner.state,this.state.moving=!1,this.state.left=!1,this.state.right=!1,this.state.up=!1,this.state.down=!1,this.moving=!1,this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1,this.facing="right",this.owner.heading=0},events:{load:function(){return this.owner.addMover?(this.direction=this.owner.addMover({vector:this.speed,event:"moving",orient:!1}).vector,void this.owner.triggerEvent("moving",this.moving)):void console.warn('The "LogicDirectionalMovement" component requires a "Mover" component to function correctly.')},"handle-logic":function(a){var b=this.up||this.upLeft||this.downLeft,c=this.upLeft||this.up&&this.left,d=this.left||this.upLeft||this.downLeft,e=this.downLeft||this.down&&this.left,f=this.down||this.downLeft||this.downRight,g=this.downRight||this.down&&this.right,h=this.right||this.upRight||this.downRight,i=this.upRight||this.up&&this.right;if(b&&f)this.moving=!1;else if(d&&h)this.moving=!1;else if(c)this.moving=!0,this.facing="up-left",this.heading=225;else if(i)this.moving=!0,this.facing="up-right",this.heading=315;else if(e)this.moving=!0,this.facing="down-left",this.heading=135;else if(g)this.moving=!0,this.facing="down-right",this.heading=45;else if(d)this.moving=!0,this.facing="left",this.heading=180;else if(h)this.moving=!0,this.facing="right",this.heading=0;else if(b)this.moving=!0,this.facing="up",this.heading=270;else if(f)this.moving=!0,this.facing="down",this.heading=90;else switch(this.moving=!1,this.facing){case"up":b=!0;break;case"down":f=!0;break;case"left":d=!0;break;case"right":h=!0;break;case"up-left":b=!0,d=!0;break;case"up-right":b=!0,h=!0;break;case"down-left":f=!0,d=!0;break;case"down-right":f=!0,h=!0}this.owner.heading!==this.heading&&(this.direction.set(this.initialVector).rotate(this.heading/180*Math.PI),this.reorient(this.heading,this.owner.heading),this.owner.heading=this.heading),this.state.moving!==this.moving&&(this.owner.triggerEvent("moving",this.moving),this.state.moving=this.moving),this.state.up!==b&&(this.state.up=b),this.state.right!==h&&(this.state.right=h),this.state.down!==f&&(this.state.down=f),this.state.left!==d&&(this.state.left=d)},"go-down":a("down"),"go-south":a("down"),"go-down-left":a("downLeft"),"go-southwest":a("downLeft"),"go-left":a("left"),"go-west":a("left"),"go-up-left":a("upLeft"),"go-northwest":a("upLeft"),"go-up":a("up"),"go-north":a("up"),"go-up-right":a("upRight"),"go-northeast":a("upRight"),"go-right":a("right"),"go-east":a("right"),"go-down-right":a("downRight"),"go-southeast":a("downRight"),stop:function(a){a&&a.pressed===!1||(this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1)},accelerate:function(a){this.initialVector.normalize().multiply(a),this.direction.normalize().multiply(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDragDrop",constructor:function(a){this.nextX=this.owner.x,this.nextY=this.owner.y,this.grabOffsetX=0,this.grabOffsetY=0,this.owner.state.dragging=!1,this.owner.state.noDrop=!1,this.tryDrop=!1,this.hitSomething=!1},events:{"handle-logic":function(a){this.owner.x=this.nextX,this.owner.y=this.nextY,this.owner.state.noDrop=!1},"handle-post-collision-logic":function(a){this.tryDrop?(this.tryDrop=!1,this.hitSomething?(this.dropFailed=!1,this.owner.state.noDrop=!0,this.owner.state.dragging=!0):(this.owner.state.noDrop=!1,this.owner.state.dragging=!1)):this.hitSomething&&(this.owner.state.noDrop=!0),this.hitSomething=!1},mousedown:function(a){this.grabOffsetX=a.x-this.owner.x,this.grabOffsetY=a.y-this.owner.y,this.owner.state.dragging=!0},mouseup:function(a){this.tryDrop=!0},pressmove:function(a){this.nextX=a.x-this.grabOffsetX,this.nextY=a.y-this.grabOffsetY},"no-drop":function(a){this.hitSomething=!0}},methods:{destroy:function(){this.owner.state.dragging=null,this.owner.state.noDrop=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicFPSCounter",constructor:function(a){this.counter={text:""},this.times={},this.timeElapsed=!1,this.ticks=a.ticks||30,this.count=this.ticks},events:{"handle-logic":function(){var a="",b="";if(!platypus.game.settings.debug&&this.owner.parent&&this.owner.parent.removeEntity(this.owner),this.timeElapsed&&(this.timeElapsed=!1,this.count-=1,!this.count)){this.count=this.ticks,a=String(Math.floor(createjs.Ticker.getMeasuredFPS()))+" FPS<br />";for(b in this.times)this.times.hasOwnProperty(b)&&(a+="<br />"+b+": "+Math.round(this.times[b]/this.ticks)+"ms",this.times[b]=0);this.counter.text=a,this.owner.trigger("update-content",this.counter)}},"time-elapsed":function(a){a&&a.name&&("Engine Total"!==a.name||this.timeElapsed||(this.timeElapsed=!0),this.times[a.name]||(this.times[a.name]=0),this.times[a.name]+=a.time)}},methods:{destroy:function(){this.counter=null,this.times=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicImpactLaunch",constructor:function(a){this.stunState=a.state||"stunned",this.aX=this.owner.accelerationX||a.accelerationX||-.2,this.aY=this.owner.accelerationY||a.accelerationY||-.6,this.flipX=this.owner.flipX===!1||this.owner.flipX!==!0&&a.flipX===!1?1:-1,this.flipY=this.owner.flipY||a.flipY?-1:1,this.mX=1,this.mY=1,"number"!=typeof this.owner.dx&&(this.owner.dx=0),"number"!=typeof this.owner.dy&&(this.owner.dy=0),this.justJumped=!1,this.stunned=!1,this.state=this.owner.state,this.state.impact=!1,this.state[this.stunState]=!1,a.message&&console.warn('"'+this.type+'" components no longer accept "message": "'+a.message+'" as a definition parameter. Use "aliases": {"'+a.message+'": "impact-launch"} instead.')},events:{"handle-logic":function(){this.state.impact!==this.justJumped&&(this.state.impact=this.justJumped),this.state[this.stunState]!==this.stunned&&(this.state[this.stunState]=this.stunned),this.justJumped&&(this.justJumped=!1,this.stunned=!0,this.owner.dx=this.aX*this.mX,this.owner.dy=this.aY*this.mY)},"impact-launch":function(a){var b=a.x,c=a.y;return a.entity&&(b=a.entity.x-this.owner.x,c=a.entity.y-this.owner.y),this.stunned||(this.justJumped=!0,this.owner.dx=0,b>0?this.mX=1:0>b&&(this.mX=this.flipX),this.owner.dy=0,c>0?this.mY=1:0>c&&(this.mY=this.flipY)),!0},"hit-solid":function(a){return this.stunned&&a.y>0&&(this.stunned=!1,this.owner.dx=0,this.owner.dy=0),!0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPacingPlatform",constructor:function(a){this.ang=this.owner.angle||a.angle||0,this.dist=this.owner.distance||a.distance||128,this.period=this.owner.period||a.period||4e3,this.time=0,this.startPos=this.owner.startPos||a.startPos||0,this.offset=0,this.originX=this.owner.x,this.originY=this.owner.y},events:{"handle-logic":function(a){var b=a.delta;this.time+=b,this.time>this.period&&(this.time=this.time%this.period),this.offset=this.time/this.period*(2*Math.PI),this.owner.x=this.originX+Math.sin(this.offset+this.startPos)*this.dist*Math.cos(this.ang),this.owner.y=this.originY+Math.sin(this.offset+this.startPos)*this.dist*Math.sin(this.ang)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPortable",constructor:function(a){this.portableDirections=a.portableDirections||{down:!0},this.carrier=this.lastCarrier=void 0,this.message={entity:this.owner}},events:{"handle-logic":function(a){this.carrierConnected?(this.carrier!==this.lastCarrier&&(this.lastCarrier&&this.lastCarrier.trigger("release-me",this.message),this.carrier.trigger("carry-me",this.message)),this.carrierConnected=!1):this.carrier&&(this.carrier.trigger("release-me",this.message),this.carrier=void 0),this.lastCarrier=this.carrier},"hit-solid":function(a){a.y>0?this.updateCarrier(a.entity,"down"):a.y<0?this.updateCarrier(a.entity,"up"):a.x<0?this.updateCarrier(a.entity,"left"):a.x>0&&this.updateCarrier(a.entity,"right")}},methods:{updateCarrier:function(a,b){this.portableDirections[b]&&a&&(a!==this.carrier&&(this.carrier=a),this.carrierConnected=!0)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPortal",constructor:function(a){var b=0,c=a.entrants||a.entrant;if(this.destination=this.owner.destination||a.destination,this.used=!1,this.ready=!1,this.wasReady=!1,c)if(this.entrants={},Array.isArray(c))for(b=0;b<c.length;b++)this.entrants[c[b]]=!1;else this.entrants[c]=!1},events:{"handle-logic":function(){var a="";!this.used&&this.activated?(this.owner.trigger("port-"+this.destination),this.used=!0):this.ready&&!this.wasReady?(this.owner.triggerEvent("portal-waiting"),this.wasReady=!0):this.wasReady&&!this.ready&&(this.owner.triggerEvent("portal-not-waiting"),this.wasReady=!1),this.owner.state.occupied=!1,this.owner.state.ready=!0;for(a in this.entrants)this.entrants.hasOwnProperty(a)&&(this.entrants[a]?(this.owner.state.occupied=!0,this.entrants[a]=!1):this.owner.state.ready=!1);this.ready=!1},"occupied-portal":function(a){var b="";this.entrants[a.entity.type]=!0;for(b in this.entrants)if(this.entrants.hasOwnProperty(b)&&!this.entrants[b])return;this.ready=!0},"activate-portal":function(){this.activated=!0}}})}(),function(){"use strict";var a=function(a,b){return a/Math.abs(a)*b};return platypus.createComponentClass({id:"LogicPushable",constructor:function(a){this.yPush=a.push||a.yPush||0,this.xPush=a.push||a.xPush||.1,a.roll?(this.radius=a.radius||this.owner.radius||(this.owner.width||this.owner.height||2)/2,this.owner.orientation=this.owner.orientation||0):this.radius=0,this.currentPushX=0,this.currentPushY=0,this.lastX=this.owner.x,this.lastY=this.owner.y,this.pushers=[]},events:{"handle-logic":function(b){var c=0,d=b.delta;for(this.currentPushY&&(this.owner.y+=a(this.currentPushY,this.yPush*d),this.currentPushY=0),this.currentPushX&&(this.owner.x+=a(this.currentPushX,this.xPush*d),this.currentPushX=0),(this.lastX!==this.owner.x||this.lastY!==this.owner.y)&&(this.radius&&(this.owner.orientation+=(this.owner.x+this.owner.y-this.lastX-this.lastY)/this.radius),this.lastX=this.owner.x,this.lastY=this.owner.y),c=0;c<this.pushers.length;c++)this.pushers[c].triggerEvent("pushed",this.owner);this.pushers.length=0},"push-entity":function(a){var b=a.x||0,c=a.y||0;this.currentPushX-=b,this.currentPushY-=c,(this.yPush&&c||this.xPush&&b)&&this.pushers.push(a.entity)},"hit-solid":function(a){return a.y>0&&this.vY>0||a.y<0&&this.vY<0?this.vY=0:(a.x<0&&this.vX<0||a.x>0&&this.vX>0)&&(this.vX=0),!0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicRebounder",constructor:function(a){platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.owner.mass=this.owner.mass||a.mass||1,this.elasticity=a.elasticity||.8,this.v=new platypus.Vector(0,0,0),this.incidentVector=new platypus.Vector(0,0,0),this.staticCollisionOccurred=!1,this.nonStaticCollisionOccurred=!1,this.hitThisTick=[],this.otherV=new platypus.Vector(0,0,0),this.otherVelocityData=[]},events:{"handle-logic":function(a){this.hitThisTick=[],this.otherVelocityData.length=0},"hit-static":function(a){var b=0;this.v.set(this.owner.velocity),this.incidentVector.set(a.direction),b=this.v.scalarProjection(this.incidentVector),isNaN(b)||(this.incidentVector.scale(b*(1+this.elasticity)),this.v.subtractVector(this.incidentVector)),this.owner.velocity.set(this.v)},"hit-non-static":function(a){var b=0,c=a.entity,d=!1,e=0,f=0,g=0;for(b=0;b<this.hitThisTick.length;b++)if(c===this.hitThisTick[b])return;for(this.hitThisTick.push(c),b=0;b<this.otherVelocityData.length;b++)if(c===this.otherVelocityData[b].entity){this.otherV.set(this.otherVelocityData[b].velocity),d=!0;break}d||(this.otherV.set(c.velocity),c.triggerEvent("share-velocity",this.owner)),this.v.set(this.owner.velocity),this.incidentVector.set(a.direction),e=this.v.scalarProjection(this.incidentVector),e=isNaN(e)?0:e,f=this.otherV.scalarProjection(this.incidentVector),f=isNaN(f)?0:f,g=(e*(this.owner.mass-c.mass)+2*c.mass*f)/(this.owner.mass+c.mass),this.incidentVector.scale(g-e),this.owner.velocity.set(this.incidentVector)},"share-velocity":function(a){this.otherVelocityData.push({entity:a,velocity:new platypus.Vector(a.velocity)})}},methods:{destroy:function(){this.v=null,this.otherV=null,this.incidentVector=null,this.hitThisTick=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicRegionSpawner",constructor:function(a){var b=0,c=0,d=1,e=1,f=0,g=0,h=0,i=0;if(this.spawnPosition={x:0,y:0},this.spawnProperties={properties:this.spawnPosition},this.regions=null,this.usedRegions=null,this.regionWidth=0,this.regionHeight=0,a.regions)for(this.regions=[],this.usedRegions=[],this.regionWidth=f=a.regions.width||this.owner.width,this.regionHeight=g=a.regions.height||this.owner.height,d=Math.round(this.owner.width/f),e=Math.round(this.owner.height/g),b=0;d>b;b++)for(c=0;e>c;c++)h=Math.min(f,this.owner.width-b*f),i=Math.min(g,this.owner.height-c*g),this.regions.push({x:b*f,y:c*g,width:h,height:i});this.entityClass=platypus.game.settings.entities[a.spawn],this.interval=this.owner.interval||a.interval||1e3,this.time=0},events:{"handle-logic":function(a){var b=this.regions,c=null;this.time+=a.delta,this.time>this.interval&&(this.time-=this.interval,b?(b.length||(this.regions=this.usedRegions,this.usedRegions=b,b=this.regions),c=b[Math.floor(b.length*Math.random())],this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+(c.x+Math.random()*c.width),this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+(c.y+Math.random()*c.height)):(this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+Math.random()*this.owner.width,this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+Math.random()*this.owner.height),this.owner.triggerEvent("entity-created",this.owner.parent.addEntity(new platypus.Entity(this.entityClass,this.spawnProperties))))}}})}(),function(){"use strict";var a=Math.PI,b=Math.cos,c=Math.sin,d=function(a,c){return a*b(c)},e=function(a,b){return a*c(b)};return platypus.createComponentClass({id:"LogicRotationalMovement",constructor:function(b){this.speed=b.speed||.3,this.magnitude=0,this.degree=(b.degree||1)*a/180,this.angle=b.angle||0,this.state=this.owner.state,this.state.moving=!1,this.state.turningRight=!1,this.state.turningLeft=!1,this.owner.orientation=0,this.moving=!1,this.turningRight=!1,this.turningLeft=!1},events:{"handle-logic":function(a){var b=0,c=0;this.turningRight&&(this.angle+=this.degree*a.delta/15),this.turningLeft&&(this.angle-=this.degree*a.delta/15),this.moving&&(b=d(this.magnitude,this.angle),c=e(this.magnitude,this.angle)),this.owner.x+=b*a.delta,this.owner.y+=c*a.delta,this.state.moving!==this.moving&&(this.state.moving=this.moving),this.state.turningLeft!==this.turningLeft&&(this.state.turningLeft=this.turningLeft),this.state.turningRight!==this.turningRight&&(this.state.turningRight=this.turningRight),this.owner.orientation!==this.angle&&(this.owner.orientation=this.angle)},"turn-right":function(a){a?this.turningRight=a.pressed:this.turningRight=!0},"turn-left":function(a){a?this.turningLeft=a.pressed:this.turningLeft=!0},"go-forward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=this.speed):this.moving=!1},"go-backward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=-this.speed):this.moving=!1},stop:function(a){(!a||a.pressed)&&(this.moving=!1,this.turningLeft=!1,this.turningRight=!1)},"stop-moving":function(a){(!a||a.pressed)&&(this.moving=!1)},"stop-turning":function(a){(!a||a.pressed)&&(this.turningLeft=!1,this.turningRight=!1)}}})}(),function(){"use strict";var a=0;return platypus.createComponentClass({id:"LogicShield",constructor:function(b){this.state=this.owner.state,this.stateName=b.state||"shielded",this.entityClass=platypus.game.settings.entities[b.shield],this.owner.linkId||(this.owner.linkId="shield-link-"+a,a+=1),this.state[this.stateName]=!1,this.shieldPosition={x:0,y:0,z:0,dx:0,dy:0,linkId:this.owner.linkId},this.shieldProperties={properties:this.shieldPosition},this.onShield=null,this.offsetX=b.offsetX||0,this.offsetY=b.offsetY||0,this.offsetZ=b.offsetZ||.01,this.shield=null,this.wieldShield=!1},events:{"handle-logic":function(){var a=0,b=this.state;this.wieldShield?(this.shield||(this.shieldPosition.x=this.owner.x,this.shieldPosition.y=this.owner.y,this.shieldPosition.z=this.owner.z,this.shield=this.owner.parent.addEntity(new platypus.Entity(this.entityClass,this.shieldProperties)),this.owner.triggerEvent("entity-created",this.shield),this.onShield&&(this.onShield(this.shield),this.onShield=null)),this.shield.x=this.owner.x,a=this.offsetX,b.left?(a*=-1,this.shield.orientation=Math.PI):b.right&&(this.shield.orientation=0),this.shield.x+=a,this.shield.y=this.owner.y,a=this.offsetY,b.top?(a*=-1,this.shield.orientation=Math.PI/2):b.bottom&&(this.shield.orientation=-Math.PI/2),this.shield.y+=a,this.shield.z=this.owner.z,this.shield.z+=this.offsetZ):this.shield&&(this.owner.parent.removeEntity(this.shield),this.shield=null),b[this.stateName]!==this.wieldShield&&(b[this.stateName]=this.wieldShield)},"wield-shield":function(a){this.wieldShield=!a||a.pressed!==!1,a&&a.onShield&&(this.onShield=a.onShield)},"drop-shield":function(){this.wieldShield=!1}},methods:{destroy:function(){this.state[this.stateName]=!1,this.shield&&(this.owner.parent.removeEntity(this.shield),this.shield=null),this.wieldShield=!1}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicSpawner",constructor:function(a){var b=this.owner.spawneeClass||a.spawneeClass,c="",d=0;if(this.state=this.owner.state,this.stateName=a.state||"spawning",this.entityClass=platypus.game.settings.entities[b],this.speed=a.speed||this.owner.speed||0,this.state[this.stateName]=!1,this.spawneeProperties={x:0,y:0,z:0,dx:0,dy:0,spawner:this.owner},a.passOnProperties)for(d=0;d<a.passOnProperties.length;d++)c=a.passOnProperties[d],this.owner[c]&&(this.spawneeProperties[c]=this.owner[c]);this.propertiesContainer={properties:this.spawneeProperties},this.offsetX=this.owner.offsetX||a.offsetX||0,this.offsetY=this.owner.offsetY||a.offsetY||0,this.firing=!1},events:{"handle-logic":function(){var a=0,b=0,c=this.state;this.firing&&(this.spawneeProperties.x=this.owner.x,this.spawneeProperties.y=this.owner.y,b=this.entityClass.properties&&this.entityClass.properties.z?this.entityClass.properties.z:0,this.spawneeProperties.z=this.owner.z+b,a=this.offsetX,c.left&&(a*=-1),this.spawneeProperties.x+=a,a=this.offsetY,c.top&&(a*=-1),this.spawneeProperties.y+=a,this.speed?(c.top?this.spawneeProperties.dy=-this.speed:c.bottom?this.spawneeProperties.dy=this.speed:delete this.spawneeProperties.dy,c.left?this.spawneeProperties.dx=-this.speed:c.right?this.spawneeProperties.dx=this.speed:delete this.spawneeProperties.dx):(delete this.spawneeProperties.dx,delete this.spawneeProperties.dy),this.parent&&this.owner.triggerEvent("entity-created",this.parent.addEntity(new platypus.Entity(this.entityClass,this.propertiesContainer)))),c[this.stateName]!==this.firing&&(c[this.stateName]=this.firing),this.firing=!1},spawn:function(a){this.firing=!a||a.pressed!==!1,this.parent=this.owner.parent}}})}(),function(){"use strict";var a=function(a,b){return function(c){var d=null;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}},b=function(a,b){return function(c){b[a]=!0}},c=null,d=null;return c=function(a,b,e,f,g,h,i){var j=0,k="",l=!1,m=f.message||0===f.message||f.message===!1;if(g)if("string"==typeof f)h.trigger(f),l=!0;else if(Array.isArray(f)){for(j=0;j<f.length;j++)c(a,b,e,f[j],g,h,i);l=!0}else f.event&&(m||f.delay)?(f.delay?i.push(f):h.trigger(f.event,f.message),l=!0):f["true"]&&c(a,b,e,f["true"],g,h,i);if(!l)for(k in f)f.hasOwnProperty(k)&&"true"!==k&&d(k,b,e,f[k],g,h,i)},d=function(a,b,d,e,f,g,h){var i=f,j=!1;"!"===a.charAt(0)?(j=b[a.substring(1)]===!1,"outputs"!==a&&d[a.substring(1)]!==b[a.substring(1)]&&(i=!0)):(j=b[a]===!0,"outputs"!==a&&d[a]!==b[a]&&(i=!0)),(j||"outputs"===a)&&c(a,b,d,e,i,g,h)},platypus.createComponentClass({id:"LogicStateMachine",constructor:function(c){var d=null;if(this.state=this.owner.state,c.inputs)for(d in c.inputs)c.inputs.hasOwnProperty(d)&&this.addEventListener(d,a(c.inputs[d],this.state));if(this.sustainedState={},c["sustained-inputs"])for(d in c["sustained-inputs"])c["sustained-inputs"].hasOwnProperty(d)&&(this.addEventListener(d,b(c["sustained-inputs"][d],this.sustainedState)),this.sustainedState[c["sustained-inputs"][d]]=!1);this.snapshot={},this.last={},this.tempQueue=[],this.queueTimes=[],this.queue=[],this.outputs=c.outputs||null},events:{"handle-logic":function(a){var b="";for(b in this.sustainedState)this.sustainedState.hasOwnProperty(b)&&(this.owner.state[b]!==this.sustainedState[b]&&(this.owner.state[b]=this.sustainedState[b]),this.sustainedState[b]=!1);for(b=this.queue.length-1;b>-1;b--)this.queueTimes[b]-=a.delta,this.queueTimes[b]<=0&&(this.owner.trigger(this.queue[b].event,this.queue[b].message),this.queueTimes.splice(b,1),this.queue.splice(b,1))},"update-state":function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this.state[b]=a[b])},"logical-state":function(a){var b=null;if(this.outputs){for(b in a)a[b]!==this.snapshot[b]&&(this.snapshot[b]=a[b]);for(this.tempQueue.length=0,d("outputs",this.snapshot,this.last,this.outputs,!1,this.owner,this.tempQueue),b=0;b<this.tempQueue.length;b++)this.queue.push(this.tempQueue[b]),this.queueTimes.push(this.tempQueue[b].delay);for(b in this.snapshot)this.snapshot[b]!==this.last[b]&&(this.last[b]=this.snapshot[b]);
}}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicSwitch",constructor:function(a){this.state=this.owner.state,this.pressed=!1,this.wasPressed=this.pressed,this.sticky=a.sticky||!1,this.state.pressed=!1,this.initialPress=!0},events:{"handle-logic":function(){this.sticky?this.pressed&&!this.wasPressed&&(this.state.pressed=!0,this.wasPressed=!0,this.owner.trigger("switch-on")):(this.pressed!==this.wasPressed&&(this.pressed?(this.state.pressed=!0,this.owner.trigger("switch-on")):(this.state.pressed=!1,this.owner.trigger("switch-off"))),this.wasPressed=this.pressed,this.pressed=!1)},"switch-pressed":function(){this.pressed=!0,this.initialPress&&(this.owner.trigger("initial-press"),this.initialPress=!1)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTeleportee",constructor:function(a){this.teleportDestination=new platypus.Vector,this.teleportNow=!1,this.DestinationSet=!1},events:{"handle-logic":function(){this.teleportNow&&(this.owner.trigger("relocate-entity",{position:this.teleportDestination}),this.teleportNow=!1,this.owner.trigger("teleport-complete"))},teleport:function(){this.destinationSet&&(this.teleportNow=!0)},"set-destination":function(a){this.setDestination(a)},"hit-telepoint":function(a){this.setDestination(a.entity)}},methods:{setDestination:function(a){this.teleportDestination.set(a.x,a.y),this.destinationSet=!0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTeleporter",constructor:function(a){this.destination=void 0,this.linkId=this.owner.teleportId||a.teleportId,this.facing=this.owner.facing||a.facing||!1,this.facing&&(this.owner.state["facing-"+this.facing]=!0)},events:{"peer-entity-added":function(a){this.destination||a.linkId!==this.linkId||(this.destination=a)},"teleport-entity":function(a){switch(this.facing){case"up":a.y<0&&a.entity.trigger("teleport",this.destination);break;case"right":a.x>0&&a.entity.trigger("teleport",this.destination);break;case"down":a.y>0&&a.entity.trigger("teleport",this.destination);break;case"left":a.x<0&&a.entity.trigger("teleport",this.destination);break;default:a.entity.trigger("teleport",this.destination)}}},methods:{destroy:function(){this.destination=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTimer",constructor:function(a){this.time=this.owner.time||a.time||0,this.prevTime=this.time,this.alarmTime=this.owner.alarmTime||a.alarmTime||void 0,this.isInterval=this.owner.isInterval||a.isInterval||!1,this.alarmMessage=this.owner.alarmMessage||a.alarmMessage||"",this.updateMessage=this.owner.updateMessage||a.updateMessage||"",this.isOn=this.owner.on||a.on||!0,this.isIncrementing=this.owner.isIncrementing||a.isIncrementing||!0,this.maxTime=this.owner.maxTime||a.maxTime||36e5},events:{"handle-logic":function(a){this.isOn&&(this.prevTime=this.time,this.isIncrementing?this.time+=a.delta:this.time-=a.delta,Math.abs(this.time)>this.maxTime&&(this.time>0?this.time=this.maxTime:this.time<0&&(this.time=-this.maxTime),this["stop-timer"]()),"undefined"!=typeof this.alarmTime&&(this.isInterval?this.isIncrementing?Math.floor(this.time/this.alarmTime)>Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):Math.floor(this.time/this.alarmTime)<Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):this.isIncrementing?this.time>this.alarmTime&&this.prevTime<this.alarmTime&&this.owner.trigger(this.alarmMessage):this.time<this.alarmTime&&this.prevTime>this.alarmTime&&this.owner.trigger(this.alarmMessage))),this.owner.trigger(this.updateMessage,{time:this.time})},"set-timer":function(a){this.time=a.time},"start-timer":function(){this.isOn=!0},"stop-timer":function(){this.isOn=!1}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicWindUpRacer",constructor:function(a){this.windTime=a.windTime||500,this.raceTime=a.raceTime||5e3,this.speed=a.speed||this.owner.speed||.3,this.windProgress=0,this.winding=!1,this.racing=!1,this.blocked=!1,this.right=!1,this.left=!1,this.state=this.owner.state,this.state.windingUp=!1,this.state.racing=!1,this.state.blocked=!1},events:{"handle-logic":function(a){this.racing?!this.blocked&&this.right&&this.state.right?(this.owner.x+=this.speed,this.owner.trigger("racing")):!this.blocked&&this.left&&this.state.left?(this.owner.x-=this.speed,this.owner.trigger("racing")):(this.racing=!1,this.owner.trigger("stopped-racing")):this.winding?((this.right&&this.state.right||this.left&&this.state.left)&&(this.windProgress+=a.delta),this.owner.trigger("winding")):this.windProgress&&(this.windProgress>this.windTime&&(this.racing=!0),this.windProgress=0,this.owner.trigger("stopped-winding")),this.state.windingUp!==this.winding&&(this.state.windingUp=this.winding),this.state.racing!==this.racing&&(this.state.racing=this.racing),this.state.blocked!==this.blocked&&(this.state.blocked=this.blocked),this.blocked=!1},"stop-racing":function(a){this.racing=!1,this.owner.trigger("stopped-racing")},"wind-up":function(a){this.winding=!a||a.pressed!==!1,this.right=this.state.right,this.left=this.state.left},"hit-solid":function(a){a.x&&this.racing&&(this.right&&a.x>0||this.left&&a.x<0)&&(this.blocked=!0,this.owner.trigger("blocked",a))}},methods:{destroy:function(){this.state.windingUp=!1,this.state.racing=!1,this.state.blocked=!1}}})}(),function(){"use strict";var a=new platypus.Vector,b=function(a){return function(b,c,d,e){this.accelerator?this.resultant=b:this.resultant=c,this.update=a,this.update(b,c,d,e)}},c=function(){return!0},d=function(a,d){var e=a.active,f=!0,g=!0,h=c,i=c,j=a.owner.state,k=d.controlState,l=d.instantState,m=d.instantSuccess;k&&(h=function(){return j[k]}),d.event&&a.addEventListener(d.event,function(a){e=a&&a.pressed!==!1}),d.instantEvent||l?(l&&(i=function(){return j[l]}),d.instantEvent&&(f=!1,a.addEventListener(d.instantEvent,function(a){f=a&&a.pressed!==!1})),a.update=b(function(a,b,c,d){var j=i();this.active=e&&h(),g&&f&&this.active&&j?(g=!1,this.move(1),m&&this.owner.triggerEvent(m)):g||f&&j||(g=!0,this.decay())})):a.update=b(function(a,b,c,d){this.active=e&&h(),this.active&&this.move(c)})};return platypus.createComponentClass({id:"Motion",properties:{orient:!0,accelerator:!1,active:!0,maxMagnitude:1/0,event:"",controlState:"",instantEvent:"",instantState:"",instantSuccess:"",instantDecay:null,vector:0},constructor:function(a){this.vector=new platypus.Vector(this.vector),this.triggered=!1,isNaN(this.instantDecay)?this.capMagnitude=-1:this.capMagnitude=this.vector.magnitude()*this.instantDecay,d(this,a),this.orient&&this.owner.triggerEvent("orient-vector",this.vector)},methods:{move:function(b){this.vector.magnitude()>this.maxMagnitude&&this.vector.normalize().multiply(this.maxMagnitude),this.resultant.add(a.set(this.vector).multiply(b))},decay:function(){var b=null;this.capMagnitude>=0&&(b=a.set(this.resultant).scalarProjection(this.vector),b>this.capMagnitude&&this.resultant.subtractVector(a.set(this.vector).normalize().scale(b-this.capMagnitude)))},destroy:function(){this.orient&&this.owner.triggerEvent("remove-vector",this.vector)}},publicMethods:{}})}(),function(){"use strict";var a=new platypus.Vector;return platypus.createComponentClass({id:"Mover",properties:{ground:[0,1]},publicProperties:{movers:[],gravity:0,jump:0,speed:0,drag:.99,friction:.94,maxMagnitude:1/0},constructor:function(a){platypus.Vector.assign(this.owner,"position","x","y","z"),platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.position=this.owner.position,this.velocity=this.owner.velocity,this.moversCopy=this.movers,this.movers=[],this.ground=new platypus.Vector(this.ground)},events:{"component-added":function(a){"Motion"===a.type&&this.movers.push(a)},"component-removed":function(a){var b=0;if("Motion"===a.type)for(b=0;b<this.movers.length;b++)if(a===this.movers[b]){this.movers.splice(b,1);break}},load:function(){var a=0,b=this.moversCopy;for(delete this.moversCopy,a=0;a<b.length;a++)this.addMover(b[a]);this.speed&&(isNaN(this.speed)||(this.speed=[this.speed,0,0]),this.speed=this.addMover({vector:this.speed,controlState:"moving"}).vector),this.gravity&&(isNaN(this.gravity)||(this.gravity=[0,this.gravity,0]),this.gravity=this.addMover({vector:this.gravity,orient:!1,accelerator:!0,event:"gravitate"}).vector),this.jump&&(isNaN(this.jump)||(this.jump=[0,this.jump,0]),this.jump=this.addMover({vector:this.jump,accelerator:!0,controlState:"grounded",state:"jumping",instantEvent:"jump",instantSuccess:"just-jumped",instantDecay:.2}).vector)},"handle-logic":function(b){var c=0,d=b.delta,e=a,f=this.velocity,g=this.position;if(!this.owner.state.paused){for(c=0;c<this.movers.length;c++)this.movers[c].update(f,g,d,this.grounded);this.grounded?f.multiply(this.friction):f.multiply(this.drag),f.magnitude()>this.maxMagnitude&&f.normalize().multiply(this.maxMagnitude),e.set(f).multiply(d),g.add(e),this.grounded!==this.owner.state.grounded&&(this.owner.state.grounded=this.grounded),this.grounded=!1}},"hit-solid":function(b){var c=this.velocity.scalarProjection(b.direction),d=a;b.direction.dot(this.ground)>0&&(this.grounded=!0),d.set(b.direction).normalize().multiply(c).dot(this.velocity)>0&&this.velocity.subtractVector(d)}},methods:{destroy:function(){var a=0;for(a=this.movers.length-1;a>=0;a--)this.removeMover(this.movers[a])}},publicMethods:{addMover:function(a){var b=this.owner.addComponent(new platypus.components.Motion(this.owner,a));return b},removeMover:function(a){this.owner.removeComponent(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Node",publicProperties:{x:0,y:0,z:0},constructor:function(a){this.nodeId=a.nodeId||this.owner.nodeId||this.owner.id||String(Math.random()),"string"!=typeof this.nodeId&&this.nodeId.length&&(this.nodeId=a.nodeId.join("|")),this.owner.nodeId=this.nodeId,this.owner.isNode=!0,this.map=this.owner.map=this.owner.map||null,this.contains=this.owner.contains=[],this.edgesContain=this.owner.edgesContain=[],platypus.Vector.assign(this.owner,"position","x","y","z"),this.neighbors=this.owner.neighbors=a.neighbors||this.owner.neighbors||{}},events:{"add-neighbors":function(a){var b=0,c=null;for(c in a)a.hasOwnProperty(c)&&(this.neighbors[c]=a[c]);for(b=0;b<this.contains.length;b++)this.contains[b].triggerEvent("set-directions")},"remove-neighbor":function(a){var b=null,c=a;"string"!=typeof c&&(c=c.nodeId);for(b in this.neighbors)if(this.neighbors.hasOwnProperty(b))if("string"==typeof this.neighbors[b]){if(this.neighbors[b]===c){delete this.neighbors[b];break}}else if(this.neighbors[b].nodeId===c){delete this.neighbors[b];break}}},publicMethods:{getNode:function(a){var b=null;if(!this.map&&this.owner.map&&(this.map=this.owner.map),this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(b.length&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},addToNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},removeFromNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.splice(b,1)[0];return!1},addToEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return!1;return this.edgesContain.push(a),a},removeFromEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return this.edgesContain.splice(b,1)[0];return!1}}})}(),function(){"use strict";var a=function(a,b){a.id?"string"==typeof a.id?this.id=a.id:Array.isArray(a.id)?this.id=a.id.join("|"):this.id=String(Math.random()):this.id=String(Math.random()),this.isNode=!0,this.map=b,this.contains=[],this.type=a.type||"",this.x=a.x||0,this.y=a.y||0,this.z=a.z||0,this.neighbors=a.neighbors||{}},b=a.prototype;return b.getNode=function(a){var b=null;if(this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(Array.isArray(b)&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},b.add=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},b.remove=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.splice(b,1)[0];return!1},platypus.createComponentClass({id:"NodeMap",constructor:function(b){var c=0;if(this.owner.map=this.map=[],this.residentsAwaitingNode=[],b.map)for(c=0;c<b.map.length;c++)this.map.push(new a(b.map[c],this))},events:{"add-node":function(b){var c=0,d=null,e=null;for(b.isNode?(e=b,b.map=this):e=new a(b,this),this.map.push(e),c=this.residentsAwaitingNode.length-1;c>=0;c--)d=this.residentsAwaitingNode[c],e.id===d.nodeId&&(this.residentsAwaitingNode.splice(c,1),d.node=this.getNode(d.nodeId),d.triggerEvent("on-node",d.node))},"child-entity-added":function(a){a.isNode?this.owner.triggerEvent("add-node",a):a.nodeId&&(a.node=this.getNode(a.nodeId),a.node?a.triggerEvent("on-node",a.node):this.residentsAwaitingNode.push(a))}},publicMethods:{getNode:function(){var a=0,b="",c="",d=arguments;if(1===d.length){if(d[0].isNode)return d[0];Array.isArray(d[0])&&(d=d[0])}for(a=0;a<d.length;a++)b+=c+d[a],c="|";for(a=0;a<this.map.length;a++)if(this.map[a].id===b)return this.map[a];return null},getClosestNode:function(){var a=new platypus.Vector(0,0,0),b=new platypus.Vector(0,0,0);return function(c,d,e){var f=0,g=0,h=a.set(c),i=b,j=0,k=d||this.map,l=null,m=!1,n=1/0;for(f=0;f<k.length;f++)if(j=i.set(h).subtractVector(k[f].position).magnitude(),n>j){if(e){for(m=!1,g=0;g<e.length;g++)if(e[g]===k[f]){m=!0;break}if(m)break}n=j,l=k[f]}return l}}()}})}(),function(){"use strict";var a=function(a,b,c){return function(d){var e=b.getNode(a);return this.isPassable(e)?(this.destinationNodes.length=0,this.destinationNodes.push(e),this.node?this.onEdge(e):this.distance=0,this.progress=0,this.setState("going-"+c),!0):!1}},b=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z;return Math.sqrt(c*c+d*d+e*e)},c=function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=0;return a.rotation&&b.rotation?(e=(a.rotation+180)%360,f=(b.rotation+180)%360,(e*(1-d)+f*d+180)%360):c?(g=Math.acos(e/c),0>f&&(g=2*Math.PI-g),180*g/Math.PI):g},d=function(a,b,c,d){return b*(1-a)+c*a+d},e=function(a,b){var c=0,d=0,e=!1;if(null===b)return!0;for(;c<a.length;c++){for(d=0;d<b.length;d++)a[c].type===b[d]&&(e=!0);if(!e)return!1;e=!1}return!0};return platypus.createComponentClass({id:"NodeResident",constructor:function(a){var c=a.offset||this.owner.nodeOffset||{};this.nodeId=this.owner.nodeId=a.nodeId||this.owner.nodeId,this.neighbors={},this.friendlyNodes=a.nodes||null,this.friendlyEntities=a.shares||null,this.speed=a.speed||0,this.snapToNodes=a.snapToNodes||!1,this.updateOrientation=a.updateOrientation||!1,this.distance=0,this.buffer=a.buffer||0,this.progress=0,this.offset={x:c.x||0,y:c.y||0,z:c.z||0},this.destinationNodes=[],this.algorithm=a.algorithm||b,this.state=this.owner.state,this.currentState=""},events:{"set-algorithm":function(a){this.algorithm=a||b},"handle-logic":function(a){var b=0,e=0,f=0,g=null;if(this.owner.node||(this.owner.triggerEvent("on-node",this.owner.parent.getClosestNode([this.owner.x,this.owner.y])),this.owner.triggerEvent("in-location",this.owner)),"number"==typeof this.owner.speed&&(this.speed=this.owner.speed),this.followEntity?(g=this.followEntity.node||this.followEntity,g&&g.isNode&&g!==this.node?(this.lag=0,this.state.moving=this.gotoNode(),this.followDistance&&(f=this.lag)):this.followEntity=null):f=this.speed*a.delta,this.blocked&&(this.blocked=!1,this.goingToNode&&this.owner.triggerEvent("goto-closest-node",this.goingToNode)),this.destinationNodes.length){if(this.state.moving=!0,this.node)this.onEdge(this.destinationNodes[0]);else if(!this.lastNode&&(this.owner.triggerEvent("on-node",this.destinationNodes[0]),this.destinationNodes.splice(0,1),!this.destinationNodes.length))return void(this.state.moving=!1);if(this.snapToNodes){for(;b<this.destinationNodes.length;b++)this.owner.triggerEvent("on-node",this.destinationNodes[b]);this.destinationNodes.length=0}else for(;this.destinationNodes.length&&f;)this.progress+f>=this.distance?(g=this.destinationNodes[0],f-=this.distance-this.progress,this.progress=0,this.destinationNodes.splice(0,1),this.owner.triggerEvent("on-node",g),this.destinationNodes.length&&f&&this.onEdge(this.destinationNodes[0])):(this.progress+=f,e=this.progress/this.distance,this.owner.x=d(e,this.lastNode.x,this.destinationNodes[0].x,this.offset.x),this.owner.y=d(e,this.lastNode.y,this.destinationNodes[0].y,this.offset.y),this.owner.z=d(e,this.lastNode.z,this.destinationNodes[0].z,this.offset.z),this.updateOrientation&&(this.owner.rotation=c(this.lastNode,this.destinationNodes[0],this.distanc,e)),f=0)}else this.state.moving=!1},"on-node":function(a){var b=0,c=null;for(this.owner.node=this.node=a,this.node.removeFromEdge(this.owner),this.lastNode&&this.lastNode.removeFromEdge(this.owner),this.node.addToNode(this.owner),this.setState("on-node"),this.owner.x=this.node.x+this.offset.x,this.owner.y=this.node.y+this.offset.y,this.owner.z=this.node.z+this.offset.z,this.updateOrientation&&this.node.rotation&&(this.owner.rotation=this.node.rotation),this.owner.triggerEvent("set-directions"),this.friendlyNodes&&this.friendlyNodes[a.type]&&this.owner.trigger(this.friendlyNodes[a.type],a),c=a.contains,b=0;b<c.length;b++)this.owner!==c[b]&&(c[b].triggerEvent("with-"+this.owner.type,this.owner),this.owner.triggerEvent("with-"+c[b].type,c[b]))},"leave-node":function(){this.node&&(this.node.removeFromNode(this.owner),this.owner.triggerEvent("left-node",this.node),this.owner.triggerEvent("remove-directions")),this.lastNode=this.node,this.node=null},"goto-node":function(a){this.gotoNode(a)},follow:function(a){a.entity?(this.followDistance=a.distance,this.followEntity=a.entity):(this.followDistance=0,this.followEntity=a)},"goto-closest-node":function(){var a=function(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},b=function(a,b){return a.type===b},c=function(a,b){return a.type===b.type};return function(d){var e=null,f=20,g=this.node||this.lastNode,h=null,i=d.steps||0;if(this.goingToNode=d,h="string"==typeof d?b:"string"==typeof d.type?c:a,g&&d&&!h(g,d))if(e=this.traverseNode({depth:f,origin:g,position:g,test:h,destination:d,nodes:[],shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),e.distance-=this.progress,e.found){if(!this.followEntity)return this.setPath(e,i);if(!this.followDistance)return this.setPath(e,i);if(e.distance+(this.followEntity.progress||0)>this.followDistance)return this.lag=e.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(e,i);this.lag=0}else if(e.blocked)return this.blocked=!0,!1;return!1}}(),"set-directions":function(){var b="",c=0,d=null,e=this.node,f=null;this.owner.triggerEvent("remove-directions");for(b in e.neighbors)if(this.neighbors[b]=a(e.neighbors[b],e.map,b),this.addEventListener(b,this.neighbors[b]),f=e.map.getNode(e.neighbors[b]))for(d=f.contains,c=0;c<d.length;c++)d[c].triggerEvent("next-to-"+this.owner.type,this.owner),this.owner.triggerEvent("next-to-"+d[c].type,d[c])},"remove-directions":function(){for(var a in this.neighbors)this.removeEventListener(a,this.neighbors[a]),delete this.neighbors[a]}},methods:{gotoNode:function(){var a=function(a,b){return a===b};return function(b){var c=null,d=20,e=this.node||this.lastNode;if(!b&&this.followEntity&&(b=this.followEntity.node||this.followEntity.lastNode||this.followEntity),e&&b&&this.node!==b)if(c=this.traverseNode({depth:d,origin:e,position:e,test:a,destination:b,nodes:[],shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),c.distance-=this.progress,c.found){if(!this.followEntity)return this.setPath(c);if(!this.followDistance)return this.setPath(c);if(c.distance+(this.followEntity.progress||0)>this.followDistance)return this.lag=c.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(c);this.lag=0}else if(c.blocked)return this.blocked=!0,!1;return!1}}(),isPassable:function(a){return a&&this.node!==a&&(!this.friendlyNodes||"undefined"!=typeof this.friendlyNodes[a.type])&&(!a.contains.length||e(a.contains,this.friendlyEntities))},traverseNode:function(a){var c=1,d="",e=a.position.map,f=null,g=null,h=null,i=null,j=a.algorithm||b,k={shortestPath:1/0,found:!1,blocked:!1},l=!0,m=!1;if(0===a.depth||a.distance>a.shortestPath)return a;if(a.test(a.position,a.destination))return a.found=!0,a.shortestPath=a.distance,a;for(h=a.nodes;c<h.length-1;c++)if(h[c]===a.position)return a;f=a.position.neighbors;for(d in f)g=e.getNode(f[d]),m=!0,this.isPassable(g)&&(h=a.nodes.slice(),h.push(g),i=this.traverseNode({depth:a.depth-1,origin:a.origin,position:g,destination:a.destination,test:a.test,algorithm:j,nodes:h,shortestPath:a.shortestPath,distance:a.distance+j(a.position,g),gateway:a.gateway||d,found:!1,blocked:!1}),i.found&&k.shortestPath>i.shortestPath&&(k=i),l=!1);return k.blocked=m&&l,k},setPath:function(a,b){a.nodes[0]===this.node&&a.nodes.splice(0,1),this.destinationNodes=a.nodes,b&&(this.destinationNodes.length=Math.min(b,this.destinationNodes.length))},setState:function(a){"on-node"===a?this.state["on-node"]=!0:(this.state["on-node"]=!1,this.currentState&&(this.state[this.currentState]=!1),this.currentState=a,this.state[a]=!0)},onEdge:function(a){this.distance=b(this.node,a),this.updateOrientation&&(this.owner.rotation=c(this.node,a,this.distance,this.progress/this.distance)),this.node.addToEdge(this.owner),a.addToEdge(this.owner),this.owner.triggerEvent("leave-node")}}})}(),function(){"use strict";var a={horizontal:[[-1,0,0],[0,1,0],[0,0,-1]],vertical:[[1,0,0],[0,-1,0],[0,0,-1]],diagonal:[[0,1,0],[1,0,0],[0,0,-1]],"diagonal-inverse":[[0,-1,0],[-1,0,0],[0,0,-1]],"rotate-90":[[0,-1,0],[1,0,0],[0,0,1]],"rotate-180":[[-1,0,0],[0,-1,0],[0,0,1]],"rotate-270":[[0,1,0],[-1,0,0],[0,0,1]]},b=function(){var a=function(a,b,c){var d=0,e=0;for(d=0;d<a.length;d++)e+=a[d]*c[d][b];return e};return function(b,c,d){var e=0,f=0,g=[];for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)g.push(a(b[e],f,c));for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)d[e][f]=g.splice(0,1)[0]}}(),c=function(a){var b=0,c=0;for(b=0;3>b;b++)for(c=0;3>c;c++)b===c?a[b][c]=1:a[b][c]=0;return a};return platypus.createComponentClass({id:"Orientation",publicProperties:{scaleX:1,scaleY:1,rotation:0,orientation:0,orientationMatrix:null},constructor:function(){var a=function(a,d){var e=new platypus.Vector([0,0,1]),f=new platypus.Vector([1,0,0]),g=new platypus.Vector([1,0,0]),h=a.owner,i=[[1,0,0],[0,1,0],[0,0,1]];return Object.defineProperty(h,"orientationMatrix",{get:function(){return b(a.matrixTween,a.matrix,c(i)),i},enumerable:!0}),delete h.orientation,Object.defineProperty(h,"orientation",{get:function(){return g.signedAngleTo(f,e)},set:function(a){g.set(f).rotate(a)},enumerable:!0}),d&&(isNaN(d)?g.set(d):g.rotate(d)),g};return function(b){this.loadedOrientationMatrix=this.orientationMatrix,this.matrix=[[1,0,0],[0,1,0],[0,0,1]],this.matrixTween=[[1,0,0],[0,1,0],[0,0,1]],this.vectors=[],this.inverses=[],this.tweens=[],this.owner.triggerEvent("orient-vector",a(this,this.orientation))}}(),events:{load:function(){this.loadedOrientationMatrix?this.transform(this.loadedOrientationMatrix):(this.scaleX&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.transform("horizontal")),this.scaleY&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.transform("vertical")),this.rotation&&((this.rotation+270)%360===0?(this.rotation=0,this.transform("rotate-90")):(this.rotation+180)%360===0?(this.rotation=0,this.transform("rotate-180")):(this.rotation+90)%360===0&&(this.rotation=0,this.transform("rotate-270")))),delete this.loadedOrientationMatrix},"handle-logic":function(a){var b=0,d=a.delta,e=this.owner.state,f=[];if(this.tweens.length){for(e.reorienting=!0,c(this.matrixTween),b=this.tweens.length-1;b>=0;b--)this.updateTween(this.tweens[b],d)&&f.push(this.tweens.splice(b,1)[0]);for(b=0;b<this.vectors.length;b++)this.updateVector(this.vectors[b],this.inverses[b]);for(b=0;b<f.length;b++)this.transform(f[b].endMatrix),f[b].onFinished(f[b].endMatrix)}else e.reorienting&&(c(this.matrixTween),e.reorienting=!1)},"drop-tweens":function(){var a=0;for(this.tweens.length=0,a=0;a<this.vectors.length;a++)this.updateVector(this.vectors[a],this.inverses[a])},"orient-vector":function(a){var b=0,c=!1,d=a.aligned||!1;for(a.vector&&(a=a.vector),b=0;b<this.vectors.length;b++)if(a===this.vectors[b]){c=!0;break}c||(d||a.multiply(this.matrix),this.vectors.push(a),this.inverses.push(new platypus.Vector))},"remove-vector":function(a){var b=0;for(b=0;b<this.vectors.length;b++)if(a===this.vectors[b]){this.vectors.splice(b,1),this.inverses.splice(b,1);break}},"tween-transform":function(){var b=function(){},c=function(a){return a};return function(d){var e=d.angle||0,f=d.matrix;if(f||(f=a[d.transform]),!e&&0===d.transform.indexOf("rotate"))switch(d.transform){case"rotate-90":e=Math.PI/2;break;case"rotate-180":e=Math.PI;break;case"rotate-270":e=-Math.PI/2;break;default:e=d.transform.split("-")[1]/180*Math.PI}this.tweens.push({transform:d.transform,endTime:d.time||0,time:0,endMatrix:f,angle:e,tween:d.tween||c,onFinished:d.onFinished||b,onTick:d.onTick||b})}}(),transform:function(a){this.transform(a)},"prepend-transform":function(a){this.transform(a)},"append-transform":function(a){this.transform(a,!0)},"replace-transform":function(a){this.replace(a)}},methods:{transform:function(b,c){Array.isArray(b)?this.multiply(b,c):"string"==typeof b&&a[b]&&this.multiply(a[b],c)},multiply:function(){return function(a,c){var d=0;for(c?b(this.matrix,a,this.matrix):b(a,this.matrix,this.matrix),d=0;d<this.vectors.length;d++)this.vectors[d].multiply(a),this.inverses[d].multiply(a);this.owner.triggerEvent("orientation-updated",a)}}(),replace:function(){var a=function(a,b,c,d){return a*d-b*c},b=function(a){var b=0,c=0;for(b=0;3>b;b++)c+=a[b][0]*a[(b+1)%3][1]*a[(b+2)%3][2],c-=a[b][2]*a[(b+1)%3][1]*a[(b+2)%3][0];return c},c=function(c){var d=[[],[],[]],e=1/b(c);return d[0].push(a(c[1][1],c[1][2],c[2][1],c[2][2])*e),d[0].push(a(c[0][2],c[0][1],c[2][2],c[2][1])*e),d[0].push(a(c[0][1],c[0][2],c[1][1],c[1][2])*e),d[1].push(a(c[1][2],c[1][0],c[2][2],c[2][0])*e),d[1].push(a(c[0][0],c[0][2],c[2][0],c[2][2])*e),d[1].push(a(c[0][2],c[0][0],c[1][2],c[1][0])*e),d[2].push(a(c[1][0],c[1][1],c[2][0],c[2][1])*e),d[2].push(a(c[0][1],c[0][0],c[2][1],c[2][0])*e),d[2].push(a(c[0][0],c[0][1],c[1][0],c[1][1])*e),d};return function(a){this.multiply(c(this.matrix)),this.multiply(a)}}(),updateTween:function(){var a=function(a,b,c){return a*(1-c)+b*c};return function(c,d){var e=0,f=1,g=0,h=0,i=1,j=1,k=0,l=c.endMatrix,m=null;return c.time+=d,c.time>=c.endTime?!0:(e=c.tween(c.time/c.endTime),c.angle?(k=e*c.angle,f=i=Math.cos(k),g=Math.sin(k),h=-g):(f=a(f,l[0][0],e),g=a(g,l[1][0],e),h=a(h,l[0][1],e),i=a(i,l[1][1],e),j=a(j,l[2][2],e)),m=[[f,h,0],[g,i,0],[0,0,j]],b(m,this.matrixTween,this.matrixTween),void c.onTick(e,m))}}(),updateVector:function(a,b){b.set(a.add(b)),a.multiply(this.matrixTween),b.subtractVector(a)},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a[Math.floor(Math.random()*a.length)],b,c)}};return platypus.createComponentClass({id:"RandomEvents",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a=function(a,b,c,d){var e=0;for(e=0;e<a.length;e++)a[e].trigger(b,c,d)},b=function(b){return function(c,d){a(this.owner.familyLinks,b,c,d)}};return platypus.createComponentClass({id:"RelayFamily",constructor:function(a){var c="";if(a.events)for(c in a.events)a.events.hasOwnProperty(c)&&this.addEventListener(c,b(a.events[c]));this.owner.familyLinks=[this.owner]},events:{"link-family":function(b){var c=0,d=this.owner.familyLinks,e=b.concat(d);for(c=0;c<e.length;c++)e[c].familyLinks=e;a(b,"family-members-added",d),a(d,"family-members-added",b)},"entity-created":function(a){a.triggerEvent("link-family",this.owner.familyLinks)||(a.addComponent(new platypus.components.RelayFamily(a,{})),a.triggerEvent("link-family",this.owner.familyLinks))}},methods:{destroy:function(){var b=0;for(b=0;b<this.owner.familyLinks.length;b++)if(this.owner===this.owner.familyLinks[b]){this.owner.familyLinks.splice(b,1);break}a(this.owner.familyLinks,"family-member-removed",this.owner)}}})}(),function(){"use strict";var a=function(a){return function(b,c){platypus.game.currentScene.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayGame",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a=function(a){return function(b,c){var d=0;for(d=0;d<this.links.length;d++)this.links[d].trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayLinker",constructor:function(b){var c=0,d=this,e="";if(b.events)for(e in b.events)b.events.hasOwnProperty(e)&&this.addEventListener(e,a(b.events[e]));if(this.linkId=b.linkId||this.owner.linkId||"linked",this.owner.linkId||(this.owner.linkId=this.linkId),this.addEventListener("to-"+this.linkId+"-entities",a("from-"+this.linkId+"-entities")),this.addEventListener("from-"+this.linkId+"-entities",function(a){d.owner.trigger(a.message,a.value,a.debug)}),this.links=[],this.owner.linkEntities)for(c=0;c<this.owner.linkEntities.length;c++)this.links.push(this.owner.linkEntities[c]);this.message={message:"",value:null},this.linkMessage={entity:this.owner,linkId:this.linkId,reciprocate:!1},this.owner.parent&&this.resolveAdoption()},events:{adopted:function(a){this.resolveAdoption(a)},"link-entity":function(a){var b=0,c=!1;if(a.linkId===this.linkId&&a.entity!==this.owner){for(b=0;b<this.links.length;b++)if(this.links[b]===a.entity){c=!0;break}c||(this.links.push(a.entity),a.reciprocate&&(this.linkMessage.reciprocate=!1,a.entity.trigger("link-entity",this.linkMessage)))}},"unlink-entity":function(a){var b=0;for(b=0;b<this.links.length;b++)if(a.entity===this.links[b]){this.links.splice(b,1);break}}},methods:{resolveAdoption:function(a){for(var b=this.owner.parent;b.parent;)b=b.parent;this.linkMessage.reciprocate=!0,b.trigger("link-entity",this.linkMessage,!0)},destroy:function(){var a=0;for(a=0;a<this.links.length;a++)this.links[a].trigger("unlink-entity",this.linkMessage);this.links.length=0}}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.parent&&this.owner.parent.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayParent",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelaySelf",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a={aabb:"255,128,255",render:"128,128,128",collision:"255,0,255",group:"0,255,0"},b=function(b,c,d,e,f,g,h){var i=null;switch(b){case"rectangle":i=new createjs.Shape((new createjs.Graphics).beginFill("rgba("+a[c]+",0.1)").setStrokeStyle(3).beginStroke("rgb("+a[c]+")").rect(0,0,d,e)),f+=d/2,g+=e/2;break;case"circle":f+=d/2,g+=d/2,i=new createjs.Shape((new createjs.Graphics).beginFill("rgba("+a[c]+",0.1)").setStrokeStyle(3).beginStroke("rgb("+a[c]+")").drawCircle(d/2,d/2,d))}return i.regX=f,i.regY=g,i.z=h,i};return platypus.createComponentClass({id:"RenderDebug",constructor:function(a){a.acceptInput?(this.hover=a.acceptInput.hover||!1,this.click=a.acceptInput.click||!1):(this.hover=!1,this.click=!1),this.regX=a.regX||0,this.regY=a.regY||0,this.parentContainer=null,this.shapes=[],this.isOutdated=!0},events:{"handle-render-load":function(a){
platypus.game.settings.debug?!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container):this.owner.removeComponent(this)},"handle-render":function(){var a=0,b=null;for(this.isOutdated&&(this.updateSprites(),this.isOutdated=!1),a=0;a<this.shapes.length;a++)this.shapes[a].x=this.owner.x,this.shapes[a].y=this.owner.y;this.owner.getCollisionGroupAABB&&(b=this.owner.getCollisionGroupAABB(),this.groupShape||(this.groupShape=new createjs.Shape((new createjs.Graphics).beginFill("rgba(255,255,0,0.2)").rect(0,0,1,1)),this.groupShape.regX=.5,this.groupShape.regY=.5,this.groupShape.z=(this.owner.z||0)+1e4,this.parentContainer.addChild(this.groupShape)),this.groupShape.scaleX=b.width,this.groupShape.scaleY=b.height,this.groupShape.x=b.x,this.groupShape.y=b.y)},"orientation-updated":function(){this.isOutdated=!0}},methods:{updateSprites:function(){var a=(this.owner.z||0)+1e4,c=0,d=0,e=this.owner.width=this.owner.width||300,f=this.owner.height=this.owner.height||100,g=null,h=null,i=null;for(c=0;c<this.shapes.length;c++)this.parentContainer.removeChild(this.shapes[c]);if(this.shapes.length=0,this.owner.getAABB)for(d=0;d<this.owner.collisionTypes.length;d++)for(h=this.owner.getAABB(this.owner.collisionTypes[d]),e=this.initialWidth=h.width,f=this.initialHeight=h.height,g=this.owner.getShapes(this.owner.collisionTypes[d]),i=b("rectangle","aabb",e,f,this.owner.x-h.x,this.owner.y-h.y,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i),c=0;c<g.length;c++)i=b(g[c].type,"collision",g[c].radius||g[c].width,g[c].height,-g[c].offsetX,-g[c].offsetY,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i);else i=b("rectangle","render",e,f,e/2,f/2,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i)},addInput:function(){var a=null,b=function(b,c){return function(c){return a!==b.owner&&2===c.nativeEvent.button&&(a=b.owner,console.log('Entity "'+a.type+'":',a)),!1}};return function(a){a.addEventListener("mousedown",b(this,"mousedown"))}}(),destroy:function(){var a=0;for(a=0;a<this.shapes.length;a++)this.parentContainer.removeChild(this.shapes[a]);this.shapes.length=0,this.parentContainer=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderDestroyMe",constructor:function(a){this.animationIds=null,a.animationId?this.animationIds=[a.animationId]:a.animationIds&&(this.animationIds=a.animationIds)},events:{"animation-ended":function(a){var b=a.name,c=0;if(this.animationIds){for(c=0;c<this.animationIds.length;c++)if(this.animationIds[c]===b){this.owner.parent.removeEntity(this.owner);break}}else this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderProgress",properties:{backgroundColor:"#000000",color:"#ffffff",rotate:!1,mirror:!1,flip:!1,width:100,height:20,regX:0,regY:0},publicProperties:{x:0,y:0,z:0},constructor:function(a){var b=new createjs.Shape,c=new createjs.Shape,d=new createjs.Container;this.parentContainer=null,this.background=b,this.progress=c,this.container=d,b.graphics.f(this.backgroundColor).r(-this.regX,-this.regY,this.width,this.height),c.graphics.f(this.color).r(-this.regX,-this.regY,this.width,this.height),d.addChild(b),d.addChild(c)},events:{"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container))},"handle-render":function(a){this.parentContainer||(a&&a.container?(this.parentContainer=a.container,this.parentContainer.addChild(this.container)):(console.warn('No CreateJS Stage, removing ProgressRender component from "'+this.owner.type+'".'),this.owner.removeComponent(this))),this.container.x=this.x,this.container.y=this.y,this.container.z=this.z},"update-progress":function(a){isNaN(a)?"number"==typeof a.fraction?this.progress.scaleX=a.fraction:"number"==typeof a.total&&"number"==typeof a.progress&&(this.progress.scaleX=a.progress/a.total):this.progress.scaleX=a}},methods:{destroy:function(){this.parentContainer&&(this.parentContainer.removeChild(this.container),this.parentContainer=null),this.container=null}}})}(),function(){"use strict";var a=window.devicePixelRatio||1,b={},c=function(a){return function(b){this.animationFinished||this.lastState>=-1?(this.currentAnimation=a,this.lastState=-1,this.animationFinished=!1,this.sprite.gotoAndPlay(a)):(this.waitingAnimation=a,this.waitingState=-1)}},d=function(a,b){var c=0,d=a.replace(/ /g,"").split(",");return"default"===a?function(a){return b}:function(a){for(c=0;c<d.length;c++)if(!a[d[c]])return!1;return b}},e=function(){var a=function(a,b){var c=b.indexOf("("),d=b.substring(0,c),e=b.substring(c+1,b.indexOf(")"));e.length?a[d].apply(a,e.split(",")):a[d]()};return function(b,c){var d=0,e=c.split(".");for(d=0;d<e.length;d++)a(b,e[d])}}();return platypus.createComponentClass({id:"RenderSprite",publicProperties:{x:0,y:0,z:0},constructor:function(){var a={"default":0},e=function(c,d){var e=0,f=null,g=null,h=1,i=1,j=!1,k=c.spriteSheet,l={framerate:0,images:null,frames:null,animations:null},m={definition:l,spriteSheet:null};if(!k&&"string"==typeof c.image){if(b[c.image])return b[c.image];platypus.assets[c.image]&&platypus.assets[c.image].data&&platypus.assets[c.image].data.spriteSheet&&(b[c.image]=m,k=platypus.assets[c.image].data.spriteSheet,k.images=[platypus.assets[c.image].asset])}for(k&&!isNaN(k.framerate)?l.framerate=k.framerate:isNaN(c.framerate)?isNaN(d.framerate)||(l.framerate=d.framerate):l.framerate=c.framerate,k&&Array.isArray(k.images)?l.images=k.images.slice():k&&k.image?l.images=[k.image]:c.images?l.images=c.images.slice():c.image?l.images=[c.image]:d.images?l.images=d.images.slice():d.image?l.images=[d.image]:console.warn('"'+d.type+'" render component: No source image defined.'),e=0;e<l.images.length;e++)"string"==typeof l.images[e]&&(platypus.assets[l.images[e]]&&platypus.assets[l.images[e]].asset?(l.images[e]=platypus.assets[l.images[e]].asset,!j&&(l.images[e].scaleX&&1!==l.images[e].scaleX||l.images[e].scaleY&&1!==l.images[e].scaleY)&&(j=!0)):platypus.supports.iOS?console.warn('"'+d.type+'" render component: "'+l.images[e]+'" is not a loaded asset. Make sure the image is not too large for iOS Safari.'):console.warn('"'+d.type+'" render component: "'+l.images[e]+'" is not a loaded asset.'));if(k&&k.frames?l.frames=k.frames:c.frames?l.frames=c.frames:d.frames?l.frames=d.frames:c.source?(l.frames=[[c.source.x||c.x||0,c.source.y||c.y||0,c.source.width||c.width||l.images[0].width||d.width,c.source.height||c.height||l.images[0].height||d.height,0,c.regX||d.regX||0,c.regY||d.regY||0]],console.warn('"'+d.type+'" render component: The original render-image "source" parameter will soon be deprecated in favor of placing source information as individual parameters directly on the render component.')):(g=l.images[0],g&&(l.frames=[[c.x||0,c.y||0,c.width||l.images[0].width||d.width,c.height||l.images[0].height||d.height,0,c.regX||d.regX||0,c.regY||d.regY||0]])),j)if(Array.isArray(l.frames))for(f=l.frames,l.frames=[],e=0;e<f.length;e++)h=l.images[f[e][4]].scaleX||1,i=l.images[f[e][4]].scaleY||1,l.frames.push([f[e][0]*h,f[e][1]*i,f[e][2]*h,f[e][3]*i,f[e][4],f[e][5]*h,f[e][6]*i]);else h=l.images[0].scaleX||1,i=l.images[0].scaleY||1,l.frames={width:l.frames.width*h,height:l.frames.height*i,regX:l.frames.regX*h,regY:l.frames.regY*i};return k&&k.animations?l.animations=k.animations:c.animations?l.animations=c.animations:d.animations?l.animations=d.animations:l.animations=a,m.spriteSheet=new createjs.SpriteSheet(m.definition),m},f=function(a,b){var c=null,d="";if(a.animationMap)return a.animationMap;if(Array.isArray(b.frames)&&1===b.frames.length)return null;c={};for(d in b.animations)b.animations.hasOwnProperty(d)&&(c[d]=d);return c},g=function(a,b){var e="",f="";a.followThroughs={},a.checkStates=[];for(e in b)b.hasOwnProperty(e)&&(f=b[e],"!"===f[f.length-1]?(f=f.substring(0,f.length-1),a.followThroughs[f]=!0):a.followThroughs[f]=!1,a.eventBased&&a.addEventListener(e,c(f)),a.stateBased&&a.checkStates.push(d(e,f)))};return function(a){var b=this,c=e(a,this.owner),d=f(a,c.definition),h=a.scaleX||1,i=a.scaleY||1,j=a.rotation||0,k=a.skewX||0,l=a.skewY||0;this.sprite=null,this.parentContainer=null,this.rotate=a.rotate||!1,this.mirror=a.mirror||!1,this.flip=a.flip||!1,this.scale=a.scale!==!1,this.stateBased=d&&a.stateBased!==!1,this.eventBased=d&&a.eventBased!==!1,this.hover=!1,this.click=!1,this.touch=!1,this.forcePlaythrough=this.owner.forcePlaythrough||a.forcePlaythrough||!1,"left"===a.facing&&(h=-h),this.imageScaleX=c.definition.images[0].scaleX||1,this.imageScaleY=c.definition.images[0].scaleY||1,a.acceptInput&&(this.hover=a.acceptInput.hover||!1,this.click=a.acceptInput.click||!1,this.touch=a.acceptInput.touch||!1,this.camera={x:0,y:0},this.addEventListener("camera-update",function(a){b.camera.x=a.viewport.left,b.camera.y=a.viewport.top})),(this.eventBased||this.stateBased)&&(g(this,d),this.currentAnimation=d["default"]||""),this.sprite=new createjs.Sprite(c.spriteSheet,this.currentAnimation||0),this.sprite.addEventListener("animationend",function(a){b.owner.trigger("animation-ended",a),b.waitingAnimation?(b.currentAnimation=b.waitingAnimation,b.waitingAnimation=!1,b.lastState=b.waitingState,b.animationFinished=!1,b.sprite.gotoAndPlay(b.currentAnimation)):b.animationFinished=!0}),this.affine=new createjs.Matrix2D(1,0,0,1).appendTransform(0,0,h,i,j,k,l),this.owner.scaleX=this.owner.scaleX||this.owner.scale||1,this.owner.scaleY=this.owner.scaleY||this.owner.scale||1,this.owner.rotation=this.owner.rotation||0,this.owner.skewX=this.owner.skewX||this.owner.skew||0,this.owner.skewY=this.owner.skewY||this.owner.skew||0,a.pins?(this.container=new createjs.Container,this.container.transformMatrix=new createjs.Matrix2D(1,0,0,1),this.container.addChild(this.sprite),this.sprite.z=0,this.addPins(a.pins,c.definition.frames),this.sprite.transformMatrix=new createjs.Matrix2D(1,0,0,1).appendTransform(0,0,1/this.imageScaleX,1/this.imageScaleY,0)):(this.container=this.sprite,this.container.transformMatrix=new createjs.Matrix2D(1,0,0,1),this.affine.appendTransform(0,0,1/this.imageScaleX,1/this.imageScaleY,0)),a.acceptInput&&a.acceptInput.hitArea&&("string"==typeof a.acceptInput.hitArea?this.container.hitArea=this.setHitArea(a.acceptInput.hitArea):this.container.hitArea=this.setHitArea("r("+(this.owner.x||0)+","+(this.owner.y||0)+","+(this.owner.width||0)+","+(this.owner.height||0)+")")),(a.mask||this.owner.mask)&&(this.container.mask=this.setMask(a.mask||this.owner.mask)),this.pinTo=a.pinTo||!1,this.pinTo&&this.owner.triggerEvent("pin-me",this.pinTo),this.offsetZ=a.offsetZ||0,this.container.hidden=a.hidden||!1,this.ignoreOpacity=a.ignoreOpacity||!1,this.state=this.owner.state,this.stateChange=!1,this.lastState=-1,this.waitingAnimation=!1,this.waitingState=0,this.playWaiting=!1,this.animationFinished=!1,this.stateChange=!0,a.cache&&(this.updateSprite(),this.owner.cacheRender=this.container)}}(),events:{"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&this.addStage(a.container)},"handle-render":function(a){if(!this.parentContainer){if(this.pinTo)return;if(!this.addStage(a.container))return console.warn('No CreateJS Stage, removing render component from "'+this.owner.type+'".'),void this.owner.removeComponent(this)}this.updateSprite()},"logical-state":function(a){this.stateChange=!0},"hide-sprite":function(){this.container.hidden=!0},"show-sprite":function(){this.container.hidden=!1},"pin-me":function(a){this.pins&&this.pins[a]&&this.owner.trigger("attach-pin",this.pins[a])},"attach-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container),this.addInputs(),this.pinnedTo=a)},"remove-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer.removeChild(this.container),this.parentContainer=null,this.pinnedTo=null)},"dispatch-event":function(a){this.sprite.dispatchEvent(a)},"input-on":function(){this.removeInputListeners||this.addInputs()},"input-off":function(){this.removeInputListeners&&this.removeInputListeners()},"set-mask":function(a){a?this.container.mask=this.setMask(a):this.container.mask=null}},methods:{addStage:function(a){return a&&!this.pinTo?(this.parentContainer=a,this.parentContainer.addChild(this.container),this.addInputs(),a):null},updateSprite:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=0,e=0,f=null,g=0,h=!1,i=1,j=1,k=null,l=this.container.transformMatrix,m=l.copy(this.affine);if(this.pinnedTo?this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame]?(d=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].x,e=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].y,this.container.z!==this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z),g=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].angle||0,this.container.visible=!0):this.pinnedTo.defaultPin?(d=this.pinnedTo.defaultPin.x,e=this.pinnedTo.defaultPin.y,this.container.z!==this.pinnedTo.defaultPin.z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.defaultPin.z),g=this.pinnedTo.defaultPin.angle||0,this.container.visible=!0):this.container.visible=!1:(d=this.owner.x,e=this.owner.y,this.rotate&&(g=this.owner.rotation),this.container.z!==this.owner.z+this.offsetZ&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.owner.z+this.offsetZ),this.ignoreOpacity||!this.owner.opacity&&0!==this.owner.opacity||(this.container.alpha=this.owner.opacity)),this.container.reorder&&(this.container.reorder=!1,this.container.sortChildren(a)),(this.mirror||this.flip)&&(k=(180*this.owner.orientation/Math.PI+360)%360,this.mirror&&k>90&&270>k&&(i=-1),this.flip&&180>k&&(j=-1)),this.stateBased&&this.stateChange){if(void 0!==this.state.hidden&&(this.container.hidden=this.state.hidden),this.checkStates)for(c=0;c<this.checkStates.length;c++)if(h=this.checkStates[c](this.state)){this.currentAnimation!==h?!this.followThroughs[this.currentAnimation]&&(!this.forcePlaythrough||this.animationFinished||this.lastState>=+c)?(this.currentAnimation=h,this.lastState=+c,this.animationFinished=!1,this.sprite.gotoAndPlay(h)):(this.waitingAnimation=h,this.waitingState=+c):this.waitingAnimation&&!this.followThroughs[this.currentAnimation]&&(this.waitingAnimation=!1);break}this.stateChange=!1}this.pinnedTo?m.prependTransform(d,e,i,j,0,0,0):(this.owner.orientationMatrix&&(f=this.owner.orientationMatrix,m.prepend(f[0][0],f[1][0],f[0][1],f[1][1],f[0][2],f[1][2])),m.prependTransform(d,e,this.owner.scaleX*i,this.owner.scaleY*j,0,this.owner.skewX,this.owner.skewY)),g&&m.appendTransform(0,0,1,1,g)}}(),addInputs:function(){var b=function(b,c){return function(d){b.owner.trigger(c,{event:d.nativeEvent,cjsEvent:d,x:d.stageX*a/b.parentContainer.scaleX+b.camera.x,y:d.stageY*a/b.parentContainer.scaleY+b.camera.y,entity:b.owner})}};return function(){var a=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null;(this.click||this.touch)&&(a=b(this,"mousedown"),g=b(this,"pressmove"),h=b(this,"pressup"),i=b(this,"click"),j=b(this,"dblclick"),this.sprite.addEventListener("mousedown",a),this.sprite.addEventListener("pressmove",g),this.sprite.addEventListener("pressup",h),this.sprite.addEventListener("click",i),this.sprite.addEventListener("dblclick",j)),this.hover&&(c=b(this,"mouseover"),d=b(this,"mouseout"),e=b(this,"rollover"),f=b(this,"rollout"),this.sprite.addEventListener("mouseover",c),this.sprite.addEventListener("mouseout",d),this.container.addEventListener("rollover",e),this.container.addEventListener("rollout",f)),this.removeInputListeners=function(){(this.click||this.touch)&&(this.sprite.removeEventListener("mousedown",a),this.sprite.removeEventListener("pressmove",g),this.sprite.removeEventListener("pressup",h),this.sprite.removeEventListener("click",i),this.sprite.removeEventListener("dblclick",j)),this.hover&&(this.sprite.removeEventListener("mouseover",c),this.sprite.removeEventListener("mouseout",d),this.container.removeEventListener("rollover",e),this.container.removeEventListener("rollout",f)),this.removeInputListeners=null}}}(),addPins:function(a,b){var c=0,d=0,e=null,f=b.regX||0,g=b.regY||0,h=Array.isArray(b);for(this.pinsToRemove=this.pinsToRemove||[],this.pins={},c=0;c<a.length;c++){if(this.pinsToRemove.push(a[c].pinId),h&&(f=(b[0][5]||0)/this.imageScaleX,g=(b[0][6]||0)/this.imageScaleY),this.pins[a[c].pinId]=e={pinId:a[c].pinId,sprite:this.sprite,container:this.container},"number"==typeof a[c].x&&"number"==typeof a[c].y&&(e.defaultPin={x:a[c].x-f,y:a[c].y-g,z:a[c].z||1e-8,angle:a[c].angle||0}),a[c].frames)for(e.frames=[],d=0;d<a[c].frames.length;d++)a[c].frames[d]?(h&&(f=(b[d][5]||0)/this.imageScaleX,g=(b[d][6]||0)/this.imageScaleY),"number"==typeof a[c].frames[d].x&&"number"==typeof a[c].frames[d].y?e.frames.push({x:a[c].frames[d].x-f,y:a[c].frames[d].y-g,z:a[c].frames[d].z||(e.defaultPin?e.defaultPin.z:1e-8),angle:a[c].frames[d].angle||(e.defaultPin?e.defaultPin.angle:0)}):e.defaultPin?"number"==typeof a[c].frames[d].x?e.frames.push({x:a[c].frames[d].x-f,y:e.defaultPin.y,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):"number"==typeof a[c].frames[d].y?e.frames.push({x:e.defaultPin.x,y:a[c].frames[d].y-g,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):e.frames.push(null):e.frames.push(null)):e.frames.push(null);this.owner.trigger("attach-pin",e)}},removePins:function(){var a=0;if(this.pins&&this.pinsToRemove){for(a=0;a<this.pinsToRemove.length;a++)this.owner.trigger("remove-pin",this.pins[this.pinsToRemove[a]].pinId),delete this.pins[this.pinsToRemove[a]];this.pinsToRemove.length=0}},setMask:function(a){var b=new createjs.Shape,c=b.graphics;return b.x=0,b.y=0,"string"==typeof a?e(c,a):a.radius?c.dc(a.x||0,a.y||0,a.radius):c.r(a.x||0,a.y||0,a.width||this.owner.width||0,a.height||this.owner.height||0),b},setHitArea:function(){var a={};return function(b){var c=null,d=null,f="";return f="string"==typeof b?b:JSON.stringify(b),c=a[f],c||(c=new createjs.Shape,d=c.graphics,c.x=0,c.y=0,d.beginFill("#000"),"string"==typeof b?e(d,b):b.radius?d.dc(b.x||0,b.y||0,b.radius):d.r(b.x||0,b.y||0,b.width||this.owner.width||0,b.height||this.owner.height||0),a[f]=c),c}}(),destroy:function(){this.removeInputListeners&&this.removeInputListeners(),this.parentContainer&&(this.parentContainer.removeChild(this.container),this.parentContainer=null),this.removePins(),this.followThroughs=null,this.sprite=null,this.container=null}}})}(),function(){"use strict";var a=function(a,b){return a.z-b.z},b=function(a){var b=[document.createElement("canvas"),document.createElement("canvas")],c=0;return a.___cache||(a.___cache=a.cache,a.cache=function(a,d,e,f,g){c=1-c,this.cacheCanvas=b[c],this.___cache(a,d,e,f,g)}),a._getObjectsUnderPoint=function(a,b,c,d,e,f){return c?(c.push(this),null):this},a},c={x:1,y:1,t:-1,r:0},d=function(a){var b=+a.substring(4),d=c,e=!!(536870912&b),f=!!(1073741824&b),g=!!(2147483648&b);return d.t=268435455&b,d.x=1,d.y=1,d.r=0,(e||f||g)&&(e&&f&&g?(d.x=-1,d.r=90):e&&g?d.r=90:f&&g?d.r=180:e&&f?d.r=270:e?(d.y=-1,d.r=90):f?d.y=-1:g&&(d.x=-1)),d};return platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,entityCache:!1,imageMap:[],scaleX:1,scaleY:1,spriteSheet:null,tileHeight:10,tileWidth:10},constructor:function(a){var b=0,c=this.spriteSheet.images.slice(),d=null,e=0;if(c[0]&&"string"==typeof c[0])for(c=c.slice(),b=0;b<c.length;b++)platypus.assets[c[b]]&&platypus.assets[c[b]].asset&&(c[b]=platypus.assets[c[b]].asset);d={images:c,frames:this.spriteSheet.frames,animations:this.spriteSheet.animations},this.controllerEvents=void 0,this.spriteSheet=new createjs.SpriteSheet(d),this.doMap=null,this.tiles={},this.tilesToRender=void 0,this.worldWidth=this.tilesWidth=this.tileWidth,this.worldHeight=this.tilesHeight=this.tileHeight,e=(this.buffer||3*this.tileWidth/4)*this.scaleX,this.camera={x:-e-1,y:-e-1,buffer:e},this.cache={minX:-1,minY:-1,maxX:-1,maxY:-1},this.reorderedStage=!1},events:{"handle-render-load":function(a){var c=0,d=0,e=null,f="",g=this.imageMap,h=[];if(a&&a.container){for(e=this.parentContainer=a.container,e&&!this.reorderedStage&&(e.reorder=!0,this.reorderedStage=!0),this.tilesToRender=b(new createjs.Container),this.tilesToRender.name="entity-managed",c=0;c<g.length;c++)for(h[c]=[],d=0;d<g[c].length;d++)h[c][d]=f=g[c][d],this.tiles[f]||(this.tiles[f]=this.createTile(f));this.imageMap=h,this.tilesWidth=c*this.tileWidth,this.tilesHeight=d*this.tileHeight,this.tilesToRender.scaleX=this.scaleX,this.tilesToRender.scaleY=this.scaleY,this.tilesToRender.z=this.owner.z,e.addChild(this.tilesToRender)}},"peer-entity-added":function(a){var b=0,c=0,d=this.imageMap,e=a.cacheRender,f=null,g=0,h=0,i=0,j=0;if(this.entityCache&&e){for(this.doMap||(this.doMap=[]),f=e.getTransformedBounds(),g=Math.max(0,Math.floor(f.y/this.tileHeight)),h=Math.min(d[0].length,Math.ceil((f.y+f.height)/this.tileHeight)),j=Math.max(0,Math.floor(f.x/this.tileWidth)),i=Math.min(d.length,Math.ceil((f.x+f.width)/this.tileWidth)),b=j;i>b;b++)for(this.doMap[b]||(this.doMap[b]=[]),c=g;h>c;c++)this.doMap[b][c]||(this.doMap[b][c]=[]),this.doMap[b][c].push(e);a.removeComponent("RenderSprite")}},"add-tiles":function(a){var b=0,c=0,d=a.imageMap,e="",f=0;if(d)for(b=0;b<this.imageMap.length;b++)for(c=0;c<this.imageMap[b].length;c++)f=d[b][c],e=this.imageMap[b][c],this.tiles[e]&&delete this.tiles[e],e=this.imageMap[b][c]+=" "+f,this.tiles[e]||(this.tiles[e]=this.createTile(e))},"camera-loaded":function(a){this.worldWidth=a.width,this.worldHeight=a.height},"camera-update":function(b){var c=0,d=0,e=0,f=this.camera.buffer,g=this.cache,h=null,i=null,j=0,k=0,l=0,m=0,n=0,o=0,p=this.convertCamera(b.viewport.left,this.worldWidth,this.tilesWidth,b.viewport.width),q=this.convertCamera(b.viewport.top,this.worldHeight,this.tilesHeight,b.viewport.height),r=Math.floor(p/this.tileWidth)*this.tileWidth,s=Math.floor(q/this.tileHeight)*this.tileHeight,t=null,u=[],v=null;if(this.tilesToRender.x=b.viewport.left-p,this.tilesToRender.y=b.viewport.top-q,(Math.abs(this.camera.x-r)>f||Math.abs(this.camera.y-s)>f)&&this.imageMap.length>0&&(this.camera.x=r,this.camera.y=s,l=Math.min(Math.ceil((r+b.viewport.width+f)/(this.tileWidth*this.scaleX)),this.imageMap.length)-1,n=Math.max(Math.floor((r-f)/(this.tileWidth*this.scaleX)),0),m=Math.min(Math.ceil((s+b.viewport.height+f)/(this.tileHeight*this.scaleY)),this.imageMap[0].length)-1,o=Math.max(Math.floor((s-f)/(this.tileHeight*this.scaleY)),0),m>g.maxY||o<g.minY||l>g.maxX||n<g.minX)){for(this.tilesToRender.cacheCanvas&&(i=this.tilesToRender.cacheCanvas,this.tilesToRender.uncache()),this.tilesToRender.removeChildAt(0),this.tilesToRender.cache(n*this.tileWidth,o*this.tileHeight,(l-n+1)*this.tileWidth,(m-o+1)*this.tileHeight,1),c=n;l>=c;c++)for(d=o;m>=d;d++)if((d>g.maxY||d<g.minY||c>g.maxX||c<g.minX)&&(t=this.tiles[this.imageMap[c][d]],this.tilesToRender.removeChildAt(0),this.tilesToRender.addChild(t),t.x=(c+.5)*this.tileWidth,t.y=(d+.5)*this.tileHeight,this.tilesToRender.updateCache("source-over"),this.doMap&&this.doMap[c]&&this.doMap[c][d]))for(v=this.doMap[c][d],e=0;e<v.length;e++)v[e].drawn||(v[e].drawn=!0,u.push(v[e]));if(u.length)for(u.sort(a),e=0;e<u.length;e++)delete u[e].drawn,this.tilesToRender.removeChildAt(0),this.tilesToRender.addChild(u[e]),this.tilesToRender.updateCache("source-over");i&&(h=this.tilesToRender.cacheCanvas.getContext("2d"),j=(g.maxX-g.minX+1)*this.tileWidth,k=(g.maxY-g.minY+1)*this.tileHeight,h.drawImage(i,0,0,j,k,(g.minX-n)*this.tileWidth,(g.minY-o)*this.tileHeight,j,k),g.minX=n,g.minY=o,g.maxX=l,g.maxY=m)}}},methods:{convertCamera:function(a,b,c,d){return b/this.scaleX===c||b/this.scaleX===d?a:a*(c-d)/(b/this.scaleX-d)},createTile:function(a){var b=1,c=a.split(" "),e=null,f=new createjs.Sprite(this.spriteSheet,0),g=null;for(f.x=0,f.y=0,f.regX=this.tileWidth/2,f.regY=this.tileHeight/2,"tile-1"!==c[0]?(g=d(c[0]),f.scaleX=g.x,f.scaleY=g.y,f.rotation=g.r,f.gotoAndStop("tile"+g.t)):f.gotoAndStop("tile-1"),b=1;b<c.length;b++)"tile-1"!==c[b]&&(e||(e=new createjs.Container,e.addChild(f),e.cache(-this.tileWidth/2,-this.tileHeight/2,this.tileWidth,this.tileHeight,1)),g=d(c[b]),f.scaleX=g.x,f.scaleY=g.y,f.rotation=g.r,f.gotoAndStop("tile"+g.t),e.updateCache("source-over"));return e?e:(f.cache(0,0,this.tileWidth,this.tileHeight,1),f)},destroy:function(){this.tilesToRender.removeAllChildren(),this.parentContainer.removeChild(this.tilesToRender),this.imageMap.length=0,this.tiles=void 0,this.camera=void 0,this.parentContainer=void 0,this.tilesToRender=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"SceneChanger",constructor:function(a){this.scene=this.owner.scene||a.scene,this.transition=this.owner.transition||a.transition||"instant",this.persistentData=a.persistentData||{},this.preload=a.preload||!1,a.message&&console.warn('"'+this.type+'" components no longer accept "message": "'+a.message+'" as a definition parameter. Use "aliases": {"'+a.message+'": "new-scene"} instead.')},events:{"scene-live":function(){this.preload&&platypus.game.loadScene(this.scene,this.transition,this.persistentData,!0)},"new-scene":function(a){var b=a||this,c=b.scene||this.scene,d=b.transition||this.transition,e=b.persistentData||this.persistentData;platypus.game.loadScene(c,d,e)},"set-scene":function(a){this.scene=a},"set-persistent-scene-data":function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this.persistentData[b]=a[b])}}})}(),function(){"use strict";var a=function(a){var b=!!(536870912&a),c=!!(1073741824&a),d=!!(2147483648&a);return b&&d?-3:b?-5:c?-4:-2},b={x:1,y:1,id:-1},c=function(a){var c=b,d=!!(1073741824&a),e=!!(2147483648&a);return c.id=268435455&a,c.x=1,c.y=1,d&&e?(c.x=-1,c.y=-1):d?c.y=-1:e&&(c.x=-1),c},d={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]},"tile-layer":{id:"tile-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"},{type:"CollisionTiles",collisionMap:"import"}]}};return platypus.createComponentClass({id:"TiledLoader",properties:{images:null,layerIncrement:1e3,separateTiles:!1},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},constructor:function(a){this.entities=[],this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(a){this.manuallyLoad||this.loadLevel({level:this.level||a.level,persistentData:a})},"load-level":function(a){this.loadLevel(a)}},methods:{loadLevel:function(a){var b=a.level,c=0,d=!1;for("string"==typeof b&&(b=platypus.game.settings.levels[b]),c=0;c<b.layers.length;c++)d=this.setupLayer(b.layers[c],b,d),this.separateTiles&&(d=!1);this.owner.trigger("world-loaded",{width:b.width*b.tilewidth*this.unitsPerPixel,height:b.height*b.tileheight*this.unitsPerPixel,tile:{width:b.tilewidth,height:b.tileheight},camera:this.followEntity}),this.owner.removeComponent(this)},setupLayer:function(b,e,f){var g=this,h=g.images||[],i=e.tilesets,j=e.tilewidth,k=e.tileheight,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=null,t=0,u=null,v=0,w=0,x=null,y="",z=-1,A=1/0,B=-(1/0),C=1/0,D=-(1/0),E=null,F=null,G=null,H=!0,I=0,J=null,K=0,L=0,M=function(a){var b=0,c=0,d=a.properties||{},e={data:[],image:"",height:1,name:a.name,type:"tilelayer",width:1,tileheight:k,tilewidth:j,x:a.x,y:a.y,properties:d};for(d.repeat&&(e.width=+d.repeat,e.height=+d.repeat),d["repeat-x"]&&(e.width=+d["repeat-x"]),d["repeat-y"]&&(e.height=+d["repeat-y"]),c=e.width*e.height,b=0;c>b;b++)e.data.push(1);return platypus.assets[a.name]&&platypus.assets[a.name].asset?(e.image=platypus.assets[a.name].asset,e.tileheight=e.image.height,e.tilewidth=e.image.width):(console.warn('Component TiledLoader: Cannot find the "'+a.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+a.name+'".'),e.image=a.image),e},N=function(b,c){var e=c.width,l=c.height,m=c.tileheight||k,n=c.tilewidth||j,o=0,p=0,q=0,r=null,s=null,t=null,u=null,v=!1,w=null,x=null,y=0,z=0,A=0,B=c.data;if(c.properties&&(c.properties.width&&(o=parseInt(c.properties.width,10)),c.properties.height&&(p=parseInt(c.properties.height,10)),o||p)){for(o=o||e,p=p||l,B=[],z=0;o>z;z++)for(A=0;p>A;A++)e>z&&l>A?B[z+A*o]=c.data[z+A*e]:B[z+A*o]=0;e=o,l=p}if(r=JSON.parse(JSON.stringify(platypus.game.settings.entities[b]||d[b])),s={},t=[],u=[],"collision-layer"===b)for(x=[],z=0;z<i.length;z++)if(w=i[z],w.tileproperties)for(A in w.tileproperties)w.tileproperties.hasOwnProperty(A)&&w.tileproperties[A].jumpThrough&&x.push(w.firstgid+parseInt(A,10)-1);for(r.properties=r.properties||{},r.properties.width=n*e*g.unitsPerPixel,r.properties.height=m*l*g.unitsPerPixel,r.properties.columns=e,r.properties.rows=l,r.properties.tileWidth=n*g.unitsPerPixel,r.properties.tileHeight=m*g.unitsPerPixel,r.properties.scaleX=g.imagesScale,r.properties.scaleY=g.imagesScale,r.properties.layerZ=g.layerZ,r.properties.z=r.properties.z||g.layerZ,q=c.image?c.image.width/n*(c.image.height/m):i[i.length-1].imagewidth/n*(i[i.length-1].imageheight/m)+i[i.length-1].firstgid,z=-1;q>z;z++)s["tile"+z]=z;for(z=0;e>z;z++)for(t[z]=[],u[z]=[],A=0;l>A;A++)y=+B[z+A*e]-1,u[z][A]="tile"+y,x&&x.length&&x[0]===(268435455&y)&&(y=a(y)),t[z][A]=y;for(z=0;z<r.components.length;z++)"RenderTiles"===r.components[z].type&&(v=r.components[z]),"import"===r.components[z].spriteSheet&&(r.components[z].spriteSheet={images:c.image?[c.image]:h,frames:{width:n*g.unitsPerPixel/g.imagesScale,height:m*g.unitsPerPixel/g.imagesScale},animations:s}),"import"===r.components[z].collisionMap&&(r.components[z].collisionMap=t),"import"===r.components[z].imageMap&&(r.components[z].imageMap=u);return g.layerZ+=g.layerIncrement,"render-layer"===b&&f&&f.tileHeight===m&&f.tileWidth===n&&f.columns===e&&f.rows===l?(f.trigger("add-tiles",v),f):g.owner.addEntity(new platypus.Entity(r,{properties:{}}))};if(0===h.length)for(n=0;n<i.length;n++)platypus.assets[i[n].name]&&platypus.assets[i[n].name].asset?h.push(platypus.assets[i[n].name].asset):(console.warn('Component TiledLoader: Cannot find the "'+i[n].name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+i[n].name+'".'),h.push(i[n].image));else for(h=h.slice(),n=0;n<h.length;n++)platypus.assets[h[n]]&&platypus.assets[h[n]].asset&&(h[n]=platypus.assets[h[n]].asset);if("tilelayer"===b.type){if(u="render-layer",b.properties&&b.properties.entity)u=b.properties.entity;else switch(b.name){case"collision":u="collision-layer";break;case"action":for(u="tile-layer",n=0;n<e.layers.length;n++)("collision"===e.layers[n].name||e.layers[n].properties&&"collision-layer"===e.layers[n].properties.entity)&&(H=!1);H||(u="render-layer")}if("tile-layer"===u)return N("collision-layer",b),N("render-layer",b);if("collision-layer"!==u)return N(u,b);N(u,b)}else{if("imagelayer"===b.type)return N("image-layer",M(b));if("objectgroup"===b.type){for(v=this.entityPositionX,w=this.entityPositionY,b.properties&&(b.properties.entityPositionX&&(v=b.properties.entityPositionX),b.properties.entityPositionY&&(w=b.properties.entityPositionY)),t=0;t<b.objects.length;t++){for(u=b.objects[t],z=u.gid||-1,E=null,-1!==z&&(E=c(z),z=E.id),n=0;n<i.length&&!(i[n].firstgid>z);n++)F=i[n];if(y="",""!==u.type?y=u.type:""!==u.name?y=u.name:F.tileproperties[z-F.firstgid]&&(F.tileproperties[z-F.firstgid].entity?y=F.tileproperties[z-F.firstgid].entity:F.tileproperties[z-F.firstgid].type&&(y=F.tileproperties[z-F.firstgid].type)),""!==y){if(G={},E?(G.scaleX=E.x,G.scaleY=E.y):(G.scaleX=1,G.scaleY=1),z>=0&&F.tileproperties&&F.tileproperties[z-F.firstgid])for(n in F.tileproperties[z-F.firstgid])F.tileproperties[z-F.firstgid].hasOwnProperty(n)&&(I=parseFloat(F.tileproperties[z-F.firstgid][n]),
0===I||I?G[n]=I:"true"===F.tileproperties[z-F.firstgid][n]?G[n]=!0:"false"===F.tileproperties[z-F.firstgid][n]?G[n]=!1:G[n]=F.tileproperties[z-F.firstgid][n]);for(n in u.properties)if(u.properties.hasOwnProperty(n))if(x=u.properties[n],"string"==typeof x)if(I=parseFloat(x),0===I||I)G[n]=I;else if("true"===x)G[n]=!0;else if("false"===x)G[n]=!1;else if(x.length>2&&("{"===x[0]&&"}"===x[x.length-1]||"["===x[0]&&"]"===x[x.length-1]))try{G[n]=JSON.parse(x)}catch(O){G[n]=x}else G[n]=x;else G[n]=x;if(u.polygon||u.polyline){for(A=1/0,B=-(1/0),C=1/0,D=-(1/0),J=null,u.polygon?J=u.polygon:u.polyline&&(J=u.polyline),n=0;n<J.length;n++)J[n].x>B&&(B=J[n].x),J[n].x<A&&(A=J[n].x),J[n].y>D&&(D=J[n].y),J[n].y<C&&(C=J[n].y);if(G.width=B-A,G.height=D-C,G.x=u.x+A,G.y=u.y+C,l=0,m=0,G.width=G.width*this.unitsPerPixel,G.height=G.height*this.unitsPerPixel,G.x=G.x*this.unitsPerPixel,G.y=G.y*this.unitsPerPixel,u.polygon)for(G.shape={},G.shape.type="polygon",G.shape.points=[],o=0;o<J.length;o++)G.shape.points.push({x:(J[o].x-A)*this.unitsPerPixel,y:(J[o].y-C)*this.unitsPerPixel});else if(u.polyline)for(G.shape={},G.shape.type="polyline",G.shape.points=[],o=0;o<J.length;o++)G.shape.points.push({x:(J[o].x-A)*this.unitsPerPixel,y:(J[o].y-C)*this.unitsPerPixel})}else K=j*this.unitsPerPixel,L=k*this.unitsPerPixel,l=0,m=0,G.width=(u.width||0)*this.unitsPerPixel,G.height=(u.height||0)*this.unitsPerPixel,y&&platypus.game.settings.entities[y]&&platypus.game.settings.entities[y].properties&&(G.width||(G.width=platypus.game.settings.entities[y].properties.width||0,l=K),G.height||(G.height=platypus.game.settings.entities[y].properties.height||0,m=L)),G.width||(G.width=K),G.height||(G.height=L),l=l||G.width,m=m||G.height,G.x=u.x*this.unitsPerPixel,G.y=u.y*this.unitsPerPixel,u.rotation&&(p=(u.width||K)/2,q=(u.height||L)/2,r=u.rotation/180%2*Math.PI,s=new platypus.Vector(p,-q).rotate(r),G.rotation=u.rotation,G.x=Math.round(1e3*(G.x+s.x-p))/1e3,G.y=Math.round(1e3*(G.y+s.y+q))/1e3),"left"===v?G.regX=0:"center"===v?(G.regX=G.width/2,G.x+=l/2):"right"===v&&(G.regX=G.width,G.x+=l),-1===z&&(G.y+=G.height),"bottom"===w?G.regY=G.height:"center"===w?(G.regY=G.height/2,G.y-=m/2):"top"===w&&(G.regY=0,G.y-=m),u.ellipse?(G.shape={},G.shape.type="ellipse",G.shape.width=G.width*this.unitsPerPixel,G.shape.height=G.height*this.unitsPerPixel):u.width&&u.height&&(G.shape={},G.shape.type="rectangle",G.shape.width=G.width*this.unitsPerPixel,G.shape.height=G.height*this.unitsPerPixel);platypus.game.settings.entities[y].properties?(G.scaleX*=this.imagesScale*(platypus.game.settings.entities[y].properties.scaleX||1),G.scaleY*=this.imagesScale*(platypus.game.settings.entities[y].properties.scaleY||1)):(G.scaleX*=this.imagesScale,G.scaleY*=this.imagesScale),G.layerZ=this.layerZ,G.z?G.z+=this.layerZ:y&&platypus.game.settings.entities[y]&&platypus.game.settings.entities[y].properties&&platypus.game.settings.entities[y].properties.z?G.z=this.layerZ+platypus.game.settings.entities[y].properties.z:G.z=this.layerZ,G.parent=this.owner,u=this.owner.addEntity(new platypus.Entity(platypus.game.settings.entities[y],{properties:G})),u&&(u.camera&&(this.followEntity={entity:u,mode:u.camera}),this.owner.triggerEvent("entity-created",u))}}return this.layerZ+=this.layerIncrement,!1}}},destroy:function(){this.entities.length=0}}})}(),function(){"use strict";var a=function(a,b,c,d){return function(){a.trigger(b,c,d)}},b=function(b){return function(c){var d=0,e=b,f=null,g=null,h=createjs.Tween.get(this.owner);if(Array.isArray(c))e=c;else if(!Array.isArray(e))return;for(d=0;d<e.length;d++)f=e[d],"string"==typeof f?h.call(a(this.owner,f)):Array.isArray(f)?"call"===f[0]&&"string"==typeof f[1]?h.call(a(this.owner,f[1])):(g=f.slice(),g.splice(0,1),h[f[0]].apply(h,g)):"call"===f.method&&"string"==typeof f.params?h.call(a(this.owner,f.params)):h[f.method].apply(h,f.params)}};return platypus.createComponentClass({id:"Tween",constructor:function(a){var c="";if(a.events)for(c in a.events)a.events.hasOwnProperty(c)&&this.addEventListener(c,b(a.events[c]))}})}(),function(){"use strict";var a=function(a,b){return" "===b?a+"default":a+b},b=function(b,c,d,e){var f=0,g="",h={},i=0,j="",k="",l=b.voice;if("string"==typeof b.sound)h.sound=b.sound,h.events=[];else{for(g in b.sound)b.sound.hasOwnProperty(g)&&(h[g]=b.sound[g]);h.events?h.events=h.events.slice():h.events=[]}if(l)for(l+=" ",f=0;f<l.length;f++)k=l[f],k!==j&&(j=k,h.events.push({time:i,event:a(d,k)})),i+=e;return h},c=function(a,c,d,e){var f=0,g=[],h=null;if(c[" "]||(c[" "]=c["default"]),Array.isArray(a)){for(f=0;f<a.length;f++)g.push(b(a[f],c,d,e));return h=g.splice(0,1)[0],h.next=g,h}return b(a,c,d,e)};return platypus.createComponentClass({id:"VoiceOver",constructor:function(b){var d="",e={audioMap:{},voiceOver:b.voiceOver,aliases:b.aliases},f={spriteSheet:b.spriteSheet,acceptInput:b.acceptInput,scaleX:b.scaleX,scaleY:b.scaleY,rotate:b.rotate,mirror:b.mirror,flip:b.flip,hidden:b.hidden,animationMap:{},pins:b.pins,pinTo:b.pinTo,aliases:b.aliases};this.message=(b.messagePrefix||"VoiceOver")+"-";for(d in b.animationMap)b.animationMap.hasOwnProperty(d)&&(f.animationMap[a(this.message,d)]=b.animationMap[d]);f.animationMap["default"]=b.animationMap["default"],this.owner.addComponent(new platypus.components.RenderSprite(this.owner,f));for(d in b.voiceoverMap)b.voiceoverMap.hasOwnProperty(d)&&(e.audioMap[d]=c(b.voiceoverMap[d],b.animationMap,this.message,b.frameLength||100));this.owner.addComponent(new platypus.components.Audio(this.owner,e))},events:{load:function(a){this.owner.removeComponent(this)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"XHR",properties:{method:"GET",path:"",responseType:"text",withCredentials:!1},constructor:function(a){this.setProperties(a)},events:{request:function(a){if(this.setProperties(a),"GET"===this.method)this.get();else{if("POST"!==this.method)throw"Method must be GET or POST";this.post()}}},methods:{setProperties:function(a){var b="",c="",d=this,e=a||this;if(this.method=e.method||this.method||"GET",this.path=e.path||this.path||null,this.responseType=e.responseType||this.responseType||"text",this.withCredentials=e.withCredentials||this.withCredentials||!1,e!==this&&e.data){this.data="";for(b in e.data)e.data.hasOwnProperty(b)&&(this.data+=c+b+"="+e.data[b],c="&")}else this.data="";this.onload=e.onload||this.onload||function(a){200===this.status&&d.owner.trigger("response",this.responseText)}},get:function(){var a=new XMLHttpRequest,b=this.path;this.data&&(b+="?"+this.data),a.open(this.method,b,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.onload=this.onload,a.send()},post:function(){var a=new XMLHttpRequest;a.open(this.method,this.path,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=this.onload,a.send(this.data)}}})}();
