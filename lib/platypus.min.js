/*!
* @license platypus
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.pako=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;c>b;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;c>b;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],2:[function(a,b,c){"use strict";function d(a,b){if(65537>b&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;b>d;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;256>j;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=new e.Buf8(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;d>c;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;h>c;)if(f=a[c++],128>f)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&h>c;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:65536>f?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":1}],3:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=d},{}],4:[function(a,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a=-1^a;for(var h=d;g>h;h++)a=a>>>8^e[255&(a^b[h])];return-1^a}var f=d();b.exports=e},{}],6:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],7:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(w>q&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,w>q&&(p+=B[f++]<<q,q+=8,w>q&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(w>n){if(z+=l+n-w,w-=n,x>w){x-=w;do C[h++]=o[z++];while(--w);if(z=0,x>n){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(g>f&&j>h);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=g>f?5+(g-f):5-(f-g),a.avail_out=j>h?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],8:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=K,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new r.Buf32(oa),b.distcode=b.distdyn=new r.Buf32(pa),b.sane=1,b.back=-1,C):F}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):F}function h(a,b){var c,d;return a&&a.state?(d=a.state,0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15)),b&&(8>b||b>15)?F:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):F}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==C&&(a.state=null),c):F}function j(a){return i(a,ra)}function k(a){if(sa){var b;for(p=new r.Buf32(512),q=new r.Buf32(32),b=0;144>b;)a.lens[b++]=8;for(;256>b;)a.lens[b++]=9;for(;280>b;)a.lens[b++]=7;for(;288>b;)a.lens[b++]=8;for(v(x,a.lens,0,288,p,0,a.work,{bits:9}),b=0;32>b;)a.lens[b++]=5;v(y,a.lens,0,32,q,0,a.work,{bits:5}),sa=!1}a.lencode=p,a.lenbits=9,a.distcode=q,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new r.Buf8(f.wsize)),d>=f.wsize?(r.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),r.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(r.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new r.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return F;c=a.state,c.mode===V&&(c.mode=W),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=C;a:for(;;)switch(c.mode){case K:if(0===c.wrap){c.mode=W;break}for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0),m=0,n=0,c.mode=L;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=la;break}if((15&m)!==J){a.msg="unknown compression method",c.mode=la;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=la;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?T:V,m=0,n=0;break;case L:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==J){a.msg="unknown compression method",c.mode=la;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=la;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0,c.mode=M;case M:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=t(c.check,Ba,4,0)),m=0,n=0,c.mode=N;case N:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0,c.mode=O;case O:if(1024&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=P;case P:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),r.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=Q;case Q:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=R;case R:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=S;case S:if(512&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=la;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=V;break;case T:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=U;case U:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,E;a.adler=c.check=1,c.mode=V;case V:if(b===A||b===B)break a;case W:if(c.last){m>>>=7&n,n-=7&n,c.mode=ia;break}for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=X;break;case 1:if(k(c),c.mode=ba,b===B){m>>>=2,n-=2;break a}break;case 2:c.mode=$;break;case 3:a.msg="invalid block type",c.mode=la}m>>>=2,n-=2;break;case X:for(m>>>=7&n,n-=7&n;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=la;break}if(c.length=65535&m,m=0,n=0,c.mode=Y,b===B)break a;case Y:c.mode=Z;case Z:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;r.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=V;break;case $:for(;14>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=la;break}c.have=0,c.mode=_;case _:for(;c.have<c.ncode;){for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=v(w,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=la;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(16>sa)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=la;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=la;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===la)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=la;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=v(x,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=la;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=v(y,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=la;break}if(c.mode=ba,b===B)break a;case ba:c.mode=ca;case ca:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,u(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===V&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ha;break}if(32&ra){c.back=-1,c.mode=V;break}if(64&ra){a.msg="invalid literal/length code",c.mode=la;break}c.extra=15&ra,c.mode=da;case da:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=ea;case ea:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=la;break}c.offset=sa,c.extra=15&ra,c.mode=fa;case fa:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=la;break}c.mode=ga;case ga:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=la;break}q>c.wnext?(q-=c.wnext,oa=c.wsize-q):oa=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,oa=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[oa++];while(--q);0===c.length&&(c.mode=ca);break;case ha:if(0===j)break a;f[h++]=c.length,j--,c.mode=ca;break;case ia:if(c.wrap){for(;32>n;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?t(c.check,f,p,h-p):s(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=la;break}m=0,n=0}c.mode=ja;case ja:if(c.wrap&&c.flags){for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=la;break}m=0,n=0}c.mode=ka;case ka:xa=D;break a;case la:xa=G;break a;case ma:return H;case na:default:return F}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<la&&(c.mode<ia||b!==z))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=ma,H):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?t(c.check,f,p,a.next_out-p):s(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===V?128:0)+(c.mode===ba||c.mode===Y?256:0),(0===o&&0===p||b===z)&&xa===C&&(xa=I),xa)}function n(a){if(!a||!a.state)return F;var b=a.state;return b.window&&(b.window=null),a.state=null,C}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?F:(c.head=b,b.done=!1,C)):F}var p,q,r=a("../utils/common"),s=a("./adler32"),t=a("./crc32"),u=a("./inffast"),v=a("./inftrees"),w=0,x=1,y=2,z=4,A=5,B=6,C=0,D=1,E=2,F=-2,G=-3,H=-4,I=-5,J=8,K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9,T=10,U=11,V=12,W=13,X=14,Y=15,Z=16,$=17,_=18,aa=19,ba=20,ca=21,da=22,ea=23,fa=24,ga=25,ha=26,ia=27,ja=28,ka=29,la=30,ma=31,na=32,oa=852,pa=592,qa=15,ra=qa,sa=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;e>=D;D++)P[D]=0;for(E=0;o>E;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;G>F&&0===P[F];F++);for(F>H&&(H=F),K=1,D=1;e>=D;D++)if(K<<=1,K-=P[D],0>K)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;e>D;D++)Q[D+1]=Q[D]+P[D];for(E=0;o>E;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;G>I+J&&(K-=P[I+J],!(0>=K));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":1}],10:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}],"/lib/inflate.js":[function(a,b,c){"use strict";function d(a,b){var c=new n(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}var f=a("./zlib/inflate.js"),g=a("./utils/common"),h=a("./utils/strings"),i=a("./zlib/constants"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=a("./zlib/gzheader"),m=Object.prototype.toString,n=function(a){this.options=g.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=f.inflateInit2(this.strm,b.windowBits);if(c!==i.Z_OK)throw new Error(j[c]);this.header=new l,f.inflateGetHeader(this.strm,this.header)};n.prototype.push=function(a,b){var c,d,e,j,k,l=this.strm,n=this.options.chunkSize,o=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,"string"==typeof a?l.input=h.binstring2buf(a):"[object ArrayBuffer]"===m.call(a)?l.input=new Uint8Array(a):l.input=a,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new g.Buf8(n),l.next_out=0,l.avail_out=n),c=f.inflate(l,i.Z_NO_FLUSH),c===i.Z_BUF_ERROR&&o===!0&&(c=i.Z_OK,o=!1),c!==i.Z_STREAM_END&&c!==i.Z_OK)return this.onEnd(c),this.ended=!0,!1;l.next_out&&(0===l.avail_out||c===i.Z_STREAM_END||0===l.avail_in&&(d===i.Z_FINISH||d===i.Z_SYNC_FLUSH))&&("string"===this.options.to?(e=h.utf8border(l.output,l.next_out),j=l.next_out-e,k=h.buf2string(l.output,e),l.next_out=j,l.avail_out=n-j,j&&g.arraySet(l.output,l.output,e,j,0),this.onData(k)):this.onData(g.shrinkBuf(l.output,l.next_out))),0===l.avail_in&&0===l.avail_out&&(o=!0)}while((l.avail_in>0||0===l.avail_out)&&c!==i.Z_STREAM_END);return c===i.Z_STREAM_END&&(d=i.Z_FINISH),d===i.Z_FINISH?(c=f.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===i.Z_OK):d===i.Z_SYNC_FLUSH?(this.onEnd(i.Z_OK),l.avail_out=0,!0):!0},n.prototype.onData=function(a){this.chunks.push(a)},n.prototype.onEnd=function(a){a===i.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=n,c.inflate=d,c.inflateRaw=e,c.ungzip=d},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),this.platypus=this.platypus||{},function(){"use strict";var a=navigator.userAgent.toLowerCase(),b=a.search("edge")>-1,c=a.search("ipod")>-1,d=a.search("iphone")>-1,e=a.search("ipad")>-1,f=a.search("android")>-1,g=a.search("silk")>-1,h=c||d||e,i=h||f||g;platypus.supports={touch:"undefined"!==window.ontouchstart,edge:b,iPod:c,iPhone:d,iPad:e,safari:a.search("safari")>-1&&!b,ie:a.search("msie")>-1||a.search("trident")>-1,firefox:a.search("firefox")>-1,android:f,chrome:a.search("chrome")>-1&&!b,silk:g,iOS:h,mobile:i,desktop:!i},platypus.version="NEXT",platypus.buildDate="Wed, 30 Mar 2016 15:03:31 GMT"}(),function(){var a={value:!1,writable:!0},b={};platypus.setUpRecycle=function(c,d,e){var f=[],g=!!springroll.Debug;return b[d]=f,g?(c.setUp=function(){var b=null;return f.length?(b=f.pop(),b.recycled=!1):(b=Object.create(this.prototype),Object.defineProperty(b,"recycled",a)),this.apply(b,arguments),b},c.recycle=function(a){a.recycled?console.warn("WHOA! I have already been recycled!",a):(a.recycled=!0,f.push(a))}):(c.setUp=function(){var a=null;return a=f.length?f.pop():Object.create(this.prototype),this.apply(a,arguments),a},c.recycle=function(a){f.push(a)}),Object.defineProperty(c.prototype,"recycle",{value:e||function(){c.recycle(this)}}),f},platypus.getObjectCaches=function(){return b}}(),function(a,b){var c=null,d=!!springroll.Debug,e=a.prototype,f={value:!1,writable:!0};e.union||b.defineProperty(e,"union",{value:function(a){var b=0,c=a.length;for(b=0;c>b;b++)-1===this.indexOf(a[b])&&this.push(a[b]);return this}}),e.greenSlice||b.defineProperty(e,"greenSlice",{value:function(){var b=a.setUp(),c=0,d=this.length;for(c=0;d>c;c++)b[c]=this[c];return b}}),e.greenSplice||b.defineProperty(e,"greenSplice",{value:function(a){var b=0,c=this[a],d=this.length;if(!(0>a||a>=d)){for(b=a+1;d>b;b++)this[b-1]=this[b];return d&&(this.length-=1),c}}}),e.recycle||(c=platypus.setUpRecycle(a,"Array",function(b){var c=0;if(b>1)for(c=this.length,b-=1;c--;)this[c].recycle(b);this.length=0,a.recycle(this)}),d?a.setUp=function(){var a=0,d=null;for(c.length?(d=c.pop(),d.recycled=!1):(d=[],b.defineProperty(d,"recycled",f)),a=0;a<arguments.length;a++)d.push(arguments[a]);return d}:a.setUp=function(){var a=0,b=null;for(b=c.length?c.pop():[],a=0;a<arguments.length;a++)b.push(arguments[a]);return b})}(Array,Object),function(){"use strict";var a=function(a){return function(){return platypus.game.settings.debug&&console.log('"'+a+'" is not an available PIXI.Graphics method.'),this}},b=PIXI.Graphics.prototype;b.a=b.arc,b.at=b.arcTo,b.bt=b.bezierCurveTo,b.c=b.clear,b.dc=b.drawCircle,b.de=b.drawEllipse,b.dr=b.drawRect,b.ef=b.endFill,b.f=b.beginFill,b.lt=b.lineTo,b.mt=b.moveTo,b.qt=b.quadraticCurveTo,b.r=b.drawRect,b.rr=b.drawRoundedRect,b.cp=a("cp"),b.lf=a("lf"),b.rf=a("rf"),b.bf=a("bf"),b.ss=a("ss"),b.sd=a("sd"),b.s=a("s"),b.ls=a("ls"),b.rs=a("rs"),b.bs=a("bs"),b.es=a("es"),b.rc=a("rc"),b.dp=a("dp"),b.p=a("p")}(),function(){"use strict";var a=PIXI.Container.prototype;a.updateTransform=function(){var a=0,b=0;if(this.visible)for(this.transformMatrix?(this.transformMatrix.copy(this.worldTransform).prepend(this.parent.worldTransform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null):this.displayObjectUpdateTransform(),a=0,b=this.children.length;b>a;++a)this.children[a].updateTransform()},a.containerUpdateTransform=a.updateTransform}(),function(a,b){var c=a.prototype;c.greenSplit||b.defineProperty(c,"greenSplit",{value:function(a){var b=this.toString(),c=0,d=0,e=Array.setUp();if(a){for(d=b.indexOf(a),c=a.length;d>=0;)e.push(b.substr(0,d)),b=b.substr(d+c),d=b.indexOf(a);e.push(b)}else for(d=this.length,c=d-1;d--;)e.push(this[c-d]);return e}})}(String,Object),function(a){"use strict";var b=null,c=null,d=null;window.Map||(b={value:null},c=function(){b.value={},a.defineProperty(this,"map",b)},d=c.prototype,a.defineProperties(d,{get:{value:function(a){return this.map[a]}},has:{value:function(a){return this.map.hasOwnProperty(a)}},set:{value:function(a,b){return this.map[a]=b,this}},"delete":{value:function(a){var b=this.map[a];return delete this.map[a],b}}}),window.Map=c)}(Object),platypus.Data=function(){"use strict";var a=function(a){var b=arguments.length,c="";if(a)if("string"==typeof a)for(b%2&&(this[b]=null,b-=1);b;)this[arguments[b-2]]=arguments[b-1],b-=2;else for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])};return platypus.setUpRecycle(a,"Data",function(){var b="";for(b in this)this.hasOwnProperty(b)&&delete this[b];a.recycle(this)}),a}(),platypus.DataMap=function(){"use strict";var a=function(a,b,c){return this.get(b)!==c&&(this.has(b)||a.push(b),this.set(b,c)),c},b=function(a,b){var c=a.indexOf(b),d=this.get(b);return c>=0&&(a.greenSplice(c),this["delete"](b)),d},c=function(a){for(var b=a.length;b--;)this["delete"](a[b]);a.length=0},d={get:{value:null},has:{value:null},keys:{value:null},set:{value:null},"delete":{value:null},clear:{value:null}},e=function(e){var f=arguments.length,g="",h=null,i=null,j=null;if(this.map||(j=d,i=this.map=new window.Map,h=j.keys.value=Array.setUp(),j.get.value=i.get.bind(i),j.has.value=i.has.bind(i),j.set.value=a.bind(i,h),j["delete"].value=b.bind(i,h),j.clear.value=c.bind(i,h),Object.defineProperties(this,j)),e)if(h=e.keys,"string"==typeof e)for(f%2&&(f-=1,this.set(arguments[f],null));f;)f-=2,this.set(arguments[f],arguments[f+1]);else if(h)for(f=h.length;f--;)this.set(h[f],e.get(h[f]));else for(g in e)e.hasOwnProperty(g)&&this.set(g,e[g])};return platypus.setUpRecycle(e,"DataMap",function(){this.clear(),e.recycle(this)}),e}(),function(){"use strict";var a=include("springroll.Application"),b=include("PIXI.BaseTexture"),c=include("PIXI.Point"),d=include("PIXI.Rectangle"),e=include("PIXI.Sprite"),f=include("PIXI.Texture"),g={},h={},i={texture:f.EMPTY,anchor:new c(0,0)},j=/[\[\]{},-]/g,k=function(a,b){var c=0,d=a.width,e=a.height,f=a.regX||0,g=a.regY||0,h=0,i=0,j=0,k=0,l=Array.setUp();for(c=0;c<b.length;c++)for(h=b[c].realWidth-d,i=b[c].realHeight-e,k=0;i>=k;k+=e)for(j=0;h>=j;j+=d)l.push([j,k,d,e,c,f,g]);return l},l=function(c){var d=0,e=Array.setUp(),f=null,g=a.instance.assetManager.cache,i=h,j=null;for(d=0;d<c.length;d++)if(j=c[d],"string"==typeof j){if(!i[j]){if(f=g.read(j),!f){console.warn('"'+j+'" is not a loaded asset.');break}i[j]=new b(f)}e.push(i[j])}else e.push(new b(j));return e},m=function(a,b){return a[b[4]]+"-x"+b[0]+"y"+b[1]+"w"+b[2]+"h"+b[3]},n=function(a){var b=0;if(a.id)return a.id;for(b=0;b<a.images.length;b++)if("string"!=typeof a.images[b])return"";return a.id=JSON.stringify(a).replace(j,""),a.id},o=function(a,b,c){var d=0,e=Array.setUp();if("number"==typeof b)return e.push(c[b]||i),{id:a,frames:e,next:a,speed:1};if(Array.isArray(b)){for(d=b[0];d<b[1]+1;d++)e.push(c[d]||i);return{id:a,frames:e,next:b[2]||a,speed:b[3]||1}}for(d=0;d<b.frames.length;d++)e.push(c[b.frames[d]]||i);return{id:a,frames:e,next:b.next||a,speed:b.speed||1}},p=function(a,b){var c="",d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=o(c,a[c],b));return d},q=function(a){var b=0,e=null,g=null,h=null,i=a.images,j=null,m=Array.setUp(),n=l(i);for(h=Array.isArray(a.frames)?a.frames.greenSlice():k(a.frames,n),b=0;b<h.length;b++)g=h[b],j=new f(n[g[4]],new d(g[0],g[1],g[2],g[3])),m.push({texture:j,anchor:new c((g[5]||0)/j.width,(g[6]||0)/j.height)});return e=p(a.animations||{},m),e["default"]||(e["default"]=o("default",[0,m.length-1],m)),h.recycle(),n.recycle(),{textures:m,animations:e}},r=function(a,b){var e=0,g="",h=null,i=null,j=null,n=a.images,q=null,r=Array.setUp(),s=l(n);for(j=Array.isArray(a.frames)?a.frames.greenSlice():k(a.frames,s),e=0;e<j.length;e++)i=j[e],g=m(n,i),q=new f(s[i[4]],new d(i[0],i[1],i[2],i[3])),r.push({texture:q,anchor:new c((i[5]||0)/q.width,(i[6]||0)/q.height)});return h=p(a.animations||{},r),h["default"]||(h["default"]=o("default",[0,r.length-1],r)),j.recycle(),s.recycle(),{textures:r,animations:h,viable:1,cacheId:b}},s=function(a,b){var c=n(a),d=c?g[c]:null,f=(a.framerate||60)/60;c?d?(d.viable+=1,this.cacheId=c):(d=g[c]=r(a,c),this.cacheId=c):d=q(a),e.call(this,d.textures[0].texture),this._animations=d.animations,this._animation=null,this.animationSpeed=f,this.onComplete=null,this._currentTime=0,this.playing=!1,this._visible=!0,this._updating=!1,d.textures.length<2?this.gotoAndStop(b):this.gotoAndPlay(b)},t=s.prototype=Object.create(e.prototype);s.prototype.constructor=s,platypus.PIXIAnimation=s,Object.defineProperties(t,{visible:{get:function(){return this._visible},set:function(a){this._visible=a,this._syncUpdate()}},currentFrame:{get:function(){var a=this._animation.frames;return a[Math.floor(this._currentTime)%a.length]}},paused:{get:function(){return!this.playing},set:function(a){(a&&this.playing||!a&&!this.playing)&&(this.playing=!a,this._syncUpdate())}}}),t.stop=function(){this.paused=!0},t.play=function(){this.paused=!1},t._syncUpdate=function(){var a=this.playing&&this._visible;a!==this._updating&&(this._updating=a,a?PIXI.ticker.shared.add(this.update,this):PIXI.ticker.shared.remove(this.update,this))},t.gotoAndStop=function(a){this.stop(),this._currentTime=0,this._animation=this._animations[a],this._animation||(this._animation=this._animations["default"]),this._texture=this._animation.frames[0].texture,this.anchor=this._animation.frames[0].anchor},t.gotoAndPlay=function(a){this._currentTime=0,this._animation=this._animations[a],
this._animation||(this._animation=this._animations["default"]),this._texture=this._animation.frames[0].texture,this.anchor=this._animation.frames[0].anchor,this.play()},t.update=function(a){var b=null,c="",d=0;this._currentTime+=this.animationSpeed*this._animation.speed*a,d=Math.floor(this._currentTime),0>d&&(d=0),d<this._animation.frames.length?(b=this._animation.frames[d%this._animation.frames.length],this._texture=b.texture,this.anchor=b.anchor):d>=this._animation.frames.length&&(c=this._animation.id,this.gotoAndPlay(this._animation.next),this.onComplete&&this.onComplete(c))},t.destroy=function(){var a="";if(this.stop(),e.prototype.destroy.call(this),this.cacheId&&(g[this.cacheId].viable-=1,g[this.cacheId].viable<=0)){g[this.cacheId].textures.recycle();for(a in g[this.cacheId].animations)g[this.cacheId].animations.hasOwnProperty(a)&&g[this.cacheId].animations[a].frames.recycle();delete g[this.cacheId]}},s.preloadBaseTextures=function(a){var b=h,c="";if(a.updateTexture)for(c in b)b.hasOwnProperty(c)&&a.updateTexture(b[c])},s.destroyBaseTextures=function(){var a=h,b="";for(b in a)a.hasOwnProperty(b)&&(a[b].destroy(),delete a[b])}}(),platypus.StateMap=function(){"use strict";var a=include("platypus.DataMap"),b=function(b){var c=arguments.length;c?1===c&&"string"==typeof b?(a.call(this),this.updateFromString(b)):a.apply(this,arguments):a.call(this)},c=extend(b,a);return Object.defineProperty(c,"updateFromString",{value:function(a){for(var b=a.greenSplit(","),c=b.length,d="";c--;)d=b[c],d&&("!"===d.substr(0,1)?this.set(d.substr(1),!1):this.set(d,!0));return b.recycle(),this}}),Object.defineProperty(c,"update",{value:function(a){for(var b=a.keys,c=b.length,d="",e=!1,f=!1;c--;)d=b[c],f=a.get(d),this.get(d)!==f&&(this.set(d,f),e=!0);return e}}),Object.defineProperty(c,"includes",{value:function(a){for(var b=a.keys,c=b.length,d="";c--;)if(d=b[c],this.get(d)!==a.get(d))return!1;return!0}}),Object.defineProperty(c,"intersects",{value:function(a){for(var b=a.keys,c=b.length,d="";c--;)if(d=b[c],this.get(d)===a.get(d))return!0;return!1}}),platypus.setUpRecycle(b,"StateMap",function(){this.clear(),b.recycle(this)}),b}(),platypus.Component=function(){"use strict";var a=include("platypus.Data"),b=function(a){return Array.setUp()},c=function(b,c){this.type=b,this.owner=c,this.publicMethods=a.setUp(),this.listener=a.setUp("events",Array.setUp(),"messages",Array.setUp())},d=c.prototype;return d.toString=function(){return"[Component "+this.type+"]"},d.destroy=function(){var a="";if(this.listener){this._destroy&&this._destroy();for(a in this.publicMethods)this.publicMethods.hasOwnProperty(a)&&this.removeMethod(a);this.publicMethods.recycle(),this.removeEventListeners(),this.listener.events.recycle(),this.listener.messages.recycle(),this.listener.recycle(),this.listener=null}},d.removeEventListeners=function(a){var b=0,c=null,d=null;if(a)for(b=0;b<a.length;b++)this.removeEventListener(a[b]);else{for(c=this.listener.events,d=this.listener.messages,b=0;b<c.length;b++)this.owner.off(c[b],d[b]);c.length=0,d.length=0}},d.addEventListener=function(a,b,c){var d=b.bind(this);this.listener.events.push(a),this.listener.messages.push(d),this.owner.on(a,d,c)},d.addMethod=function(a,b){this.owner[a]?console.warn(this.owner.type+': Entity already has a method called "'+a+'". Method not added.'):(this.owner[a]=function(){return b.apply(this,arguments)}.bind(this),this.publicMethods[a]=b)},d.removeEventListener=function(a,b){var c=0,d=this.listener.events,e=this.listener.messages;for(c=d.length-1;c>=0;c--)d[c]!==a||b&&e[c]!==b||(this.owner.off(a,e[c]),this.listener.events.greenSplice(c),this.listener.messages.greenSplice(c))},d.removeMethod=function(a){this.owner[a]?delete this.owner[a]:console.warn(this.owner.type+': Entity does not have a method called "'+a+'".'),delete this.publicMethods[a]},c.getAssetList=b,c.getLateAssetList=b,c}(),platypus.Messenger=function(){"use strict";var a=include("springroll.EventDispatcher"),b=function(){a.call(this),this.loopCheck=Array.setUp()},c=!!springroll.Debug,d=c&&window.performance&&window.performance.mark&&window.performance.measure&&window.performance,e=extend(b,a);return e.toString=function(){return"[Messenger Object]"},e._trigger=e.trigger,e.trigger=function(a,b,c){var d=0,e=0;if("string"==typeof a)return this.triggerEvent(a,b,c);if(Array.isArray(a)){for(d=0;d<a.length;d++)e+=this.trigger(a[d],b,c);return e}return a.event?this.triggerEvent(a.event,a.message||b,a.debug||c):(console.warn('Event incorrectly formatted: must be string, array, or object containing an "event" property.',a),0)},e.triggerEvent=function(a){var b=0,c=0,d=null,e=this._listeners,f=null;if(!this._destroyed&&e.hasOwnProperty(a)&&void 0!==e[a]){for(e=e[a].greenSlice(),arguments.length>1&&(f=Array.prototype.greenSlice.call(arguments),f.greenSplice(0)),b=c=e.length;c--;)d=e[c],d._eventDispatcherOnce&&(delete d._eventDispatcherOnce,this.off(a,d)),d.apply(this,f);f&&f.recycle(),e.recycle()}return b},c&&(e._triggerEvent=e.triggerEvent,e.triggerEvent=function(a,b){var c=0,e=b&&b.debug,f=0,g=0;if(e||this.debug){for(c=0;c<this.loopCheck.length;c++)if(this.loopCheck[c]===a){if(f+=1,f>5)throw"Endless loop detected for '"+a+"'.";console.warn("Event '"+a+"' is nested inside another '"+a+"' event.")}return this.loopCheck.push(a),d&&d.mark("a"),g=this._triggerEvent.apply(this,arguments),d&&(d.mark("b"),d.measure(this.type+":"+a,"a","b")),this.loopCheck.length=this.loopCheck.length-1,e&&(g?console.log('Entity "'+this.type+'": Event "'+a+'" has '+g+" subscriber"+(g>1?"s":"")+".",b):console.warn('Entity "'+this.type+'": Event "'+a+'" has no subscribers.',b)),g}return this._triggerEvent.apply(this,arguments)}),e.getMessageIds=function(){return Object.keys(this._listeners)},e.eventDispatcherDestroy=e.destroy,e.destroy=function(){this.loopCheck.recycle(),this.eventDispatcherDestroy()},b}(),platypus.Entity=function(){"use strict";var a=include("platypus.Data"),b=include("platypus.StateMap"),c={},d=function(a,b){platypus.game.settings.debug&&console.warn(a,b)},e=function(e,f){var g=0,h=null,i=a.setUp(e),j=i.components,k=a.setUp(i.properties),l=a.setUp(f),m=a.setUp(l.properties),n=Array.setUp(),o=Array.setUp();if(platypus.Messenger.call(this),this.components=Array.setUp(),this.type=i.id||"none",this.id=l.id||m.id,this.id||(c[this.type]||(c[this.type]=0),this.id=this.type+"-"+c[this.type],c[this.type]+=1),this.setProperty(k),this.setProperty(m),this.on("set-property",function(a){this.setProperty(a)}.bind(this)),this.state=b.setUp(this.state),this.lastState=b.setUp(),this.trigger=this.triggerEvent=function(a,b){n.push(a),o.push(b)},j)for(g=0;g<j.length;g++)h=j[g],h&&(platypus.components[h.type]?this.addComponent(new platypus.components[h.type](this,h)):d('Entity "'+this.type+'": Component "'+h.type+'" is not defined.',h));for(delete this.trigger,delete this.triggerEvent,g=0;g<n.length;g++)this.trigger(n[g],o[g]);n.recycle(),o.recycle(),this.triggerEvent("load"),i.recycle(),k.recycle(),l.recycle(),m.recycle()},f=e.prototype=new platypus.Messenger;return f.toString=function(){return"[entity "+this.type+"]"},f.addComponent=function(a){return this.components.push(a),this.triggerEvent("component-added",a),a},f.removeComponent=function(a){var b=0;if("string"==typeof a){for(b=0;b<this.components.length;b++)if(this.components[b].type===a)return a=this.components[b],this.components.greenSplice(b),this.triggerEvent("component-removed",a),a.destroy(),a}else for(b=0;b<this.components.length;b++)if(this.components[b]===a)return this.components.greenSplice(b),this.triggerEvent("component-removed",a),a.destroy(),a;return!1},f.setProperty=function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},f.messengerDestroy=f.destroy,f.destroy=function(){var a=this.components,b=a.length;if(!this._destroyed){for(;b--;)a[b].destroy();a.recycle(),this.state.recycle(),this.state=null,this.lastState.recycle(),this.lastState=null,this.messengerDestroy()}},e.getAssetList=function(a,b){var c=0,f=null,g=null,h=null,i=null;if(a.type)return i=platypus.game.settings.entities[a.type],i?e.getAssetList(i,a.properties):(d('Entity "'+a.type+'": This entity is not defined.',a),h);for(h=Array.setUp(),c=0;c<a.components.length;c++)f=a.components[c]&&a.components[c].type&&platypus.components[a.components[c].type],f&&(g=f.getAssetList(a.components[c],a.properties,b),h.union(g),g.recycle());return h},e.getLateAssetList=function(a,b,c){var d=0,f=null,g=null,h=null;if(a.type)return e.getLateAssetList(platypus.game.settings.entities[a.type],b,c);for(h=Array.setUp(),d=0;d<a.components.length;d++)f=a.components[d]&&a.components[d].type&&platypus.components[a.components[d].type],f&&(g=f.getLateAssetList(a.components[d],a.properties,b,c),h.union(g),g.recycle());return h},e}(),platypus.Scene=function(){"use strict";var a=include("platypus.Entity"),b=include("platypus.PIXIAnimation"),c=include("springroll.State"),d=/([\w-]+)\.(\w+)$/,e=function(a){var b=a.match(d),c={id:a,src:a};return b?c.id=b[1]:c.src="assets/images/"+a+".png",c},f=function(a){this.app.unload(a),a.recycle()},g=function(){var a=0,c="",d=this.layerDefinitions,e=!0,f=!1,g=null,h=null;for(this.storeMessages=!0,this.storedMessages=Array.setUp(),this.layers=Array.setUp(),a=0;a<d.length;a++){if(f=d[a],g={stage:this.stage,parent:this},f.properties)for(c in f.properties)f.properties.hasOwnProperty(c)&&(g[c]=f.properties[c]);if(f.type&&(f=platypus.game.settings.entities[f.type]),e=!0,f.filter){if(f.filter.includes){e=!1;for(c in f.filter.includes)f.filter.includes.hasOwnProperty(c)&&platypus.supports[f.filter.includes[c]]&&(e=!0)}if(f.filter.excludes)for(c in f.filter.excludes)f.filter.excludes.hasOwnProperty(c)&&platypus.supports[f.filter.excludes[c]]&&(e=!1)}e&&this.layers.push(new platypus.Entity(f,{properties:g}))}for(h=this.storedMessages,this.storeMessages=!1,a=0;a<h.length;a++)this.triggerOnChildren(h[a].message,h[a].value);h.recycle(),this.storedMessages=null,platypus.game.settings.debug&&console.log("Scene loaded: "+this.id),this.triggerOnChildren("scene-loaded",this.data),b.preloadBaseTextures(this.app.display.renderer)},h=function(a,b){var d=this.getAssetList(b);c.call(this,a,b.options),this.id=b.id,this.preload.union(d),this.layerDefinitions=b.layers,this.storeMessages=!1,this.storedMessages=null,this.stage=a,this.layers=null,this.assets=b.assets||null,this.on("loading",function(a){var c=this.getLateAssetList(b);c.length?(a.union(c),this.once("exit",f.bind(this,c))):c.recycle()}),this.on("loaded",g),d.recycle()},i=extend(h,c);return i.enterDone=function(){platypus.game.currentScene=this,platypus.game.settings.debug&&console.log("Scene live: "+this.id),this.triggerOnChildren("scene-live",this.data)},i.exitStart=function(){platypus.game.settings.debug&&console.log("Scene ending: "+this.id),this.triggerOnChildren("scene-ended",this.data)},i.triggerOnChildren=function(a,b){var c=0;if(this.storeMessages)this.storedMessages.push({message:a,value:b});else for(c=0;c<this.layers.length;c++)this.layers[c].trigger(a,b)},i.getEntityById=function(a){var b=0,c=null;for(b=0;b<this.layers.length;b++){if(this.layers[b].id===a)return this.layers[b];if(this.layers[b].getEntityById&&(c=this.layers[b].getEntityById(a)))return c}return void 0},i.getEntitiesByType=function(a){var b=0,c=null,d=Array.setUp();for(b=0;b<this.layers.length;b++)this.layers[b].type===a&&d.push(this.layers[b]),this.layers[b].getEntitiesByType&&(c=this.layers[b].getEntitiesByType(a),d.union(c),c.recycle());return d},i.exit=function(){var a=0;for(a=0;a<this.layers.length;a++)this.layers[a].destroy();this.layers.recycle(),this.layers=null,b.destroyBaseTextures(),platypus.game.currentScene=null},i.getAssetList=function(b){var c=0,d=null,f=Array.setUp();for(b.assets&&f.union(b.assets),c=0;c<b.layers.length;c++)d=a.getAssetList(b.layers[c]),f.union(d),d.recycle();for(c=0;c<f.length;c++)f[c]=e(f[c]);return f},i.getLateAssetList=function(b){var c=0,d=null,f=Array.setUp();for(c=0;c<b.layers.length;c++)d=a.getLateAssetList(b.layers[c],null,this.data),f.union(d),d.recycle();for(c=0;c<f.length;c++)f[c]=e(f[c]);return f},h}(),platypus.Game=function(){"use strict";var a=include("PIXI.Container"),b=include("platypus.Scene"),c=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="text",c.onload=function(){var d=null;if(200===c.status)try{d=JSON.parse(c.responseText)}catch(e){console.warn('Error parsing "'+a+'": '+e.message)}else console.warn('Error opening "'+a+'": '+c.description);b(d)},c.send()},d=function(a,b){var e=0,f="",g=0,h=function(c){g-=1,g||b(a)},i=function(a,b,c){d(a[b],function(d){a[b]=d,c(d)})};if(a){if(Array.isArray(a)){if(g=a.length)for(e=0;e<a.length;e++)i(a,e,h);else b(a);return}if("object"==typeof a){if(a.src&&a.src.length>5&&".json"===a.src.substring(a.src.length-5).toLowerCase())d(a.src,function(c){a.src!==c&&(a=c),b(a)});else{for(f in a)a.hasOwnProperty(f)&&(g+=1);if(g)for(f in a)a.hasOwnProperty(f)&&i(a,f,h);else b(a)}return}if("string"==typeof a&&a.length>5&&".json"===a.substring(a.length-5).toLowerCase())return void c(a,function(a){"object"==typeof a?d(a,b):b(a)})}b(a)},e=function(c,e,f){var g=function(c){var d="",e="",g=this.app.states||{};platypus.game=this,this.currentScene=null,this.settings=c,this.stage=this.app.display.stage;for(e in c.scenes)c.scenes.hasOwnProperty(e)&&(d=c.scenes[e].id=c.scenes[e].id||e,g[d]=new b(new a,c.scenes[e]));this.app.states||(this.app.states=g),f&&f(this),window.getEntityById=function(a){return this.getEntityById(a)}.bind(this),window.getEntitiesByType=function(a){return this.getEntitiesByType(a)}.bind(this),window.getVisibleSprites=function(a,b){var c=0;if(b=b||Array.setUp(),a=a||this.stage,!a.texture&&a.visible){for(c=0;c<a.children.length;c++)window.getVisibleSprites(a.children[c],b);return b}return a.visible?(b.push(a),b):b}.bind(this)}.bind(this);return c?(this.app=e,void("string"==typeof c?d(c,g):g(c))):(console.warn("No game definition is supplied. Game not created."),null)},f=e.prototype;return f.tick=function(a){this.currentScene&&this.currentScene.triggerOnChildren("tick",a)},f.loadScene=function(){var c=function(c,d){var e="",f=null;"string"==typeof c?(this.app.states[c].data=d,this.app.manager.state=c):(e=c.id=c.id||"new-scene",f=new b(new a,c),f.data=d,this.app.manager.addState(e,f),this.stage.addChild(f.panel),this.app.trigger("stateAdded",e,f),this.app.manager.state=e)};return function(a,b){setTimeout(c.bind(this,a,b),1)}}(),f.getEntityById=function(a){return this.currentScene?this.currentScene.getEntityById(a):null},f.getEntitiesByType=function(a){return this.currentScene?this.currentScene.getEntitiesByType(a):Array.setUp()},f.destroy=function(){},e}(),platypus.Vector=function(){"use strict";var a=function(a,b,c){this.matrix||(this.matrix=Array.setUp()),this.set(a,b,c)},b=a.prototype;return Object.defineProperty(b,"x",{get:function(){return this.matrix[0]},set:function(a){this.matrix[0]=a}}),Object.defineProperty(b,"y",{get:function(){return this.matrix[1]},set:function(a){this.matrix[1]=a}}),Object.defineProperty(b,"z",{get:function(){return this.matrix[2]},set:function(a){this.matrix[2]=a}}),b.toString=function(){return"["+this.matrix.join(",")+"]"},b.set=function(a,b,c){return a&&a.matrix?this.setVector(a,b):a&&Array.isArray(a)?this.setArray(a,b):this.setXYZ(a,b,c)},b.setXYZ=function(a,b,c){var d=this.matrix;return d[0]=a||0,d[1]=b||0,d[2]=c||0,this},b.setVector=function(a,b){return this.setArray(a.matrix,b)},b.setArray=function(a,b){for(var c=b||a.length,d=this.matrix;c--;)d[c]=a[c];return this},b.equals=function(a,b,c){var d=null,e=0,f=this.matrix;if(a&&Array.isArray(a)){for(e=b||a.length;e--;)if(f[e]!==a[e])return!1;return!0}if(a&&a.matrix){for(d=a.matrix,e=b||d.length;e--;)if(f[e]!==d[e])return!1;return!0}return!("number"!=typeof a||f[0]!==a||"number"==typeof b&&f[1]!==b||"number"==typeof c&&f[2]!==c)},b.copyValues=b.setVector,b.magnitude=function(a){var b=0,c=0;for(a=a||this.matrix.length,c=0;a>c;c++)b+=Math.pow(this.matrix[c],2);return Math.sqrt(b)},b.getAngle=function(){var a=this.magnitude(2),b=0;return 0!==a&&(b=Math.acos(this.x/a),this.y<0&&(b=2*Math.PI-b)),b},b.getUnit=function(){return platypus.Vector.setUp(this).normalize()},b.getInverse=function(){return platypus.Vector.setUp(this).multiply(-1)},b.normalize=function(){var a=this.magnitude();return 0===a?this:this.multiply(1/a)},b.cross=function(){var a=function(a,b,c,d){return a*d-b*c};return function(b){var c=a(this.y,this.z,b.y,b.z),d=-a(this.x,this.z,b.x,b.z),e=a(this.x,this.y,b.x,b.y);return this.x=c,this.y=d,this.z=e,this}}(),b.getCrossProduct=function(a){return platypus.Vector.setUp(this).cross(a)},b.rotate=function(a,b){var c=b,d=null,e=Math.cos(a),f=Math.sin(a),g=1-e,h=0,i=0,j=0,k=platypus.Vector.setUp();return c?"x"===c?c=k.setXYZ(1,0,0):"y"===c?c=k.setXYZ(0,1,0):"z"===c&&(c=k.setXYZ(0,0,1)):c=k.setXYZ(0,0,1),h=c.x,i=c.y,j=c.z,d=Array.setUp(Array.setUp(e+h*h*g,h*i*g-j*f,h*j*g+i*f),Array.setUp(i*h*g+j*f,e+i*i*g,i*j*g-h*f),Array.setUp(j*h*g-i*f,j*i*g+h*f,e+j*j*g)),this.multiply(d),k.recycle(),d.recycle(2),this},b.multiply=function(a,b){var c=0,d=0,e=null,f=0;if(Array.isArray(a)){for(e=this.matrix.greenSlice(),f=b||a.length,c=0;f>c;c++)for(this.matrix[c]=0,d=0;f>d;d++)this.matrix[c]+=e[d]*a[c][d];e.recycle()}else for(f=b||this.matrix.length,c=0;f>c;c++)this.matrix[c]*=a;return this},b.add=function(b,c,d){var e=b,f=0,g=0;for(Array.isArray(e)?f=c||this.matrix.length:e instanceof a?(e=e.matrix,f=c||this.matrix.length):(e=[b||0,c||0,d||0],f=this.matrix.length),g=0;f>g;g++)this.matrix[g]+=e[g];return this},b.addVector=function(a,b){return this.add(a,b)},b.subtractVector=function(a,b){return this.add(a.getInverse(),b)},b.scale=function(a,b){return this.multiply(a,b)},b.dot=function(a,b){var c=0,d=0,e=this.matrix,f=a.matrix;for(d=b||e.length;d--;)c+=e[d]*(f[d]||0);return c},b.angleTo=function(a){var b=this.getUnit(),c=a.getUnit(),d=0;return b.magnitude()&&c.magnitude()?d=Math.acos(b.dot(c)):(console.warn("Vector: Attempted to find the angle of a zero-length vector."),d=void 0),b.recycle(),c.recycle(),d},b.signedAngleTo=function(a,b){var c=this.getUnit(),d=a.getUnit(),e=c.getCrossProduct(d),f=0;return f=e.dot(b)<0?-Math.acos(c.dot(d)):Math.acos(c.dot(d)),c.recycle(),d.recycle(),e.recycle(),f},b.scalarProjection=function(b){var c=null,d=0;return"number"==typeof b?this.magnitude(2)*Math.cos(b):(c=a.setUp(b).normalize(),d=this.dot(c),c.recycle(),d)},b.copy=function(){return platypus.Vector.setUp(this)},a.assign=function(){var a=function(a,b,c,d){var e=null,f=!1;"string"==typeof a&&"undefined"!=typeof b[a]&&(e=b[a],delete b[a],f=!0),Object.defineProperty(b,a,{get:function(){return c.matrix[d]},set:function(a){c.matrix[d]=a},enumerable:!0}),f&&(b[a]=e)};return function(b,c){var d=0;if(b&&c){if(!b[c]){for(b[c]=platypus.Vector.setUp(),d=2;d<arguments.length;d++)arguments[d]!==c&&a(arguments[d],b,b[c],d-2);return}return b[c]}return null}}(),platypus.setUpRecycle(a,"Vector",function(){this.matrix.length=0,a.recycle(this)}),a}(),platypus.AABB=function(){"use strict";var a=function(a,b,c,d){this.empty=!0,this.setAll(a,b,c,d)},b=a.prototype;return b.setAll=function(a,b,c,d){return this.empty=!1,this.x=a,this.y=b,this.resize(c,d),this},b.setBounds=function(a,b,c,d){return this.empty=!1,this.x=(c+a)/2,this.y=(b+d)/2,this.resize(c-a,d-b),this},b.set=function(a){return this.empty=a.empty,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.halfWidth=a.halfWidth,this.halfHeight=a.halfHeight,this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this},b.reset=function(){return this.empty=!0,this},b.resize=function(a,b){var c=a||0,d=b||0,e=c/2,f=d/2;return this.width=c,this.height=d,this.halfWidth=e,this.halfHeight=f,"number"==typeof this.x?(this.left=-e+this.x,this.right=e+this.x):this.empty=!0,"number"==typeof this.y?(this.top=-f+this.y,this.bottom=f+this.y):this.empty=!0,this},b.include=function(a){return this.empty?this.set(a):(this.left>a.left&&(this.left=a.left),this.right<a.right&&(this.right=a.right),this.top>a.top&&(this.top=a.top),this.bottom<a.bottom&&(this.bottom=a.bottom),this.width=this.right-this.left,this.height=this.bottom-this.top,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.x=this.left+this.halfWidth,this.y=this.top+this.halfHeight),this},b.move=function(a,b){return this.moveX(a),this.moveY(b),this},b.moveX=function(a){return this.x=a,this.left=-this.halfWidth+a,this.right=this.halfWidth+a,this},b.moveY=function(a){return this.y=a,this.top=-this.halfHeight+a,this.bottom=this.halfHeight+a,this},b.moveXBy=function(a){return this.moveX(this.x+a)},b.moveYBy=function(a){return this.moveY(this.y+a)},b.getCopy=function(){return a.setUp(this.x,this.y,this.width,this.height)},b.matches=function(a,b,c,d){return this.x===a&&this.y===b&&this.width===c&&this.height===d},b.equals=function(a){return!this.empty&&!a.empty&&this.left===a.left&&this.top===a.top&&this.right===a.right&&this.bottom===a.bottom},b.contains=function(a){return a.top>=this.top&&a.bottom<=this.bottom&&a.left>=this.left&&a.right<=this.right},b.containsVector=function(a){return this.containsPoint(a.x,a.y)},b.containsPoint=function(a,b){return b>=this.top&&b<=this.bottom&&a>=this.left&&a<=this.right},b.collides=function(a){return a.bottom>this.top&&a.top<this.bottom&&a.right>this.left&&a.left<this.right},b.intersects=function(a){return a.bottom>=this.top&&a.top<=this.bottom&&a.right>=this.left&&a.left<=this.right},b.getIntersectionArea=function(a){var b=Math.max,c=Math.min;return this.intersects(a)?(c(this.bottom,a.bottom)-b(this.top,a.top))*(c(this.right,a.right)-b(this.left,a.left)):0},platypus.setUpRecycle(a,"AABB"),a}(),platypus.ActionState=function(){"use strict";var a=include("platypus.Data"),b=include("platypus.StateMap"),c=function(c,d,e){this.event=c,this.trigger=e,this.active=!1,this.wasActive=!1,this.valid=!0,this.wasValid=!0,this.states=b.setUp(d),this.inputs=Array.setUp(),this.stateSummary=a.setUp("pressed",!1,"released",!1,"triggered",!1)},d=function(a){return a},e=c.prototype;return e.update=function(a){var b=this.stateSummary;return this.valid=a.includes(this.states),this.active=this.inputs.some(d),b.pressed=this.valid&&this.active,b.released=this.wasActive&&(!this.valid&&this.wasValid||this.valid&&!this.active),b.triggered=this.valid&&this.active&&!this.wasActive,this.wasValid=this.valid,this.wasActive=this.active,b.pressed||b.released||b.triggered},e.resolve=function(){this.trigger(this.event,this.stateSummary)},e.isStateValid=function(a){return a.includes(this.states)},platypus.setUpRecycle(c,"ActionState",function(){this.states.recycle(),this.stateSummary.recycle(),this.inputs.recycle(),c.recycle(this)}),c}(),platypus.CollisionData=function(){"use strict";var a=function(a,b,c,d,e,f,g,h,i){this.occurred=a||!1,this.direction=b||null,this.position=c||null,this.deltaMovement=d||null,this.aABB=e||null,this.thisShape=f||null,this.thatShape=g||null,this.vector=platypus.Vector.setUp(h),this.stuck=i||0},b=a.prototype;return b.copy=function(a){this.occurred=a.occurred,this.direction=a.direction,this.position=a.position,this.deltaMovement=a.deltaMovement,this.aABB=a.aABB,this.thisShape=a.thisShape,this.thatShape=a.thatShape,this.vector.setVector(a.vector),this.stuck=a.stuck},b.clear=function(){this.occurred=!1,this.direction=null,this.position=null,this.deltaMovement=null,this.aABB=null,this.thisShape=null,this.thatShape=null,this.vector.setXYZ(0,0,0),this.stuck=0},a}(),platypus.CollisionDataContainer=function(){"use strict";var a=function(){this.xData=Array.setUp(new platypus.CollisionData,new platypus.CollisionData),this.yData=Array.setUp(new platypus.CollisionData,new platypus.CollisionData),this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},b=a.prototype;return b.getXEntry=function(a){return this.xData[a]},b.getYEntry=function(a){return this.yData[a]},b.tryToAddX=function(a){return a.deltaMovement<this.xDeltaMovement?(this.xDeltaMovement=a.deltaMovement,this.xData[0].copy(a),this.xCount=1,!0):a.deltaMovement===this.xDeltaMovement?(this.ensureRoomX(),this.xData[this.xCount].copy(a),this.xCount+=1,!0):!1},b.tryToAddY=function(a){return a.deltaMovement<this.yDeltaMovement?(this.yDeltaMovement=a.deltaMovement,this.yData[0].copy(a),this.yCount=1,!0):a.deltaMovement===this.yDeltaMovement?(this.ensureRoomY(),this.yData[this.yCount].copy(a),this.yCount+=1,!0):!1},b.ensureRoomX=function(){var a=0,b=2*this.xData.length;if(this.xData.length<=this.xCount)for(a=this.xData.length;b>a;a++)this.xData[a]=new platypus.CollisionData},b.ensureRoomY=function(){var a=0,b=2*this.yData.length;if(this.yData.length<=this.yCount)for(a=this.yData.length;b>a;a++)this.yData[a]=new platypus.CollisionData},b.reset=function(){this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},a}(),platypus.CollisionShape=function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.Vector"),c=function(a,b){var c=b.aABB,d=c.halfHeight,e=c.halfWidth,f=Math.abs,g=Math.pow,h=f(a.x-b.x),i=f(a.y-b.y),j=a.radius;return e>h||d>i||e+j>h&&d+j>i&&g(h-e,2)+g(i-d,2)<g(j,2)},d=function(a){var b=Math.pow;return this.aABB.collides(a.aABB)&&("rectangle"===a.type&&c(this,a)||"circle"===a.type&&b(this.x-a.x,2)+b(this.y-a.y,2)<=b(this.radius+a.radius,2))},e=function(){return!1},f=function(a){return this.aABB.collides(a.aABB)&&("rectangle"===a.type||"circle"===a.type&&c(a,this))},g=function(c,g,h){var i=g.regX,j=g.regY,k=g.width||2*g.radius||0,l=g.height||2*g.radius||0,m=g.radius||0,n=g.type||"rectangle";this.initialized||(this.initialized=!0,b.assign(this,"offset","offsetX","offsetY"),b.assign(this,"position","x","y"),b.assign(this,"size","width","height"),this.aABB=a.setUp()),this.owner=c,this.collisionType=h,this.type=n,this.subType="","circle"===n?(k=l=2*m,this.collides=d):"rectangle"===n?this.collides=f:this.collides=e,this.size.setXYZ(k,l),this.radius=m,"number"!=typeof i&&(i=k/2),"number"!=typeof j&&(j=l/2),this.offset.setXYZ(g.offsetX||k/2-i,g.offsetY||l/2-j),c?this.position.setXYZ(c.x,c.y).add(this.offset):this.position.setXYZ(g.x,g.y).add(this.offset),this.aABB.setAll(this.x,this.y,k,l)},h=g.prototype;return h.update=function(a,b){var c=a+this.offsetX,d=b+this.offsetY;this.position.setXYZ(c,d),this.aABB.move(c,d)},h.moveX=function(a){this.x=a,this.aABB.moveX(a)},h.moveY=function(a){this.y=a,this.aABB.moveY(a)},h.getAABB=function(){return this.aABB},h.setXWithEntityX=function(a){this.x=a+this.offsetX,this.aABB.moveX(this.x)},h.setYWithEntityY=function(a){this.y=a+this.offsetY,this.aABB.moveY(this.y)},h.destroy=function(){this.recycle()},h.multiply=function(a){var b=this.position,c=this.owner.position;b.subtractVector(c),b.multiply(a),this.offset.multiply(a),this.size.multiply(a),b.addVector(c),this.width=Math.abs(this.width),this.height=Math.abs(this.height),this.aABB.setAll(this.x,this.y,this.width,this.height)},platypus.setUpRecycle(g,"CollisionShape"),g}(),function(){"use strict";var a=include("platypus.Component"),b="",c=0,d=function(a,b,c){Object.defineProperty(b,a,{get:function(){return c[a]},set:function(b){c[a]=b},enumerable:!0})},e=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}};platypus.components={},platypus.createComponentClass=function(f,g){var h=function(b,e){var h="",i="",j="",k="";if(a.call(this,f.id,b),g&&g.call(this),f.properties)for(h in f.properties)f.properties.hasOwnProperty(h)&&("undefined"!=typeof e[h]?this[h]=e[h]:"undefined"!=typeof this.owner[h]?this[h]=this.owner[h]:this[h]=f.properties[h]);if(f.publicProperties)for(h in f.publicProperties)f.publicProperties.hasOwnProperty(h)&&(d(h,this,b),"undefined"!=typeof e[h]?this[h]=e[h]:"undefined"!=typeof this.owner[h]?this[h]=this.owner[h]:this[h]=f.publicProperties[h]);if(f.events){c-=1;for(i in f.events)if(f.events.hasOwnProperty(i)&&(this.addEventListener(i,f.events[i],c),e.aliases))for(k in e.aliases)e.aliases.hasOwnProperty(k)&&e.aliases[k]===i&&this.addEventListener(k,f.events[i],c)}if(f.publicMethods)for(i in f.publicMethods)if(f.publicMethods.hasOwnProperty(i)){if(j=i,e.aliases)for(k in e.aliases)e.aliases.hasOwnProperty(k)&&e.aliases[k]===i&&(j=k);this.addMethod(j,f.publicMethods[i])}this.constructor&&this.constructor(e)},i=null,j=h.prototype;if(g){j=extend(h,g);for(b in a.prototype)j[b]?j[b]=e(j[b],a.prototype[b]):j[b]=a.prototype[b]}else j=extend(h,a);if(j.constructor=f.constructor,f.methods)for(i in f.methods)f.methods.hasOwnProperty(i)&&("destroy"===i?j._destroy=f.methods[i]:j[i]=f.methods[i]);if(f.publicMethods)for(i in f.publicMethods)f.publicMethods.hasOwnProperty(i)&&(j[i]=f.publicMethods[i]);h.getAssetList=f.getAssetList||a.getAssetList,h.getLateAssetList=f.getLateAssetList||a.getLateAssetList,platypus.components[f.id]=h}}(),function(){"use strict";var a=include("springroll.Application"),b=include("springroll.ApplicationPlugin"),c=null,d=new b,e=null,f=function(){var b=function(a,b){return Math.floor(204*a/b)},c=function(a,c){var d=0,e=0,f="color: #ffffff; padding:3px 0; border-radius: 6px;",g=0,h=0,i=0,j=null;return c&&(j=c.greenSplit(".")),c&&3===j.length?(g=parseInt(j[0],10),h=parseInt(j[1],10),i=parseInt(j[2],10)):(g=a.charCodeAt(0)||0,h=a.charCodeAt(1)||0,i=a.charCodeAt(2)||0,e=Math.min(g,h,i),g-=e,h-=e,i-=e),j&&j.recycle(),d=Math.max(g,h,i,1),f+" background: rgb("+b(g,d)+","+b(h,d)+","+b(i,d)+");"};return function(b,d){var e=d.options,f=e.author?"by "+e.author:"",g=d.name||document.title||"",h=a.version||"(?)",i="Platypus "+platypus.version,j="Pixi.js "+PIXI.VERSION,k="SpringRoll "+h,l=e.version||"(?)";e.hideHello||("(?)"!==l&&(g+=" "+l),platypus.supports.firefox||platypus.supports.chrome?console.log("\n%c "+g+" %c "+f+" \n\nUsing %c "+k+" %c %c "+j+" %c %c "+i+" %c\n\n",c(g,l),"",c(k,h),"",c(j,PIXI.VERSION),"",c(i,platypus.version),""):console.log('--- "'+g+'" '+f+" - Using "+k+", "+j+", and "+i+" ---")),b.debug&&console.log("Game config loaded.",b)}}(),g=function(a){var b=null,c=null,d=null,e={};for(b in a)if(a[b].id)e[b]=a[b];else{c=g(a[b]);for(d in c)e[d]=c[d]}return e},h=function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(a[b].id=b)};PIXI.utils._saidHello=!0,d.setup=function(){var a="",b=document.getElementsByName("author"),c=this.options;b.length&&(a=b[0].getAttribute("content")||""),c.add("author",a,!0),c.add("hideHello",!1,!0)},d.preload=function(a){var b=this.config.platypus||this.config,d=null,i={delta:0};b?(this.options.debug&&(b.debug=!0),f(b,this),b.entities=g(b.entities),b.spriteSheets&&h(b.spriteSheets),d=this.platypus=new platypus.Game(b,this),c=function(a){i.delta=a,d.tick(i)},this.on("update",c,320),e=function(a){d.currentScene&&d.currentScene.triggerOnChildren("resize",a)},this.on("resize",e)):console.warn("PlatypusPlugin: Platypus requires a game configuration."),a()},d.teardown=function(){this.platypus&&(this.off("update",c),this.off("resize",e),this.platypus.destroy(),delete this.platypus)}}(),function(){"use strict";var a=include("platypus.Vector");return platypus.createComponentClass({id:"AIChaser",properties:{accelerate:!1,chasing:!0},publicProperties:{speed:.3},constructor:function(b){this.target=this.owner.target||null,this.offset=a.setUp(0,0),this.state=this.owner.state,this.state.set("chasing",!1)},events:{load:function(){return this.owner.addMover?void(this.direction=this.owner.addMover({vector:[this.speed,0,0],event:"chase",accelerator:this.accelerate}).vector):void console.warn('The "AIChaser" component requires a "Mover" component to function correctly.')},"handle-ai":function(){var b=null,c=0,d=!1;this.target&&this.chasing&&(b=a.setUp(this.offset).add(this.target.position).subtractVector(this.owner.position),c=b.magnitude(2),c&&(d=!0,this.direction.setVector(b).normalize().multiply(this.speed)),b.recycle()),d!==this.state.get("chasing")&&(this.state.set("chasing",d),this.owner.triggerEvent("chase",d))},"set-target":function(a){this.target=a,this.offset.x=0,this.offset.y=0},"set-target-offset":function(a){this.offset.x=a.x,this.offset.y=a.y},"start-chasing":function(a){a&&(this.target=a),this.chasing=!0},"stop-chasing":function(){
this.chasing=!1}},methods:{destroy:function(){this.target=null,this.offset.recycle(),this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"AIPacer",properties:{movement:"both",direction:null},constructor:function(){this.lastDirection="",this.currentDirection=this.direction||("horizontal"===this.movement?"left":"up")},events:{"handle-ai":function(){this.currentDirection!==this.lastDirection&&(this.lastDirection=this.currentDirection,this.owner.triggerEvent("stop"),this.owner.triggerEvent("go-"+this.currentDirection))},"turn-around":function(a){("both"===this.movement||"horizontal"===this.movement)&&(a.x>0?this.currentDirection="left":a.x<0&&(this.currentDirection="right")),("both"===this.movement||"vertical"===this.movement)&&(a.y>0?this.currentDirection="up":a.y<0&&(this.currentDirection="down"))}}})}(),function(){"use strict";var a=include("springroll.Application"),b=function(a){var b=a.split("/");return b=b[b.length-1].split("."),b[0]},c=function(a,c){var d=0,e=!1;for(a.id||(a.id=b(a.src)),d=0;d<c.length;d++)if(c[d].id===a.id){e=!0;break}e||c.push(a)};return platypus.createComponentClass({id:"AssetLoader",properties:{automatic:!0,assets:null,cache:!0},constructor:function(b){this.assets=this.assets||platypus.game.settings.assets||[],this.app=a.instance,this.sound=this.app.sound,this.owner.assets={},this.progress=0,this.total=0,this.assetInterface=null,platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" is using the AssetLoader component which has been deprecated in favor of Spring Roll preloading and scene-specific asset loading.')},events:{load:function(){this.automatic&&this.owner.triggerEvent("load-assets")},"load-assets":function(){var a=function(a,b){var c=null;b&&b.id?(c=this.owner.assets[b.id]={data:b,asset:a},this.cache&&(platypus.assets[b.id]=c)):(a=null,b=null),this.progress+=1,this.owner.triggerEvent("file-load",{asset:a,complete:this.progress===this.total,data:b,fraction:this.progress/this.total,progress:this.progress,total:this.total}),this.progress===this.total&&this.owner.triggerEvent("complete")}.bind(this);this.assets&&this.assets.length?this.load(a):this.owner.triggerEvent("complete")}},methods:{destroy:function(){delete this.owner.assets},load:function(a){var b=0,d=[],e=this.sound;for(b=0;b<this.assets.length;b++)"string"==typeof this.assets[b]?c({src:this.assets[b]},d):"string"==typeof this.assets[b].src&&c(this.assets[b],d);if(platypus.assets=platypus.assets||{},this.total=d.length,e)for(b=d.length-1;b>=0;b--)e.exists(d[b].id)&&(e.preload(d[b].id,a),d.greenSplice(b));d.length&&this.app.load(d,{taskDone:a})}}})}(),function(){"use strict";return platypus.createComponentClass({id:"AudioMobile",properties:{button:{}},constructor:function(a){platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" is using the AudioMobile component which has been deprecated.')},events:{complete:function(){platypus.supports.mobile?(this.owner.removeComponent("RenderSprite"),this.owner.removeComponent("RenderProgress"),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{image:this.button.image,spriteSheet:this.button.spriteSheet,acceptInput:{click:!0,touch:!0}})),this.owner.addComponent(new platypus.components.LogicCanvasButton(this.owner,{onRelease:"audio-ready"})),isNaN(this.button.x)||(this.owner.x=this.button.x),isNaN(this.button.y)||(this.owner.y=this.button.y),this.owner.parent.triggerEvent("child-entity-updated",this.owner)):this.owner.triggerEvent("audio-ready")}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.Data"),c=include("platypus.StateMap"),d={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1},e=function(a){var c="",e=null,f=function(a,b){a.audio&&this.onComplete(a.audio),a.recycle()};return"string"==typeof a?(c=a,e={}):(c=a.sound,e={interrupt:a.interrupt,delay:a.delay,offset:a.offset,loop:a.loop,volume:a.volume,pan:a.pan,startTime:a.startTime,duration:a.duration,mute:a.mute,paused:a.paused}),function(a){var g=null;a=a||e,g=b.setUp("interrupt",a.interrupt||e.interrupt||d.interrupt,"delay",a.delay||e.delay||d.delay,"loop",a.loop||e.loop||d.loop,"offset",a.offset||e.offset||d.offset,"volume","undefined"!=typeof a.volume?a.volume:"undefined"!=typeof e.volume?e.volume:d.volume,"pan",a.pan||e.pan||d.pan,"mute",a.mute||e.mute||d.mute,"paused",a.paused||e.paused||d.paused),g.complete=f.bind(this,g),g.audio=this.player.play(c,g),g.audio&&(g.audio.soundId=c,this.activeAudioClips.push(g.audio))}},f=function(a,b,c,d){var e=d.includes(a.states);e!==a.playing&&(e?c():this.stopAudio(b,this.forcePlaythrough),a.playing=e)};return platypus.createComponentClass({id:"AudioSFX",properties:{audioMap:null,forcePlayThrough:!0,eventBased:!0,stateBased:!0},constructor:function(b){var c="",d=null,f=null;if(this.activeAudioClips=Array.setUp(),this.state=this.owner.state,this.stateChange=!1,this.player=a.instance.sound,b.audioMap){this.stateBased&&(this.checkStates=Array.setUp());for(c in b.audioMap)b.audioMap.hasOwnProperty(c)&&(f=b.audioMap[c],d=e(f),f.sound&&(f=f.sound),this.eventBased&&this.addEventListener(c,d),this.stateBased&&this.addStateCheck(c,f,d))}this.paused=!1},events:{"handle-render":function(){var a=0,b=null,c=this.state;if(!this.paused&&this.stateBased&&this.stateChange){for(b=this.checkStates,a=b.length;a--;)b[a].check(c);this.stateChange=!1}},"state-changed":function(){this.stateChange=!0},"toggle-mute":function(a){this.handleClip(a,function(a){a&&(a.unmuted?(a.volume=a.unmuted,delete a.unmuted):(a.unmuted=a.volume,a.volume=0))})},"stop-audio":function(a){a?"string"==typeof a?this.stopAudio(a):this.stopAudio(a.audioId||!1,a.playthrough||!1):this.stopAudio()},"mute-audio":function(a){this.handleClip(a,function(a){a&&(a.unmuted=a.volume,a.volume=0)})},"unmute-audio":function(a){this.handleClip(a,function(a){a&&(a.volume=a.unmuted,delete a.unmuted)})},"pause-audio":function(a){this.handleClip(a,function(a){a&&a.pause()})},"unpause-audio":function(a){this.handleClip(a,function(a){a&&a.unpause()})},"set-volume":function(a){var b=0,c=function(a){a.volume=b};"number"==typeof a?(b=a,this.getAllClips(c)):a.volume&&(b=a.volume,this.handleClip(a.soundId,c))}},methods:{handleClip:function(a,b){"string"==typeof a?this.getClipById(a,b):this.getAllClips(b)},getClipById:function(a,b){var c=0,d=this.activeAudioClips;for(c=0;c<d.length;c++)if(d[c].soundId===a)return b&&b(d[c]),d[c];return b&&b(null),null},getAllClips:function(a){var b=0,c=this.activeAudioClips;if(a)for(b=0;b<c.length;b++)a(c[b]);return c},stopAudio:function(){var a=function(a){this.stopAudioInstance(a.currentTarget)};return function(b,c){var d=this.activeAudioClips,e=null,f=d.length;if(b)for(e=a.bind(this);f--;)d[f].soundId===b&&(c?d[f].addEventListener("loop",e):(d[f].stop(),d.greenSplice(f)));else if(c)for(e=a.bind(this);f--;)d[f].addEventListener("loop",e);else{for(;f--;)d[f].stop();d.length=0}}}(),stopAudioInstance:function(a){var b=this.activeAudioClips,c=b.indexOf(a);c>=0&&b.greenSplice(c).stop()},onComplete:function(a){this.owner.destroyed||(this.removeClip(a.audio),this.owner.triggerEvent("clip-complete"))},removeClip:function(a){var b=this.activeAudioClips.indexOf(a);b>=0&&this.activeAudioClips.greenSplice(b)},addStateCheck:function(a,d,e){var g=c.setUp(a),h=b.setUp("states",g,"playing",!1);h.check=f.bind(this,h,d,e.bind(this)),this.checkStates.push(h)},destroy:function(){var a=this.checkStates,b=null,c=0;if(this.stopAudio(),this.activeAudioClips.recycle(),this.state=null,a){for(c=a.length;c--;)b=a[c],b.states.recycle(),b.recycle();a.recycle(),this.checkStates=null}}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.Data"),c=function(a,b){return a.time-b.time},d=function(a,d){var e=0;for(e=0;e<a.length;e++)d.push(b.setUp("event",a[e].event,"time",a[e].time||0,"message",a[e].message));return e&&d.sort(c),d},e=function(a,d,e){var f=0,g=e.getElapsed();for(f=0;f<a.length;f++)d.push(b.setUp("event",a[f].event,"time",(a[f].time||0)+g,"message",a[f].message||null));f&&d.sort(c)},f=function(a,b,c){var d=0,f=Array.setUp();for(d=0;d<a.length;d++)a[d].sound?(a[d].events&&f.push(e.bind(a[d].events,b,c)),f.push(a[d].sound)):f.push(a[d]);return f},g=function(a,b){this.playingAudio=!1,this.owner.destroyed||(this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")),b.recycle()},h=function(a,b){var c=null,e=this.eventList,h=this.player;"string"==typeof a?c=Array.setUp(a):Array.isArray(a)?c=f(a,e,h):(a.events&&d(a.events,e),c=Array.isArray(a.sound)?f(a.sound,e,h):Array.setUp(a.sound)),b&&b.events&&d(b.events,e),this.playingAudio=!0,h.play(c,g.bind(this,!0,c),g.bind(this,!1,c))};return platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},constructor:function(b){var c="";if(this.eventList=Array.setUp(),this.playingAudio=!1,this.player=a.instance.voPlayer,b.audioMap)for(c in b.audioMap)b.audioMap.hasOwnProperty(c)&&this.addEventListener(c,h.bind(this,b.audioMap[c]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop()}},methods:{checkTimeEvents:function(a){var b=null,c=this.eventList,d=0,e=this.owner;if(c&&c.length)for(d=this.player.getElapsed();c.length&&(a||c[0].time<=d);)b=c.greenSplice(0),e.trigger(b.event,b.message),b.recycle()},destroy:function(){this.playingAudio&&this.player.stop(),this.eventList.recycle()}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.AABB"),c=include("platypus.Data"),d=include("platypus.Vector"),e=function(){return!1};return platypus.createComponentClass({id:"Camera",properties:{width:0,height:0,mode:"static",overflow:!1,stretch:!1,threshold:1,rotate:!1,x:0,y:0},publicProperties:{canvas:null,transitionX:400,transitionY:600,transitionAngle:600,worldWidth:0,worldHeight:0},constructor:function(d){this.viewport=b.setUp(0,0,0,0),this.worldCamera=c.setUp("viewport",b.setUp(this.x,this.y,this.width,this.height),"orientation",d.orientation||0),this.worldDimensions=b.setUp(),this.message=c.setUp("viewport",b.setUp(),"scaleX",0,"scaleY",0,"orientation",0,"stationary",!1,"world",this.worldDimensions),this.cameraLoadedMessage=c.setUp("worldWidth",0,"worldHeight",0,"viewport",this.message.viewport,"world",this.worldDimensions),this.worldIsLoaded=!1,this.following=void 0,this.state="static","pan"===this.mode&&(this.state="mouse-pan"),this.boundingBox=b.setUp(this.worldCamera.viewport.x,this.worldCamera.viewport.y,this.worldCamera.viewport.width/2,this.worldCamera.viewport.height/2),this.lastX=this.worldCamera.viewport.x,this.lastY=this.worldCamera.viewport.y,this.lastOrientation=this.worldCamera.orientation,this.forwardX=0,this.forwardY=0,this.forwardAngle=0,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=0,this.offsetY=0,this.offsetAngle=0,this.forwardFollower=c.setUp("x",this.lastX,"y",this.lastY,"orientation",this.lastOrientation),this.lastFollow=c.setUp("entity",null,"mode",null,"offsetX",0,"offsetY",0,"begin",0),this.xMagnitude=0,this.yMagnitude=0,this.xWaveLength=0,this.yWaveLength=0,this.xShakeTime=0,this.yShakeTime=0,this.shakeTime=0,this.shakeIncrementor=0,this.direction=!0,this.stationary=!1,this.viewportUpdate=!1,this.owner.container?this.parentContainer=this.owner.container:this.owner.stage?(this.canvas=this.canvas||a.instance.display.canvas,this.parentContainer=this.owner.stage,this.owner.width=this.canvas.width,this.owner.height=this.canvas.height):console.warn("Camera: There appears to be no Container on this entity for the camera to display."),this.container=new PIXI.Container,this.matrix=this.container.transformMatrix=new PIXI.Matrix,this.parentContainer.addChild(this.container)},events:{load:function(){this.resize()},"render-world":function(a){this.world=a.world,this.world.transformMatrix=this.world.transformMatrix||new PIXI.Matrix,this.container.addChild(this.world)},"child-entity-added":function(a){this.viewportUpdate=!0,this.worldIsLoaded&&a.triggerEvent("camera-loaded",this.cameraLoadedMessage)},"child-entity-updated":function(a){this.viewportUpdate=!0,this.worldIsLoaded&&a.triggerEvent("camera-update",this.message)},"world-loaded":function(a){var b=this.message;b.viewport.set(this.worldCamera.viewport),this.worldDimensions.set(a.world),this.worldIsLoaded=!0,this.worldWidth=a.width,this.worldHeight=a.height,a.camera&&this.follow(a.camera),this.owner.triggerEventOnChildren&&(this.cameraLoadedMessage.worldWidth=this.worldWidth,this.cameraLoadedMessage.worldHeight=this.worldHeight,this.owner.triggerEventOnChildren("camera-loaded",this.cameraLoadedMessage)),this.updateMovementMethods()},mousedown:function(a){"mouse-pan"===this.state&&(this.mouseVector||(this.mouseVector=d.setUp(),this.mouseWorldOrigin=d.setUp()),this.mouse=this.mouseVector,this.mouse.x=a.event.x,this.mouse.y=a.event.y,this.mouseWorldOrigin.x=this.worldCamera.viewport.x,this.mouseWorldOrigin.y=this.worldCamera.viewport.y)},pressmove:function(a){this.mouse&&this.move(this.mouseWorldOrigin.x+(this.mouse.x-a.event.x)/this.world.transformMatrix.a,this.mouseWorldOrigin.y+(this.mouse.y-a.event.y)/this.world.transformMatrix.d)&&(this.viewportUpdate=!0)},pressup:function(a){this.mouse=null},tick:function(a){var b=this.message,c=b.viewport,d=null;"following"===this.state&&this.followingFunction(this.following,a.delta)&&(this.viewportUpdate=!0),this.canvas&&(this.owner.width=this.canvas.width,this.owner.height=this.canvas.height),(this.owner.width!==this.lastWidth||this.owner.height!==this.lastHeight)&&(this.resize(),this.lastWidth=this.owner.width,this.lastHeight=this.owner.height),this.viewportUpdate?(this.viewportUpdate=!1,this.stationary=!1,b.stationary=!1,c.set(this.worldCamera.viewport),this.shakeIncrementor<this.shakeTime&&(this.viewportUpdate=!0,this.shakeIncrementor+=a.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.shakeIncrementor<this.xShakeTime&&c.moveX(c.x+Math.sin(this.shakeIncrementor/this.xWaveLength*2*Math.PI)*this.xMagnitude),this.shakeIncrementor<this.yShakeTime&&c.moveY(c.y+Math.sin(this.shakeIncrementor/this.yWaveLength*2*Math.PI)*this.yMagnitude)),b.scaleX=this.windowPerWorldUnitWidth,b.scaleY=this.windowPerWorldUnitHeight,b.orientation=this.worldCamera.orientation,d=this.world.transformMatrix,d.a=b.scaleX,d.b=0,d.c=0,d.d=b.scaleY,b.orientation&&d.rotate(b.orientation),d.tx=(c.halfWidth-c.x)*b.scaleX,d.ty=(c.halfHeight-c.y)*b.scaleY,this.owner.triggerEvent("camera-update",b),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",b)):this.stationary||(this.stationary=!0,b.stationary=!0,this.owner.triggerEvent("camera-update",b),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",b)),this.lastFollow.begin&&this.lastFollow.begin<Date.now()&&this.follow(this.lastFollow)},"resize-camera":function(a){this.worldCamera.viewport.resize(a.width,a.height),this.resize()},relocate:function(a){var b=null,c=function(){this.move(b.x,b.y)&&(this.viewportUpdate=!0)}.bind(this),e=function(){b.recycle()};a.time&&window.createjs&&createjs.Tween?(b=d.setUp(this.worldCamera.viewport.x,this.worldCamera.viewport.y),createjs.Tween.get(b).to({x:a.x,y:a.y},a.time,a.ease).on("change",c).call(e)):this.move(a.x,a.y)&&(this.viewportUpdate=!0)},follow:function(a){this.follow(a)},shake:function(a){var b=a||{},c=b.xMagnitude||0,d=b.yMagnitude||0,e=b.xFrequency||0,f=b.yFrequency||0,g=b.time||0;this.viewportUpdate=!0,this.shakeIncrementor=0,this.xMagnitude=c,this.yMagnitude=d,0===e?(this.xWaveLength=1,this.xShakeTime=0):(this.xWaveLength=1e3/e,this.xShakeTime=Math.ceil(g/this.xWaveLength)*this.xWaveLength),0===f?(this.yWaveLength=1,this.yShakeTime=0):(this.yWaveLength=1e3/f,this.yShakeTime=Math.ceil(g/this.yWaveLength)*this.yWaveLength),this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function(a){switch(a.time?(this.lastFollow.begin||(this.lastFollow.entity=this.following,this.lastFollow.mode=this.mode,this.lastFollow.offsetX=this.offsetX,this.lastFollow.offsetY=this.offsetY),this.lastFollow.begin=Date.now()+a.time):this.lastFollow.begin&&(this.lastFollow.begin=0),this.mode=a.mode,a.mode){case"locked":this.state="following",this.following=a.entity,this.followingFunction=this.lockedFollow,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0;break;case"forward":this.state="following",this.followFocused=!1,this.following=a.entity,this.lastX=a.entity.x-a.offsetX||0,this.lastY=a.entity.y-a.offsetY||0,this.lastOrientation=a.entity.orientation||0,this.forwardX=a.movementX||this.transitionX/10,this.forwardY=a.movementY||this.transitionY/10,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following",this.following=a.entity,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.boundingBox.setAll(a.x,a.y,a.width,a.height),this.followingFunction=this.boundingFollow;break;case"pan":this.state="mouse-pan",this.following=void 0,this.followingFunction=void 0,a&&"number"==typeof a.x&&"number"==typeof a.y&&(this.move(a.x,a.y,a.orientation||0),this.viewportUpdate=!0);break;default:this.state="static",this.following=void 0,this.followingFunction=void 0,a&&"number"==typeof a.x&&"number"==typeof a.y&&(this.move(a.x,a.y,a.orientation||0),this.viewportUpdate=!0)}a.begin&&(a.begin=0)},move:function(a,b,c){var d=this.moveX(a);return d=this.moveY(b)||d,this.rotate&&(d=this.reorient(c||0)||d),d},moveX:e,moveY:e,reorient:function(a){return Math.abs(this.worldCamera.orientation-a)>1e-4?(this.worldCamera.orientation=a,!0):!1},lockedFollow:function(){var a=Math.min,b=function(a,b,c){return c*b+(1-c)*a},c=function(b,c){return b?a(c/b,1):1};return function(a,d,e){var f=b(this.worldCamera.viewport.x,a.x,c(this.transitionX,d)),g=b(this.worldCamera.viewport.y,a.y,c(this.transitionY,d));return this.rotate?this.move(f,g,b(this.worldCamera.orientation,-(a.orientation||0),c(this.transitionAngle,d))):this.move(f,g,0)}}(),forwardFollow:function(a,b){var c=this.forwardFollower,d=15/b,e=!1,f=a.x+this.offsetX,g=a.y+this.offsetY,h=(a.orientation||0)+this.offsetAngle;return this.followFocused&&this.lastX===f&&this.lastY===g?this.lockedFollow(c,b):(this.averageOffsetX*=.9,this.averageOffsetY*=.9,this.averageOffsetX+=.1*(f-this.lastX)*d,this.averageOffsetY+=.1*(g-this.lastY)*d,Math.abs(this.averageOffsetX)>this.worldCamera.viewport.width/(2*this.forwardX)&&(this.averageOffsetX=0),Math.abs(this.averageOffsetY)>this.worldCamera.viewport.height/(2*this.forwardY)&&(this.averageOffsetY=0),this.rotate&&(this.averageOffsetAngle*=.9,this.averageOffsetAngle+=.1*(h-this.lastOrientation)*d,Math.abs(this.averageOffsetAngle)>this.worldCamera.orientation/(2*this.forwardAngle)&&(this.averageOffsetAngle=0)),c.x=this.averageOffsetX*this.forwardX+f,c.y=this.averageOffsetY*this.forwardY+g,c.orientation=this.averageOffsetAngle*this.forwardAngle+h,this.lastX=f,this.lastY=g,this.lastOrientation=h,e=this.lockedFollow(c,b),this.followFocused||e||(this.followFocused=!0),e)},boundingFollow:function(a,b){var c=0,d=0,e=this.transitionX?Math.min(b/this.transitionX,1):1,f=1-e,g=this.transitionY?Math.min(b/this.transitionY,1):1,h=1-g;return this.boundingBox.move(this.worldCamera.viewport.x,this.worldCamera.viewport.y),a.x>this.boundingBox.right?c=a.x-this.boundingBox.halfWidth:a.x<this.boundingBox.left&&(c=a.x+this.boundingBox.halfWidth),a.y>this.boundingBox.bottom?d=a.y-this.boundingBox.halfHeight:a.y<this.boundingBox.top&&(d=a.y+this.boundingBox.halfHeight),0!==c&&(c=this.moveX(e*c+f*this.worldCamera.viewport.x)),0!==d&&(d=this.moveY(g*d+h*this.worldCamera.viewport.y)),c||d},resize:function(){var a=this.width/this.height,b=this.owner.width/this.owner.height;this.viewport.setAll(this.owner.width/2,this.owner.height/2,this.owner.width,this.owner.height),this.stretch||(b>a?this.overflow?this.worldCamera.viewport.resize(this.height*b,this.height):this.viewport.resize(this.viewport.height*a,this.viewport.height):this.overflow?this.worldCamera.viewport.resize(this.width,this.width/b):this.viewport.resize(this.viewport.width,this.viewport.width/a)),this.worldPerWindowUnitWidth=this.worldCamera.viewport.width/this.viewport.width,this.worldPerWindowUnitHeight=this.worldCamera.viewport.height/this.viewport.height,this.windowPerWorldUnitWidth=this.viewport.width/this.worldCamera.viewport.width,this.windowPerWorldUnitHeight=this.viewport.height/this.worldCamera.viewport.height,this.matrix.tx=this.viewport.x-this.viewport.halfWidth,this.matrix.ty=this.viewport.y-this.viewport.halfHeight,this.viewportUpdate=!0,this.updateMovementMethods()},updateMovementMethods:function(){var a=e,b=function(){var b=this.worldDimensions;return this.worldCamera.viewport.moveX(b.width/2+b.left),this.moveX=a,!0},c=function(){var b=this.worldDimensions;return this.worldCamera.viewport.moveY(b.height/2+b.top),this.moveY=a,!0},d=function(a){var b=this.worldCamera.viewport,c=this.worldDimensions,d=c.width,e=c.left;return Math.abs(b.x-a)>this.threshold?(a+b.halfWidth>d+e?b.moveX(d-b.halfWidth+e):a<b.halfWidth+e?b.moveX(b.halfWidth+e):b.moveX(a),!0):!1},f=function(a){var b=this.worldCamera.viewport,c=this.worldDimensions,d=c.height,e=c.top;return Math.abs(b.y-a)>this.threshold?(a+b.halfHeight>d+e?b.moveY(d-b.halfHeight+e):a<b.halfHeight+e?b.moveY(b.halfHeight+e):b.moveY(a),!0):!1},g=function(a){var b=this.worldCamera.viewport;return Math.abs(b.x-a)>this.threshold?(b.moveX(a),!0):!1},h=function(a){var b=this.worldCamera.viewport;return Math.abs(b.y-a)>this.threshold?(b.moveY(a),!0):!1};return function(){var a=this.worldCamera.viewport,e=this.worldDimensions,i=e.width,j=e.height;i?i<a.width?this.moveX=b:this.moveX=d:this.moveX=g,j?j<a.height?this.moveY=c:this.moveY=f:this.moveY=h}}(),destroy:function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.mouseVector&&(this.mouseVector.recycle(),this.mouseWorldOrigin.recycle()),this.boundingBox.recycle(),this.viewport.recycle(),this.worldCamera.viewport.recycle(),this.worldCamera.recycle(),this.message.viewport.recycle(),this.message.recycle(),this.cameraLoadedMessage.recycle(),this.worldDimensions.recycle(),this.forwardFollower.recycle(),this.lastFollow.recycle()}}})}(),function(){"use strict";var a=include("platypus.Data");return platypus.createComponentClass({id:"CameraFollowMe",properties:{camera:{},mode:"forward",pause:!1},constructor:function(b){this.pauseGame=this.pause&&this.camera.time?{time:this.camera.time}:null,this.camera=a.setUp("entity",this.owner,"mode",this.camera.mode||this.mode,"top",this.camera.top,"left",this.camera.left,"offsetX",this.camera.offsetX,"offsetY",this.camera.offsetY,"width",this.camera.width,"height",this.camera.height,"time",this.camera.time)},events:{"follow-me":function(b){var c=null;c=b?a.setUp("entity",this.owner,"mode",b.mode||this.camera.mode,"top",b.top||this.camera.top,"left",b.left||this.camera.left,"offsetX",b.offsetX||this.camera.offsetX,"offsetY",b.offsetY||this.camera.offsetY,"width",b.width||this.camera.width,"height",b.height||this.camera.height,"time",b.time||this.camera.time):a.setUp(this.camera),this.pauseGame&&(this.owner.parent.triggerEvent("pause-logic",this.pauseGame),this.owner.parent.triggerEvent("pause-render",this.pauseGame)),this.owner.parent.triggerEvent("follow",c),c.recycle()}},methods:{destroy:function(){this.camera.recycle()}}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.CollisionShape"),c=include("platypus.Data"),d=include("platypus.DataMap"),e=include("platypus.Vector"),f=function(){var a=function(a,b,c,d){d.myType===b&&d.hitType===c&&this.owner.triggerEvent(a,d)},b=function(a,b,c,d){var e=0;if(d.myType===b&&d.hitType===c)for(e=0;e<a.length;e++)this.owner.triggerEvent(a[e],d)},c=function(a,b,c,d){var e=d.x,f=d.y;!d.entity||e||f||(e=d.entity.x-this.owner.x,f=d.entity.y-this.owner.y),d.myType===b&&d.hitType===c&&(f>0&&a.bottom?this.owner.trigger(a.bottom,d):0>f&&a.top&&this.owner.trigger(a.top,d),e>0&&a.right?this.owner.trigger(a.right,d):0>e&&a.left&&this.owner.trigger(a.left,d),a.all&&this.owner.trigger(a.all,d))};return function(d,e,f,g){return"string"==typeof e?a.bind(d,e,d.collisionType,f):Array.isArray(e)?b.bind(d,e,d.collisionType,f):c.bind(d,e,d.collisionType,f)}}(),g=function(){var b=function(a,b,c){var d=b.keys,e=d.length,f=null;if(c)return f=b.get(c),f?f.getAABB():null;for(a.reset();e--;)a.include(b.get(d[e]).getAABB());return a},f=function(a,b){var c=a.get(b);return c?c.getPreviousAABB():null},g=function(a,b){var c=a.get(b);return c?c.getShapes():null},h=function(a,b){var c=a.get(b);return c?c.getPrevShapes():null},i=function(a,b,c){for(var d=a.keys,e=d.length;e--;)a.get(d[e]).prepareCollision(b,c)},j=function(){var a=function(a,b,c){var d=0,f=b.stuck;f&&(d=a.magnitude(),b.thatShape.owner&&Math.abs(f)>1&&(f*=.05),(!d||d>Math.abs(f))&&(b.vector.x&&(a.x=f,a.y=0),b.vector.y&&(a.x=0,a.y=f),c.stuckWith&&c.stuckWith.recycle(),c.stuckWith=e.setUp(b.thatShape.x,b.thatShape.y)))},b={position:null,unstick:null};return function(c,d){var f=b,g=null;d.xCount&&(g=e.setUp(0,0,0),a(g,d.getXEntry(0),this)),d.yCount&&(g=g||e.setUp(0,0,0),a(g,d.getYEntry(0),this)),f.position=c,f.unstick=g,this.triggerEvent("relocate-entity",f),g&&g.recycle()}}(),k=function(a,b){for(var c=a.keys,d=c.length;d--;)a.get(c[d]).movePreviousX(b)},l=function(){return this.collisionTypes},m=function(){return this.solidCollisionMap},n=function(){return this.getAABB()},o=function(){return this.getPreviousAABB()},p=function(){return this.getShapes()},q=function(){return this.getPrevShapes()},r=function(a,b){this.prepareCollision(a,b)},s=function(a){this.movePreviousX(a)};return function(e,t){var u=t.collisionFunctions;u||(u=t.collisionFunctions=d.setUp(),t.aabb=a.setUp(),t.getAABB=b.bind(t,t.aabb,u),t.getPreviousAABB=f.bind(t,u),t.getShapes=g.bind(t,u),t.getPrevShapes=h.bind(t,u),t.prepareCollision=i.bind(t,u),t.relocateEntity=j.bind(t),t.movePreviousX=k.bind(t,u),t.getCollisionTypes=l.bind(t),t.getSolidCollisions=m.bind(t)),u.set(e.collisionType,c.setUp("getAABB",n.bind(e),"getPreviousAABB",o.bind(e),"getShapes",p.bind(e),"getPrevShapes",q.bind(e),"prepareCollision",r.bind(e),"movePreviousX",s.bind(e)))}}();return platypus.createComponentClass({id:"CollisionBasic",properties:{collisionType:"none",shapeType:"rectangle",ignoreOrientation:!1,regX:null,regY:null,width:0,height:0,radius:0,softCollisions:null,solidCollisions:null,margin:0,shapes:null},publicProperties:{immobile:!1,bullet:!1,jumpThrough:!1},constructor:function(c){var h=null,i=0,j="",k=null,l=this.regX,m=this.regY,n=this.width,o=this.height,p=this.radius,q=0,r=0,s=0,t=0;for("number"==typeof this.margin?(q=this.margin,r=this.margin,s=this.margin,t=this.margin):(q=this.margin.left||0,r=this.margin.right||0,s=this.margin.top||0,t=this.margin.bottom||0),null===l&&(l=this.regX=n/2),null===m&&(m=this.regY=o/2),e.assign(this.owner,"position","x","y","z"),e.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.aabb=a.setUp(),this.prevAABB=a.setUp(),this.shapes?k=this.shapes:"circle"===this.shapeType?(p=p||((n||0)+(o||0))/4,k=[{regX:(isNaN(l)?p:l)-(r-q)/2,regY:(isNaN(m)?p:m)-(t-s)/2,radius:p,type:this.shapeType}]):k=[{regX:(isNaN(l)?(n||0)/2:l)+q,regY:(isNaN(m)?(o||0)/2:m)+s,points:c.points,width:(n||0)+q+r,height:(o||0)+s+t,type:this.shapeType}],this.owner.collisionTypes=this.owner.collisionTypes||Array.setUp(),this.owner.collisionTypes.push(this.collisionType),this.shapes=Array.setUp(),this.prevShapes=Array.setUp(),this.entities=void 0,i=0;i<k.length;i++)this.shapes.push(b.setUp(this.owner,k[i],this.collisionType)),this.prevShapes.push(b.setUp(this.owner,k[i],this.collisionType)),this.prevAABB.include(this.prevShapes[i].aABB),this.aabb.include(this.shapes[i].aABB);if(g(this,this.owner),this.owner.solidCollisionMap=this.owner.solidCollisionMap||d.setUp(),h=this.owner.solidCollisionMap.set(this.collisionType,Array.setUp()),this.solidCollisions)for(j in this.solidCollisions)this.solidCollisions.hasOwnProperty(j)&&(h.push(j),this.solidCollisions[j]&&this.addEventListener("hit-by-"+j,f(this,this.solidCollisions[j],"solid")));if(this.owner.softCollisionMap=this.owner.softCollisionMap||d.setUp(),h=this.owner.softCollisionMap.set(this.collisionType,Array.setUp()),this.softCollisions)for(j in this.softCollisions)this.softCollisions.hasOwnProperty(j)&&(h.push(j),this.softCollisions[j]&&this.addEventListener("hit-by-"+j,f(this,this.softCollisions[j],"soft")));this.stuck=!1},events:{"collide-on":function(a){var b=this.owner,c=this.collisionType,d=b.collisionTypes;("string"!=typeof a||a===c)&&(-1===d.indexOf(c)&&d.push(c),b.parent.triggerEvent("add-collision-entity",b),this.active=!0)},"collide-off":function(a){var b=0,c=this.owner,d=c.parent,e=this.collisionType,f=c.collisionTypes;("string"!=typeof a||a===e)&&(d.triggerEvent("remove-collision-entity",c),b=f.indexOf(e),b>=0&&f.greenSplice(b),this.active=!1,f.length&&d.triggerEvent("add-collision-entity",c))},"relocate-entity":function(a){var b=a.unstick,c=0,d=0,e=0,f=0,g=this.aabb,h=this.owner,i=null,j=this.shapes;for(b&&(c=b.magnitude()),this.move&&(this.move.recycle(),this.move=null),a.relative?h.position.setVector(h.previousPosition).add(a.position):h.position.setVector(a.position),this.stuck&&(c>0?h.position.add(b):this.stuck=!1),e=h.x,f=h.y,g.reset(),d=j.length;d--;)i=j[d],i.update(e,f),g.include(i.aABB);h.previousPosition.setVector(h.position),c>0&&(this.stuck||(this.stuck=!0),this.move=h.stuckWith.copy().add(-e,-f).normalize())},"handle-logic":function(){this.move&&this.owner.position.add(this.move)},"orientation-updated":function(a){var b=0;if(!this.ignoreOrientation)for(b=0;b<this.shapes.length;b++)this.shapes[b].multiply(a)}},methods:{getAABB:function(){return this.aabb},getPreviousAABB:function(){return this.prevAABB},getShapes:function(){return this.shapes},getPrevShapes:function(){return this.prevShapes},prepareCollision:function(a,b){var c=0,d=null,e=this.shapes,f=this.prevShapes,g=this.aabb;for(this.owner.x=a,this.owner.y=b,this.prevShapes=e,this.shapes=f,this.prevAABB.set(g),g.reset(),c=f.length;c--;)d=f[c],d.update(a,b),g.include(d.aABB)},movePreviousX:function(a){var b=0;for(this.prevAABB.moveX(a),b=0;b<this.prevShapes.length;b++)this.prevShapes[b].setXWithEntityX(a)},destroy:function(){var a=this.owner.collisionFunctions,b=this.collisionType,c=this.owner.collisionTypes.indexOf(b),d=this.owner;for(d.parent.triggerEvent("remove-collision-entity",d),this.aabb.recycle(),delete this.aabb,this.prevAABB.recycle(),delete this.prevAABB,c>=0&&d.collisionTypes.greenSplice(c),d.solidCollisionMap.has(b)&&d.solidCollisionMap["delete"](b).recycle(),d.softCollisionMap.has(b)&&d.softCollisionMap["delete"](b).recycle(),a["delete"](b).recycle(),c=this.shapes.length;c--;)this.shapes[c].recycle(),this.prevShapes[c].recycle();this.shapes.recycle(),this.prevShapes.recycle(),delete this.shapes,delete this.prevShapes,delete this.entities,d.collisionTypes.length?d.parent.triggerEvent("add-collision-entity",d):(a.recycle(),d.collisionFunctions=null,d.solidCollisionMap.recycle(),d.solidCollisionMap=null,d.softCollisionMap.recycle(),d.softCollisionMap=null,d.aabb.recycle(),d.aabb=null)}}})}(),function(){"use strict";var a=function(a,b,c){this.state.get(a)&&this.trigger(b,c)},b=function(a,b,c){this.state.get(a)||this.trigger(b,c)};return platypus.createComponentClass({id:"CollisionFilter",properties:{collisions:{},state:""},constructor:function(c){var d="",e=this.collisions,f=this.state;if(e)if("!"===f[0]){f=f.substring(1);for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,b.bind(this.owner,f,e[d]))}else for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,a.bind(this.owner,f,e[d]));
}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.DataMap"),c=include("platypus.Vector");return platypus.createComponentClass({id:"CollisionGroup",constructor:function(b){this.solidEntities=Array.setUp(),this.collisionTypes=Array.setUp(),this.shapes=Array.setUp(),this.prevShapes=Array.setUp(),this.terrain=void 0,this.aabb=a.setUp(this.owner.x,this.owner.y),this.prevAABB=a.setUp(this.owner.x,this.owner.y),this.filteredAABB=a.setUp(),c.assign(this.owner,"position","x","y","z"),c.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.collisionGroup=this.owner.collisionGroup={getAllEntities:function(){var a=0,b=0,c=null;for(a=0;a<this.solidEntities.length;a++)c=this.solidEntities[a],b+=c!==this.owner&&c.collisionGroup?c.collisionGroup.getAllEntities():1;return b}.bind(this),getSize:function(){return this.solidEntities.length}.bind(this),getCollisionTypes:function(){return this.getCollisionTypes()}.bind(this),getSolidCollisions:function(){return this.getSolidCollisions()}.bind(this),getAABB:function(a){return this.getAABB(a)}.bind(this),getPreviousAABB:function(a){return this.getPreviousAABB(a)}.bind(this),getShapes:function(a){return this.getShapes(a)}.bind(this),getPrevShapes:function(a){return this.getPrevShapes(a)}.bind(this),prepareCollision:function(a,b){return this.prepareCollision(a,b)}.bind(this),relocateEntity:function(a,b){return this.relocateEntity(a,b)}.bind(this),movePreviousX:function(a){return this.movePreviousX(a)}.bind(this),getSolidEntities:function(){return this.solidEntities}.bind(this),jumpThrough:!1}},events:{"child-entity-added":function(a){this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"relocate-entity":function(){this.owner.previousPosition.setVector(this.owner.position),this.updateAABB()}},methods:{addCollisionEntity:function(a){var b=0,c=a.collisionTypes;if(c){for(b=c.length;b--;)a.solidCollisionMap.get(c[b]).length&&!a.immobile&&(this.solidEntities[this.solidEntities.length]=a);this.updateAABB()}},removeCollisionEntity:function(a){var b=0,c=0,d=a.collisionTypes;if(d){for(c=d.length;c--;)a.solidCollisionMap.get(d[c]).length&&(b=this.solidEntities.indexOf(a),b>=0&&this.solidEntities.greenSplice(b));this.updateAABB()}},getCollisionTypes:function(){var a=null,b=this.collisionTypes,c=this.solidEntities,d=c.length;for(b.length=0;d--;)a=c[d],a!==this.owner&&a.collisionGroup&&(a=a.collisionGroup),b.union(a.getCollisionTypes());return b},getSolidCollisions:function(){var a=0,c="",d=null,e=null,f=b.setUp(),g=null,h=0,i=null,j=null,k=!1;for(a=0;a<this.solidEntities.length;a++){for(k=!1,e=this.solidEntities[a],e!==this.owner&&e.collisionGroup&&(e=e.collisionGroup,k=!0),g=e.getSolidCollisions(),d=g.keys,h=d.length;h--;)c=d[h],i=f.get(c),j=g.get(c),i||(i=f.set(c,Array.setUp())),i.union(j),k&&j.recycle();k&&g.recycle()}return f},getAABB:function(a){var b=0,c=this.filteredAABB,d=null,e=null,f=this.solidEntities;if(a){for(c.reset(),b=f.length;b--;)d=f[b],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),e=d.getAABB(a),e&&c.include(e);return c}return this.aabb},getPreviousAABB:function(a){var b=0,c=this.filteredAABB,d=null,e=null,f=this.solidEntities;if(a){for(c.reset(),b=f.length;b--;)d=f[b],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),e=d.getPreviousAABB(a),e&&c.include(e);return c}return this.prevAABB},updateAABB:function(){var a=this.aabb,b=this.solidEntities,c=null,d=b.length,e=this.owner;for(a.reset();d--;)c=b[d],a.include(c!==e&&c.getCollisionGroupAABB?c.getCollisionGroupAABB():c.getAABB())},getShapes:function(a){var b=0,c=null,d=this.shapes,e=null;for(d.length=0,b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),e=c.getShapes(a),e&&d.union(e);return d},getPrevShapes:function(a){var b=0,c=null,d=null,e=this.prevShapes;for(e.length=0,b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),d=c.getPrevShapes(a),d&&e.union(d);return e},prepareCollision:function(a,b){var c=0,d=null,e=0,f=0;for(c=0;c<this.solidEntities.length;c++)d=this.solidEntities[c],d.saveDX=d.x-d.previousX,d.saveDY=d.y-d.previousY,e=d.saveOX=this.owner.previousX-d.previousX,f=d.saveOY=this.owner.previousY-d.previousY,d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),d.prepareCollision(a-e,b-f)},movePreviousX:function(a){var b=null,c=0,d=0;for(d=0;d<this.solidEntities.length;d++)b=this.solidEntities[d],c=b.saveOX,b!==this.owner&&b.collisionGroup&&(b=b.collisionGroup),b.movePreviousX(a-c)},relocateEntity:function(a,b){var d=null,e=null,f=0,g=null;for(this.owner.saveDX-=a.x-this.owner.previousX,this.owner.saveDY-=a.y-this.owner.previousY,f=0;f<b.xCount;f++)if(b.getXEntry(f).thisShape.owner===this.owner){this.owner.saveDX=0;break}for(f=0;f<b.yCount;f++)if(b.getYEntry(f).thisShape.owner===this.owner){this.owner.saveDY=0;break}for(f=0;f<this.solidEntities.length;f++)d=e=this.solidEntities[f],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),g=c.setUp(a.x-e.saveOX,a.y-e.saveOY,d.z),d.relocateEntity(g,b),g.recycle(),e.x+=e.saveDX,e.y+=e.saveDY,e!==this.owner&&(e.x+=this.owner.saveDX,e.y+=this.owner.saveDY)},destroy:function(){this.solidEntities.recycle(),this.collisionTypes.recycle(),this.shapes.recycle(),this.prevShapes.recycle(),this.aabb.recycle(),this.prevAABB.recycle(),this.filteredAABB.recycle()}},publicMethods:{getCollisionGroupAABB:function(){return this.getAABB()},getWorldEntities:function(){return this.owner.parent.getWorldEntities()},getWorldTerrain:function(){return this.owner.parent.getWorldTerrain()}}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.CollisionShape"),c=include("platypus.Data"),d=268435456,e=536870912,f=2147483648,g=1073741824,h=function(a,b,c,d){return b&&(a^=f),c&&(a^=g),d&&(a^=e),a},i=function(a,b,c,d,e){var f=0,g=0,h=Array.setUp();for(g=0;e>g;g++)for(h[g]=Array.setUp(),f=0;d>f;f++)h[g][f]=a[b+f][c+g];return h},j=function(a,b,c,d,e){var f=0,g=0,h=Array.setUp();for(g=0;e>g;g++)for(h[g]=Array.setUp(),f=0;d>f;f++)h[g][f]=a[b+f][c+g],a[b+f][c+g]=-1;return h},k=function(a,b,c,d,e,f){var g=0,h=0;for(h=0;f>h;h++)for(g=0;e>g;g++)a[c+g][d+h]=b[h][g];return a},l={diagonal:function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(g=0;d>g;g++)for(j=0;e>j;j++)a[b+g][c+j]=h(f[g][j],!1,!0,!0);return f.recycle(2),a},"diagonal-inverse":function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(g=0;d>g;g++)for(j=0;e>j;j++)a[b+d-g-1][c+e-j-1]=h(f[g][j],!0,!1,!0);return f.recycle(2),a},horizontal:function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(j=0;e>j;j++)for(g=0;d>g;g++)a[b+d-g-1][c+j]=h(f[j][g],!0,!1,!1);return f.recycle(2),a},vertical:function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(j=0;e>j;j++)for(g=0;d>g;g++)a[b+g][c+e-j-1]=h(f[j][g],!1,!0,!0);return f.recycle(2),a},"rotate-90":function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(j=0;e>j;j++)for(g=0;d>g;g++)a[b+e-j-1][c+g]=h(f[j][g],!0,!0,!0);return f.recycle(2),a},"rotate-180":function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(j=0;e>j;j++)for(g=0;d>g;g++)a[b+d-g-1][c+e-j-1]=h(f[j][g],!0,!0,!1);return f.recycle(2),a},"rotate-270":function(a,b,c,d,e){var f=i(a,b,c,d,e),g=0,j=0;for(j=0;e>j;j++)for(g=0;d>g;g++)a[b+j][c+d-g-1]=h(f[j][g],!1,!1,!0);return f.recycle(2),a},translate:function(a,b,c,d,e,f,g){var h=j(a,b,c,d,e),i=0,k=0;for(k=0;e>k;k++)for(i=0;d>i;i++)a[b+i+f][c+k+g]=h[k][i];return h.recycle(2),a}};return platypus.createComponentClass({id:"CollisionTiles",properties:{top:0,left:0},publicProperties:{collisionMap:[],tileWidth:10,tileHeight:10},constructor:function(){this.tileOffsetLeft=this.tileWidth/2+this.left,this.tileOffsetTop=this.tileHeight/2+this.top,this.columns=this.collisionMap.length,this.rows=this.collisionMap[0].length,this.shapeDefinition=c.setUp("x",0,"y",0,"type","rectangle","width",this.tileWidth,"height",this.tileHeight),this.storedTiles=Array.setUp(),this.serveTiles=Array.setUp(),this.storedTileIndex=0,this.aabb=a.setUp(),this.aabb.setBounds(this.left,this.top,this.tileWidth*this.columns+this.left,this.tileHeight*this.rows+this.top)},events:{transform:function(a){this.transform(a)},translate:function(a){this.translate(a)}},methods:{getShape:function(a,c){var d=this.storedTileIndex,e=null,f=this.storedTiles;return d===f.length&&f.push(b.setUp(null,this.shapeDefinition,"tiles")),e=f[d],e.update(a*this.tileWidth+this.tileOffsetLeft,c*this.tileHeight+this.tileOffsetTop),this.storedTileIndex+=1,e},addShape:function(a,b,c,h){var i=this.collisionMap[c][h],j=d,k=e,l=f,m=g;return i&&(j&=i,j?(k&=i,l&=i,m&=i,k&&l?b.left>=(c+1)*this.tileWidth+this.left&&a.push(this.getShape(c,h)):k?b.right<=c*this.tileWidth+this.left&&a.push(this.getShape(c,h)):m?b.top>=(h+1)*this.tileHeight+this.top&&a.push(this.getShape(c,h)):b.bottom<=h*this.tileHeight+this.top&&a.push(this.getShape(c,h))):a.push(this.getShape(c,h))),a},destroy:function(){var a=this.storedTiles,b=a.length;for(this.shapeDefinition.recycle(),delete this.shapeDefinition;b--;)a[b].recycle();a.recycle(),delete this.storedTiles,this.serveTiles.recycle(),delete this.serveTiles,this.aabb.recycle(),delete this.aabb}},publicMethods:{getAABB:function(){return this.aabb},isTile:function(a,b){return!(0>a||0>b||a>=this.columns||b>=this.rows||-1===this.collisionMap[a][b])},getTileShapes:function(a,b){var c=this.left,d=this.top,e=this.tileHeight,f=this.tileWidth,g=Math.max(Math.floor((a.left-c)/f),0),h=Math.max(Math.floor((a.top-d)/e),0),i=Math.min(Math.ceil((a.right-c)/f),this.columns),j=Math.min(Math.ceil((a.bottom-d)/e),this.rows),k=0,l=0,m=this.serveTiles;for(m.length=0,this.storedTileIndex=0,k=g;i>k;k++)for(l=h;j>l;l++)this.addShape(m,b,k,l);return m},transform:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.rows,f=b.height||this.columns,g=b.type||"horizontal";return l[g]?l[g](this.collisionMap,c,d,e,f):null},translate:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.rows,f=b.height||this.columns,g=b.dx||0,h=b.dy||0;return l.translate(this.collisionMap,c,d,e,f,g,h)},getCollisionMatrix:function(a,b,c,d){return i(this.collisionMap,a,b,c,d)},setCollisionMatrix:function(a,b,c,d,e){return k(this.collisionMap,a,b,c,d,e)}}})}(),function(){"use strict";var a=function(a){this.switches.push(a)};return platypus.createComponentClass({id:"ComponentSwitcher",properties:{componentMap:null},constructor:function(b){var c="";if(this.switches=Array.setUp(),this.componentMap)for(c in this.componentMap)this.componentMap.hasOwnProperty(c)&&this.addEventListener(c,a.bind(this,c))},events:{"prepare-logic":function(){var a=0;if(this.switches.length){for(a=0;a<this.switches.length;a++)this.switchComponents(this.componentMap[this.switches[a]]);this.switches.length=0}}},methods:{switchComponents:function(a){var b=0,c=0,d=this.owner,e=d.components,f=a.remove,g=a.add;if(f)if(Array.isArray(f))for(b=0;b<f.length;b++)for(c=e.length-1;c>-1;c--)e[c].type===f[b]&&d.removeComponent(e[c]);else for(b=e.length-1;b>-1;b--)e[b].type===f&&d.removeComponent(e[b]);if(g)if(Array.isArray(g))for(b=0;b<g.length;b++)d.addComponent(new platypus.components[g[b].type](d,g[b]));else d.addComponent(new platypus.components[g.type](d,g));d.parent&&d.parent.triggerEvent("child-entity-updated",d),d.triggerEvent("add-remove-component-complete")},destroy:function(){this.switches.recycle()}},getAssetList:function(a,b,c){var d=a.componentMap||b.componentMap||c.componentMap,e="",f=0,g=null,h=Array.setUp(),i=null;for(e in d)if(d.hasOwnProperty(e))for(f=0;f<d[e].add.length;f++)g=platypus.components[d[e].add[f].type],g&&(i=g.getAssetList(d[e].add[f],b,c),h.union(i),i.recycle());return h}})}(),function(){"use strict";var a=include("platypus.Data");return platypus.createComponentClass({id:"Counter",publicProperties:{total:0},constructor:function(b){this.count=0,this.lastTotal=0,this.lastCount=0,this.message=a.setUp("text","")},events:{"handle-logic":function(){var a=!1,b=this.message;this.total!==this.lastTotal&&(this.lastTotal=this.total,a=!0),this.count!==this.lastCount&&(this.lastCount=this.count,a=!0),a&&(this.total?b.text=String(this.count)+"/"+String(this.total):b.text=String(this.count),this.owner.triggerEvent("update-content",b))},"change-total":function(a){this.total=a},"change-count":function(a){this.count=a},"increment-count":function(){this.count+=1}},methods:{destroy:function(){this.message.recycle()}}})}(),function(){"use strict";var a=include("platypus.Data"),b=include("platypus.Entity"),c=function(a){return function(b,c){this.triggerOnChildren(a,b,c)}};return platypus.createComponentClass({id:"EntityContainer",properties:{childEvents:[]},constructor:function(a){var b=0,c=this.childEvents;for(this.entityDefinitions=null,a.entities&&this.owner.entities?this.entityDefinitions=a.entities.concat(this.owner.entities):this.entityDefinitions=a.entities||this.owner.entities||null,this.owner.entities=this.entities=Array.setUp(),this.childEvents=Array.setUp(),b=0;b<c.length;b++)this.addNewPublicEvent(c[b]);this.addNewPrivateEvent("peer-entity-added"),this.addNewPrivateEvent("peer-entity-removed")},events:{load:function(){var a=0,b=this.entityDefinitions;if(b)for(a=0;a<b.length;a++)this.addEntity(b[a]);delete this.entityDefinitions},"add-entity":function(a){this.addEntity(a)},"remove-entity":function(a){this.removeEntity(a)},"child-entity-updated":function(a){this.updateChildEventListeners(a)}},methods:{addNewPublicEvent:function(a){var b=0;for(this.addNewPrivateEvent(a),b=0;b<this.childEvents.length;b++)if(this.childEvents[b]===a)return!1;this.childEvents.push(a),this.addEventListener(a,c(a))},addNewPrivateEvent:function(a){var b=0,c=0;if(this._listeners[a])return!1;for(this._listeners[a]=Array.setUp(),b=0;b<this.entities.length;b++)if(this.entities[b]._listeners[a])for(c=0;c<this.entities[b]._listeners[a].length;c++)this.addChildEventListener(this.entities[b],a,this.entities[b]._listeners[a][c])},updateChildEventListeners:function(a){this.removeChildEventListeners(a),this.addChildEventListeners(a)},addChildEventListeners:function(a){var b=0,c="";for(c in this._listeners)if(this._listeners.hasOwnProperty(c)&&a._listeners[c])for(b=0;b<a._listeners[c].length;b++)this.addChildEventListener(a,c,a._listeners[c][b])},removeChildEventListeners:function(a){var b=0,c=null,d=null;if(a.containerListener){for(c=a.containerListener.events,d=a.containerListener.messages,b=0;b<c.length;b++)this.removeChildEventListener(a,c[b],d[b]);c.recycle(),d.recycle(),a.containerListener.recycle(),a.containerListener=null}},addChildEventListener:function(b,c,d){b.containerListener||(b.containerListener=a.setUp("events",Array.setUp(),"messages",Array.setUp())),b.containerListener.events.push(c),b.containerListener.messages.push(d),this.on(c,d,d._priority||0)},removeChildEventListener:function(a,b,c){var d=0,e=a.containerListener.events,f=a.containerListener.messages;for(d=0;d<e.length;d++)e[d]!==b||c&&f[d]!==c||this.off(b,f[d])},destroy:function(){for(var a=this.entities.length,b=null;a--;)b=this.entities[a],this.removeChildEventListeners(b),b.destroy();this.entities.recycle(),delete this.owner.entities,this.childEvents.recycle()}},publicMethods:{getEntityById:function(a){var b=0,c=null;for(b=0;b<this.entities.length;b++){if(this.entities[b].id===a)return this.entities[b];if(this.entities[b].getEntityById&&(c=this.entities[b].getEntityById(a)))return c}return void 0},getEntitiesByType:function(a){var b=0,c=null,d=Array.setUp();for(b=0;b<this.entities.length;b++)this.entities[b].type===a&&d.push(this.entities[b]),this.entities[b].getEntitiesByType&&(c=this.entities[b].getEntitiesByType(a),d.union(c),c.recycle());return d},addEntity:function(a){var c=null,d=0;for(a instanceof b?c=a:(c="string"==typeof a?new b(platypus.game.settings.entities[a]):a.id?new b(a):new b(platypus.game.settings.entities[a.type],a),this.owner.triggerEvent("entity-created",c)),c.parent=this.owner,c.triggerEvent("adopted",c),d=0;d<this.entities.length&&c.triggerEvent("peer-entity-added",this.entities[d]);d++);return this.triggerEventOnChildren("peer-entity-added",c),this.addChildEventListeners(c),this.entities.push(c),this.owner.triggerEvent("child-entity-added",c),c},removeEntity:function(a){var b=this.entities.indexOf(a);return b>=0?(this.removeChildEventListeners(a),this.entities.greenSplice(b),this.triggerEventOnChildren("peer-entity-removed",a),this.owner.triggerEvent("child-entity-removed",a),a.destroy(),a.parent=null,a):!1},triggerEventOnChildren:function(a,b,c){return this.destroyed?0:(this._listeners[a]||this.addNewPrivateEvent(a),this.triggerEvent(a,b,c))},triggerOnChildren:function(a,b,c){return this.destroyed?0:(this._listeners[a]||this.addNewPrivateEvent(a),this.trigger(a,b,c))}},getAssetList:function(a,c,d){var e=0,f=Array.setUp(),g=Array.setUp(),h=null;for(a.entities&&g.union(a.entities),c&&c.entities?g.union(c.entities):d&&d.entities&&g.union(d.entities),e=0;e<g.length;e++)h=b.getAssetList(g[e]),f.union(h),h.recycle();return g.recycle(),f}},platypus.Messenger)}(),function(){"use strict";var a=include("platypus.ActionState"),b=include("platypus.Data"),c=include("platypus.DataMap"),d=include("platypus.StateMap"),e=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},f=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=0,g=2*Math.PI;return c?(f=Math.acos(d/c),0>e&&(f=g-f),f):f},g=[null,null,null,null,["east","south","west","north"],null,null,null,["east","southeast","south","southwest","west","northwest","north","northeast"],null,null,null,null,null,null,null,["east","east-southeast","southeast","south-southeast","south","south-southwest","southwest","west-southwest","west","west-northwest","northwest","north-northwest","north","north-northeast","northeast","east-northeast"]],h=["left-button","middle-button","right-button"],i=function(a,b){this.paused||this.owner.trigger(a,b)},j=function(a,b,c){!this.paused&&c[a]&&this.owner.trigger(b,c)};return platypus.createComponentClass({id:"EntityController",properties:{controlMap:{},stateMaps:{}},publicProperties:{paused:!1},constructor:function(a){var e="",f=null;if(this.actions=c.setUp(),this.stateMaps)for(e in this.stateMaps)this.stateMaps.hasOwnProperty(e)&&(f=d.setUp(e),this.addMap(this.stateMaps[e],e,f),f.recycle());this.addMap(this.controlMap,"default"),a.joystick&&(this.joystick=b.setUp("directions",a.joystick.directions||4,"handleEdge",a.joystick.handleEdge||!1,"innerRadius",a.joystick.innerRadius||0,"outerRadius",a.joystick.outerRadius||1/0))},events:{"handle-controller":function(){for(var a=this.actions,b=a.keys,c=b.length,d="",e=Array.setUp(),f=this.owner.state;c--;)d=a.get(b[c]),d.update(f)&&e.push(d);for(c=e.length;c--;)e[c].resolve();e.recycle()},mousedown:function(a){this.owner.triggerEvent("mouse:"+h[a.event.button||0]+":down",a.event),this.joystick&&(this.owner.triggerEvent("joystick:down",a.event),this.handleJoy(a))},pressup:function(a){this.owner.triggerEvent("mouse:"+h[a.event.button||0]+":up",a.event),this.joystick&&(this.owner.triggerEvent("joystick:up",a.event),this.handleJoy(a))},pressmove:function(a){this.joystick&&this.handleJoy(a)},"pause-controls":function(){this.paused=!0},"unpause-controls":function(){this.paused=!1}},methods:{handleJoy:function(a){var b=Math.PI/(this.joystick.directions/2),c=e(this.owner,a),d=0,h="",i="";c>this.joystick.outerRadius||c<this.joystick.innerRadius||this.paused||(d=f(this.owner,a,c),h=g[this.joystick.directions][Math.floor((d+b/2)%(2*Math.PI)/b)],this.joystick.handleEdge&&(b=Math.PI/this.joystick.directions,i=g[2*this.joystick.directions][Math.floor((d+b/2)%(2*Math.PI)/b)],i!==h&&this.owner.triggerEvent(i.replace(h,"").replace("-",""),a)),this.owner.triggerEvent(h,a),this.owner.triggerEvent("joystick-orientation",d))},addController:function(){var b=function(a){this.inputs[a]=!1},c=function(a){this.inputs[a]=!0};return function(d,e,f,g,h){var k=this.actions,l=e+"-"+f+"-"+(h||"all"),m=k.get(l);m||(m=h?k.set(l,a.setUp(f,g,j.bind(this,h))):k.set(l,a.setUp(f,g,i.bind(this)))),this.addEventListener(d+":up",b.bind(m,m.inputs.length)),this.addEventListener(d+":down",c.bind(m,m.inputs.length)),m.inputs.push(!1)}}(),addMap:function(a,b,c){var d=null,e=0,f="",g="";for(g in a)if(a.hasOwnProperty(g))if(d=a[g],"string"==typeof d)this.addController(g,b,d,c);else if(Array.isArray(d))for(e=0;e<d.length;e++)this.addController(g,b,d[e],c);else for(f in d)if(d.hasOwnProperty(f))if("string"==typeof d[f])this.addController(g,b,d[f],c,f);else for(e=0;e<d[f].length;e++)this.addController(g,b,d[f][e],c,f)},destroy:function(){for(var a=this.actions,b=a.keys,c=b.length;c--;)a.get(b[c]).recycle();a.recycle(),this.joystick&&this.joystick.recycle()}}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.CollisionData"),c=include("platypus.CollisionDataContainer"),d=include("platypus.Data"),e=include("platypus.DataMap"),f=include("platypus.Vector"),g=new c,h={entity:null,type:null,x:0,y:0,hitType:null,myType:null},i=function(a,b){return a.collisionGroup.getAllEntities()-b.collisionGroup.getAllEntities()};return platypus.createComponentClass({id:"HandlerCollision",properties:{gridBits:8},constructor:function(a){this.againstGrid=d.setUp(),this.solidEntitiesLive=Array.setUp(),this.softEntitiesLive=Array.setUp(),this.allEntitiesLive=Array.setUp(),this.groupsLive=Array.setUp(),this.nonColliders=Array.setUp(),this.terrain=void 0,this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.relocationMessage=d.setUp("position",f.setUp(),"relative",!1)},events:{"child-entity-added":function(a){a.collideOff||this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"child-entity-updated":function(a){this.removeCollisionEntity(a),this.addCollisionEntity(a)},"check-collision-group":function(a){this.checkCamera(a.camera,a.entities),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("prepare-for-collision",a),this.checkGroupCollisions(),this.checkSolidCollisions(),this.resolveNonCollisions(),this.checkSoftCollisions(a)}},methods:{mapDown:function(b){var c=a.setUp(),d=this.gridBits;return c.setBounds(b.left>>d,b.top>>d,b.right>>d,b.bottom>>d)},getAgainstGrid:function(a,b,c){var e=this.mapDown(b),f=null,g=d.setUp(),h=0,i=null,j=this.againstGrid,k=null,l="",m=0,n=0;if(b.equals(a.againstAABB))return this.getEntityAgainstGrid(a,c);for(m=e.left;m<=e.right;m++)for(n=e.top;n<=e.bottom;n++)if(i=j[(n<<16^m)>>>0])for(h=c.length;h--;)l=c[h],f=i.get(l),f&&f.length&&(k=g[l],k?k.union(f):g[l]=Array.setUp.apply(null,f));return e.recycle(),g},getEntityAgainstGrid:function(a,b){for(var c=a.againstGrid,e=null,f=d.setUp(),g=c.length,h=0,i=null,j=null,k="";g--;)for(i=c[g],h=b.length;h--;)k=b[h],e=i.get(k),e&&e.length&&(j=f[k],j?j.union(e):f[k]=Array.setUp.apply(null,e));return f},removeAgainst:function(a){for(var b=a.againstGrid,c=a.collisionTypes,d=null,e=b.length,f=0,g=0,h=c.length,i=null;e--;)for(i=b[e],f=h;f--;)d=i.get(c[f]),d&&(g=d.indexOf(a),g>=0&&d.greenSplice(g));b.length=0},updateAgainst:function(a){var b=null,c=0,d="",f=a.collisionTypes,g=this.mapDown(a.getAABB()),h=a.againstGrid,i=0,j=null,k=this.againstGrid,l=0,m=0;if(!g.equals(a.againstAABB))for(a.againstAABB.set(g),this.removeAgainst(a),l=g.left;l<=g.right;l++)for(m=g.top;m<=g.bottom;m++){for(i=(m<<16^l)>>>0,j=k[i],j||(j=k[i]=e.setUp()),c=f.length;c--;)d=f[c],b=j.get(d),b||(b=j.set(d,Array.setUp())),b.push(a);h.push(j)}g.recycle()},addCollisionEntity:function(b){b.getTileShapes?this.terrain=b:b.collisionTypes&&(b.againstGrid=Array.setUp(),b.againstAABB=a.setUp(),this.updateAgainst(b))},removeCollisionEntity:function(a){a.againstGrid&&(this.removeAgainst(a),a.againstGrid.recycle(),a.againstGrid=null,a.againstAABB.recycle(),a.againstAABB=null)},checkCamera:function(a,b){var c=b.length,d=0,e=this.allEntitiesLive,f=this.softEntitiesLive,g=this.solidEntitiesLive,h=this.nonColliders,j=this.groupsLive,k=null,l=null,m=!1;for(e.length=0,g.length=0,f.length=0,h.length=0,j.length=0;c--;)if(m=!1,k=b[c],l=k.collisionTypes,!k.immobile&&l&&l.length){if(e.push(k),k!==this.owner)for(d=l.length;d--;)if(k.solidCollisionMap.get(l[d]).length){g.push(k),m=!0;break}for(d=l.length;d--;)if(k.softCollisionMap.get(l[d]).length){f.push(k);break}m||h.push(k),k.collisionGroup&&j.push(k)}j.sort(i)},resolveNonCollisions:function(){var a=null,b=this.relocationMessage,c=this.nonColliders,d=c.length;for(b.relative=!1;d--;)a=c[d],(a.position.x!==a.previousPosition.x||a.position.y!==a.previousPosition.y)&&(b.position.setVector(a.position),a.triggerEvent("relocate-entity",b),this.updateAgainst(a))},checkGroupCollisions:function(){var a=function(a,b,c,d,e,f,g,i){var j=h;j.entity=b,j.myType=c,j.type=d,j.x=e,j.y=f,j.direction=i,j.hitType=g,a.triggerEvent("hit-by-"+d,j),b&&(j.entity=a,j.type=c,j.myType=d,j.x=-e,j.y=-f,j.direction=i.getInverse(),j.hitType=g,b.triggerEvent("hit-by-"+c,j),j.direction.recycle())};return function(){for(var b=0,c=this.groupsLive,d=c.length,e=null,f=null,h=g;d--;)if(e=c[d],e.collisionGroup.getSize()>1){for(h.reset(),this.checkSolidEntityCollision(e,e.collisionGroup,h),b=h.xCount;b--;)f=h.getXEntry(b),a(f.thisShape.owner,f.thatShape.owner,f.thisShape.collisionType,f.thatShape.collisionType,f.direction,0,"solid",f.vector);for(b=h.yCount;b--;)f=h.getYEntry(b),a(f.thisShape.owner,f.thatShape.owner,f.thisShape.collisionType,f.thatShape.collisionType,0,f.direction,"solid",f.vector)}}}(),checkSolidCollisions:function(){var a=function(a,b,c,d,e,f,g,i){var j=h;j.entity=b,j.myType=c,j.type=d,j.x=e,j.y=f,j.direction=i,j.hitType=g,a.triggerEvent("hit-by-"+d,j),b&&(j.entity=a,j.type=c,j.myType=d,j.x=-e,j.y=-f,j.direction=i.getInverse(),j.hitType=g,b.triggerEvent("hit-by-"+c,j),j.direction.recycle())};return function(){for(var b=0,c=this.solidEntitiesLive,d=c.length,e=null,f=null,h=g,i=a;d--;){for(e=c[d],h.reset(),this.checkSolidEntityCollision(e,e,h),b=h.xCount;b--;)f=h.getXEntry(b),i(f.thisShape.owner,f.thatShape.owner,f.thisShape.collisionType,f.thatShape.collisionType,f.direction,0,"solid",f.vector);for(b=h.yCount;b--;)f=h.getYEntry(b),i(f.thisShape.owner,f.thatShape.owner,f.thisShape.collisionType,f.thatShape.collisionType,0,f.direction,"solid",f.vector)}}}(),checkSolidEntityCollision:function(a,b,c){var d=0,e=null,g=null,h=a.previousX,i=a.previousY,j=a.x-h,k=a.y-i,l=1/0,m=1/0,n=b.getCollisionTypes(),o=0,p=!1,q=null;if(b.getSolidEntities&&(p=b.getSolidEntities()),e=f.setUp(a.position),j||k){if(a.bullet){for(q=Math.min,o=n.length;o--;)g=b.getAABB(n[o]),l=q(l,g.width),m=q(m,g.height);for(d=Math.ceil(Math.max(Math.abs(j)/l,Math.abs(k)/m)),d=q(d,100),j/=d,k/=d;d--;){if(b.prepareCollision(a.previousX+j,a.previousY+k),e=this.processCollisionStep(a,b,p,c,e.setVector(a.position),j,k,n),e.x===a.previousX&&e.y===a.previousY){b.relocateEntity(e,c);break}b.relocateEntity(e,c)}}else b.prepareCollision(a.previousX+j,a.previousY+k),e=this.processCollisionStep(a,b,p,c,e,j,k,n),b.relocateEntity(e,c);(e.x!==h||e.y!==i)&&this.updateAgainst(a)}e.recycle()},processCollisionStep:function(){var b=a.setUp(),c=function(a,b,c,d,e,f){var g=0;if(c===a)return!1;if(c.jumpThrough&&b.bottom>d.top)return!1;if(a.jumpThrough&&d.bottom>b.top)return!1;if(e)for(g=e.length;g--;)if(c===e[g])return!1;return f.collides(d)};return function(a,d,e,f,g,h,i,j){for(var k=j.length,l=0,m=0,n=0,o=c,p=!1,q=Array.setUp(),r=null,s=null,t=null,u=null,v=null,w="",x=null,y=null,z=null,A=this.terrain,B=null,C=d.getSolidCollisions(),D=null,E=b;k--;){for(q[k]=r=Array.setUp(),u=j[k],s=d.getPreviousAABB(u),t=d.getAABB(u),E.set(t),E.include(s),D=C.get(u),B=this.getAgainstGrid(a,E,D),l=D.length;l--;)if(w=D[l],z=B[w]){for(m=z.length;m--;)if(v=z[m],x=v.getAABB(w),o(a,s,v,x,e,E)){for(y=v.getShapes(w),n=y.length;n--;)r.push(y[n]);p=!0}z.recycle()}else if(A&&"tiles"===w)for(y=A.getTileShapes(E,s),m=y.length;m--;)r.push(y[m]),p=!0;B.recycle()}return p&&(g=this.resolveCollisionPosition(a,d,g,q,f,j,h,i)),q.recycle(2),g}}(),resolveCollisionPosition:function(){var a=new b;return function(b,c,d,e,f,g,h,i){var j=0,k=a;if(0!==h)for(j=g.length;j--;)k.clear(),this.findMinAxisMovement(b,c,g[j],"x",e[j],k),k.occurred&&f.tryToAddX(k);if(f.xCount>0?(k.copy(f.getXEntry(0)),d.x=b.previousX+k.deltaMovement*k.direction):d.x=b.x,c.movePreviousX(d.x),0!==i)for(j=g.length;j--;)k.clear(),this.findMinAxisMovement(b,c,g[j],"y",e[j],k),k.occurred&&f.tryToAddY(k);return f.yCount>0?(k.copy(f.getYEntry(0)),d.y=b.previousY+k.deltaMovement*k.direction):d.y=b.y,d}}(),findMinAxisMovement:function(){var a=new b;return function(b,c,d,e,f,g){for(var h=c.getShapes(d),i=c.getPrevShapes(d),j=a,k=h.length;k--;)j.clear(),this.findMinShapeMovementCollision(i[k],h[k],e,f,j),j.occurred&&(!g.occurred||j.deltaMovement<g.deltaMovement)&&g.copy(j)}}(),findMinShapeMovementCollision:function(){var a=function(a,b,c,d,e,f,g){a.occurred=!0,a.direction=b,a.position=c,a.deltaMovement=Math.abs(c-d),a.aABB=f.aABB,a.thisShape=e,a.thatShape=f,a.vector.setVector(g)},b={position:0,contactVector:f.setUp()},c=function(a,b){var c=Math.pow;return Math.sqrt(c(b,2)-c(a,2))},d=function(a,b,c){var d=a-b;return d-d/Math.abs(d)*c},e=function(a,b,e,f,g){var h=0,i=b.aABB,j=i.halfWidth,k=a.x,l=a.y;return l>=i.top&&l<=i.bottom?j+a.radius:(l=d(l,b.y,i.halfHeight),h=j+c(l,a.radius),e===a?(g.x=-d(k-f*h,b.x,j)/2,l=-l):g.x=d(k,b.x-f*h,j)/2,g.y=l,g.normalize(),h)},g=function(a,b,e,f,g){var h=0,i=b.aABB,j=i.halfHeight,k=a.x,l=a.y;return k>=i.left&&k<=i.right?j+a.radius:(k=d(k,b.x,i.halfWidth),h=j+c(k,a.radius),e===a?(k=-k,g.y=-d(l-f*h,b.y,j)/2):g.y=d(l,b.y-f*h,j)/2,g.x=k,g.normalize(),h)},h={x:{rectangle:{rectangle:function(a,c,d){var e=b;return e.position=d.x-a*(d.aABB.halfWidth+c.aABB.halfWidth),e.contactVector.setXYZ(a,0),e},circle:function(a,c,d){var f=b;return f.position=d.x-a*e(d,c,c,a,f.contactVector.setXYZ(a,0)),f}},circle:{rectangle:function(a,c,d){var f=b;return f.position=d.x-a*e(c,d,c,a,f.contactVector.setXYZ(a,0)),f},circle:function(a,d,e){var f=e.y-d.y,g=e.x-a*c(f,d.radius+e.radius),h=b;return h.contactVector.setXYZ(e.x-g,f).normalize(),h.position=g,h}}},y:{rectangle:{rectangle:function(a,c,d){var e=b;return e.position=d.y-a*(d.aABB.halfHeight+c.aABB.halfHeight),e.contactVector.setXYZ(0,a),e},circle:function(a,c,d){var e=b;return e.position=d.y-a*g(d,c,c,a,e.contactVector.setXYZ(0,a)),e}},circle:{rectangle:function(a,c,d){var e=b;return e.position=d.y-a*g(c,d,c,a,e.contactVector.setXYZ(0,a)),e},circle:function(a,d,e){var f=e.x-d.x,g=e.y-a*c(f,d.radius+e.radius),h=b;return h.contactVector.setXYZ(f,e.y-g).normalize(),h.position=g,h}}}};return function(b,c,d,e,f){var g=0,i=b[d],j=c[d],k=b,l=j>i?1:-1,m=j,n=null,o=null,p=j,q=null;if(i!==j)for(q=h[d][k.type],"x"===d?k.moveX(j):"y"===d&&k.moveY(j),g=e.length;g--;)n=e[g],m=j,k.collides(n)&&(o=q[n.type](l,k,n),m=o.position,l>0?p>m&&(i>m&&(m=i),p=m,a(f,l,p,i,c,n,o.contactVector)):m>p&&(m>i&&(m=i),p=m,a(f,l,p,i,c,n,o.contactVector)))}}(),checkSoftCollisions:function(){var a=function(a){this.triggerEvent("hit-by-"+a.type,a)};return function(b){for(var c=this.softEntitiesLive,d=null,e=c.length,f=a;e--;)d=c[e],this.checkEntityForSoftCollisions(d,f.bind(d))}}(),checkEntityForSoftCollisions:function(a,b){var c=null,d=null,e=h,f=a.collisionTypes.length,g=0,i=0,j=0,k=0,l=null,m=null,n=null,o=null,p=null,q=null,r=!1;for(e.x=0,e.y=0;f--;){for(l=a.collisionTypes[f],m=a.softCollisionMap.get(l),c=this.getEntityAgainstGrid(a,m),g=m.length;g--;)if(o=m[g],n=c[o]){for(i=n.length;i--;)if(d=n[i],d!==a&&a.getAABB(l).collides(d.getAABB(o)))for(r=!1,p=a.getShapes(l),q=d.getShapes(o),j=p.length;j--;){for(k=q.length;k--;)if(p[j].collides(q[k])){e.entity=d,e.type=o,e.myType=l,e.shape=q[k],e.hitType="soft",b(e),r=!0;break}if(r)break}n.recycle();
}c.recycle()}},destroy:function(){var a=this.againstGrid,b=null,c="",d=null,e=0;this.groupsLive.recycle(),this.nonColliders.recycle(),this.allEntitiesLive.recycle(),this.softEntitiesLive.recycle(),this.solidEntitiesLive.recycle(),this.relocationMessage.position.recycle(),this.relocationMessage.recycle();for(c in a)if(a.hasOwnProperty(c)){for(b=a[c],d=b.keys,e=d.length;e--;)b.get(d[e]).recycle();b.recycle()}a.recycle(),this.againstGrid=null}},publicMethods:{getWorldEntities:function(){return this.allEntitiesLive},getWorldTerrain:function(){return this.terrain},getEntityCollisions:function(a){var b=Array.setUp();return this.checkEntityForSoftCollisions(a,function(a){b.push(d.setUp(a))}),b}}})}(),function(){"use strict";var a={kc0:"unknown",kc8:"backspace",kc9:"tab",kc12:"numpad-5-shift",kc13:"enter",kc16:"shift",kc17:"ctrl",kc18:"alt",kc19:"pause",kc20:"caps-lock",kc27:"esc",kc32:"space",kc33:"page-up",kc34:"page-down",kc35:"end",kc36:"home",kc37:"left-arrow",kc38:"up-arrow",kc39:"right-arrow",kc40:"down-arrow",kc42:"numpad-multiply",kc43:"numpad-add",kc44:"print-screen",kc45:"insert",kc46:"delete",kc47:"numpad-division",kc48:"0",kc49:"1",kc50:"2",kc51:"3",kc52:"4",kc53:"5",kc54:"6",kc55:"7",kc56:"8",kc57:"9",kc59:"semicolon",kc61:"equals",kc65:"a",kc66:"b",kc67:"c",kc68:"d",kc69:"e",kc70:"f",kc71:"g",kc72:"h",kc73:"i",kc74:"j",kc75:"k",kc76:"l",kc77:"m",kc78:"n",kc79:"o",kc80:"p",kc81:"q",kc82:"r",kc83:"s",kc84:"t",kc85:"u",kc86:"v",kc87:"w",kc88:"x",kc89:"y",kc90:"z",kc91:"left-windows-start",kc92:"right-windows-start",kc93:"windows-menu",kc96:"back-quote",kc106:"numpad-multiply",kc107:"numpad-add",kc109:"numpad-minus",kc110:"numpad-period",kc111:"numpad-division",kc112:"f1",kc113:"f2",kc114:"f3",kc115:"f4",kc116:"f5",kc117:"f6",kc118:"f7",kc119:"f8",kc120:"f9",kc121:"f10",kc122:"f11",kc123:"f12",kc144:"num-lock",kc145:"scroll-lock",kc186:"semicolon",kc187:"equals",kc188:"comma",kc189:"hyphen",kc190:"period",kc191:"forward-slash",kc192:"back-quote",kc219:"open-bracket",kc220:"back-slash",kc221:"close-bracket",kc222:"quote"};return platypus.createComponentClass({id:"HandlerController",constructor:function(a){this.callbackKeyUp=null,this.callbackKeyDown=null,platypus.game.settings.debug?(this.callbackKeyDown=function(a){this.keyDown(a)}.bind(this),this.callbackKeyUp=function(a){this.keyUp(a)}.bind(this)):(this.callbackKeyDown=function(a){this.keyDown(a),a.preventDefault()}.bind(this),this.callbackKeyUp=function(a){this.keyUp(a),a.preventDefault()}.bind(this)),window.addEventListener("keydown",this.callbackKeyDown,!0),window.addEventListener("keyup",this.callbackKeyUp,!0)},events:{tick:function(a){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-controller",a)}},methods:{keyDown:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":down",b)},keyUp:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":up",b)},destroy:function(){window.removeEventListener("keydown",this.callbackKeyDown),window.removeEventListener("keyup",this.callbackKeyUp)}}})}(),function(){"use strict";var a=include("platypus.AABB"),b=function(a,b){var c=a.length;for(b.length=0;c--;)b.push(a[c])},c=function(a,b){return a.alwaysOn||a.aabb&&b.collides(a.getAABB())||"undefined"==typeof a.x||b.containsPoint(a.x,a.y)},d=function(a,b,d){var e=a.length,f=null;for(b.length=0;e--;)f=a[e],c(f,d)&&b.push(f)},e=function(a,b,c){return"handle-logic"===a||"handle-post-collision-logic"===a||"prepare-logic"===a||"state-changed"===a||"handle-movement"===a};return platypus.createComponentClass({id:"HandlerLogic",properties:{alwaysOn:!1},publicProperties:{buffer:-1,stepLength:5,maxStepsPerTick:100,timeMultiplier:1},constructor:function(c){this.entities=Array.setUp(),this.activeEntities=Array.setUp(),this.removals=Array.setUp(),this.inLogicLoop=!1,this.alwaysOn?(this.updateList=b,this.camera=null):(this.updateList=d,this.camera=a.setUp()),this.paused=0,this.leftoverTime=0,this.message={delta:this.stepLength,tick:null,camera:this.camera,entities:this.activeEntities}},events:{"child-entity-added":function(a){a.getMessageIds().some(e)&&(this.entities.push(a),!this.inLogicLoop||this.camera&&!c(a,this.camera)||this.activeEntities.push(a))},"child-entity-removed":function(a){var b=this.entities.indexOf(a);b>=0&&(this.entities.greenSplice(b),this.inLogicLoop&&this.removals.push(a))},"pause-logic":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-logic":function(){this.paused=0},"camera-update":function(a){var b=this.buffer,c=this.camera,d=null;c&&(-1===b&&(b=a.viewport.width/10),d=a.viewport,c.setBounds(d.left-b,d.top-b,d.right+b,d.bottom+b))},tick:function(a){var b=0,c=0,d=0,e=null,f=this.message,g=this.activeEntities,h=this.removals,i=this.stepLength;for(this.leftoverTime+=a.delta*this.timeMultiplier,d=Math.floor(this.leftoverTime/i)||1,f.delta=i,this.leftoverTime=Math.max(this.leftoverTime-d*i,0),f.tick=a,this.updateList(this.entities,g,this.camera),d=Math.min(d,this.maxStepsPerTick);d--;)if(this.paused>0&&(this.paused-=i,this.paused<0&&(this.paused=0)),!this.paused){for(this.owner.triggerEvent("logic-tick",f),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-ai",f),this.inLogicLoop=!0,b=g.length;b--;)e=g[b],e.triggerEvent("prepare-logic",f),e.triggerEvent("handle-logic",f),e.triggerEvent("handle-movement",f);if(this.inLogicLoop=!1,h.length){for(b=h.length;b--;)c=g.indexOf(h[b]),c>=0&&g.greenSplice(c);h.length=0}if(b=g.length,this.owner.triggerEvent("check-collision-group",f))for(;b--;)e=g[b],e.triggerEvent("handle-post-collision-logic",f),e.lastState.update(e.state)&&e.triggerEvent("state-changed",e.state);else for(;b--;)e=g[b],e.lastState.update(e.state)&&e.triggerEvent("state-changed",e.state)}}},methods:{destroy:function(){this.entities.recycle(),this.activeEntities.recycle(),this.removals.recycle()}}})}(),function(){"use strict";var a=include("platypus.Vector");return platypus.createComponentClass({id:"HandlerRender",properties:{acceptInput:null},publicProperties:{},constructor:function(a){this.container=new PIXI.Container,this.camera={x:0,y:0},this.acceptInput&&(this.click=this.acceptInput.click,this.cameraMovementMovesMouse=this.acceptInput.camera,this.hover=this.acceptInput.hover,(this.click||this.hover)&&this.addInputs()),this.renderMessage={delta:0,container:this.container}},events:{load:function(){this.owner.triggerEvent("render-world",{world:this.container})},"child-entity-added":function(a){a.triggerEvent("handle-render-load",this.renderMessage)},"pause-render":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-render":function(){this.paused=0},tick:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=null,e=this.renderMessage;if(e.delta=b.delta,this.paused>0&&(this.paused-=b.delta,this.paused<=0&&(this.paused=0)),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-render",e),this.container){for(c=this.container.children.length;c--;)d=this.container.children[c],d.visible&&(d.paused&&!this.paused?d.paused=!1:this.paused&&(d.paused=!0));this.container.reorder&&(this.container.reorder=!1,this.container.children.sort(a))}}}(),"camera-update":function(a){this.camera.x=a.viewport.left,this.camera.y=a.viewport.top,this.moveMouse&&this.moveMouse()}},methods:{addInputs:function(){var a=function(a,b){return function(c){var d=c.data.global.x,e=c.data.global.y,f=c.data.originalEvent,g=0,h=0;a.container&&(g=d/a.container.transformMatrix.a+a.camera.x,h=e/a.container.transformMatrix.d+a.camera.y,c.target.mouseTarget=!0,a.owner.trigger(b,{event:f,pixiEvent:c,x:g,y:h,entity:a.owner}),a.cameraMovementMovesMouse&&("pressup"===b?(c.target.mouseTarget=!1,a.moveMouse=null,c.target.removeDisplayObject&&c.target.removeDisplayObject()):a.moveMouse=function(){a.owner.triggerEvent("pressmove",{event:f,x:d/a.container.transformMatrix.a+a.camera.x,y:e/a.container.transformMatrix.d+a.camera.y,entity:a.owner})}))}};return function(){var b=this.container,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=!1;this.click&&(b.interactive=!0,k=a(this,"mousedown"),c=function(a){k(a),l=!0}.bind(this),i=a(this,"pressmove"),f=function(a){l&&i(a)}.bind(this),j=a(this,"pressup"),g=function(a){j(a),l=!1}.bind(this),h=a(this,"click"),b.addListener("mousedown",c),b.addListener("touchstart",c),b.addListener("mouseup",g),b.addListener("touchend",g),b.addListener("mouseupoutside",g),b.addListener("touchendoutside",g),b.addListener("mousemove",f),b.addListener("touchmove",f),b.addListener("click",h),b.addListener("tap",h)),this.hover&&(b.interactive=!0,d=a(this,"mouseover"),e=a(this,"mouseout"),b.addListener("mouseover",d),b.addListener("mouseout",e)),this.removeInputListeners=function(){this.click&&(b.removeListener("mousedown",c),b.removeListener("touchstart",c),b.removeListener("mouseup",g),b.removeListener("touchend",g),b.removeListener("mouseupoutside",g),b.removeListener("touchendoutside",g),b.removeListener("mousemove",f),b.removeListener("touchmove",f),b.removeListener("click",h),b.removeListener("tap",h)),this.hover&&(b.removeListener("mouseover",d),b.removeListener("mouseout",e)),this.removeInputListeners=null}}}(),destroy:function(){this.container.mouseTarget?(this.container.visible=!1,this.container.removeDisplayObject=function(){this.container=null}.bind(this)):this.container=null}},publicMethods:{windowToWorld:function(b,c,d){var e=d||a.setUp();return e.x=b.x*this.worldPerWindowUnitWidth,e.y=b.y*this.worldPerWindowUnitHeight,c!==!1&&(e.x-=this.viewport.x*this.worldPerWindowUnitWidth,e.y-=this.viewport.y*this.worldPerWindowUnitHeight),e},worldToWindow:function(b,c,d){var e=d||a.setUp();return e.x=b.x*this.windowPerWorldUnitWidth,e.y=b.y*this.windowPerWorldUnitHeight,c!==!1&&(e.x+=this.viewport.x,e.y+=this.viewport.y),e}}})}(),function(){"use strict";var a=function(a,b,c,d,e,f){var g=0,h=0,i=0,j=a.greenSlice();if("horizontal"===f){for(h=e-1;h>=0;h--)for(g=h*d,i=0;(h+1)*d>g;g++,i++)j.splice((h+1)*b+i,0,c[g]);return j}return"vertical"===f?a.concat(c):void 0},b=function(a,b,c,d){var e=0,f="",g=a.greenSlice(),h=null;for(e=0;e<b.length;e++){h={};for(f in b[e])b[e].hasOwnProperty(f)&&(h[f]=b[e][f]);"horizontal"===d?h.x+=c:"vertical"===d&&(h.y+=c),g.push(h)}return g},c=function(c,d,e,f){var g=0,h="";for(c.tilewidth||c.tileheight?(c.tilewidth!==d.tilewidth||c.tileheight!==d.tileheight)&&console.warn("Tiled-Loader: Your map has segments with different tile sizes. All tile sizes must match. Segment: "+d):(c.tilewidth=d.tilewidth,c.tileheight=d.tileheight),"horizontal"===e?0===c.height?c.height=d.height:c.height!==d.height&&console.warn("Tiled-Loader: You are trying to merge segments with different heights. All segments need to have the same height. Level: "+c+" Segment: "+d):"vertical"===e&&(0===c.width?c.width=d.width:c.width!==d.width&&console.warn("Tiled-Loader: You are trying to merge segments with different widths. All segments need to have the same width. Level: "+c+" Segment: "+d)),g=0;g<d.layers.length;g++)if(c.layers[g])c.layers[g].type===d.layers[g].type?c.layers[g].data&&d.layers[g].data?(f(d.layers[g]),"horizontal"===e?(c.layers[g].data=a(c.layers[g].data,c.width,d.layers[g].data,d.width,c.height,e),c.layers[g].width+=d.width):"vertical"===e&&(c.layers[g].data=a(c.layers[g].data,c.height,d.layers[g].data,d.height,c.width,e),c.layers[g].height+=d.height)):c.layers[g].objects&&d.layers[g].objects&&("horizontal"===e?c.layers[g].objects=b(c.layers[g].objects,d.layers[g].objects,c.width*c.tilewidth,e):"vertical"===e&&(c.layers[g].objects=b(c.layers[g].objects,d.layers[g].objects,c.height*c.tileheight,e))):console.warn("Tiled-Loader: The layers in your level segments do not match. Level: "+c+" Segment: "+d);else{f(d.layers[g]),c.layers[g]={};for(h in d.layers[g])d.layers[g].hasOwnProperty(h)&&(c.layers[g][h]=d.layers[g][h])}"horizontal"===e?c.width+=d.width:"vertical"===e&&(c.height+=d.height);for(h in d)d.hasOwnProperty(h)&&!c[h]&&(c[h]=d[h])},d=function(a,b){var d=0,e=0,f=platypus.game.settings.levels,g={height:0,width:0,layers:[]},h={height:0,width:0,layers:[]},i=a[d].length;for(d=0;d<a.length;d++){for(i!==a[d].length&&console.warn("Tiled-Loader: Your map is not square. Maps must have an equal number of segments in every row."),g={height:0,width:0,layers:[]},e=0;e<a[d].length;e++)"string"==typeof a[d][e]?c(g,f[a[d][e]],"horizontal",b):c(g,a[d][e],"horizontal",b);c(h,g,"vertical",b)}return h};return platypus.createComponentClass({id:"LevelBuilder",properties:{useUniques:!0,levelTemplate:null,levelPieces:null},publicProperties:{},constructor:function(a){this.levelMessage={level:null,persistentData:null}},events:{"scene-loaded":function(a){var b=null,c=null,e="",f=0,g=0,h=0;if(this.levelMessage.persistentData=a,this.levelTemplate=a.levelTemplate||this.levelTemplate,this.useUniques=a.useUniques||this.useUniques,c=a.levelPieces||this.levelPieces,this.levelPieces={},c)for(e in c)if(c.hasOwnProperty(e))if("string"==typeof c[e])this.levelPieces[e]=c[e];else{if(!c[e].length)throw"Level Builder: Level pieces of incorrect type: "+c[e];for(this.levelPieces[e]=[],f=0;f<c[e].length;f++)this.levelPieces[e].push(c[e][f])}if(!this.levelTemplate)throw"Level Builder: There is no level template.";if(!this.levelTemplate)throw"Level Builder: Template is not defined";for(this.levelMessage.level=[],g=0;g<this.levelTemplate.length;g++)if(b=this.levelTemplate[g],"string"==typeof b)this.levelMessage.level[g]=this.getLevelPiece(b);else{if(!b.length)throw"Level Builder: Template row is neither a string or array. What is it?";for(this.levelMessage.level[g]=[],h=0;h<b.length;h++)this.levelMessage.level[g][h]=this.getLevelPiece(b[h])}this.levelMessage.level&&(this.levelMessage.level=d(this.levelMessage.level,this.owner.decodeLayer),this.owner.triggerEvent("load-level",this.levelMessage))}},methods:{getLevelPiece:function(a){var b=this.levelPieces[a]||a,c=null,d=0;if(b){if("string"==typeof b)return this.useUniques?(c=b,this.levelPieces[a]=null,c):b;if(b.length)return d=Math.floor(Math.random()*b.length),this.useUniques?this.levelPieces[a].greenSplice(d):b[d];throw"Level Builder: There are no MORE level pieces of type: "+a}throw"Level Builder: There are no level pieces of type: "+a},destroy:function(){this.levelMessage.level=null,this.levelMessage.persistentData=null,this.levelMessage=null}},publicMethods:{mergeLevels:function(a){return d(a,this.owner.decodeLayer)}},getAssetList:function(a,b,c){var d=0,e=null,f=Array.setUp(),g="",h=null;if(a&&a.levelPieces?h=a.levelPieces:b&&b.levelPieces?h=b.levelPieces:c&&c.levelPieces&&(h=c.levelPieces),h)for(g in h)if(h.hasOwnProperty(g))if(Array.isArray(h[g]))for(d=0;d<h[g].length;d++)e=platypus.components.TiledLoader.getAssetList({level:h[g][d]},b,c),f.union(e),e.recycle();else e=platypus.components.TiledLoader.getAssetList({level:h[g]},b,c),f.union(e),e.recycle();return f}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicAngularMovement",properties:{maxVelocity:3,acceleration:.01,visualOffset:0,startAngle:0},publicProperties:{},constructor:function(a){this.angle=this.startAngle,this.v=Array.setUp(0,0),this.moving=!1,this.piOverTwo=Math.PI/2,this.owner.rotation=this.owner.rotation||this.visualOffset},events:{"handle-logic":function(a){var b=Math.PI,c=Math.sin,d=Math.cos,e=Math.min,f=Math.max,g=a.delta,h=0;this.moving&&(this.v[0]+=this.acceleration*d(this.angle)*g,this.v[1]+=this.acceleration*c(this.angle)*g,0===this.v[0]?h=this.v[1]>0?this.piOverTwo:this.v[1]<0?-this.piOverTwo:this.angle:(h=Math.atan(this.v[1]/this.v[0]),this.v[0]<0&&(h=b+h)),this.v[0]>=0?this.v[0]=e(this.v[0],this.maxVelocity*d(h)):this.v[0]=f(this.v[0],this.maxVelocity*d(h)),this.v[1]>=0?this.v[1]=e(this.v[1],this.maxVelocity*c(h)):this.v[1]=f(this.v[1],this.maxVelocity*c(h)),this.owner.x+=this.v[0],this.owner.y+=this.v[1],this.owner.rotation=h*(180/b)+this.visualOffset)},"set-angle":function(a){this.angle=a},move:function(){this.moving=!0},stop:function(){this.moving=!1,this.v[0]=0,this.v[1]=0},"set-max-velocity":function(a){this.maxVelocity=a}},methods:{destroy:function(){this.v.recycle()}}})}(),function(){"use strict";var a=include("platypus.Entity"),b=0;return platypus.createComponentClass({id:"LogicAttachment",properties:{attachState:"attached",attachment:"",offsetX:0,offsetY:0,offsetZ:.01},publicProperties:{},constructor:function(a){this.state=this.owner.state,this.owner.linkId||(this.owner.linkId="attachment-link-"+b,b+=1),this.state.set(this.attachState,!1),this.attachmentPosition={x:0,y:0,z:0,dx:0,dy:0,linkId:this.owner.linkId},this.attachmentProperties={type:this.attachment,properties:this.attachmentPosition},this.attachment=null,this.isAttached=!1},events:{"handle-logic":function(a){var b=0,c=this.state;this.isAttached?(this.attachment||(this.attachmentPosition.x=this.owner.x,this.attachmentPosition.y=this.owner.y,this.attachmentPosition.z=this.owner.z,this.attachment=this.owner.parent.addEntity(this.attachmentProperties)),this.attachment.destroyed?(this.owner.parent.removeEntity(this.attachment),this.attachment=null,this.isAttached=!1):(this.attachment.x=this.owner.x,b=this.offsetX,c.get("left")?(b*=-1,this.attachment.rotation=180):c.get("right")&&(this.attachment.rotation=0),this.attachment.x+=b,this.attachment.y=this.owner.y,b=this.offsetY,c.get("top")?(b*=-1,this.attachment.rotation=90):c.get("bottom")&&(this.attachment.rotation=-90),this.attachment.y+=b,this.attachment.z=this.owner.z,this.attachment.z+=this.offsetZ)):this.attachment&&(this.owner.parent.removeEntity(this.attachment),this.attachment=null),c.set(this.attachState,this.isAttached)},attach:function(a){this.isAttached=!a||a.pressed!==!1},detach:function(){this.isAttached=!1}},methods:{destroy:function(){this.state.set(this.attachState,!1),this.attachment&&(this.owner.parent.removeEntity(this.attachment),this.attachment=null),this.isAttached=!1,this.state=null}},getAssetList:function(b,c,d){var e=b.attachment||c.attachment||d.attachment;return e?a.getAssetList({type:e}):Array.setUp()}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicButton",constructor:function(a){this.state=this.owner.state,this.toggle=!!a.toggle,"pressed"===a.state?(this.state.set("released",!1),this.state.set("pressed",!0)):(this.state.set("released",!0),this.state.set("pressed",!1))},events:{mousedown:function(a){platypus.supports.mobile&&"touchstart"!==a.event.type||this.toggle||this.updateState("pressed")},pressup:function(a){platypus.supports.mobile&&"touchend"!==a.event.type&&"touchcancel"!==a.event.type||(this.toggle?this.state.get("pressed")?this.updateState("released"):this.updateState("pressed"):this.updateState("released"))},"handle-logic":function(){}},methods:{updateState:function(a){var b=this.state;b.get("released")&&"pressed"===a?(b.set("pressed",!0),b.set("released",!1)):b.get("pressed")&&"released"===a&&(b.set("pressed",!1),b.set("released",!0)),this.owner.triggerEvent(a,b)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCanvasButton",properties:{onPress:"",onRelease:"",onCancel:"",useOnce:!1,disabled:!1},publicProperties:{},constructor:function(a){var b=this.owner.state;this.state=b,b.set("disabled",this.disabled),b.set("down",!1),this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.used=!1,this.last=null},events:{"handle-logic":function(a){var b=this.disabled===this.state.get("disabled");this.last!==b&&(this.last=b)},mousedown:function(a){this.state.set("down",!0),this.state.get("disabled")||this.useOnce&&this.used||(this.onPress&&(this.owner.trigger(this.onPress),this.used=!0),a.pixiEvent.stopPropagation())},pressup:function(a){this.state.get("disabled")||this.useOnce&&this.used||(this.cancelled?this.onCancel&&(this.owner.trigger(this.onCancel),this.used=!0):this.onRelease&&(this.owner.trigger(this.onRelease),this.used=!0),a.pixiEvent.stopPropagation()),this.state.set("down",!1),this.cancelled=!1},mouseover:function(){this.state.get("down")&&(this.cancelled=!1)},mouseout:function(){this.state.get("down")&&(this.cancelled=!0)},disable:function(){this.state.set("disabled",!0),this.owner.buttonMode=!1},enable:function(){this.state.set("disabled",!1),this.owner.buttonMode=!0},"toggle-disabled":function(){var a=this.state.get("disabled");this.owner.buttonMode=a,this.state.set("disabled",!a)}},methods:{destroy:function(){this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCarrier",constructor:function(a){},events:{load:function(a){this.owner.triggerEvent("add-collision-entity",this.owner)||(this.owner.addComponent(new platypus.components.CollisionGroup(this.owner,{})),this.owner.triggerEvent("add-collision-entity",this.owner))},"carry-me":function(a){this.owner.triggerEvent("add-collision-entity",a.entity)},"release-me":function(a){this.owner.triggerEvent("remove-collision-entity",a.entity)}}})}(),function(){"use strict";var a=function(a){var b=function(a,b){return b&&!a.message?{event:a.event,message:b,delay:a.delay,repeat:a.repeat}:a};return a.singleInstance?function(c){var d=0,e=!0;for(d=0;d<this.queue.length;d++)this.queue[d].event===a.event&&(e=!1);e&&(this.queue.push(b(a,c)),this.queueTimes.push(a.delay))}:function(c){this.queue.push(b(a,c)),this.queueTimes.push(a.delay)}},b=function(a){return function(){var b=0;for(b=this.queue.length-1;b>-1;b--)this.queue[b]===a&&(this.queueTimes.greenSplice(b),this.queue.greenSplice(b))}};return platypus.createComponentClass({id:"LogicDelayMessage",constructor:function(c){var d="";if(this.queueTimes=Array.setUp(),this.queue=Array.setUp(),c.events)for(d in c.events)c.events.hasOwnProperty(d)&&(this.addEventListener(d,a(c.events[d])),c.events[d].cancelEvent&&this.addEventListener(c.events[d].cancelEvent,b(c.events[d])))},events:{"handle-logic":function(a){for(var b=this.queue.length;b--;)this.queueTimes[b]-=a.delta,this.queueTimes[b]<=0&&(this.owner.trigger(this.queue[b].event,this.queue[b].message),this.queue[b]&&(this.queue[b].repeat?this.queueTimes[b]+=this.queue[b].delay:(this.queueTimes.greenSplice(b),this.queue.greenSplice(b))))}},methods:{destroy:function(){this.queueTimes.recycle(),this.queue.recycle()}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDestroyMe",properties:{delay:0,destroyed:!1},events:{"prepare-logic":function(a){var b=a.delta;this.destroyed&&!this.owner.state.get("paused")&&(this.delay-=b,this.delay<=0&&this.owner.parent.removeEntity(this.owner))},"destroy-me":function(){this.destroyed=!0}}})}(),function(){"use strict";var a=function(a){return function(b){this[a]=!b||b.pressed!==!1}},b=function(){},c={x:function(a,b){a!==b&&(a>180&&180>=b||180>=a&&b>180)&&this.owner.triggerEvent("transform","vertical")},y:function(a,b){a!==b&&(a>90&&270>=a&&(90>=b||b>270)||(90>=a||a>270)&&b>90&&270>=b)&&this.owner.triggerEvent("transform","horizontal")},z:function(a,b){a!==b&&this.owner.triggerEvent("replace-transform","rotate-"+a)}};return platypus.createComponentClass({id:"LogicDirectionalMovement",properties:{axis:"y",speed:.3},constructor:function(a){var d=this.state=this.owner.state;"number"==typeof this.speed&&(this.speed=[this.speed,0,0]),this.initialVector=platypus.Vector.setUp(this.speed),this.reorient=c[this.axis],this.reorient||(this.reorient=b),this.moving=d.set("moving",!1),this.left=d.set("left",!1),this.right=d.set("right",!1),this.up=d.set("up",!1),this.down=d.set("down",!1),this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1,this.heading=0,this.owner.heading=this.owner.heading||0},events:{"component-added":function(a){if(a===this){if(!this.owner.addMover)return void console.warn('The "LogicDirectionalMovement" component requires a "Mover" component to function correctly.');this.direction=this.owner.addMover({velocity:this.speed,drag:0,friction:0,stopOnCollision:!1,orient:!1,aliases:{moving:"control-velocity"}}).velocity,this.owner.heading!==this.heading&&(this.direction.setVector(this.initialVector).rotate(this.owner.heading/180*Math.PI),this.heading=this.owner.heading),this.owner.triggerEvent("moving",this.moving)}},"handle-logic":function(){var a=this.state,b=this.up||this.upLeft||this.downLeft,c=this.upLeft||this.up&&this.left,d=this.left||this.upLeft||this.downLeft,e=this.downLeft||this.down&&this.left,f=this.down||this.downLeft||this.downRight,g=this.downRight||this.down&&this.right,h=this.right||this.upRight||this.downRight,i=this.upRight||this.up&&this.right;if(d&&h||b&&f)this.moving=!1;else if(c)this.moving=!0,this.heading=225;else if(i)this.moving=!0,this.heading=315;else if(e)this.moving=!0,this.heading=135;else if(g)this.moving=!0,this.heading=45;else if(d)this.moving=!0,this.heading=180;else if(h)this.moving=!0,this.heading=0;else if(b)this.moving=!0,this.heading=270;else if(f)this.moving=!0,this.heading=90;else switch(this.moving=!1,this.heading){case 270:b=!0;break;case 90:f=!0;break;case 180:d=!0;break;case 225:b=!0,d=!0;break;case 315:b=!0,h=!0;break;case 135:f=!0,d=!0;break;case 45:f=!0,h=!0;break;case 0:default:h=!0}this.owner.heading!==this.heading&&(this.direction.setVector(this.initialVector).rotate(this.heading/180*Math.PI),this.reorient(this.heading,this.owner.heading),this.owner.heading=this.heading),a.get("moving")!==this.moving&&(this.owner.triggerEvent("moving",this.moving),a.set("moving",this.moving)),a.set("up",b),a.set("right",h),a.set("down",f),a.set("left",d)},"go-down":a("down"),"go-south":a("down"),"go-down-left":a("downLeft"),"go-southwest":a("downLeft"),"go-left":a("left"),"go-west":a("left"),"go-up-left":a("upLeft"),"go-northwest":a("upLeft"),"go-up":a("up"),"go-north":a("up"),"go-up-right":a("upRight"),"go-northeast":a("upRight"),"go-right":a("right"),"go-east":a("right"),"go-down-right":a("downRight"),"go-southeast":a("downRight"),stop:function(a){a&&a.pressed===!1||(this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1)},face:function(){var a={up:270,north:270,down:90,south:90,left:180,west:180,right:0,east:0,"up-left":225,northwest:225,"up-right":315,northeast:315,"down-left":135,southwest:135,"down-right":45,southeast:45};return function(b){this.heading=a[b]||0}}(),accelerate:function(a){this.initialVector.normalize().multiply(a),this.direction.normalize().multiply(a)}},methods:{destroy:function(){this.initialVector.recycle(),this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDragDrop",constructor:function(a){this.nextX=this.owner.x,this.nextY=this.owner.y,this.grabOffsetX=0,this.grabOffsetY=0,this.state=this.owner.state,this.state.set("dragging",!1),this.state.set("noDrop",!1),this.tryDrop=!1,this.hitSomething=!1},events:{"handle-logic":function(a){this.owner.x=this.nextX,this.owner.y=this.nextY,this.state.set("noDrop",!1)},"handle-post-collision-logic":function(a){this.tryDrop?(this.tryDrop=!1,this.hitSomething?(this.dropFailed=!1,this.state.set("noDrop",!0),this.state.set("dragging",!0)):(this.state.set("noDrop",!1),this.state.set("dragging",!1))):this.hitSomething&&this.state.set("noDrop",!0),this.hitSomething=!1},mousedown:function(a){this.grabOffsetX=a.x-this.owner.x,this.grabOffsetY=a.y-this.owner.y,this.state.set("dragging",!0)},mouseup:function(a){this.tryDrop=!0},pressmove:function(a){this.nextX=a.x-this.grabOffsetX,this.nextY=a.y-this.grabOffsetY},"no-drop":function(a){this.hitSomething=!0}},methods:{destroy:function(){this.state.set("dragging",!1),this.state.set("noDrop",!1),this.state=null}}})}(),function(){"use strict";var a=include("platypus.Vector");return platypus.createComponentClass({id:"LogicImpactLaunch",properties:{accelerationX:-.3,accelerationY:-.8,flipX:!0,flipY:!1},constructor:function(a){this.stunState=a.state||"stunned",this.flipX=this.flipX?-1:1,this.flipY=this.flipY?-1:1,this.justJumped=!1,this.stunned=!1,this.state=this.owner.state,this.state.set("impact",!1),this.state.set(this.stunState,!1)},events:{"component-added":function(b){if(b===this){if(!this.owner.addMover)return void console.warn('The "LogicDirectionalMovement" component requires a "Mover" component to function correctly.');this.direction=this.owner.addMover({velocity:[0,0,0],orient:!1}).velocity,this.vector=a.setUp()}},"handle-logic":function(){this.state.set("impact",this.justJumped),this.state.set(this.stunState,this.stunned),this.justJumped&&(this.direction.setVector(this.vector),this.justJumped=!1,this.stunned=!0)},"impact-launch":function(a){var b=a.x,c=a.y;a.entity&&(b=a.entity.x-this.owner.x,c=a.entity.y-this.owner.y),this.stunned||(this.justJumped=!0,b>=0?this.vector.x=this.accelerationX:0>b&&(this.vector.x=this.accelerationX*this.flipX),c>=0?this.vector.y=this.accelerationY:0>c&&(this.vector.y=this.accelerationY*this.flipY))},"hit-solid":function(a){this.stunned&&a.y>0&&(this.direction.x=0,this.direction.y=0,this.stunned=!1)}},methods:{destroy:function(){this.vector.recycle(),this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPacingPlatform",constructor:function(a){this.ang=this.owner.angle||a.angle||0,this.dist=this.owner.distance||a.distance||128,this.dX=this.dist*Math.cos(this.ang),this.dY=this.dist*Math.sin(this.ang),this.period=this.owner.period||a.period||4e3,this.time=0,this.startPos=this.owner.startPos||a.startPos||0,this.offset=0,this.originX=this.owner.x,this.originY=this.owner.y},events:{"handle-logic":function(a){var b=this.period,c=a.delta;this.time+=c,this.time>b&&(this.time=this.time%b),this.offset=this.time/b*2*Math.PI,this.owner.x=this.originX+Math.sin(this.offset+this.startPos)*this.dX,this.owner.y=this.originY+Math.sin(this.offset+this.startPos)*this.dY}}})}(),function(){"use strict";var a={down:!0};return platypus.createComponentClass({id:"LogicPortable",constructor:function(b){this.portableDirections=b.portableDirections||a,this.carrier=this.lastCarrier=null,this.message={entity:this.owner}},events:{"handle-logic":function(a){var b=this.message;this.carrierConnected?(this.carrier!==this.lastCarrier&&(this.lastCarrier&&this.lastCarrier.triggerEvent("release-me",b),this.carrier.triggerEvent("carry-me",b)),this.carrierConnected=!1):this.carrier&&(this.carrier.triggerEvent("release-me",b),this.carrier=null),this.lastCarrier=this.carrier},"hit-solid":function(a){a.y>0?this.updateCarrier(a.entity,"down"):a.y<0?this.updateCarrier(a.entity,"up"):a.x<0?this.updateCarrier(a.entity,"left"):a.x>0&&this.updateCarrier(a.entity,"right")}},methods:{updateCarrier:function(a,b){this.portableDirections[b]&&a&&(a!==this.carrier&&(this.carrier=a),this.carrierConnected=!0)}}})}(),function(){"use strict";var a=include("platypus.DataMap");return platypus.createComponentClass({id:"LogicPortal",constructor:function(b){var c=0,d=b.entrants||b.entrant||"no one",e=this.owner.state;if(this.destination=this.owner.destination||b.destination,this.used=!1,this.ready=!1,this.wasReady=!1,this.entrants=a.setUp(),Array.isArray(d))for(c=0;c<d.length;c++)this.entrants.set(d[c],!1);else this.entrants.set(d,!1);this.state=e,e.set("occupied",!1),e.set("ready",!0)},events:{"handle-logic":function(){var a=this.entrants,b=a.keys,c=b.length,d=!1,e=!0,f=this.state;for(!this.used&&this.activated?(this.owner.triggerEvent("port-"+this.destination),this.used=!0):this.ready&&!this.wasReady?(this.owner.triggerEvent("portal-waiting"),this.wasReady=!0):this.wasReady&&!this.ready&&(this.owner.triggerEvent("portal-not-waiting"),this.wasReady=!1);c--;)a[b[c]]?(d=!0,a.set(b[c],!1)):e=!1;f.set("occupied",d),f.set("ready",e),this.ready=!1},"occupied-portal":function(a){var b=this.entrants,c=b.keys,d=c.length;for(b.set(a.entity.type,!0);d--;)if(!b.get(c[d]))return;this.ready=!0},"activate-portal":function(){this.activated=!0}},methods:{destroy:function(){this.state=null,this.entrants.recycle(),this.entrants=null}}})}(),function(){"use strict";var a=function(a,b){return a/Math.abs(a)*b};return platypus.createComponentClass({id:"LogicPushable",constructor:function(a){
this.yPush=a.push||a.yPush||0,this.xPush=a.push||a.xPush||.1,a.roll?(this.radius=a.radius||this.owner.radius||(this.owner.width||this.owner.height||2)/2,this.owner.orientation=this.owner.orientation||0):this.radius=0,this.currentPushX=0,this.currentPushY=0,this.lastX=this.owner.x,this.lastY=this.owner.y,this.pushers=Array.setUp()},events:{"handle-logic":function(b){var c=0,d=b.delta;for(this.currentPushY&&(this.owner.y+=a(this.currentPushY,this.yPush*d),this.currentPushY=0),this.currentPushX&&(this.owner.x+=a(this.currentPushX,this.xPush*d),this.currentPushX=0),(this.lastX!==this.owner.x||this.lastY!==this.owner.y)&&(this.radius&&(this.owner.orientation+=(this.owner.x+this.owner.y-this.lastX-this.lastY)/this.radius),this.lastX=this.owner.x,this.lastY=this.owner.y),c=0;c<this.pushers.length;c++)this.pushers[c].triggerEvent("pushed",this.owner);this.pushers.length=0},"push-entity":function(a){var b=a.x||0,c=a.y||0;this.currentPushX-=b,this.currentPushY-=c,(this.yPush&&c||this.xPush&&b)&&this.pushers.push(a.entity)},"hit-solid":function(a){return a.y>0&&this.vY>0||a.y<0&&this.vY<0?this.vY=0:(a.x<0&&this.vX<0||a.x>0&&this.vX>0)&&(this.vX=0),!0}},methods:{destroy:function(){this.pushers.recycle()}}})}(),function(){"use strict";var a=include("platypus.Vector");return platypus.createComponentClass({id:"LogicRebounder",constructor:function(b){platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.owner.mass=this.owner.mass||b.mass||1,this.elasticity=b.elasticity||.8,this.v=a.setUp(0,0,0),this.incidentVector=a.setUp(0,0,0),this.staticCollisionOccurred=!1,this.nonStaticCollisionOccurred=!1,this.hitThisTick=Array.setUp(),this.otherV=a.setUp(0,0,0),this.otherVelocityData=Array.setUp()},events:{"handle-logic":function(a){var b=0;for(this.hitThisTick.length=0,b=0;b<this.otherVelocityData.length;b++)this.otherVelocityData[b].velocity.recycle();this.otherVelocityData.length=0},"hit-static":function(a){var b=0,c=a.entity,d=0;for(d=0;d<this.hitThisTick.length;d++)if(c===this.hitThisTick[d])return;this.hitThisTick.push(c),this.v.setVector(this.owner.velocity),this.incidentVector.setVector(a.direction),b=this.v.scalarProjection(this.incidentVector),isNaN(b)||(this.incidentVector.scale(b*(1+this.elasticity)),this.v.subtractVector(this.incidentVector)),this.owner.velocity.setVector(this.v)},"hit-non-static":function(a){var b=0,c=a.entity,d=!1,e=0,f=0,g=0;if(b=this.hitThisTick.indexOf(c),!(b>=0)){for(this.hitThisTick.push(c),b=0;b<this.otherVelocityData.length;b++)if(c===this.otherVelocityData[b].entity){this.otherV.setVector(this.otherVelocityData[b].velocity),d=!0;break}d||(this.otherV.setVector(c.velocity),c.triggerEvent("share-velocity",this.owner)),this.v.setVector(this.owner.velocity),this.incidentVector.setVector(a.direction),e=this.v.scalarProjection(this.incidentVector),e=isNaN(e)?0:e,f=this.otherV.scalarProjection(this.incidentVector),f=isNaN(f)?0:f,g=(e*(this.owner.mass-c.mass)+2*c.mass*f)/(this.owner.mass+c.mass),this.incidentVector.scale(g-e),this.owner.velocity.setVector(this.incidentVector)}},"share-velocity":function(b){this.otherVelocityData.push({entity:b,velocity:a.setUp(b.velocity)})}},methods:{destroy:function(){this.v.recycle(),this.incidentVector.recycle(),this.otherV.recycle(),this.hitThisTick.recycle(),this.otherVelocityData.recycle()}},publicMethods:{}})}(),function(){"use strict";var a=include("platypus.Entity");return platypus.createComponentClass({id:"LogicRegionSpawner",constructor:function(a){var b=0,c=0,d=1,e=1,f=0,g=0,h=0,i=0;if(this.spawnPosition={x:0,y:0},this.spawnProperties={properties:this.spawnPosition},this.regions=null,this.usedRegions=null,this.regionWidth=0,this.regionHeight=0,a.regions)for(this.regions=Array.setUp(),this.usedRegions=Array.setUp(),this.regionWidth=f=a.regions.width||this.owner.width,this.regionHeight=g=a.regions.height||this.owner.height,d=Math.round(this.owner.width/f),e=Math.round(this.owner.height/g),b=0;d>b;b++)for(c=0;e>c;c++)h=Math.min(f,this.owner.width-b*f),i=Math.min(g,this.owner.height-c*g),this.regions.push({x:b*f,y:c*g,width:h,height:i});this.entityClass=platypus.game.settings.entities[a.spawn],this.interval=this.owner.interval||a.interval||1e3,this.time=0},events:{"handle-logic":function(a){var b=this.regions,c=null;this.time+=a.delta,this.time>this.interval&&(this.time-=this.interval,b?(b.length||(this.regions=this.usedRegions,this.usedRegions=b,b=this.regions),c=b[Math.floor(b.length*Math.random())],this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+(c.x+Math.random()*c.width),this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+(c.y+Math.random()*c.height)):(this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+Math.random()*this.owner.width,this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+Math.random()*this.owner.height),this.owner.triggerEvent("entity-created",this.owner.parent.addEntity(new platypus.Entity(this.entityClass,this.spawnProperties))))}},methods:{destroy:function(){this.regions.recycle(),this.usedRegions.recycle()}},getAssetList:function(b,c,d){var e=b.spawn||c.spawn||d.spawn;return e?a.getAssetList({type:e}):Array.setUp()}})}(),function(){"use strict";var a=Math.cos,b=Math.sin,c=function(b,c){return b*a(c)},d=function(a,c){return a*b(c)};return platypus.createComponentClass({id:"LogicRotationalMovement",constructor:function(a){var b=this.owner.state;this.speed=a.speed||.3,this.magnitude=0,this.degree=a.degree||1,this.angle=a.angle||0,this.state=b,b.set("moving",!1),b.set("turningRight",!1),b.set("turningLeft",!1),this.owner.orientation=0,this.moving=!1,this.turningRight=!1,this.turningLeft=!1},events:{"handle-logic":function(a){var b=this.state,e=0,f=0;this.turningRight&&(this.angle+=this.degree*a.delta/15),this.turningLeft&&(this.angle-=this.degree*a.delta/15),this.moving&&(e=c(this.magnitude,this.angle),f=d(this.magnitude,this.angle)),this.owner.x+=e*a.delta,this.owner.y+=f*a.delta,b.set("moving",this.moving),b.set("turningLeft",this.turningLeft),b.set("turningRight",this.turningRight),this.owner.rotation!==this.angle&&(this.owner.rotation=this.angle)},"turn-right":function(a){a?this.turningRight=a.pressed:this.turningRight=!0},"turn-left":function(a){a?this.turningLeft=a.pressed:this.turningLeft=!0},"go-forward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=this.speed):this.moving=!1},"go-backward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=-this.speed):this.moving=!1},stop:function(a){(!a||a.pressed)&&(this.moving=!1,this.turningLeft=!1,this.turningRight=!1)},"stop-moving":function(a){(!a||a.pressed)&&(this.moving=!1)},"stop-turning":function(a){(!a||a.pressed)&&(this.turningLeft=!1,this.turningRight=!1)}},methods:{destroy:function(){this.state=null}}})}(),function(){"use strict";var a=include("platypus.Entity");return platypus.createComponentClass({id:"LogicSpawner",constructor:function(a){var b=this.owner.spawneeClass||a.spawneeClass,c="",d=0;if(this.state=this.owner.state,this.stateName=a.state||"spawning",this.entityClass=platypus.game.settings.entities[b],this.speed=a.speed||this.owner.speed||0,this.state.set(this.stateName,!1),this.spawneeProperties={x:0,y:0,z:0,dx:0,dy:0,spawner:this.owner},a.passOnProperties)for(d=0;d<a.passOnProperties.length;d++)c=a.passOnProperties[d],this.owner[c]&&(this.spawneeProperties[c]=this.owner[c]);this.propertiesContainer={properties:this.spawneeProperties},this.offsetX=this.owner.offsetX||a.offsetX||0,this.offsetY=this.owner.offsetY||a.offsetY||0,this.firing=!1},events:{"handle-logic":function(){var a=0,b=0,c=this.state;this.firing&&(this.spawneeProperties.x=this.owner.x,this.spawneeProperties.y=this.owner.y,b=this.entityClass.properties&&this.entityClass.properties.z?this.entityClass.properties.z:0,this.spawneeProperties.z=this.owner.z+b,a=this.offsetX,c.get("left")&&(a*=-1),this.spawneeProperties.x+=a,a=this.offsetY,c.get("top")&&(a*=-1),this.spawneeProperties.y+=a,this.speed?(c.get("top")?this.spawneeProperties.dy=-this.speed:c.get("bottom")?this.spawneeProperties.dy=this.speed:delete this.spawneeProperties.dy,c.get("left")?this.spawneeProperties.dx=-this.speed:c.get("right")?this.spawneeProperties.dx=this.speed:delete this.spawneeProperties.dx):(delete this.spawneeProperties.dx,delete this.spawneeProperties.dy),this.parent&&this.owner.triggerEvent("entity-created",this.parent.addEntity(new platypus.Entity(this.entityClass,this.propertiesContainer)))),c.set(this.stateName,this.firing),this.firing=!1},spawn:function(a){this.firing=!a||a.pressed!==!1,this.parent=this.owner.parent}},methods:{destroy:function(){this.state=null}},getAssetList:function(b,c,d){var e=b.spawneeClass||c.spawneeClass||d.spawneeClass;return e?a.getAssetList({type:e}):Array.setUp()}})}(),function(){"use strict";var a=include("platypus.DataMap"),b=include("platypus.StateMap"),c=function(a,b){b.update(a)},d=function(a,b){b.set(a,!0)},e=null,f=null,g=function(b){var c=null,d="";if(!b||"object"!=typeof b||Array.isArray(b)||b.event)return b;c=a.setUp();for(d in b)b.hasOwnProperty(d)&&c.set(d,g(b[d]));return c};return e=function(a,b,c,d,g,h,i){var j=0,k="",l=null,m=d.message||0===d.message||d.message===!1,n=null;if(g){if("string"==typeof d)return void h.triggerEvent(d);if(Array.isArray(d)){for(j=0;j<d.length;j++)e(a,b,c,d[j],g,h,i);return}if(d.event&&(m||d.delay))return void(d.delay?i.push(d):h.trigger(d.event,d.message));d.get&&(n=d.get("true"),n&&e(a,b,c,n,g,h,i))}if(l=d.keys)for(j=l.length;j--;)k=l[j],"true"!==k&&f(k,b,c,d.get(k),g,h,i)},f=function(a,b,c,d,f,g,h){var i=f,j=!1,k="",l=!1;"!"===a.charAt(0)?(k=a.substring(1),l=b.get(k),j=l===!1,"outputs"!==a&&c.get(k)!==l&&(i=!0)):(l=b.get(a),j=l===!0,"outputs"!==a&&c.get(a)!==l&&(i=!0)),(j||"outputs"===a)&&e(a,b,c,d,i,g,h)},platypus.createComponentClass({id:"LogicStateMachine",properties:{inputs:null,outputs:null},constructor:function(a){var e=0,f=this.inputs,h="",i=null,j=null,k=null,l=a["sustained-inputs"],m=this.owner.state;if(this.state=m,f){k=Array.setUp();for(h in f)if(f.hasOwnProperty(h))for(j=b.setUp(f[h]),k.push(j),this.addEventListener(h,c.bind(this,j,m)),i=j.keys,e=i.length;e--;)m.set(i[e],!1);this.stateObjects=k}if(this.sustainedState=b.setUp(),l)for(h in l)l.hasOwnProperty(h)&&(this.addEventListener(h,d.bind(this,l[h],this.sustainedState)),this.sustainedState.set(l[h],!1),m.set(l[h],!1));this.snapshot=b.setUp(),this.last=b.setUp(),this.queueTimes=Array.setUp(),this.queue=Array.setUp(),this.outputs=g(this.outputs)},events:{"handle-logic":function(a){for(var b=this.sustainedState,c="",d=b.keys,e=d.length,f=this.state;e--;)c=d[e],f.set(c,b.get(c)),b.set(c,!1);for(e=this.queue.length;e--;)this.queueTimes[e]-=a.delta,this.queueTimes[e]<=0&&(this.owner.trigger(this.queue[e].event,this.queue[e].message),this.queueTimes.greenSplice(e),this.queue.greenSplice(e))},"update-state":function(a){this.state.update(a)},"state-changed":function(a){var b=0,c=null,d=this.snapshot;if(this.outputs){for(d.update(a),c=Array.setUp(),f("outputs",d,this.last,this.outputs,!1,this.owner,c),b=c.length;b--;)this.queue.push(c[b]),this.queueTimes.push(c[b].delay);c.recycle(),this.last.update(d)}}},methods:{destroy:function(){var a=0,b=this.stateObjects;if(this.queueTimes.recycle(),this.queue.recycle(),b){for(a=b.length;a--;)b[a].recycle();b.recycle(),this.stateObjects=null}this.sustainedState.recycle(),this.snapshot.recycle(),this.last.recycle(),this.state=null,this.inputs=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicSwitch",constructor:function(a){this.state=this.owner.state,this.pressed=!1,this.wasPressed=this.pressed,this.sticky=a.sticky||!1,this.state.set("pressed",!1),this.initialPress=!0},events:{"handle-logic":function(){this.sticky?this.pressed&&!this.wasPressed&&(this.state.set("pressed",!0),this.wasPressed=!0,this.owner.triggerEvent("switch-on")):(this.pressed!==this.wasPressed&&(this.pressed?(this.state.set("pressed",!0),this.owner.triggerEvent("switch-on")):(this.state.set("pressed",!1),this.owner.triggerEvent("switch-off"))),this.wasPressed=this.pressed,this.pressed=!1)},"switch-pressed":function(){this.pressed=!0,this.initialPress&&(this.owner.triggerEvent("initial-press"),this.initialPress=!1)}},methods:{destroy:function(){this.state=null}}})}(),function(){"use strict";var a=include("platypus.Vector");return platypus.createComponentClass({id:"LogicTeleportee",constructor:function(b){this.teleportDestination=a.setUp(),this.teleportNow=!1,this.DestinationSet=!1,this.message={position:this.teleportDestination}},events:{"handle-logic":function(){this.teleportNow&&(this.owner.triggerEvent("relocate-entity",this.message),this.teleportNow=!1,this.owner.triggerEvent("teleport-complete"))},teleport:function(){this.destinationSet&&(this.teleportNow=!0)},"set-destination":function(a){this.setDestination(a)},"hit-telepoint":function(a){this.setDestination(a.entity)}},methods:{setDestination:function(a){this.teleportDestination.setXYZ(a.x,a.y,this.owner.z),this.destinationSet=!0},destroy:function(){this.teleportDestination.recycle()}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTeleporter",constructor:function(a){this.destination=void 0,this.linkId=this.owner.teleportId||a.teleportId,this.facing=this.owner.facing||a.facing||!1,this.facing&&this.owner.state.set("facing-"+this.facing,!0)},events:{"peer-entity-added":function(a){this.destination||a.linkId!==this.linkId||(this.destination=a)},"teleport-entity":function(a){switch(this.facing){case"up":a.y<0&&a.entity.triggerEvent("teleport",this.destination);break;case"right":a.x>0&&a.entity.triggerEvent("teleport",this.destination);break;case"down":a.y>0&&a.entity.triggerEvent("teleport",this.destination);break;case"left":a.x<0&&a.entity.triggerEvent("teleport",this.destination);break;default:a.entity.triggerEvent("teleport",this.destination)}}},methods:{destroy:function(){this.destination=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTimer",constructor:function(a){this.time=this.owner.time||a.time||0,this.prevTime=this.time,this.alarmTime=this.owner.alarmTime||a.alarmTime||void 0,this.isInterval=this.owner.isInterval||a.isInterval||!1,this.alarmMessage=this.owner.alarmMessage||a.alarmMessage||"",this.updateMessage=this.owner.updateMessage||a.updateMessage||"",this.isOn=this.owner.on||a.on||!0,this.isIncrementing=this.owner.isIncrementing||a.isIncrementing||!0,this.maxTime=this.owner.maxTime||a.maxTime||36e5},events:{"handle-logic":function(a){this.isOn&&(this.prevTime=this.time,this.isIncrementing?this.time+=a.delta:this.time-=a.delta,Math.abs(this.time)>this.maxTime&&(this.time>0?this.time=this.maxTime:this.time<0&&(this.time=-this.maxTime),this.triggerEvent("stop-timer")),"undefined"!=typeof this.alarmTime&&(this.isInterval?this.isIncrementing?Math.floor(this.time/this.alarmTime)>Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):Math.floor(this.time/this.alarmTime)<Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):this.isIncrementing?this.time>this.alarmTime&&this.prevTime<this.alarmTime&&this.owner.trigger(this.alarmMessage):this.time<this.alarmTime&&this.prevTime>this.alarmTime&&this.owner.trigger(this.alarmMessage))),this.owner.trigger(this.updateMessage,{time:this.time})},"set-timer":function(a){this.time=a.time},"start-timer":function(){this.isOn=!0},"stop-timer":function(){this.isOn=!1}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicWindUpRacer",properties:{speed:.3,raceTime:5e3,windTime:500},constructor:function(a){var b=this.owner.state;this.windProgress=0,this.winding=!1,this.racing=!1,this.blocked=!1,this.right=!1,this.left=!1,this.state=b,b.set("windingUp",!1),b.set("racing",!1),b.set("blocked",!1)},events:{"handle-logic":function(a){var b=this.state;this.racing?!this.blocked&&this.right&&b.get("right")?(this.owner.x+=this.speed*a.delta,this.owner.triggerEvent("racing")):!this.blocked&&this.left&&b.get("left")?(this.owner.x-=this.speed*a.delta,this.owner.triggerEvent("racing")):(this.racing=!1,this.owner.triggerEvent("stopped-racing")):this.winding?((this.right&&b.get("right")||this.left&&b.get("left"))&&(this.windProgress+=a.delta),this.owner.triggerEvent("winding",this.windProgress/this.windTime)):this.windProgress&&(this.windProgress>=this.windTime&&(this.racing=!0),this.windProgress=0,this.owner.triggerEvent("stopped-winding")),b.set("windingUp",this.winding),b.set("racing",this.racing),b.set("blocked",this.blocked),this.blocked=!1},"stop-racing":function(){this.racing=!1,this.owner.triggerEvent("stopped-racing")},"wind-up":function(a){this.winding=!a||a.pressed!==!1,this.right=this.state.get("right"),this.left=this.state.get("left")},"hit-solid":function(a){a.x&&this.racing&&(this.right&&a.x>0||this.left&&a.x<0)&&(this.blocked=!0,this.owner.triggerEvent("blocked",a))}},methods:{destroy:function(){this.state.set("windingUp",!1),this.state.set("racing",!1),this.state.set("blocked",!1),this.state=null}}})}(),function(){"use strict";var a=include("platypus.Vector"),b=function(){return!0},c=function(a,c){var d=b,e=b,f=b,g=a.owner.state,h=c.controlState,i=c.instantState,j=c.instantSuccess;h&&(e=function(){return g.get(h)}),a.instant||i?(i&&(f=function(){return g.get(i)}),a.instant=!0,a.update=function(a){var b=f(),c=e();if(this.activeVelocity){if(this.enact&&!c&&(this.ready=!1),this.ready&&this.enact&&b)this.ready=!1,this.velocity.setVector(this.instant),j&&this.owner.triggerEvent(j);else if(this.ready||this.enact&&b){if(c)return null}else this.ready=!0,this.decay();return this.velocity}return null}):a.update=function(a){return this.activeVelocity&&e()?(this.activeAcceleration&&d()&&this.move(a),this.velocity):null}};return platypus.createComponentClass({id:"Motion",properties:{orient:!0,acceleration:0,activeAcceleration:!0,activeVelocity:!0,maxMagnitude:1/0,controlState:"",instant:!1,instantState:"",instantSuccess:"",instantDecay:null,velocity:0,stopOnCollision:!0,drag:-1,friction:-1},constructor:function(b){this.acceleration||(this.activeAcceleration=!1),this.acceleration=a.setUp(this.acceleration),this.velocity=a.setUp(this.velocity),this.triggered=!1,this.ready=!0,"number"==typeof this.instantDecay?this.capMagnitude=this.velocity.magnitude()*this.instantDecay:this.capMagnitude=-1,c(this,b),this.instant&&(this.enact=!1,this.instant=a.setUp(this.velocity),this.velocity.setXYZ(0,0,0)),this.orient&&(this.owner.triggerEvent("orient-vector",this.velocity),this.owner.triggerEvent("orient-vector",this.acceleration))},events:{"control-velocity":function(a){this.activeVelocity=a&&a.pressed!==!1},"stop-velocity":function(){this.activeVelocity=!1},"start-velocity":function(){this.activeVelocity=!0},"control-acceleration":function(a){this.activeAcceleration=a&&a.pressed!==!1},"stop-acceleration":function(){this.activeAcceleration=!1},"start-acceleration":function(){this.activeAcceleration=!0},"instant-motion":function(a){this.enact=a&&a.triggered!==!1},"instant-begin":function(){this.enact=!0},"instant-end":function(){this.enact=!1},"set-motion":function(a){a.acceleration&&this.acceleration.set(a.acceleration),a.velocity&&(this.velocity.set(a.velocity),"number"==typeof this.instantDecay?this.capMagnitude=this.velocity.magnitude()*this.instantDecay:this.capMagnitude=-1),"number"==typeof a.maxMagnitude&&(this.maxMagnitude=a.maxMagnitude)}},methods:{move:function(b){var c=a.setUp(this.acceleration).multiply(b);return this.velocity.add(c),c.recycle(),this.velocity.magnitude()>this.maxMagnitude&&this.velocity.normalize().multiply(this.maxMagnitude),this.velocity},decay:function(){this.capMagnitude>=0&&this.velocity.magnitude()>this.capMagnitude&&this.velocity.normalize().multiply(this.capMagnitude)},destroy:function(){this.orient&&(this.owner.triggerEvent("remove-vector",this.acceleration),this.owner.triggerEvent("remove-vector",this.velocity)),this.acceleration.recycle(),this.velocity.recycle(),this.instant&&this.instant.recycle()}},publicMethods:{}})}(),function(){"use strict";var a=include("platypus.Vector"),b=a.setUp(),c=function(a,b,c,d){return a&&b!==c?c>b?Math.min(b+a*d,c):Math.max(b-a*d,c):b},d=function(a,b){var d=this.maxMagnitudeInterim=c(this.maxMagnitudeDelta,this.maxMagnitudeInterim,this.maxMagnitude,b);a.magnitude()>d&&a.normalize().multiply(d)},e=function(a,b){var d=this.maxMagnitude,e=this.maxMagnitudeDelta,f=this.maxMagnitudeInterim;f.up=c(e,f.up,d.up,b),f.right=c(e,f.right,d.right,b),f.down=c(e,f.down,d.down,b),f.left=c(e,f.left,d.left,b),a.x>0?a.x>f.right&&(a.x=f.right):a.x<0&&a.x<-f.left&&(a.x=-f.left),a.y>0?a.y>f.down&&(a.y=f.down):a.y<0&&a.y<-f.up&&(a.y=-f.up)};return platypus.createComponentClass({id:"Mover",properties:{ground:[0,1]},publicProperties:{movers:[],gravity:0,jump:0,speed:0,drag:.01,friction:.06,maxMagnitude:1/0,maxMagnitudeDelta:0,reorientVelocities:!0},constructor:function(b){var c=1/0,f=this.maxMagnitude,g=this.owner.state;platypus.Vector.assign(this.owner,"position","x","y","z"),platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.position=this.owner.position,this.velocity=this.owner.velocity,this.lastVelocity=a.setUp(this.velocity),this.collision=null,this.pause=!1,this.moversCopy=this.movers,this.movers=Array.setUp(),this.velocityChanges=Array.setUp(),this.velocityDirections=Array.setUp(),this.ground=a.setUp(this.ground),this.state=g,g.set("grounded",!1),Object.defineProperty(this.owner,"maxMagnitude",{get:function(){return c},set:function(a){"number"==typeof a?(this.clamp=d,c=a,this.maxMagnitudeDelta||(this.maxMagnitudeInterim=a)):(this.clamp=e,"number"==typeof c&&(c={up:c,right:c,down:c,left:c}),"number"==typeof a.up&&(c.up=a.up),"number"==typeof a.right&&(c.right=a.right),"number"==typeof a.down&&(c.down=a.down),"number"==typeof a.left&&(c.left=a.left),"number"==typeof this.maxMagnitudeInterim?this.maxMagnitudeDelta?this.maxMagnitudeInterim={up:this.maxMagnitudeInterim,right:this.maxMagnitudeInterim,down:this.maxMagnitudeInterim,left:this.maxMagnitudeInterim}:this.maxMagnitudeInterim={up:c.up,right:c.right,down:c.down,left:c.left}:this.maxMagnitudeDelta||(this.maxMagnitudeInterim.up=c.up,this.maxMagnitudeInterim.right=c.right,this.maxMagnitudeInterim.down=c.down,this.maxMagnitudeInterim.left=c.left))}.bind(this)}),this.maxMagnitudeInterim=0,this.maxMagnitude=f},events:{"component-added":function(a){"Motion"===a.type&&this.movers.push(a)},"component-removed":function(a){var b=0;"Motion"===a.type&&(b=this.movers.indexOf(a),b>=0&&this.movers.greenSplice(b))},load:function(){var a=0,b=this.moversCopy;for(delete this.moversCopy,a=0;a<b.length;a++)this.addMover(b[a]);this.externalForces=this.addMover({velocity:[0,0,0],orient:!1}).velocity,this.speed&&(isNaN(this.speed)||(this.speed=[this.speed,0,0]),this.speed=this.addMover({velocity:this.speed,controlState:"moving"}).velocity),this.gravity&&(isNaN(this.gravity)||(this.gravity=[0,this.gravity,0]),this.gravity=this.addMover({acceleration:this.gravity,orient:!1,aliases:{gravitate:"control-acceleration"}}).acceleration),this.jump&&(isNaN(this.jump)||(this.jump=[0,this.jump,0]),this.jump=this.addMover({velocity:this.jump,instant:!0,controlState:"grounded",state:"jumping",instantSuccess:"just-jumped",instantDecay:.2,aliases:{jump:"instant-motion"}}).instant)},"handle-movement":function(b){var c=b.delta,d=null,e=this.state,f=null,g=this.velocity,h=this.position,i=this.movers,j=i.length;if(!e.get("paused")&&!this.paused){for(g.equals(this.lastVelocity,2)||this.externalForces.addVector(g).subtractVector(this.lastVelocity),g.setXYZ(0,0,0);j--;)d=i[j].update(c),d&&(this.grounded?-1!==i[j].friction?d.multiply(1-i[j].friction):d.multiply(1-this.friction):-1!==i[j].drag?d.multiply(1-i[j].drag):d.multiply(1-this.drag),g.add(d));this.clamp(g,c),this.lastVelocity.setVector(g),f=a.setUp(g).multiply(c),h.add(f),f.recycle(),e.set("grounded",this.grounded),this.grounded=!1}},"hit-solid":function(b){var c=0,d=0,e=b.entity&&b.entity.velocity,f=b.direction,g=!0,h=this.velocityChanges,i=this.velocityDirections,j=h.length;if(f.dot(this.ground)>0&&(this.grounded=!0),c=this.velocity.scalarProjection(f),c>0){for(e?(d=Math.max(e.scalarProjection(f),0),c=c>d?d:0):c=0;j--;)if(c<h[j]&&i[j].dot(f)>0){h[j]=c,i[j].setVector(f),g=!1;break}g&&(h.push(c),i.push(a.setUp(f)))}},"handle-post-collision-logic":function(){var a=null,c=this.movers,d=this.velocityChanges,e=this.velocityDirections,f=d.length,g=c.length,h=null,i=0,j=0,k=null,l=b;if(f){for(k=Array.setUp();g--;)h=c[g],h.stopOnCollision&&k.push(h);for(;f--;){for(a=e[f],i=d[f],g=k.length,j=i/g;g--;)h=k[g],l.setVector(a).normalize().multiply(j-h.velocity.scalarProjection(a)),h.velocity.add(l);a.recycle()}d.length=0,e.length=0}},"set-mover":function(a){"number"==typeof a.maxMagnitudeDelta&&(this.maxMagnitudeDelta=a.maxMagnitudeDelta),a.maxMagnitude&&(this.maxMagnitude=a.maxMagnitude)},"pause-movement":function(){this.paused=!0},"unpause-movement":function(){this.paused=!1},"orientation-updated":function(a){this.reorientVelocities||this.lastVelocity.multiply(a)}},methods:{destroy:function(){var a=0,b=this.maxMagnitude;for(a=this.movers.length-1;a>=0;a--)this.removeMover(this.movers[a]);this.movers.recycle(),this.ground.recycle(),this.lastVelocity.recycle(),this.velocityChanges.recycle(),this.velocityDirections.recycle(),delete this.owner.maxMagnitude,this.owner.maxMagnitude=b,this.state=null}},publicMethods:{addMover:function(a){var b=this.owner.addComponent(new platypus.components.Motion(this.owner,a));return b},removeMover:function(a){this.owner.removeComponent(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Node",publicProperties:{x:0,y:0,z:0},constructor:function(a){this.nodeId=a.nodeId||this.owner.nodeId||this.owner.id||String(Math.random()),"string"!=typeof this.nodeId&&this.nodeId.length&&(this.nodeId=a.nodeId.join("|")),this.owner.nodeId=this.nodeId,this.owner.isNode=!0,this.map=this.owner.map=this.owner.map||null,this.contains=this.owner.contains=Array.setUp(),this.edgesContain=this.owner.edgesContain=Array.setUp(),platypus.Vector.assign(this.owner,"position","x","y","z"),this.neighbors=this.owner.neighbors=a.neighbors||this.owner.neighbors||{}},events:{"add-neighbors":function(a){var b=0,c=null;for(c in a)a.hasOwnProperty(c)&&(this.neighbors[c]=a[c]);for(b=0;b<this.contains.length;b++)this.contains[b].triggerEvent("set-directions")},"remove-neighbor":function(a){var b=null,c=a;"string"!=typeof c&&(c=c.nodeId);for(b in this.neighbors)if(this.neighbors.hasOwnProperty(b))if("string"==typeof this.neighbors[b]){if(this.neighbors[b]===c){delete this.neighbors[b];break}}else if(this.neighbors[b].nodeId===c){delete this.neighbors[b];break}}},methods:{destroy:function(){this.contains.recycle(),this.edgesContain.recycle()}},publicMethods:{getNode:function(a){var b=null;if(!this.map&&this.owner.map&&(this.map=this.owner.map),this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(b.length&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},addToNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},removeFromNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.greenSplice(b);return!1},addToEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return!1;return this.edgesContain.push(a),a},removeFromEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return this.edgesContain.greenSplice(b);return!1}}})}(),function(){"use strict";var a=include("platypus.Vector"),b=function(a,b){a.id?"string"==typeof a.id?this.id=a.id:Array.isArray(a.id)?this.id=a.id.join("|"):this.id=String(Math.random()):this.id=String(Math.random()),this.isNode=!0,this.map=b,this.contains=Array.setUp(),this.type=a.type||"",this.x=a.x||0,this.y=a.y||0,this.z=a.z||0,this.neighbors=a.neighbors||{}},c=b.prototype;return c.getNode=function(a){var b=null;if(this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(Array.isArray(b)&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},c.add=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},c.remove=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.greenSplice(b);return!1},c.recycle=function(){this.contains.recycle(),this.recycle()},platypus.setUpRecycle(b,"Node"),platypus.createComponentClass({id:"NodeMap",publicProperties:{map:[]},constructor:function(a){var c=0,d=this.map;for(this.map=Array.setUp(),this.nodes={},this.residentsAwaitingNode=Array.setUp(),c=0;c<d.length;c++)this.addNode(b.setUp(d[c],this))},events:{"add-node":function(a){var c=0,d=null,e=null;for(a.isNode?(e=a,a.map=this):e=b.setUp(a,this),this.addNode(e),c=this.residentsAwaitingNode.length-1;c>=0;c--)d=this.residentsAwaitingNode[c],e.id===d.nodeId&&(this.residentsAwaitingNode.greenSplice(c),d.node=this.getNode(d.nodeId),d.triggerEvent("on-node",d.node))},"child-entity-added":function(a){a.isNode?this.owner.triggerEvent("add-node",a):a.nodeId&&(a.node=this.getNode(a.nodeId),a.node?a.triggerEvent("on-node",a.node):this.residentsAwaitingNode.push(a))}},methods:{addNode:function(a){this.map.push(a),this.nodes[a.id]=a},destroy:function(){var a=0;for(a=0;a<this.map.length;a++)this.map[a]instanceof platypus.Entity||this.map[a].recycle();this.map.recycle(),this.residentsAwaitingNode.recycle()}},publicMethods:{getNode:function(){var a=0,b="",c="",d=arguments;if(1===d.length){if(d[0].isNode)return d[0];Array.isArray(d[0])&&(d=d[0])}for(a=0;a<d.length;a++)b+=c+d[a],c="|";return this.nodes[b]||null},getClosestNode:function(b,c,d){var e=0,f=0,g=a.setUp(b),h=a.setUp(),i=0,j=c||this.map,k=null,l=1/0;for(e=0;e<j.length;e++)if(i=h.setVector(g).subtractVector(j[e].position).magnitude(),l>i){if(d&&(f=d.indexOf(j[e]),f>=0))break;l=i,k=j[e]}return g.recycle(),h.recycle(),k}}})}(),function(){"use strict";var a=function(a,b,c){return function(d){var e=b.getNode(a);return this.isPassable(e)?(this.destinationNodes.length=0,this.destinationNodes.push(e),this.node?this.onEdge(e):this.distance=0,this.progress=0,this.setState("going-"+c),!0):!1}},b=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z;return Math.sqrt(c*c+d*d+e*e)},c=function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=0;return a.rotation&&b.rotation?(e=(a.rotation+180)%360,f=(b.rotation+180)%360,(e*(1-d)+f*d+180)%360):c?(g=Math.acos(e/c),0>f&&(g=2*Math.PI-g),180*g/Math.PI):g},d=function(a,b,c,d){return b*(1-a)+c*a+d},e=function(a,b){var c=0,d=0,e=!1;if(null===b)return!0;for(c=0;c<a.length;c++){for(d=0;d<b.length;d++)a[c].type===b[d]&&(e=!0);if(!e)return!1;e=!1}return!0};return platypus.createComponentClass({id:"NodeResident",publicProperties:{speed:0},constructor:function(a){var c=a.offset||this.owner.nodeOffset||{};this.nodeId=this.owner.nodeId=a.nodeId||this.owner.nodeId,this.neighbors={},this.friendlyNodes=a.nodes||null,this.friendlyEntities=a.shares||null,this.snapToNodes=a.snapToNodes||!1,this.updateOrientation=a.updateOrientation||!1,this.distance=0,this.buffer=a.buffer||0,this.progress=0,this.offset={x:c.x||0,y:c.y||0,z:c.z||0},this.destinationNodes=Array.setUp(),this.algorithm=a.algorithm||b,this.state=this.owner.state,this.state.set("moving",!1),this.state.set("on-node",!1),this.currentState=""},events:{"set-algorithm":function(a){this.algorithm=a||b},"handle-logic":function(a){var b=0,e=0,f=0,g=null,h=null;if(this.owner.node||(h=Array.setUp(this.owner.x,this.owner.y),this.owner.triggerEvent("on-node",this.owner.parent.getClosestNode(h)),h.recycle(),this.owner.triggerEvent("in-location",this.owner)),this.followEntity?(g=this.followEntity.node||this.followEntity,g&&g.isNode&&g!==this.node?(this.lag=0,this.state.set("moving",this.gotoNode()),this.followDistance&&(f=this.lag)):this.followEntity=null):f=this.speed*a.delta,
this.blocked&&(this.blocked=!1,this.goingToNode&&this.owner.triggerEvent("goto-closest-node",this.goingToNode)),this.destinationNodes.length){if(this.state.set("moving",0!==this.speed),this.node)this.onEdge(this.destinationNodes[0]);else if(!this.lastNode&&(this.owner.triggerEvent("on-node",this.destinationNodes[0]),this.destinationNodes.greenSplice(0),!this.destinationNodes.length))return void this.state.set("moving",!1);if(this.snapToNodes){for(b=0;b<this.destinationNodes.length;b++)this.owner.triggerEvent("on-node",this.destinationNodes[b]);this.destinationNodes.length=0}else for(;this.destinationNodes.length&&f;)this.progress+f>=this.distance?(g=this.destinationNodes[0],f-=this.distance-this.progress,this.progress=0,this.destinationNodes.greenSplice(0),this.owner.triggerEvent("on-node",g),this.destinationNodes.length&&f&&this.onEdge(this.destinationNodes[0])):(this.progress+=f,e=this.progress/this.distance,this.owner.x=d(e,this.lastNode.x,this.destinationNodes[0].x,this.offset.x),this.owner.y=d(e,this.lastNode.y,this.destinationNodes[0].y,this.offset.y),this.owner.z=d(e,this.lastNode.z,this.destinationNodes[0].z,this.offset.z),this.updateOrientation&&(this.owner.rotation=c(this.lastNode,this.destinationNodes[0],this.distance,e)),f=0)}else this.state.set("moving",!1)},"on-node":function(a){var b=0,c=null;for(this.owner.node=this.node=a,this.node.removeFromEdge(this.owner),this.lastNode&&this.lastNode.removeFromEdge(this.owner),this.node.addToNode(this.owner),this.setState("on-node"),this.owner.x=this.node.x+this.offset.x,this.owner.y=this.node.y+this.offset.y,this.owner.z=this.node.z+this.offset.z,this.updateOrientation&&this.node.rotation&&(this.owner.rotation=this.node.rotation),this.owner.triggerEvent("set-directions"),this.friendlyNodes&&this.friendlyNodes[a.type]&&this.owner.trigger(this.friendlyNodes[a.type],a),c=a.contains,b=0;b<c.length;b++)this.owner!==c[b]&&(c[b].triggerEvent("with-"+this.owner.type,this.owner),this.owner.triggerEvent("with-"+c[b].type,c[b]))},"leave-node":function(){this.node&&(this.node.removeFromNode(this.owner),this.owner.triggerEvent("left-node",this.node),this.owner.triggerEvent("remove-directions")),this.lastNode=this.node,this.node=null},"goto-node":function(a){this.gotoNode(a)},follow:function(a){a.entity?(this.followDistance=a.distance,this.followEntity=a.entity):(this.followDistance=0,this.followEntity=a)},"goto-closest-node":function(){var a=function(a,b){var c=0;for(c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},b=function(a,b){return a.type===b},c=function(a,b){return a.type===b.type};return function(d){var e=null,f=20,g=this.node||this.lastNode,h=null,i=d.steps||0,j=null;this.goingToNode=d,h="string"==typeof d?b:"string"==typeof d.type?c:a,g&&d&&!h(g,d)&&(j=Array.setUp(),e=this.traverseNode({depth:f,origin:g,position:g,test:h,destination:d,nodes:j,shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),e.distance-=this.progress,e.found?this.followEntity&&this.followDistance?e.distance+(this.followEntity.progress||0)>this.followDistance?(this.lag=e.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(e,i)):this.lag=0:this.setPath(e,i):e.blocked&&(this.blocked=!0),j.recycle())}}(),"set-directions":function(){var b="",c=0,d=null,e=this.node,f=null;this.owner.triggerEvent("remove-directions");for(b in e.neighbors)if(e.neighbors.hasOwnProperty(b)&&(this.neighbors[b]=a(e.neighbors[b],e.map,b),this.addEventListener(b,this.neighbors[b]),f=e.map.getNode(e.neighbors[b])))for(d=f.contains,c=0;c<d.length;c++)d[c].triggerEvent("next-to-"+this.owner.type,this.owner),this.owner.triggerEvent("next-to-"+d[c].type,d[c])},"remove-directions":function(){var a="";for(a in this.neighbors)this.neighbors.hasOwnProperty(a)&&(this.removeEventListener(a,this.neighbors[a]),delete this.neighbors[a])}},methods:{gotoNode:function(){var a=function(a,b){return a===b};return function(b){var c=null,d=20,e=this.node||this.lastNode,f=null,g=!1;return!b&&this.followEntity&&(b=this.followEntity.node||this.followEntity.lastNode||this.followEntity),e&&b&&this.node!==b&&(f=Array.setUp(),c=this.traverseNode({depth:d,origin:e,position:e,test:a,destination:b,nodes:f,shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),c.distance-=this.progress,c.found?this.followEntity&&this.followDistance?c.distance+(this.followEntity.progress||0)>this.followDistance?(this.lag=c.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(c),g=!0):this.lag=0:(this.setPath(c),g=!0):c.blocked&&(this.blocked=!0),f.recycle()),g}}(),isPassable:function(a){return!(!a||this.node===a||this.friendlyNodes&&"undefined"==typeof this.friendlyNodes[a.type]||a.contains.length&&!e(a.contains,this.friendlyEntities))},traverseNode:function(a){var c=1,d="",e=a.position.map,f=null,g=null,h=null,i=null,j=a.algorithm||b,k={shortestPath:1/0,found:!1,blocked:!1},l=!0,m=!1;if(0===a.depth||a.distance>a.shortestPath)return a;if(a.test(a.position,a.destination))return a.found=!0,a.shortestPath=a.distance,a;for(h=a.nodes,c=1;c<h.length-1;c++)if(h[c]===a.position)return a;f=a.position.neighbors;for(d in f)f.hasOwnProperty(d)&&(g=e.getNode(f[d]),m=!0,this.isPassable(g)&&(h=a.nodes.greenSlice(),h.push(g),i=this.traverseNode({depth:a.depth-1,origin:a.origin,position:g,destination:a.destination,test:a.test,algorithm:j,nodes:h,shortestPath:a.shortestPath,distance:a.distance+j(a.position,g),gateway:a.gateway||d,found:!1,blocked:!1}),h.recycle(),i.found&&k.shortestPath>i.shortestPath&&(k=i),l=!1));return k.blocked=m&&l,k},setPath:function(a,b){a.nodes[0]===this.node&&a.nodes.greenSplice(0),this.destinationNodes.recycle(),this.destinationNodes=a.nodes.greenSlice(),b&&(this.destinationNodes.length=Math.min(b,this.destinationNodes.length))},setState:function(a){"on-node"===a?this.state.set("on-node",!0):(this.state.set("on-node",!1),this.currentState&&this.state.set(this.currentState,!1),this.currentState=a,this.state.set(a,!0))},onEdge:function(a){this.distance=b(this.node,a),this.updateOrientation&&(this.owner.rotation=c(this.node,a,this.distance,this.progress/this.distance)),this.node.addToEdge(this.owner),a.addToEdge(this.owner),this.owner.triggerEvent("leave-node")},destroy:function(){this.destinationNodes.recycle(),this.state=null}}})}(),function(){"use strict";var a=include("platypus.Data"),b=include("platypus.Vector"),c=b.setUp(0,0,1),d=b.setUp(1,0,0),e={horizontal:[[-1,0,0],[0,1,0],[0,0,-1]],vertical:[[1,0,0],[0,-1,0],[0,0,-1]],diagonal:[[0,1,0],[1,0,0],[0,0,-1]],"diagonal-inverse":[[0,-1,0],[-1,0,0],[0,0,-1]],"rotate-90":[[0,-1,0],[1,0,0],[0,0,1]],"rotate-180":[[-1,0,0],[0,-1,0],[0,0,1]],"rotate-270":[[0,1,0],[-1,0,0],[0,0,1]]},f=function(){var a=function(a,b,c){var d=0,e=0;for(d=0;d<a.length;d++)e+=a[d]*c[d][b];return e};return function(b,c,d){var e=0,f=0,g=Array.setUp();for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)g.push(a(b[e],f,c));for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)d[e][f]=g.greenSplice(0);g.recycle()}}(),g=function(a){var b=0,c=0;for(b=0;3>b;b++)for(c=0;3>c;c++)b===c?a[b][c]=1:a[b][c]=0;return a};return platypus.createComponentClass({id:"Orientation",publicProperties:{scaleX:1,scaleY:1,rotation:0,orientation:0,orientationMatrix:null},constructor:function(){var e=function(a,e){var h=b.setUp(1,0,0),i=a.owner,j=Array.setUp(Array.setUp(1,0,0),Array.setUp(0,1,0),Array.setUp(0,0,1));return Object.defineProperty(i,"orientationMatrix",{get:function(){return f(a.matrixTween,a.matrix,g(j)),j},enumerable:!0}),delete i.orientation,Object.defineProperty(i,"orientation",{get:function(){return h.signedAngleTo(d,c)},set:function(a){h.setVector(d).rotate(a)},enumerable:!0}),e&&("number"!=typeof e?h.set(e):h.rotate(e)),h};return function(b){this.loadedOrientationMatrix=this.orientationMatrix,this.matrix=Array.setUp(Array.setUp(1,0,0),Array.setUp(0,1,0),Array.setUp(0,0,1)),this.matrixTween=Array.setUp(Array.setUp(1,0,0),Array.setUp(0,1,0),Array.setUp(0,0,1)),this.relocationMessage=a.setUp("position",null),this.vectors=Array.setUp(),this.inverses=Array.setUp(),this.tweens=Array.setUp(),this.orientationVector=e(this,this.orientation),this.owner.triggerEvent("orient-vector",this.orientationVector),this.owner.state.set("reorienting",!1)}}(),events:{load:function(){this.loadedOrientationMatrix?this.transform(this.loadedOrientationMatrix):(this.scaleX&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.transform("horizontal")),this.scaleY&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.transform("vertical")),this.rotation&&((this.rotation+270)%360===0?(this.rotation=0,this.transform("rotate-90")):(this.rotation+180)%360===0?(this.rotation=0,this.transform("rotate-180")):(this.rotation+90)%360===0&&(this.rotation=0,this.transform("rotate-270")))),delete this.loadedOrientationMatrix},"handle-logic":function(a){var b=this.tweens.length,c=a.delta,d=this.owner.state,e=null,f=null,h=this.relocationMessage;if(b){for(e=Array.setUp(),d.set("reorienting",!0),g(this.matrixTween);b--;)this.updateTween(this.tweens[b],c)&&e.push(this.tweens.greenSplice(b));for(b=this.vectors.length;b--;)this.updateVector(this.vectors[b],this.inverses[b]);for(b=e.length;b--;)f=e[b],this.transform(f.endMatrix),f.anchor&&(f.offset.multiply(f.endMatrix).addVector(f.anchor),h.position=f.offset,this.owner.triggerEvent("relocate-entity",h),f.recycleOffset&&f.offset.recycle()),f.onFinished(f.endMatrix),f.recycle();e.recycle()}else d.get("reorienting")&&(g(this.matrixTween),d.set("reorienting",!1))},"complete-tweens":function(){var a=0;for(a=0;a<this.tweens.length;a++)this.tweens[a].time=this.tweens[a].endTime},"drop-tweens":function(){var a=0;for(a=this.tweens.length;a--;)this.tweens[a].offset&&this.tweens[a].offset.recycle();for(this.tweens.length=0,a=this.vectors.length;a--;)this.updateVector(this.vectors[a],this.inverses[a])},"orient-vector":function(a){var c=a.aligned||!1;a.vector&&(a=a.vector),-1===this.vectors.indexOf(a)&&(c||a.multiply(this.matrix),this.vectors.push(a),this.inverses.push(b.setUp()))},"remove-vector":function(a){var b=this.vectors.indexOf(a);b>=0&&(this.vectors.greenSplice(b),this.inverses.greenSplice(b).recycle())},"tween-transform":function(){var b=function(){},c=function(){return!0},d=function(a){return a};return function(f){var g=null,h=f.angle||0,i=f.matrix,j=a.setUp("transform",f.transform,"anchor",f.anchor,"endTime",f.time||0,"time",0,"tween",f.tween||d,"onFinished",f.onFinished||b,"beforeTick",f.beforeTick||c,"afterTick",f.onTick||f.afterTick||b);if(i||(i=e[f.transform]),j.endMatrix=i,!h&&0===f.transform.indexOf("rotate"))switch(f.transform){case"rotate-90":h=Math.PI/2;break;case"rotate-180":h=Math.PI;break;case"rotate-270":h=-Math.PI/2;break;default:g=f.transform.greenSplit("-"),h=g[1]/180*Math.PI,g.recycle()}j.angle=h,f.anchor&&(j.offset=f.offset,j.offset||(j.offset=this.owner.position.copy().subtractVector(f.anchor,2),j.recycleOffset=!0)),this.tweens.push(j)}}(),transform:function(a){this.transform(a)},"prepend-transform":function(a){this.transform(a)},"append-transform":function(a){this.transform(a,!0)},"replace-transform":function(a){this.replace(a)}},methods:{transform:function(a,b){Array.isArray(a)?this.multiply(a,b):"string"==typeof a&&e[a]&&this.multiply(e[a],b)},multiply:function(){return function(a,b){var c=0;for(b?f(this.matrix,a,this.matrix):f(a,this.matrix,this.matrix),c=0;c<this.vectors.length;c++)this.vectors[c].multiply(a),this.inverses[c].multiply(a);this.owner.triggerEvent("orientation-updated",a)}}(),replace:function(){var a=function(a,b,c,d){return a*d-b*c},b=function(a){var b=0,c=0;for(b=0;3>b;b++)c+=a[b][0]*a[(b+1)%3][1]*a[(b+2)%3][2],c-=a[b][2]*a[(b+1)%3][1]*a[(b+2)%3][0];return c},c=function(c){var d=Array.setUp(Array.setUp(),Array.setUp(),Array.setUp()),e=1/b(c);return d[0].push(a(c[1][1],c[1][2],c[2][1],c[2][2])*e),d[0].push(a(c[0][2],c[0][1],c[2][2],c[2][1])*e),d[0].push(a(c[0][1],c[0][2],c[1][1],c[1][2])*e),d[1].push(a(c[1][2],c[1][0],c[2][2],c[2][0])*e),d[1].push(a(c[0][0],c[0][2],c[2][0],c[2][2])*e),d[1].push(a(c[0][2],c[0][0],c[1][2],c[1][0])*e),d[2].push(a(c[1][0],c[1][1],c[2][0],c[2][1])*e),d[2].push(a(c[0][1],c[0][0],c[2][1],c[2][0])*e),d[2].push(a(c[0][0],c[0][1],c[1][0],c[1][1])*e),d};return function(a){var b=c(this.matrix);this.multiply(b),this.multiply(a),b.recycle(2)}}(),updateTween:function(){var a=function(a,b,c){return a*(1-c)+b*c};return function(c,d){var e=0,g=1,h=0,i=0,j=1,k=1,l=0,m=c.endMatrix,n=null,o=null,p=null;return c.beforeTick(c.time)&&(c.time+=d),c.time>=c.endTime?!0:(e=c.tween(c.time/c.endTime),c.angle?(l=e*c.angle,g=j=Math.cos(l),h=Math.sin(l),i=-h):(g=a(g,m[0][0],e),h=a(h,m[1][0],e),i=a(i,m[0][1],e),j=a(j,m[1][1],e),k=a(k,m[2][2],e)),n=Array.setUp(Array.setUp(g,i,0),Array.setUp(h,j,0),Array.setUp(0,0,k)),f(n,this.matrixTween,this.matrixTween),c.anchor&&(o=b.setUp(c.offset).multiply(1-e),p=b.setUp(c.offset).multiply(e),this.owner.triggerEvent("relocate-entity",{position:o.add(p).multiply(n).addVector(c.anchor)}),o.recycle(),p.recycle()),c.afterTick(e,n),void n.recycle(2))}}(),updateVector:function(a,b){b.setVector(a.add(b)),a.multiply(this.matrixTween),b.subtractVector(a)},destroy:function(){this.vectors.recycle(),this.inverses.recycle(),this.tweens.recycle(),this.orientationVector.recycle(),this.orientationMatrix.recycle(2),this.matrix.recycle(2),this.matrixTween.recycle(2),this.relocationMessage.recycle()}}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a[Math.floor(Math.random()*a.length)],b,c)}};return platypus.createComponentClass({id:"RandomEvents",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a=function(a,b,c,d){var e=0;for(e=0;e<a.length;e++)a[e].trigger(b,c,d)},b=function(b){return function(c,d){a(this.owner.familyLinks,b,c,d)}};return platypus.createComponentClass({id:"RelayFamily",properties:{events:null},publicProperties:{},constructor:function(a){var c="";if(this.events)for(c in this.events)this.events.hasOwnProperty(c)&&this.addEventListener(c,b(this.events[c]));this.owner.familyLinks=Array.setUp(this.owner)},events:{"link-family":function(b){var c=0,d=this.owner.familyLinks,e=Array.setUp().union(b).union(d);for(c=0;c<e.length;c++)e[c].familyLinks=e;a(b,"family-members-added",d),a(d,"family-members-added",b),d.recycle()},"entity-created":function(a){a.triggerEvent("link-family",this.owner.familyLinks)||(a.addComponent(new platypus.components.RelayFamily(a,{})),a.triggerEvent("link-family",this.owner.familyLinks))}},methods:{destroy:function(){var b=this.owner.familyLinks.indexOf(this.owner);b>=0&&this.owner.familyLinks.greenSplice(b),a(this.owner.familyLinks,"family-member-removed",this.owner),this.events=null}}})}(),function(){"use strict";var a=function(a){return function(b,c){platypus.game.currentScene.triggerOnChildren(a,b,c)}};return platypus.createComponentClass({id:"RelayGame",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a=function(a){return function(b,c){var d=0;for(d=0;d<this.links.length;d++)this.links[d].trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayLinker",properties:{linkId:"linked",events:null},publicProperties:{},constructor:function(b){var c=0,d="";if(this.events)for(d in this.events)this.events.hasOwnProperty(d)&&this.addEventListener(d,a(this.events[d]));if(this.owner.linkId||(this.owner.linkId=this.linkId),this.addEventListener("to-"+this.linkId+"-entities",a("from-"+this.linkId+"-entities")),this.addEventListener("from-"+this.linkId+"-entities",function(a){this.owner.trigger(a.message,a.value,a.debug)}.bind(this)),this.links=Array.setUp(),this.owner.linkEntities)for(c=0;c<this.owner.linkEntities.length;c++)this.links.push(this.owner.linkEntities[c]);this.message={message:"",value:null},this.linkMessage={entity:this.owner,linkId:this.linkId,reciprocate:!1},this.owner.parent&&this.resolveAdoption()},events:{adopted:function(a){this.resolveAdoption(a)},"link-entity":function(a){a.linkId===this.linkId&&a.entity!==this.owner&&-1===this.links.indexOf(a.entity)&&(this.links.push(a.entity),a.reciprocate&&(this.linkMessage.reciprocate=!1,a.entity.triggerEvent("link-entity",this.linkMessage)))},"unlink-entity":function(a){var b=this.links.indexOf(a.entity);b>=0&&this.links.greenSplice(b)}},methods:{resolveAdoption:function(a){for(var b=this.owner.parent;b.parent;)b=b.parent;this.linkMessage.reciprocate=!0,b.triggerOnChildren("link-entity",this.linkMessage)},destroy:function(){var a=0;for(a=0;a<this.links.length;a++)this.links[a].triggerEvent("unlink-entity",this.linkMessage);this.links.recycle(),this.links=null,this.events=null}}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.parent&&this.owner.parent.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayParent",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelaySelf",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a={aabb:16746751,render:255,collision:16711935,group:65280},b=function(b,c,d,e,f,g,h){var i=null;switch(b){case"rectangle":i=(new PIXI.Graphics).beginFill(a[c],.1).drawRect(d,e,f,g);break;case"circle":i=(new PIXI.Graphics).beginFill(a[c],.1).drawCircle(0,0,f)}return i.z=h,i};return platypus.createComponentClass({id:"RenderDebug",constructor:function(a){this.regX=a.regX||0,this.regY=a.regY||0,this.parentContainer=null,this.shapes=Array.setUp(),this.isOutdated=!0},events:{"handle-render-load":function(a){platypus.game.settings.debug?!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container):this.owner.removeComponent(this)},"handle-render":function(a){var b=0,c=null;if(!this.parentContainer){if(!platypus.game.settings.debug)return void this.owner.removeComponent(this);if(!a.container)return console.warn('No Container, removing render debug component from "'+this.owner.type+'".'),void this.owner.removeComponent(this);this.parentContainer=a.container}for(this.isOutdated&&(this.updateSprites(),this.isOutdated=!1),b=0;b<this.shapes.length;b++)this.shapes[b].x=this.owner.x,this.shapes[b].y=this.owner.y;this.owner.getCollisionGroupAABB&&(c=this.owner.getCollisionGroupAABB(),this.groupShape||(this.groupShape=(new PIXI.Graphics).beginFill("rgba(255,255,0,0.2)").drawRect(-.5,-.5,1,1),this.groupShape.z=(this.owner.z||0)+1e4,this.parentContainer.addChild(this.groupShape)),this.groupShape.scaleX=c.width,this.groupShape.scaleY=c.height,this.groupShape.x=c.x,this.groupShape.y=c.y)},"orientation-updated":function(){this.isOutdated=!0}},methods:{updateSprites:function(){var a=(this.owner.z||0)+1e4,c=0,d=0,e=this.owner.width=this.owner.width||300,f=this.owner.height=this.owner.height||100,g=null,h=null,i=null;for(c=0;c<this.shapes.length;c++)this.parentContainer.removeChild(this.shapes[c]);if(this.shapes.length=0,this.owner.getAABB)for(d=0;d<this.owner.collisionTypes.length;d++)for(h=this.owner.getAABB(this.owner.collisionTypes[d]),e=this.initialWidth=h.width,f=this.initialHeight=h.height,g=this.owner.getShapes(this.owner.collisionTypes[d]),i=b("rectangle","aabb",h.left-this.owner.x,h.top-this.owner.y,e,f,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i),c=0;c<g.length;c++)i=b(g[c].type,"collision",g[c].offsetX-g[c].width/2,g[c].offsetY-g[c].height/2,g[c].radius||g[c].width,g[c].height,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i);else i=b("rectangle","render",-e/2,-f/2,e,f,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i)},addInput:function(){var a=null,b=function(b){return function(c){return a!==b.owner&&(a=b.owner,console.log('Entity "'+a.type+'":',a)),!1}};return function(a){a.interactive=!0,a.addListener("rightdown",b(this))}}(),destroy:function(){var a=0;for(a=0;a<this.shapes.length;a++)this.parentContainer.removeChild(this.shapes[a]);this.shapes.recycle(),this.parentContainer=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderDestroyMe",properties:{animationId:"",animationIds:null},constructor:function(a){this.animationId?this.animationIds=Array.setUp(a.animationId):this.animationIds&&(this.animationIds=this.animationIds.greenSlice())},events:{"animation-ended":function(a){(!this.animationIds||this.animationIds.indexOf(a)>=0)&&this.owner.parent.removeEntity(this.owner)}},methods:{destroy:function(){this.animationIds&&(this.animationIds.recycle(),delete this.animationIds)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderProgress",properties:{backgroundColor:0,color:16777215,rotate:!1,mirror:!1,flip:!1,width:100,height:20,regX:0,regY:0},publicProperties:{x:0,y:0,z:0},constructor:function(a){var b=new PIXI.Graphics,c=new PIXI.Graphics,d=new PIXI.Container;this.parentContainer=null,this.background=b,this.progress=c,this.container=d,"string"==typeof this.backgroundColor&&(this.backgroundColor=+this.backgroundColor.replace("#","0x")),"string"==typeof this.color&&(this.color=+this.color.replace("#","0x")),b.f(this.backgroundColor).r(-this.regX,-this.regY,this.width,this.height),c.f(this.color).r(-this.regX,-this.regY,this.width,this.height),c.scale=new PIXI.Point(1e-4,1),d.addChild(b),d.addChild(c)},events:{"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container))},"handle-render":function(a){this.container&&(this.parentContainer||(a&&a.container?(this.parentContainer=a.container,this.parentContainer.addChild(this.container)):(console.warn('No PIXI Stage, removing ProgressRender component from "'+this.owner.type+'".'),this.owner.removeComponent(this))),this.container.x=this.x,this.container.y=this.y,this.container.z=this.z)},"update-progress":function(a){isNaN(a)?"number"==typeof a.fraction?this.progress.scale.x=a.fraction:"number"==typeof a.total&&"number"==typeof a.progress&&(this.progress.scale.x=a.progress/a.total):this.progress.scale.x=a}},methods:{destroy:function(){this.parentContainer&&(this.parentContainer.removeChild(this.container),this.parentContainer=null),this.container=null}}})}(),function(){"use strict";var a=include("platypus.Data"),b=include("platypus.StateMap"),c=new PIXI.Matrix,d=function(a){return function(b){this.animationFinished||this.lastState>=-1?(this.currentAnimation=a,this.lastState=-1,this.animationFinished=!1,this.sprite.gotoAndPlay(a)):(this.waitingAnimation=a,this.waitingState=-1)}},e=function(a){return a},f=function(a,b,c){return c.includes(b)?a:!1},g=function(a,c){return"default"===a?e.bind(null,c):f.bind(null,c,b.setUp(a))},h=function(){var a=function(a,b){var c=0,d=b.indexOf("("),e=b.substring(0,d),f=b.substring(d+1,b.indexOf(")"));if(f.length){for(f=f.greenSplit(","),c=f.length;c--;)f[c]=+f[c];a[e].apply(a,f),f.recycle()}else a[e]()};return function(b,c){var d=0,e=c.greenSplit(".");for(d=0;d<e.length;d++)a(b,e[d]);e.recycle()}}();return platypus.createComponentClass({id:"RenderSprite",properties:{spriteSheet:null,animationMap:null,mask:null,acceptInput:null,pinLocations:null,pinTo:null,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1},publicProperties:{buttonMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},constructor:function(){var a=function(a,b){var c=null,d="";if(a)return a;if(Array.isArray(b.frames)&&1===b.frames.length)return null;c={};for(d in b.animations)b.animations.hasOwnProperty(d)&&(c[d]=d);return c},b=function(a,b){var c="",e="";a.followThroughs={},a.checkStates=Array.setUp();for(c in b)b.hasOwnProperty(c)&&(e=b[c],"!"===e[e.length-1]?(e=e.substring(0,e.length-1),a.followThroughs[e]=!0):a.followThroughs[e]=!1,a.eventBased&&a.addEventListener(c,d(e)),a.stateBased&&a.checkStates.push(g(c,e)))};return function(c){var d=null,e=null;this.spriteSheet?d="string"==typeof this.spriteSheet?platypus.game.settings.spriteSheets[this.spriteSheet]:this.spriteSheet:(d={},console.warn(this.owner.type+" - RenderSprite: Sprite Sheet not defined.")),e=a(this.animationMap,d),this.parentContainer=null,this.stateBased=e&&this.stateBased,this.eventBased=e&&this.eventBased,this.hover=!1,this.click=!1,this.wasVisible=this.visible,this.lastX=this.owner.x,this.lastY=this.owner.y,this.camera=new platypus.AABB,(this.eventBased||this.stateBased)&&(b(this,e),this.currentAnimation=e["default"]||""),this.sprite=new platypus.PIXIAnimation(d,this.currentAnimation||0),this.sprite.onComplete=function(a){this.owner.triggerEvent("animation-ended",a),this.waitingAnimation?(this.currentAnimation=this.waitingAnimation,this.waitingAnimation=!1,this.lastState=this.waitingState,this.animationFinished=!1,this.sprite.gotoAndPlay(this.currentAnimation)):this.animationFinished=!0}.bind(this),this.affine=new PIXI.Matrix,this.pinLocations?(this.container=new PIXI.Container,this.container.transformMatrix=new PIXI.Matrix,this.container.addChild(this.sprite),this.sprite.z=0,this.addPins(this.pinLocations,d.frames),this.sprite.transformMatrix=new PIXI.Matrix):(this.container=this.sprite,this.sprite.transformMatrix=new PIXI.Matrix),this.pinTo&&this.owner.triggerEvent("pin-me",this.pinTo),this.acceptInput&&(this.hover=this.acceptInput.hover||!1,this.click=this.acceptInput.click||!1,this.acceptInput.hitArea&&(this.container.hitArea=this.setHitArea(this.acceptInput.hitArea))),this.isOnCamera=!0,this.state=this.owner.state,this.stateChange=!0,this.lastState=-1,this.waitingAnimation=!1,this.waitingState=0,this.playWaiting=!1,this.animationFinished=!1,this.cache&&(this.updateSprite(!1),this.owner.cacheRender=this.container)}}(),events:{cache:function(){this.updateSprite(!1),this.owner.cacheRender=this.container,this.cache=!0,this.owner.parent&&this.owner.parent.triggerEventOnChildren?this.owner.parent.triggerEventOnChildren("cache-sprite",this.owner):console.warn("Unable to cache sprite for "+this.owner.type)},"camera-update":function(a){this.camera.set(a.viewport),this.sprite&&this.checkCameraBounds()},"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&(this.addStage(a.container),this.updateSprite(!0))},"handle-render":function(a){if(this.container){if(!this.parentContainer){if(this.pinTo)return;if(!this.addStage(a.container))return console.warn('No PIXI Stage, removing render component from "'+this.owner.type+'".'),void this.owner.removeComponent(this)}this.updateSprite(!0)}},"state-changed":function(){this.stateChange=!0},"hide-sprite":function(){this.visible=!1},"show-sprite":function(){this.visible=!0},"pin-me":function(a){this.pins&&this.pins[a]&&this.owner.triggerEvent("attach-pin",this.pins[a])},"attach-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container),this.addInputs(),this.pinnedTo=a,this.updateSprite(!0))},"remove-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer.removeChild(this.container),this.parentContainer=null,this.pinnedTo=null)},"dispatch-event":function(a){this.sprite.dispatchEvent(this.sprite,a.event,a.data)},"input-on":function(){this.removeInputListeners||this.addInputs()},"input-off":function(){this.removeInputListeners&&this.removeInputListeners()},"set-mask":function(a){this.setMask(a)},"stop-sprite":function(){this.sprite.stop()},"play-sprite":function(){this.sprite.play()}},methods:{checkCameraBounds:function(){var a=null,b=this.sprite,d=null,e=null;for(d=b.transformMatrix.copy(c),e=this.pinnedTo;e;)d.prepend(e.container.transformMatrix),e=e.pinnedTo;b._currentBounds=null,a=b.getBounds(d),a&&(a.x+a.width<this.camera.left||a.x>this.camera.right||a.y+a.height<this.camera.top||a.y>this.camera.bottom)?this.isOnCamera=!1:this.isOnCamera=!0},addStage:function(a){return a&&!this.pinTo?(this.parentContainer=a,this.parentContainer.addChild(this.container),this.mask&&this.setMask(this.mask),this.addInputs(),a):null},updateSprite:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=0,e=0,f=null,g=0,h=!1,i=1,j=1,k=null,l=this.affine.copy(this.container.transformMatrix),m=PIXI.Matrix.TEMP_MATRIX;if(this.buttonMode!==this.container.buttonMode&&(this.container.buttonMode=this.buttonMode),this.pinnedTo?this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame]?(d=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].x,e=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].y,this.container.z!==this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z),g=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].angle||0,this.visible=!0):this.pinnedTo.defaultPin?(d=this.pinnedTo.defaultPin.x,e=this.pinnedTo.defaultPin.y,this.container.z!==this.pinnedTo.defaultPin.z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.defaultPin.z),g=this.pinnedTo.defaultPin.angle||0,this.visible=!0):this.visible=!1:(d=this.owner.x,e=this.owner.y,this.rotate&&(g=this.rotation),this.container.z!==this.owner.z+this.offsetZ&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.owner.z+this.offsetZ),this.ignoreOpacity||!this.owner.opacity&&0!==this.owner.opacity||(this.container.alpha=this.owner.opacity)),this.container.reorder&&(this.container.reorder=!1,this.container.children.sort(a)),(this.mirror||this.flip)&&(k=this.rotation%360,this.mirror&&k>90&&270>k&&(i=-1),this.flip&&180>k&&(j=-1)),this.stateBased&&this.stateChange){if(this.state.has("visible")&&(this.visible=this.state.get("visible")),this.checkStates)for(c=0;c<this.checkStates.length;c++)if(h=this.checkStates[c](this.state)){this.currentAnimation!==h?!this.followThroughs[this.currentAnimation]&&(!this.forcePlaythrough||this.animationFinished||this.lastState>=+c)?(this.currentAnimation=h,this.lastState=+c,this.animationFinished=!1,b?this.sprite.gotoAndPlay(h):this.sprite.gotoAndStop(h)):(this.waitingAnimation=h,this.waitingState=+c):this.waitingAnimation&&!this.followThroughs[this.currentAnimation]&&(this.waitingAnimation=!1);break}this.stateChange=!1}g&&l.rotate(g/180*Math.PI),this.pinnedTo?(m.tx=d,m.ty=e,m.a=i,m.b=0,m.c=0,m.d=j,l.prepend(m)):(this.owner.orientationMatrix&&(f=this.owner.orientationMatrix,m.tx=f[0][2],m.ty=f[1][2],m.a=f[0][0],m.b=f[1][0],m.c=f[0][1],m.d=f[1][1],l.prepend(m)),m.tx=d,m.ty=e,m.a=this.scaleX*i,m.b=this.owner.skewX,m.c=this.owner.skewY,m.d=this.scaleY*j,l.prepend(m)),this.sprite&&(!this.wasVisible&&this.visible||this.lastX!==this.owner.x||this.lastY!==this.owner.y)&&this.checkCameraBounds(),this.lastX=this.owner.x,this.lastY=this.owner.y,this.wasVisible=this.visible,this.container.visible=this.visible&&this.isOnCamera}}(),triggerInput:function(b,c){var d=null;this.container&&(d=a.setUp("event",b.data.originalEvent,"pixiEvent",b,"x",b.data.global.x/this.parentContainer.transformMatrix.a+this.camera.left,"y",b.data.global.y/this.parentContainer.transformMatrix.d+this.camera.top,"entity",this.owner),this.owner.trigger(c,d),d.recycle())},addInputs:function(){var a=!1,b=this.container,c=null,d=null,e=null,f=null,g=null,h=null;this.click&&(b.interactive=!0,c=function(b){a||(this.triggerInput(b,"mousedown"),b.target.mouseTarget=!0,a=!0)}.bind(this),f=function(b){a?(this.triggerInput(b,"pressmove"),b.target.mouseTarget=!0):this.triggerInput(b,"mousemove")}.bind(this),g=function(b){a&&(this.triggerInput(b,"pressup"),b.target.mouseTarget=!1,a=!1,b.target.removeDisplayObject&&b.target.removeDisplayObject())}.bind(this),h=function(a){this.triggerInput(a,"click")}.bind(this),b.addListener("mousedown",c),
b.addListener("touchstart",c),b.addListener("mouseup",g),b.addListener("touchend",g),b.addListener("mouseupoutside",g),b.addListener("touchendoutside",g),b.addListener("mousemove",f),b.addListener("touchmove",f),b.addListener("click",h),b.addListener("tap",h)),this.hover&&(b.interactive=!0,d=function(a){this.triggerInput(a,"mouseover")}.bind(this),e=function(a){this.triggerInput(a,"mouseout")}.bind(this),b.addListener("mouseover",d),b.addListener("mouseout",e)),this.removeInputListeners=function(){this.click&&(b.removeListener("mousedown",c),b.removeListener("touchstart",c),b.removeListener("mouseup",g),b.removeListener("touchend",g),b.removeListener("mouseupoutside",g),b.removeListener("touchendoutside",g),b.removeListener("mousemove",f),b.removeListener("touchmove",f),b.removeListener("click",h),b.removeListener("tap",h)),this.hover&&(b.removeListener("mouseover",d),b.removeListener("mouseout",e)),b.interactive=!1,this.removeInputListeners=null}},addPins:function(a,b){var c=0,d=0,e=null,f=b.regX||0,g=b.regY||0,h=Array.isArray(b);for(this.pinsToRemove=this.pinsToRemove||Array.setUp(),this.pins={},c=0;c<a.length;c++){if(this.pinsToRemove.push(a[c].pinId),h&&(f=b[0][5]||0,g=b[0][6]||0),this.pins[a[c].pinId]=e={pinId:a[c].pinId,sprite:this.sprite,container:this.container},"number"==typeof a[c].x&&"number"==typeof a[c].y&&(e.defaultPin={x:a[c].x-f,y:a[c].y-g,z:a[c].z||1e-8,angle:a[c].angle||0}),a[c].frames)for(e.frames=Array.setUp(),d=0;d<a[c].frames.length;d++)a[c].frames[d]?(h&&(f=b[d][5]||0,g=b[d][6]||0),"number"==typeof a[c].frames[d].x&&"number"==typeof a[c].frames[d].y?e.frames.push({x:a[c].frames[d].x-f,y:a[c].frames[d].y-g,z:a[c].frames[d].z||(e.defaultPin?e.defaultPin.z:1e-8),angle:a[c].frames[d].angle||(e.defaultPin?e.defaultPin.angle:0)}):e.defaultPin?"number"==typeof a[c].frames[d].x?e.frames.push({x:a[c].frames[d].x-f,y:e.defaultPin.y,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):"number"==typeof a[c].frames[d].y?e.frames.push({x:e.defaultPin.x,y:a[c].frames[d].y-g,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):e.frames.push(null):e.frames.push(null)):e.frames.push(null);this.owner.triggerEvent("attach-pin",e)}},removePins:function(){var a=0;if(this.pins&&this.pinsToRemove){for(a=0;a<this.pinsToRemove.length;a++)this.owner.triggerEvent("remove-pin",this.pins[this.pinsToRemove[a]].pinId),this.pins[this.pinsToRemove[a]].frames&&this.pins[this.pinsToRemove[a]].frames.recycle(),delete this.pins[this.pinsToRemove[a]];this.pinsToRemove.recycle()}},setMask:function(a){var b=null;return this.mask&&this.parentContainer&&this.parentContainer.removeChild(this.mask),a?(a instanceof PIXI.Graphics?b=a:(b=new PIXI.Graphics,b.beginFill(0,1),"string"==typeof a?h(b,a):a.radius?b.dc(a.x||0,a.y||0,a.radius):a.width&&a.height&&b.r(a.x||0,a.y||0,a.width,a.height),b.endFill()),b.isMask=!0,this.mask=this.container.mask=b,void(this.parentContainer&&this.parentContainer.addChild(this.mask))):void(this.mask=this.container.mask=null)},setHitArea:function(){var a={};return function(b){var c=null,d="";return d=JSON.stringify(b),c=a[d],c||(c=b.radius?new PIXI.Circle(b.x||0,b.y||0,b.radius):new PIXI.Rectangle(b.x||0,b.y||0,b.width||this.owner.width||0,b.height||this.owner.height||0),a[d]=c),c}}(),destroy:function(){this.removeInputListeners&&this.removeInputListeners(),this.parentContainer&&(this.container.mouseTarget?(this.container.visible=!1,this.container.removeDisplayObject=function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null}.bind(this)):(this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null)),this.removePins(),this.followThroughs=null,this.checkStates&&this.checkStates.recycle(),this.cache||this.sprite.destroy(),this.sprite=null,this.state=null}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d?platypus.game.settings.spriteSheets[d].images.greenSlice():d.images.greenSlice()}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.PIXIAnimation"),c=include("springroll.Application"),d=include("PIXI.CanvasRenderer"),e=include("PIXI.Container"),f=include("PIXI.Graphics"),g=include("PIXI.ParticleContainer"),h=include("PIXI.RenderTexture"),i=include("PIXI.Sprite"),j=function(){return null},k=a.setUp(),l=function(a,b){return a.z-b.z},m=function(a){for(var b=1;a>b;)b*=2;return b},n=function(a,b){var c=+a.substring(4),d=0;return 2147483648&c&&(b.scale.x=-1),1073741824&c&&(b.scale.y=-1),536870912&c&&(d=b.scale.x,b.scale.x=b.scale.y,b.scale.y=-d,b.rotation=Math.PI/2),268435455&c},o=function(a,b){this.id=b,this.instances=Array.setUp(a),this.index=0,a.template=this},p={getNext:j,destroy:j},q=o.prototype;return q.getNext=function(){var a=this.instances[this.index],b=null;return a||(b=this.instances[0],a=this.instances[this.index]=new i(b.texture),a.scale=b.scale,a.rotation=b.rotation,a.anchor=b.anchor),this.index+=1,a},q.clear=function(){this.index=0},q.destroy=function(){var a=0;for(a=0;a<this.instances.length;a++)this.instances[a].destroy();this.instances.recycle(),this.recycle()},platypus.setUpRecycle(o,"Template"),platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10,top:0,left:0},constructor:function(b){var f=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=c.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=a.setUp(),this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=a.setUp(),this.cachePixels=a.setUp(),this.spriteSheet&&"string"==typeof this.spriteSheet&&(this.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof d?new e:new g(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new e,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=Array.setUp(this.createMap(f)),this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(m(this.layerWidth),this.maximumBuffer),this.cacheHeight=Math.min(m(this.layerHeight),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1)},events:{"handle-render-load":function(a){var b=this.owner.z,c=this.renderer,d=null,f=this.mapContainer,g=null;a&&a.container&&(d=this.parentContainer=a.container,d&&!this.reorderedStage&&(d.reorder=!0,this.reorderedStage=!0),this.updateRegion(),this.tileCache?(this.render=this.renderCache,this.mapContainerWrapper=new e,this.mapContainerWrapper.addChild(f),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.cacheTexture=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSprite=g=new i(this.cacheTexture),g.scaleX=this.scaleX,g.scaleY=this.scaleY,g.z=b,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),d.addChild(g)):this.cacheAll||this.layerWidth<=2*this.cacheWidth&&this.layerHeight<=this.cacheHeight||this.layerWidth<=this.cacheWidth&&this.layerHeight<=2*this.cacheHeight?(this.cacheAll=!0,this.cacheGrid=this.createGrid(d,c),this.updateCache=!0):(this.cacheAll=!1,this.cacheTexture=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSprite=new i(this.cacheTexture),this.tilesSprite.scaleX=this.scaleX,this.tilesSprite.scaleY=this.scaleY,this.tilesSprite.z=b,this.cacheTexture.alternate=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new i(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,d.addChild(this.tilesSprite))):(this.render=j,f.scaleX=this.scaleX,f.scaleY=this.scaleY,f.x=this.left,f.y=this.top,f.z=b,d.addChild(f)))},"cache-sprite":function(a){this.cacheSprite(a)},"peer-entity-added":function(a){this.cacheSprite(a)},"add-tiles":function(a){var b=a.imageMap;b&&(this.imageMap.push(this.createMap(b)),this.updateCache=!0)},"camera-loaded":function(a){this.worldWidth=a.world.width,this.worldHeight=a.world.height,this.buffer&&!this.cacheAll&&this.updateBufferRegion(a.viewport)},"camera-update":function(a){var b=0,c=0,d=!1,e=null,f=0,g=0,h=0,i=0,j=this.cache,l=this.cachePixels,m=a.viewport,n=this.buffer&&(m.width!==this.laxCam.width||m.height!==this.laxCam.height),o=k,p=this.convertCamera(m);if(!this.cacheAll&&(l.empty||!l.contains(p))&&this.imageMap.length>0&&(n&&this.updateBufferRegion(p),f=this.cacheTilesWidth-1,g=this.cacheTilesHeight-1,h=f/2,i=g/2,o.setAll(Math.round((p.x-this.left)/this.tileWidth-h)+h,Math.round((p.y-this.top)/this.tileHeight-i)+i,f,g),o.left<0?o.moveX(o.halfWidth):o.right>this.tilesWidth-1&&o.moveX(this.tilesWidth-1-o.halfWidth),o.top<0?o.moveY(o.halfHeight):o.bottom>this.tilesHeight-1&&o.moveY(this.tilesHeight-1-o.halfHeight),this.tileCache?(j.empty||!o.contains(j))&&(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,o,this.tilesSpriteCache,j)):this.update(null,o),l.setAll((j.x+.5)*this.tileWidth+this.left,(j.y+.5)*this.tileHeight+this.top,(j.width+1)*this.tileWidth,(j.height+1)*this.tileHeight)),this.cacheGrid)for(b=0;b<this.cacheGrid.length;b++)for(c=0;c<this.cacheGrid[b].length;c++)e=this.cacheGrid[b][c],l.setAll((b+.5)*this.cacheClipWidth+this.left,(c+.5)*this.cacheClipHeight+this.top,this.cacheClipWidth,this.cacheClipHeight),d=l.intersects(p),e.visible&&!d?e.visible=!1:!e.visible&&d&&(e.visible=!0),e.visible&&d&&(e.x=m.left-p.left+b*this.cacheClipWidth+this.left,e.y=m.top-p.top+c*this.cacheClipHeight+this.top);else this.tileCache&&(this.tilesSprite.x=m.left-p.left+j.left*this.tileWidth+this.left,this.tilesSprite.y=m.top-p.top+j.top*this.tileHeight+this.top)},"handle-render":function(a){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{cacheSprite:function(a){var b=0,c=0,d=a.cacheRender,e=null,f=0,g=0,h=0,i=0;if(this.entityCache&&d){for(this.doMap||(this.doMap=Array.setUp(),this.cachedDisplayObjects=Array.setUp(),this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(d),e=d.getBounds(d.transformMatrix),e.x-=this.left,e.y-=this.top,f=Math.max(0,Math.floor(e.y/this.tileHeight)),g=Math.min(this.tilesHeight,Math.ceil((e.y+e.height)/this.tileHeight)),i=Math.max(0,Math.floor(e.x/this.tileWidth)),h=Math.min(this.tilesWidth,Math.ceil((e.x+e.width)/this.tileWidth)),b=i;h>b;b++)for(this.doMap[b]||(this.doMap[b]=Array.setUp()),c=f;g>c;c++)this.doMap[b][c]||(this.doMap[b][c]=Array.setUp()),this.doMap[b][c].push(d);a.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(a){var b=this.worldWidth/this.scaleX,c=b-a.width,d=this.worldHeight/this.scaleY,e=d-a.height,f=this.laxCam;return b!==this.layerWidth&&c?f.moveX((a.left-this.left)*(this.layerWidth-a.width)/c+a.halfWidth+this.left):f.moveX(a.x),d!==this.layerHeight&&e?f.moveY((a.top-this.top)*(this.layerHeight-a.height)/e+a.halfHeight+this.top):f.moveY(a.y),(a.width!==f.width||a.height!==f.height)&&f.resize(a.width,a.height),f},createTile:function(a){var c=null,d="";return"tile-1"===a?p:(c=new b(this.spriteSheet),d="tile"+n(a,c),c.gotoAndStop(d),o.setUp(c,a))},createMap:function(a){var b=0,c=0,d="",e=null,f=this.tiles,g=null;if("string"!=typeof a[0][0])return a;for(e=Array.setUp(),b=0;b<a.length;b++)for(e[b]=Array.setUp(),c=0;c<a[b].length;c++)d=a[b][c],d.id&&(d=d.id),g=f[d],g||null===g||(g=f[d]=this.createTile(d)),e[b][c]=f[d];return e},createGrid:function(a,b){var c=this.cacheHeight,d=this.cacheWidth,e=this.cacheTilesHeight,f=this.cacheTilesWidth,g=0,j=0,k=this.scaleX,l=this.scaleY,n=this.tileHeight,o=this.tileWidth,p=this.tilesHeight,q=this.tilesWidth,r=0,s=0,t=this.owner.z,u=null,v=null,w=Array.setUp();for(r=0;q>r;r+=f)for(u=Array.setUp(),w.push(u),s=0;p>s;s+=e)j=Math.min(m((q-r)*o),d),g=Math.min(m((p-s)*n),c),v=new i(new h(b,j,g)),v.z=t,v.scaleX=k,v.scaleY=l,u.push(v),a.addChild(v),t-=1e-6;return w},updateRegion:function(){var a=Math.floor(this.cacheWidth/this.tileWidth),b=Math.floor(this.cacheHeight/this.tileHeight);this.cacheTilesWidth=Math.min(this.tilesWidth,a),this.cacheTilesHeight=Math.min(this.tilesHeight,b),this.cacheClipWidth=this.cacheTilesWidth*this.tileWidth,this.cacheClipHeight=this.cacheTilesHeight*this.tileHeight,this.tileCache&&(this.mapContainer.mask=(new f).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill())},updateBufferRegion:function(a){var b=Math.floor(this.cacheWidth/this.tileWidth),c=Math.floor(this.cacheHeight/this.tileHeight);this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((a.width+2*this.buffer)/this.tileWidth),b),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((a.height+2*this.buffer)/this.tileHeight),c),this.cacheClipWidth=this.cacheTilesWidth*this.tileWidth,this.cacheClipHeight=this.cacheTilesHeight*this.tileHeight,this.mapContainer.mask=(new f).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(a,b,c,d){this.populate(b,d),this.render(b,a,this.mapContainer,this.mapContainerWrapper,c,d),d&&d.set(b)},populateTiles:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=Array.setUp();for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left)for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&h.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));for(e=0;e<h.length;e++)h[e].clear();h.recycle()},populateTilesAndEntities:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=null,i=Array.setUp(),j=Array.setUp(),k=null;for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left){for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&j.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));if(this.doMap[c]&&this.doMap[c][d])for(k=this.doMap[c][d],e=0;e<k.length;e++)k[e].drawn||(k[e].drawn=!0,i.push(k[e]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),i.length)for(i.sort(l),e=0;e<i.length;e++)h=i[e],delete h.drawn,this.mapContainer.addChild(h),h.mask&&this.mapContainer.addChild(h.mask);for(e=0;e<j.length;e++)j[e].clear();j.recycle(),i.recycle()},renderCache:function(a,b,c,d,e,f){e&&!f.empty&&(e.x=f.left*this.tileWidth,e.y=f.top*this.tileHeight,c.addChild(e)),c.x=-a.left*this.tileWidth,c.y=-a.top*this.tileHeight,b.clear(),b.render(d),b.requiresUpdate=!0},updateGrid:function(){var a=this.cache,b=this.cacheTilesHeight,c=this.cacheTilesWidth,d=this.tilesHeight-1,e=this.tilesWidth-1,f=0,g=0,h=this.cacheGrid;for(f=0;f<h.length;f++)for(g=0;g<h[f].length;g++)a.setBounds(f*c,g*b,Math.min((f+1)*c,e),Math.min((g+1)*b,d)),this.update(h[f][g].texture,a)},destroy:function(){var a=0,b=0,c="",d=this.cacheGrid,e=this.doMap,f=this.imageMap;if(d){for(a=0;a<d.length;a++)for(b=0;b<d[a].length;b++)d[a][b].texture.destroy(!0),this.parentContainer.removeChild(d[a][b]);d.recycle(2),delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.parentContainer.removeChild(this.tilesSprite)):this.parentContainer.removeChild(this.mapContainer);f.recycle(2);for(c in this.tiles)this.tiles.hasOwnProperty(c)&&this.tiles[c].destroy();if(this.tiles=null,this.parentContainer=null,this.tilesSprite=null,e){for(a=0;a<this.cachedDisplayObjects.length;a++)this.cachedDisplayObjects[a].destroy();for(this.cachedDisplayObjects.recycle(),a=0;a<e.length;a++)if(e[a]){for(b=0;b<e.length;b++)e[a][b]&&e[a][b].recycle();e[a].recycle()}e.recycle()}this.laxCam.recycle(),this.cache.recycle(),this.cachePixels.recycle()}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d&&"import"!==d?platypus.game.settings.spriteSheets[d].images.greenSlice():d.images?d.images.greenSlice():Array.setUp()}})}(),function(){"use strict";var a=include("platypus.Data");return platypus.createComponentClass({id:"SceneChanger",properties:{scene:"",persistentData:null},constructor:function(){this.persistentData=a.setUp(this.persistentData)},events:{"new-scene":function(a){var b=a||this,c=b.scene||this.scene,d=b.persistentData||this.persistentData;platypus.game.loadScene(c,d)},"set-scene":function(a){this.scene=a},"set-persistent-scene-data":function(a){var b=this.persistentData,c="";for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}},methods:{destroy:function(){}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.AABB"),c=include("platypus.Data"),d=include("platypus.Entity"),e=268435455,f=268435456,g=2147483648,h=1073741824,i=function(){var a=function(a,b){return a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24)>>>0},b=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)>>>0};return function(c,d){var e=4,f=[],g=atob(c.replace(/\\/g,""));if("zlib"===d)for(g=pako.inflate(g);e<=g.length;)f.push(b(g,e-4)),e+=4;else for(;e<=g.length;)f.push(a(g,e-4)),e+=4;return f}}(),j=function(a){for(var b=1;a>b;)b*=10;return b},k={x:1,y:1,id:-1},l=function(a){var b=k,c=!!(h&a),d=!!(g&a);return b.id=e&a,b.x=1,b.y=1,c&&(b.y=-1),d&&(b.x=-1),b},m=function(a,b){var c=0,d=a.gid||-1,e={},f={gid:-1,transform:null,properties:e,type:""},g=null,h=null;for(-1!==d&&(f.transform=l(d),d=f.gid=k.id),c=0;c<b.length&&!(b[c].firstgid>d);c++)h=b[c];return h&&h.tileproperties&&h.tileproperties[d-h.firstgid]&&(g=h.tileproperties[d-h.firstgid]),""!==a.type?f.type=a.type:""!==a.name?f.type=a.name:g&&(f.type=g.entity||g.type||""),f.type?(f.transform?(e.scaleX=f.transform.x,e.scaleY=f.transform.y):(e.scaleX=1,e.scaleY=1),n(g,f.properties),n(a.properties,f.properties),f):null},n=function(a,b){var c="";if(a&&b)for(c in a)a.hasOwnProperty(c)&&(b[c]=o(a[c]));return b},o=function(a){var b=0;if("string"==typeof a){if(b=parseFloat(a),0===b||b)return b;if("true"===a)return!0;if("false"===a)return!1;if(a.length>1&&("{"===a[0]&&"}"===a[a.length-1]||"["===a[0]&&"]"===a[a.length-1]))try{return JSON.parse(a)}catch(c){}}return a},p=function(a,b){var e=0,f=0,g=Array.setUp(),h=null,i=Array.setUp(),j=null,k=null,l=null;if("string"==typeof a&&(a=platypus.game.settings.levels[a]),a)if(a.tilesets=s(a.tilesets),a.assets)i.union(a.assets);else{for(e=0;e<a.layers.length;e++)if("objectgroup"===a.layers[e].type)for(f=0;f<a.layers[e].objects.length;f++)k=m(a.layers[e].objects[f],a.tilesets),k&&(l=d.getAssetList(k),i.union(l),l.recycle());else"imagelayer"===a.layers[e].type?i.union([a.layers[e].name]):a.layers[e].properties&&a.layers[e].properties.entity&&(j=c.setUp("type",a.layers[e].properties.entity),h=d.getAssetList(j),i.union(h),h.recycle(),j.recycle());if(!b){for(e=0;e<a.tilesets.length;e++)g.push(a.tilesets[e].name);i.union(g),g.recycle()}a.assets=i.greenSlice()}return i},q={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},r=function(a){var b="",c=platypus.game.settings.levels[a.source.replace(".json","")];for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return delete a.source,a},s=function(a){var b=0;for(b=0;b<a.length;b++)a[b].source&&(a[b]=r(a[b]));return a};return platypus.createComponentClass({id:"TiledLoader",properties:{offsetMap:!1,showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},constructor:function(){this.assetCache=a.instance.assetManager.cache,this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(a){this.manuallyLoad||this.loadLevel({level:this.level||a.level,persistentData:a})},"load-level":function(a){this.loadLevel(a)}},methods:{createLayer:function(a,b,c,g,h,i,j,k,l){var m=null,o=b.width,p=b.height,r=b.tileheight||i,s=b.tilewidth||h,t=0,u=0,v=0,w=JSON.parse(JSON.stringify(platypus.game.settings.entities[a]||q[a])),x=null,y=null,z=null,A=!1,B=null,C=null,D=0,E=0,F=0,G="",H=null;if(this.decodeLayer(b),H=b.data,w.properties=w.properties||{},b.properties){if(b.properties.width&&(t=parseInt(b.properties.width,10)),b.properties.height&&(u=parseInt(b.properties.height,10)),t||u){for(t=t||o,u=u||p,H=[],E=0;t>E;E++)for(F=0;u>F;F++)o>E&&p>F?H[E+F*t]=b.data[E+F*o]:H[E+F*t]=0;o=t,p=u}n(b.properties,w.properties)}if(x={},y=[],z=[],"collision-layer"===a)for(C=[],E=0;E<j.length;E++)if(B=j[E],B.tileproperties)for(G in B.tileproperties)B.tileproperties.hasOwnProperty(G)&&B.tileproperties[G].jumpThrough&&C.push(B.firstgid+parseInt(G,10)-1);for(w.properties.width=s*o*this.unitsPerPixel,w.properties.height=r*p*this.unitsPerPixel,w.properties.columns=o,w.properties.rows=p,w.properties.tileWidth=s*this.unitsPerPixel,w.properties.tileHeight=r*this.unitsPerPixel,w.properties.scaleX=this.imagesScale,w.properties.scaleY=this.imagesScale,w.properties.layerZ=this.layerZ,w.properties.left=w.properties.x||c,w.properties.top=w.properties.y||g,w.properties.z=w.properties.z||this.layerZ,v=j[j.length-1].imagewidth/s*(j[j.length-1].imageheight/r)+j[j.length-1].firstgid,E=-1;v>E;E++)x["tile"+E]=E;for(E=0;o>E;E++)for(y[E]=[],z[E]=[],F=0;p>F;F++)D=+H[E+F*o]-1,z[E][F]="tile"+D,D+=1,C&&C.length&&C[0]===(e&D)&&(D=f|D),y[E][F]=D;for(E=0;E<w.components.length;E++)"RenderTiles"===w.components[E].type&&(A=w.components[E]),"import"===w.components[E].spriteSheet?w.components[E].spriteSheet={images:b.image?[b.image]:k,frames:{width:s*this.unitsPerPixel/this.imagesScale,height:r*this.unitsPerPixel/this.imagesScale,regX:s*this.unitsPerPixel/this.imagesScale/2,regY:r*this.unitsPerPixel/this.imagesScale/2},animations:x}:w.components[E].spriteSheet&&("string"==typeof w.components[E].spriteSheet&&platypus.game.settings.spriteSheets[w.components[E].spriteSheet]&&(w.components[E].spriteSheet=platypus.game.settings.spriteSheets[w.components[E].spriteSheet]),w.components[E].spriteSheet.animations||(w.components[E].spriteSheet.animations=x)),"import"===w.components[E].collisionMap&&(w.components[E].collisionMap=y),"import"===w.components[E].imageMap&&(w.components[E].imageMap=z);return this.layerZ+=this.layerIncrement,"render-layer"===a&&!this.separateTiles&&l&&l.tileHeight===r&&l.tileWidth===s&&l.columns===o&&l.rows===p?(l.triggerEvent("add-tiles",A),l):(m={},"render-layer"===a&&this.spriteSheet&&("string"==typeof this.spriteSheet?m.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:m.spriteSheet=this.spriteSheet,m.spriteSheet.animations||(m.spriteSheet.animations=x)),this.owner.addEntity(new d(w,{properties:m})))},convertImageLayer:function(a,b,c){var d=0,e=0,f=a.properties||{},g={data:[],image:"",height:1,name:a.name,type:"tilelayer",width:1,tileheight:b,tilewidth:c,x:a.x,y:a.y,properties:f};for(f.repeat&&(g.width=+f.repeat,g.height=+f.repeat),f["repeat-x"]&&(g.width=+f["repeat-x"]),f["repeat-y"]&&(g.height=+f["repeat-y"]),e=g.width*g.height,d=0;e>d;d++)g.data.push(1);return this.assetCache.read(a.name)?(g.image=a.name,g.tileheight=this.assetCache.read(a.name).height,g.tilewidth=this.assetCache.read(a.name).width):(console.warn('Component TiledLoader: Cannot find the "'+a.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+a.name+'".'),g.image=a.image),g},loadLevel:function(a){var d=!0,e=null,f=null,g=0,h=0,i=null,k=null,l=null,m=null,n=0,o=0,p=c.setUp("count",0,"progress",0,"total",0),q=0,r=0,t=0,u=c.setUp("world",b.setUp(),"width",0,"height",0,"tile",b.setUp(),"camera",null);if(f="string"==typeof a.level?platypus.game.settings.levels[a.level]:a.level,e=f.layers,m=s(f.tilesets),n=f.tilewidth,o=f.tileheight,i=this.images?this.images.greenSlice():Array.setUp(),0===i.length)for(h=0;h<m.length;h++)this.assetCache.read(m[h].name)?i.push(m[h].name):(console.warn('Component TiledLoader: Cannot find the "'+m[r].name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+m[r].name+'".'),i.push(m[h].image));for(q=f.width*n*this.unitsPerPixel,g=f.height*o*this.unitsPerPixel,this.offsetMap&&(r=j(q),t=j(g)),p.total=h=e.length;h--;)"objectgroup"===e[h].type?p.total+=e[h].objects.length:d&&("collision"===e[h].name||e[h].properties&&"collision-layer"===e[h].properties.entity)&&(d=!1);for(h=0;h<e.length;h++){switch(l=e[h],l.type){case"imagelayer":k=this.createLayer("image-layer",this.convertImageLayer(l,o,n),r,t,n,o,m,i,k);break;case"objectgroup":this.setUpEntities(l,r,t,n,o,m,p),k=null;break;case"tilelayer":k=this.setupLayer(l,d,k,r,t,n,o,m,i);break;default:platypus.game.settings.debug&&console.warn('TiledLoader: Platypus does not support Tiled layers of type "'+l.type+'". This layer will not be loaded.')}this.updateLoadingProgress(p)}p.recycle(),u.camera=this.followEntity,u.width=q,u.height=g,u.world.setBounds(r,t,r+q,t+g),u.tile.setBounds(0,0,n,o),this.owner.triggerEvent("world-loaded",u),u.world.recycle(),u.tile.recycle(),u.recycle(),this.owner.removeComponent(this)},setUpEntities:function(a,b,c,e,f,g,h){var i=1e3,j=0,k=0,l=0,n=0,o=0,p=0,q=0,r=null,s=0,t=null,u=null,v=null,w="",x="",y="",z=-1,A=1/0,B=-(1/0),C=1/0,D=-(1/0),E=null,F=null,G=null,H=0,I=0;for(w=this.entityPositionX,x=this.entityPositionY,a.properties&&(a.properties.entityPositionX&&(w=a.properties.entityPositionX),a.properties.entityPositionY&&(x=a.properties.entityPositionY)),s=0;s<a.objects.length;s++){if(t=a.objects[s],E=m(t,g)){if(z=E.gid,y=E.type,u=platypus.game.settings.entities[y],v=u?u.properties||null:null,F=E.properties,t.polygon||t.polyline){for(A=1/0,B=-(1/0),C=1/0,D=-(1/0),G=null,t.polygon?G=t.polygon:t.polyline&&(G=t.polyline),l=0;l<G.length;l++)G[l].x>B&&(B=G[l].x),G[l].x<A&&(A=G[l].x),G[l].y>D&&(D=G[l].y),G[l].y<C&&(C=G[l].y);if(F.width=B-A,F.height=D-C,F.x=t.x+A,F.y=t.y+C,j=0,k=0,F.width=F.width*this.unitsPerPixel,F.height=F.height*this.unitsPerPixel,F.x=F.x*this.unitsPerPixel+b,F.y=F.y*this.unitsPerPixel+c,t.polygon)for(F.shape={},F.shape.type="polygon",F.shape.points=[],n=0;n<G.length;n++)F.shape.points.push({x:(G[n].x-A)*this.unitsPerPixel+b,y:(G[n].y-C)*this.unitsPerPixel+c});else if(t.polyline)for(F.shape={},F.shape.type="polyline",F.shape.points=[],n=0;n<G.length;n++)F.shape.points.push({x:(G[n].x-A)*this.unitsPerPixel+b,y:(G[n].y-C)*this.unitsPerPixel+c})}else H=e*this.unitsPerPixel,I=f*this.unitsPerPixel,j=0,k=0,F.width=(t.width||0)*this.unitsPerPixel,F.height=(t.height||0)*this.unitsPerPixel,v&&("number"==typeof v.width&&(F.width=v.width,j=H),"number"==typeof v.height&&(F.height=v.height,k=I)),F.width||(F.width=H),F.height||(F.height=I),j=j||F.width,k=k||F.height,F.x=t.x*this.unitsPerPixel,F.y=t.y*this.unitsPerPixel,t.rotation&&(o=(t.width||H)/2,p=(t.height||I)/2,q=t.rotation/180%2*Math.PI,r=platypus.Vector.setUp(o,-p).rotate(q),F.rotation=t.rotation,F.x=Math.round((F.x+r.x-o)*i)/i,F.y=Math.round((F.y+r.y+p)*i)/i,r.recycle()),"left"===w?F.regX=0:"center"===w?(F.regX=F.width/2,F.x+=j/2):"right"===w&&(F.regX=F.width,F.x+=j),F.x+=b,-1===z&&(F.y+=F.height),"bottom"===x?F.regY=F.height:"center"===x?(F.regY=F.height/2,F.y-=k/2):"top"===x&&(F.regY=0,F.y-=k),F.y+=c,t.ellipse?(F.shape={},F.shape.type="ellipse",F.shape.width=F.width*this.unitsPerPixel,F.shape.height=F.height*this.unitsPerPixel):t.width&&t.height&&(F.shape={},F.shape.type="rectangle",F.shape.width=F.width*this.unitsPerPixel,F.shape.height=F.height*this.unitsPerPixel);v?(F.scaleX*=this.imagesScale*(v.scaleX||1),F.scaleY*=this.imagesScale*(v.scaleY||1)):(F.scaleX*=this.imagesScale,F.scaleY*=this.imagesScale),F.layerZ=this.layerZ,F.z?F.z+=this.layerZ:v&&"number"==typeof v.z?F.z=this.layerZ+v.z:F.z=this.layerZ,F.parent=this.owner,t=this.owner.addEntity(new d(u,{properties:F})),t&&(t.camera&&(this.followEntity={entity:t,mode:t.camera}),this.owner.triggerEvent("entity-created",t))}this.updateLoadingProgress(h)}this.layerZ+=this.layerIncrement},setupLayer:function(a,b,c,d,e,f,g,h,i){var j="render-layer";return a.properties&&a.properties.entity?j=a.properties.entity:"collision"===a.name?j="collision-layer":"action"===a.name&&(j=b?"tile-layer":"render-layer"),"tile-layer"===j||this.showCollisionTiles&&platypus.game.settings.debug?(this.createLayer("collision-layer",a,d,e,f,g,h,i,c),this.createLayer("render-layer",a,d,e,f,g,h,i,c)):"collision-layer"===j?(this.createLayer("collision-layer",a,d,e,f,g,h,i,c),null):this.createLayer(j,a,d,e,f,g,h,i,c)},updateLoadingProgress:function(a){a.count+=1,a.progress=a.count/a.total,this.owner.triggerEvent("level-loading-progress",a)},destroy:function(){}},publicMethods:{decodeLayer:function(a){return"base64"===a.encoding&&(a.data=i(a.data,a.compression),a.encoding="csv"),a}},getAssetList:function(a,b,c){var d=b||{},e=c||{},f=a.spriteSheet||d.spriteSheet||e.spriteSheet,g=a.images||d.images||e.images,h=p(a.level||d.level||e.level,f);return f&&("string"==typeof f?h.union(platypus.game.settings.spriteSheets[f].images):h.union(f.images)),g&&h.union(g),h},getLateAssetList:function(a,b,c,d){var e=b||{},f=c||{},g=a.spriteSheet||e.spriteSheet||f.spriteSheet;return d&&d.level?p(d.level,g):Array.setUp()}})}(),function(){"use strict";var a=function(a,b,c,d){return function(){a.trigger(b,c,d)}},b=function(b){return function(c){var d=0,e=b,f=null,g=null,h=createjs.Tween.get(this.owner);if(Array.isArray(c))e=c;else if(!Array.isArray(e))return;for(d=0;d<e.length;d++)f=e[d],"string"==typeof f?h.call(a(this.owner,f)):Array.isArray(f)?"call"===f[0]&&"string"==typeof f[1]?h.call(a(this.owner,f[1])):(g=f.greenSlice(),g.greenSplice(0),h[f[0]].apply(h,g),g.recycle()):"call"===f.method&&"string"==typeof f.params?h.call(a(this.owner,f.params)):h[f.method].apply(h,f.params)}};return platypus.createComponentClass({id:"Tween",constructor:function(a){var c="";if(a.events)for(c in a.events)a.events.hasOwnProperty(c)&&this.addEventListener(c,b(a.events[c]))}})}(),function(){"use strict";var a=function(a,b){return" "===b?a+"default":a+b},b=function(b,c,d,e){var f=0,g="",h={},i=0,j="",k="",l=b.voice;if("string"==typeof b.sound)h.sound=b.sound,h.events=Array.setUp();else{for(g in b.sound)b.sound.hasOwnProperty(g)&&(h[g]=b.sound[g]);h.events?h.events=h.events.greenSlice():h.events=Array.setUp()}if(l)for(l+=" ",f=0;f<l.length;f++)k=l[f],k!==j&&(j=k,h.events.push({time:i,event:a(d,k)})),i+=e;return h},c=function(a,c,d,e){var f=0,g=Array.setUp();if(c[" "]||(c[" "]=c["default"]),Array.isArray(a)){for(f=0;f<a.length;f++)g.push(b(a[f],c,d,e));return g}return b(a,c,d,e)};return platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{"default":"default"},frameLength:100,messagePrefix:"VoiceOver",voiceOverMap:{}},constructor:function(b){var d="",e={audioMap:{},aliases:b.aliases},f={acceptInput:b.acceptInput,aliases:b.aliases,animationMap:{},eventBased:!0,flip:b.flip,hidden:b.hidden,mask:b.mask,mirror:b.mirror,offsetZ:b.offsetZ,pins:b.pins,pinTo:b.pinTo,rotate:b.rotate,scaleX:b.scaleX,scaleY:b.scaleY,spriteSheet:b.spriteSheet,stateBased:b.stateBased||!1};this.message=this.messagePrefix+"-";for(d in this.animationMap)this.animationMap.hasOwnProperty(d)&&(f.animationMap[a(this.message,d)]=this.animationMap[d]);f.animationMap["default"]=this.animationMap["default"],this.owner.addComponent(new platypus.components.RenderSprite(this.owner,f));for(d in this.voiceOverMap)this.voiceOverMap.hasOwnProperty(d)&&(e.audioMap[d]=c(this.voiceOverMap[d],this.animationMap,this.message,this.frameLength));
this.owner.addComponent(new platypus.components.AudioVO(this.owner,e))},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d?platypus.game.settings.spriteSheets[d].images.greenSlice():d.images.greenSlice()}})}(),function(){"use strict";return platypus.createComponentClass({id:"XHR",properties:{method:"GET",path:"",responseType:"text",withCredentials:!1},constructor:function(a){this.setProperties(a)},events:{request:function(a){if(this.setProperties(a),"GET"===this.method)this.get();else{if("POST"!==this.method)throw"Method must be GET or POST";this.post()}}},methods:{setProperties:function(a){var b="",c="",d=a||this;if(this.method=d.method||this.method||"GET",this.path=d.path||this.path||null,this.responseType=d.responseType||this.responseType||"text",this.withCredentials=d.withCredentials||this.withCredentials||!1,d!==this&&d.data){this.data="";for(b in d.data)d.data.hasOwnProperty(b)&&(this.data+=c+b+"="+d.data[b],c="&")}else this.data="";this.onload=d.onload||this.onload||function(a){200===this.status&&this.owner.triggerEvent("response",this.responseText)}.bind(this)},get:function(){var a=new XMLHttpRequest,b=this.path;this.data&&(b+="?"+this.data),a.open(this.method,b,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.onload=this.onload,a.send()},post:function(){var a=new XMLHttpRequest;a.open(this.method,this.path,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=this.onload,a.send(this.data)}}})}();