/*!
* @license Platypus
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.pako=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;c>b;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;c>b;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;d>f;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],2:[function(a,b,c){"use strict";function d(a,b){if(65537>b&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;b>d;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;256>j;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;h>f;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=128>c?1:2048>c?2:65536>c?3:4;for(b=new e.Buf8(i),g=0,f=0;i>g;f++)c=a.charCodeAt(f),55296===(64512&c)&&h>f+1&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),128>c?b[g++]=c:2048>c?(b[g++]=192|c>>>6,b[g++]=128|63&c):65536>c?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;d>c;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;h>c;)if(f=a[c++],128>f)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&h>c;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:65536>f?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return 0>c?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":1}],3:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0}b.exports=d},{}],4:[function(a,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;256>c;c++){a=c;for(var d=0;8>d;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a=-1^a;for(var h=d;g>h;h++)a=a>>>8^e[255&(a^b[h])];return-1^a}var f=d();b.exports=e},{}],6:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],7:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(w>q&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),15>q&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,w>q&&(p+=B[f++]<<q,q+=8,w>q&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(w>n){if(z+=l+n-w,w-=n,x>w){x-=w;do C[h++]=o[z++];while(--w);if(z=0,x>n){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,x>w){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(g>f&&j>h);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=g>f?5+(g-f):5-(f-g),a.avail_out=j>h?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],8:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=K,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new r.Buf32(oa),b.distcode=b.distdyn=new r.Buf32(pa),b.sane=1,b.back=-1,C):F}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):F}function h(a,b){var c,d;return a&&a.state?(d=a.state,0>b?(c=0,b=-b):(c=(b>>4)+1,48>b&&(b&=15)),b&&(8>b||b>15)?F:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):F}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==C&&(a.state=null),c):F}function j(a){return i(a,ra)}function k(a){if(sa){var b;for(p=new r.Buf32(512),q=new r.Buf32(32),b=0;144>b;)a.lens[b++]=8;for(;256>b;)a.lens[b++]=9;for(;280>b;)a.lens[b++]=7;for(;288>b;)a.lens[b++]=8;for(v(x,a.lens,0,288,p,0,a.work,{bits:9}),b=0;32>b;)a.lens[b++]=5;v(y,a.lens,0,32,q,0,a.work,{bits:5}),sa=!1}a.lencode=p,a.lenbits=9,a.distcode=q,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new r.Buf8(f.wsize)),d>=f.wsize?(r.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),r.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(r.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new r.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return F;c=a.state,c.mode===V&&(c.mode=W),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=C;a:for(;;)switch(c.mode){case K:if(0===c.wrap){c.mode=W;break}for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0),m=0,n=0,c.mode=L;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=la;break}if((15&m)!==J){a.msg="unknown compression method",c.mode=la;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=la;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?T:V,m=0,n=0;break;case L:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==J){a.msg="unknown compression method",c.mode=la;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=la;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0,c.mode=M;case M:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=t(c.check,Ba,4,0)),m=0,n=0,c.mode=N;case N:for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0,c.mode=O;case O:if(1024&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=t(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=P;case P:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),r.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=Q;case Q:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=R;case R:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&i>q);if(512&c.flags&&(c.check=t(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=S;case S:if(512&c.flags){for(;16>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=la;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=V;break;case T:for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=U;case U:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,E;a.adler=c.check=1,c.mode=V;case V:if(b===A||b===B)break a;case W:if(c.last){m>>>=7&n,n-=7&n,c.mode=ia;break}for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=X;break;case 1:if(k(c),c.mode=ba,b===B){m>>>=2,n-=2;break a}break;case 2:c.mode=$;break;case 3:a.msg="invalid block type",c.mode=la}m>>>=2,n-=2;break;case X:for(m>>>=7&n,n-=7&n;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=la;break}if(c.length=65535&m,m=0,n=0,c.mode=Y,b===B)break a;case Y:c.mode=Z;case Z:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;r.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=V;break;case $:for(;14>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=la;break}c.have=0,c.mode=_;case _:for(;c.have<c.ncode;){for(;3>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=v(w,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=la;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(16>sa)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=la;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=la;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===la)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=la;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=v(x,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=la;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=v(y,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=la;break}if(c.mode=ba,b===B)break a;case ba:c.mode=ca;case ca:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,u(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===V&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ha;break}if(32&ra){c.back=-1,c.mode=V;break}if(64&ra){a.msg="invalid literal/length code",c.mode=la;break}c.extra=15&ra,c.mode=da;case da:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=ea;case ea:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(n>=ta+qa);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=la;break}c.offset=sa,c.extra=15&ra,c.mode=fa;case fa:if(c.extra){for(za=c.extra;za>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=la;break}c.mode=ga;case ga:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=la;break}q>c.wnext?(q-=c.wnext,oa=c.wsize-q):oa=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,oa=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[oa++];while(--q);0===c.length&&(c.mode=ca);break;case ha:if(0===j)break a;f[h++]=c.length,j--,c.mode=ca;break;case ia:if(c.wrap){for(;32>n;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?t(c.check,f,p,h-p):s(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=la;break}m=0,n=0}c.mode=ja;case ja:if(c.wrap&&c.flags){for(;32>n;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=la;break}m=0,n=0}c.mode=ka;case ka:xa=D;break a;case la:xa=G;break a;case ma:return H;case na:default:return F}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<la&&(c.mode<ia||b!==z))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=ma,H):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?t(c.check,f,p,a.next_out-p):s(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===V?128:0)+(c.mode===ba||c.mode===Y?256:0),(0===o&&0===p||b===z)&&xa===C&&(xa=I),xa)}function n(a){if(!a||!a.state)return F;var b=a.state;return b.window&&(b.window=null),a.state=null,C}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?F:(c.head=b,b.done=!1,C)):F}var p,q,r=a("../utils/common"),s=a("./adler32"),t=a("./crc32"),u=a("./inffast"),v=a("./inftrees"),w=0,x=1,y=2,z=4,A=5,B=6,C=0,D=1,E=2,F=-2,G=-3,H=-4,I=-5,J=8,K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9,T=10,U=11,V=12,W=13,X=14,Y=15,Z=16,$=17,_=18,aa=19,ba=20,ca=21,da=22,ea=23,fa=24,ga=25,ha=26,ia=27,ja=28,ka=29,la=30,ma=31,na=32,oa=852,pa=592,qa=15,ra=qa,sa=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;e>=D;D++)P[D]=0;for(E=0;o>E;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;G>F&&0===P[F];F++);for(F>H&&(H=F),K=1,D=1;e>=D;D++)if(K<<=1,K-=P[D],0>K)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;e>D;D++)Q[D+1]=Q[D]+P[D];for(E=0;o>E;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(var T=0;;){T++,z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;G>I+J&&(K-=P[I+J],!(0>=K));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":1}],10:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}],"/lib/inflate.js":[function(a,b,c){"use strict";function d(a,b){var c=new n(b);if(c.push(a,!0),c.err)throw c.msg;return c.result}function e(a,b){return b=b||{},b.raw=!0,d(a,b)}var f=a("./zlib/inflate.js"),g=a("./utils/common"),h=a("./utils/strings"),i=a("./zlib/constants"),j=a("./zlib/messages"),k=a("./zlib/zstream"),l=a("./zlib/gzheader"),m=Object.prototype.toString,n=function(a){this.options=g.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var c=f.inflateInit2(this.strm,b.windowBits);if(c!==i.Z_OK)throw new Error(j[c]);this.header=new l,f.inflateGetHeader(this.strm,this.header)};n.prototype.push=function(a,b){var c,d,e,j,k,l=this.strm,n=this.options.chunkSize,o=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?i.Z_FINISH:i.Z_NO_FLUSH,"string"==typeof a?l.input=h.binstring2buf(a):"[object ArrayBuffer]"===m.call(a)?l.input=new Uint8Array(a):l.input=a,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new g.Buf8(n),l.next_out=0,l.avail_out=n),c=f.inflate(l,i.Z_NO_FLUSH),c===i.Z_BUF_ERROR&&o===!0&&(c=i.Z_OK,o=!1),c!==i.Z_STREAM_END&&c!==i.Z_OK)return this.onEnd(c),this.ended=!0,!1;l.next_out&&(0===l.avail_out||c===i.Z_STREAM_END||0===l.avail_in&&(d===i.Z_FINISH||d===i.Z_SYNC_FLUSH))&&("string"===this.options.to?(e=h.utf8border(l.output,l.next_out),j=l.next_out-e,k=h.buf2string(l.output,e),l.next_out=j,l.avail_out=n-j,j&&g.arraySet(l.output,l.output,e,j,0),this.onData(k)):this.onData(g.shrinkBuf(l.output,l.next_out))),0===l.avail_in&&0===l.avail_out&&(o=!0)}while((l.avail_in>0||0===l.avail_out)&&c!==i.Z_STREAM_END);return c===i.Z_STREAM_END&&(d=i.Z_FINISH),d===i.Z_FINISH?(c=f.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===i.Z_OK):d===i.Z_SYNC_FLUSH?(this.onEnd(i.Z_OK),l.avail_out=0,!0):!0},n.prototype.onData=function(a){this.chunks.push(a)},n.prototype.onEnd=function(a){a===i.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=g.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=n,c.inflate=d,c.inflateRaw=e,c.ungzip=d},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),this.platypus=this.platypus||{},function(){"use strict";var a=navigator.userAgent.toLowerCase(),b=a.search("edge")>-1,c=a.search("ipod")>-1,d=a.search("iphone")>-1,e=a.search("ipad")>-1,f=a.search("android")>-1,g=a.search("silk")>-1,h=c||d||e,i=h||f||g;platypus.supports={touch:"undefined"!==window.ontouchstart,edge:b,iPod:c,iPhone:d,iPad:e,safari:a.search("safari")>-1&&!b,ie:a.search("msie")>-1||a.search("trident")>-1,firefox:a.search("firefox")>-1,android:f,chrome:a.search("chrome")>-1&&!b,silk:g,iOS:h,mobile:i,desktop:!i},platypus.version="NEXT",platypus.buildDate="Wed, 27 Jan 2016 18:54:22 GMT"}(),platypus.Component=function(){"use strict";var a=function(){var a=[];return function(b){return a}}(),b=function(a,b){this.type=a,this.owner=b,this.publicMethods={},this.listener={events:[],messages:[]}},c=b.prototype;return c.toString=function(){return"[Component "+this.type+"]"},c.destroy=function(){var a="";this._destroy&&this._destroy();for(a in this.publicMethods)this.publicMethods.hasOwnProperty(a)&&this.removeMethod(a);this.removeEventListeners()},c.removeEventListeners=function(a){var b=0,c=null,d=null;if(a)for(c=a,b=0;b<c.length;b++)this.removeEventListener(c[b]);else for(c=this.listener.events,d=this.listener.messages,b=0;b<c.length;b++)this.removeEventListener(c[b],d[b])},c.addEventListener=function(a,b,c){var d=b.bind(this);this.listener.events.push(a),this.listener.messages.push(d),this.owner.on(a,d,c)},c.addMethod=function(a,b){this.owner[a]?console.warn(this.owner.type+': Entity already has a method called "'+a+'". Method not added.'):(this.owner[a]=function(){return b.apply(this,arguments)}.bind(this),this.publicMethods[a]=b)},c.removeEventListener=function(a,b){var c=0,d=this.listener.events,e=this.listener.messages;for(c=0;c<d.length;c++)d[c]!==a||b&&e[c]!==b||this.owner.off(a,e[c])},c.removeMethod=function(a){this.owner[a]?delete this.owner[a]:console.warn(this.owner.type+': Entity does not have a method called "'+a+'".'),delete this.publicMethods[a]},b.getAssetList=a,b.getLateAssetList=a,b}(),platypus.Messenger=function(){"use strict";var a=include("springroll.EventDispatcher"),b=function(){a.call(this),this.loopCheck=[]},c=extend(b,a);return c.toString=function(){return"[Messenger Object]"},c._trigger=c.trigger,c.trigger=function(a,b,c){var d=0,e=0;if("string"==typeof a)return this.triggerEvent(a,b,c);if(Array.isArray(a)){for(d=0;d<a.length;d++)e+=this.trigger(a[d],b,c);return e}return a.event?this.triggerEvent(a.event,a.message||b,a.debug||c):(console.warn('Event incorrectly formatted: must be string, array, or object containing an "event" property.',a),0)},c.triggerEvent=function(a,b,c){var d=0,e=this.debug||c||b&&b.debug,f=0,g=0;if(this.destroyed)return 0;if(g=this._listeners[a]&&this._listeners[a].length||0,e){if(!g)return console.warn('Entity "'+this.type+'": Event "'+a+'" has no subscribers.',b),0;for(console.log('Entity "'+this.type+'": Event "'+a+'" has '+g+" subscriber"+(g>1?"s":"")+".",b),d=0;d<this.loopCheck.length;d++)if(this.loopCheck[d]===a){if(f+=1,f>5)throw"Endless loop detected for '"+a+"'.";console.warn("Event '"+a+"' is nested inside another '"+a+"' event.")}this.loopCheck.push(a),this._trigger(a,b,c),this.loopCheck.length=this.loopCheck.length-1}else g&&this._trigger(a,b,c);return g},c.getMessageIds=function(){return Object.keys(this._listeners)},b}(),platypus.Entity=function(){"use strict";var a={},b=function(a,b){platypus.game.settings.debug&&console.warn(a,b)},c=function(c,d){var e=0,f=null,g=c||{},h=g.components||[],i=g.properties||{},j=d||{},k=j.properties||{},l=[],m=[];for(platypus.Messenger.call(this),this.components=[],this.type=g.id||"none",this.id=j.id||k.id,this.id||(a[this.type]||(a[this.type]=0),this.id=this.type+"-"+a[this.type],a[this.type]+=1),this.setProperty(i),this.setProperty(k),this.on("set-property",function(a){this.setProperty(a)}.bind(this)),this.state||(this.state={}),this.lastState={},this.trigger=this.triggerEvent=function(a,b){l.push(a),m.push(b)},e=0;e<h.length;e++)f=h[e],f&&(platypus.components[f.type]?this.addComponent(new platypus.components[f.type](this,f)):b('Entity "'+this.type+'": Component "'+f.type+'" is not defined.',f));for(delete this.trigger,delete this.triggerEvent,e=0;e<l.length;e++)this.trigger(l[e],m[e]);this.triggerEvent("load")},d=c.prototype=new platypus.Messenger;return d.toString=function(){return"[entity "+this.type+"]"},d.addComponent=function(a){return this.components.push(a),this.triggerEvent("component-added",a),a},d.removeComponent=function(a){var b=0;if("string"==typeof a){for(b=0;b<this.components.length;b++)if(this.components[b].type===a)return a=this.components[b],this.components.splice(b,1),this.triggerEvent("component-removed",a),a.destroy(),a}else for(b=0;b<this.components.length;b++)if(this.components[b]===a)return this.components.splice(b,1),this.triggerEvent("component-removed",a),a.destroy(),a;return!1},d.setProperty=function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},d.messengerDestroy=d.destroy,d.destroy=function(){var a=0;for(a=0;a<this.components.length;a++)this.components[a].destroy();this.components.length=0,this.messengerDestroy()},c.getAssetList=function(a,d){var e=0,f=null,g=[],h=null;if(a.type)return h=platypus.game.settings.entities[a.type],h?c.getAssetList(h,a.properties):(b('Entity "'+a.type+'": This entity is not defined.',a),g);for(e=0;e<a.components.length;e++)f=a.components[e]&&a.components[e].type&&platypus.components[a.components[e].type],f&&g.union(f.getAssetList(a.components[e],a.properties,d));return g},c.getLateAssetList=function(a,b,d){var e=0,f=null,g=[];if(a.type)return c.getLateAssetList(platypus.game.settings.entities[a.type],b,d);for(e=0;e<a.components.length;e++)f=a.components[e]&&a.components[e].type&&platypus.components[a.components[e].type],f&&g.union(f.getLateAssetList(a.components[e],a.properties,b,d));return g},c}(),platypus.Scene=function(){"use strict";var a=include("platypus.Entity"),b=include("springroll.State"),c=/([\w-]+)\.(\w)$/,d=function(a){var b=a.match(c),d={id:a,src:a};return b?d.id=b[1]:d.src="assets/images/"+a+".png",d},e=function(a,c){b.call(this,a,c.options),this.id=c.id,this.preload.union(this.getAssetList(c)),this.layerDefinitions=c.layers,this.storeMessages=!1,this.storedMessages=[],this.stage=a,this.layers=[],this.on("loading",function(a){var b=this.getLateAssetList(c);b.length&&(a.union(b),this.on("exit",function(a){this.app.unload(a),a=null}.bind(this,b)))}.bind(this)),this.on("loaded",function(){var a=0,b="",c=this.layerDefinitions,d=!0,e=!1,f=null,g=null;for(this.storeMessages=!0,a=0;a<c.length;a++){if(e=c[a],f={stage:this.stage,parent:this},e.properties)for(b in e.properties)e.properties.hasOwnProperty(b)&&(f[b]=e.properties[b]);if(e.type&&(e=platypus.game.settings.entities[e.type]),d=!0,e.filter){if(e.filter.includes){d=!1;for(b in e.filter.includes)e.filter.includes.hasOwnProperty(b)&&platypus.supports[e.filter.includes[b]]&&(d=!0)}if(e.filter.excludes)for(b in e.filter.excludes)e.filter.excludes.hasOwnProperty(b)&&platypus.supports[e.filter.excludes[b]]&&(d=!1)}d&&this.layers.push(new platypus.Entity(e,{properties:f}))}for(g=this.storedMessages,this.storeMessages=!1,a=0;a<g.length;a++)this.triggerOnChildren(g[a].message,g[a].value);g.length=0,platypus.game.settings.debug&&console.log("Scene loaded: "+this.id),this.triggerOnChildren("scene-loaded",this.data)}.bind(this))},f=extend(e,b);return f.enterDone=function(){platypus.game.currentScene=this,platypus.game.settings.debug&&console.log("Scene live: "+this.id),this.triggerOnChildren("scene-live",this.data)},f.exitStart=function(){platypus.game.settings.debug&&console.log("Scene ending: "+this.id)},f.triggerOnChildren=function(a,b){var c=0;if(this.storeMessages)this.storedMessages.push({message:a,value:b});else for(c=0;c<this.layers.length;c++)this.layers[c].trigger(a,b)},f.getEntityById=function(a){var b=0,c=null;for(b=0;b<this.layers.length;b++){if(this.layers[b].id===a)return this.layers[b];if(this.layers[b].getEntityById&&(c=this.layers[b].getEntityById(a)))return c}return void 0},f.getEntitiesByType=function(a){var b=0,c=null,d=[];for(b=0;b<this.layers.length;b++)this.layers[b].type===a&&d.push(this.layers[b]),this.layers[b].getEntitiesByType(a)&&(c=this.layers[b].getEntitiesByType(a),c&&(d=d.concat(c)));return d},f.destroy=f.exit=function(){var a=0;for(a=0;a<this.layers.length;a++)this.layers[a].destroy();this.layers.length=0,platypus.game.currentScene=null},f.getAssetList=function(b){var c=0,e=[];for(c=0;c<b.layers.length;c++)e.union(a.getAssetList(b.layers[c]));for(c=0;c<e.length;c++)e[c]=d(e[c]);return e},f.getLateAssetList=function(b){var c=0,e=[];for(c=0;c<b.layers.length;c++)e.union(a.getLateAssetList(b.layers[c],null,this.data));for(c=0;c<e.length;c++)e[c]=d(e[c]);return e},e}(),platypus.Game=function(){"use strict";var a=include("PIXI.Container"),b=include("platypus.Scene"),c=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="text",c.onload=function(){var d=null;if(200===c.status)try{d=JSON.parse(c.responseText)}catch(e){console.warn('Error parsing "'+a+'": '+e.message)}else console.warn('Error opening "'+a+'": '+c.description);b(d)},c.send()},d=function(a,b){var e=0,f="",g=0,h=function(c){g-=1,g||b(a)},i=function(a,b,c){d(a[b],function(d){a[b]=d,c(d)})};if(a){if(Array.isArray(a)){
if(g=a.length)for(e=0;e<a.length;e++)i(a,e,h);else b(a);return}if("object"==typeof a){if(a.src&&a.src.length>5&&".json"===a.src.substring(a.src.length-5).toLowerCase())d(a.src,function(c){a.src!==c&&(a=c),b(a)});else{for(f in a)a.hasOwnProperty(f)&&(g+=1);if(g)for(f in a)a.hasOwnProperty(f)&&i(a,f,h);else b(a)}return}if("string"==typeof a&&a.length>5&&".json"===a.substring(a.length-5).toLowerCase())return void c(a,function(a){"object"==typeof a?d(a,b):b(a)})}b(a)},e=function(c,e,f){var g=function(c){var d="",e=this.app.states||{};platypus.game=this,this.currentScene=null,this.settings=c,this.stage=this.app.display.stage;for(d in c.scenes)c.scenes.hasOwnProperty(d)&&(e[c.scenes[d].id]=new b(new a,c.scenes[d]));this.app.states||(this.app.states=e),f&&f(this),window.getEntityById=function(a){return this.getEntityById(a)}.bind(this),window.getEntitiesByType=function(a){return this.getEntitiesByType(a)}.bind(this),window.getVisibleSprites=function(a,b){var c=0;if(b=b||[],a=a||this.stage,!a.texture&&a.visible){for(c=0;c<a.children.length;c++)window.getVisibleSprites(a.children[c],b);return b}return a.visible?(b.push(a),b):b}.bind(this)}.bind(this);return this.app=e,c?void("string"==typeof c?d(c,g):g(c)):(console.warn("No game definition is supplied. Game not created."),null)},f=e.prototype;return f.tick=function(a){this.currentScene&&this.currentScene.triggerOnChildren("tick",a)},f.loadScene=function(){var a=function(a,b){this.app.states[a].data=b,this.app.manager.state=a};return function(b,c){setTimeout(a.bind(this,b,c),1)}}(),f.getEntityById=function(a){return this.currentScene?this.currentScene.getEntityById(a):null},f.getEntitiesByType=function(a){return this.currentScene?this.currentScene.getEntitiesByType(a):[]},f.destroy=function(){},e}(),platypus.Vector=function(){"use strict";var a=function(a,b,c){this.matrix=[0,0,0],this.set(a,b,c)},b=a.prototype;return Object.defineProperty(b,"x",{get:function(){return this.matrix[0]},set:function(a){this.matrix[0]=a}}),Object.defineProperty(b,"y",{get:function(){return this.matrix[1]},set:function(a){this.matrix[1]=a}}),Object.defineProperty(b,"z",{get:function(){return this.matrix[2]},set:function(a){this.matrix[2]=a}}),b.toString=function(){return"["+this.matrix.join(",")+"]"},b.set=function(a,b,c){var d=null,e=0,f=0;if(a&&Array.isArray(a)?(d=a,e=b||d.length):a&&a.matrix?(d=a.matrix,e=b||d.length):(this.x=a||0,this.y=b||0,this.z=c||0),d)for(f=0;e>f;f++)this.matrix[f]=d[f];return this},b.copyValues=function(a){return this.set(a)},b.magnitude=function(a){var b=0,c=0;for(a=a||this.matrix.length,c=0;a>c;c++)b+=Math.pow(this.matrix[c],2);return Math.sqrt(b)},b.getAngle=function(){var a=this.magnitude(2),b=0;return 0!==a&&(b=Math.acos(this.x/a),this.y<0&&(b=2*Math.PI-b)),b},b.getUnit=function(){return new platypus.Vector(this).normalize()},b.getInverse=function(){return new platypus.Vector(this).multiply(-1)},b.normalize=function(){var a=this.magnitude();return 0===a?this.multiply(0):this.multiply(1/a)},b.cross=function(){var a=function(a,b,c,d){return a*d-b*c};return function(b){var c=a(this.y,this.z,b.y,b.z),d=-a(this.x,this.z,b.x,b.z),e=a(this.x,this.y,b.x,b.y);return this.x=c,this.y=d,this.z=e,this}}(),b.getCrossProduct=function(a){return new platypus.Vector(this).cross(a)},b.rotate=function(b,c){var d=c,e=Math.cos(b),f=Math.sin(b),g=1-e,h=0,i=0,j=0;return d?"x"===d?d=new a(1,0,0):"y"===d?d=new a(0,1,0):"z"===d&&(d=new a(0,0,1)):d=new a(0,0,1),h=d.x,i=d.y,j=d.z,this.multiply([[e+h*h*g,h*i*g-j*f,h*j*g+i*f],[i*h*g+j*f,e+i*i*g,i*j*g-h*f],[j*h*g-i*f,j*i*g+h*f,e+j*j*g]])},b.multiply=function(a,b){var c=0,d=0,e=null,f=0;if(Array.isArray(a))for(e=this.matrix.slice(),f=b||a.length,c=0;f>c;c++)for(this.matrix[c]=0,d=0;f>d;d++)this.matrix[c]+=e[d]*a[c][d];else for(f=b||this.matrix.length,c=0;f>c;c++)this.matrix[c]*=a;return this},b.add=function(b,c,d){var e=b,f=0,g=0;for(Array.isArray(e)?f=c||this.matrix.length:e instanceof a?(e=e.matrix,f=c||this.matrix.length):(e=[b||0,c||0,d||0],f=this.matrix.length),g=0;f>g;g++)this.matrix[g]+=e[g];return this},b.addVector=function(a,b){return this.add(a,b)},b.subtractVector=function(a,b){return this.add(a.getInverse(),b)},b.scale=function(a,b){return this.multiply(a,b)},b.dot=function(a,b){var c=0,d=0;for(b=b||this.matrix.length,d=0;b>d;d++)c+=this.matrix[d]*(a.matrix[d]||0);return c},b.angleTo=function(a){var b=this.getUnit(),c=a.getUnit();return Math.acos(b.dot(c))},b.signedAngleTo=function(a,b){var c=this.getUnit(),d=a.getUnit();return c.getCrossProduct(d).dot(b)<0?-Math.acos(c.dot(d)):Math.acos(c.dot(d))},b.scalarProjection=function(a){var b=0;return b="number"==typeof a?a:this.angleTo(a),this.magnitude(2)*Math.cos(b)},b.copy=function(){return new platypus.Vector(this)},a.assign=function(){var a=function(a,b,c,d){var e=null,f=!1;"string"==typeof a&&"undefined"!=typeof b[a]&&(e=b[a],delete b[a],f=!0),Object.defineProperty(b,a,{get:function(){return c.matrix[d]},set:function(a){c.matrix[d]=a},enumerable:!0}),f&&(b[a]=e)};return function(b,c){var d=0;if(b&&c){if(!b[c]){for(b[c]=new platypus.Vector,d=2;d<arguments.length;d++)arguments[d]!==c&&a(arguments[d],b,b[c],d-2);return}return b[c]}return null}}(),a}(),platypus.AABB=function(){"use strict";var a=function(a,b,c,d){this.empty=!0,this.setAll(a,b,c,d)},b=a.prototype;return b.setAll=function(a,b,c,d){return this.empty=!1,this.x=a,this.y=b,this.resize(c,d),this},b.setBounds=function(a,b,c,d){return this.empty=!1,this.x=(c+a)/2,this.y=(b+d)/2,this.resize(c-a,d-b),this},b.set=function(a){return this.empty=a.empty,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.halfWidth=a.halfWidth,this.halfHeight=a.halfHeight,this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this},b.reset=function(){return this.empty=!0,this},b.resize=function(a,b){return this.width=a||0,this.height=b||0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,isNaN(this.x)?this.empty=!0:(this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x),isNaN(this.y)?this.empty=!0:(this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y),this},b.include=function(a){return a&&(this.empty?this.set(a):(this.left>a.left&&(this.left=a.left),this.right<a.right&&(this.right=a.right),this.top>a.top&&(this.top=a.top),this.bottom<a.bottom&&(this.bottom=a.bottom),this.width=this.right-this.left,this.height=this.bottom-this.top,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.x=this.left+this.halfWidth,this.y=this.top+this.halfHeight)),this},b.move=function(a,b){return this.moveX(a),this.moveY(b),this},b.moveX=function(a){return this.x=a,this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x,this},b.moveY=function(a){return this.y=a,this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y,this},b.moveXBy=function(a){return this.x+=a,this.left=-this.halfWidth+this.x,this.right=this.halfWidth+this.x,this},b.moveYBy=function(a){return this.y+=a,this.top=-this.halfHeight+this.y,this.bottom=this.halfHeight+this.y,this},b.getCopy=function(){return new a(this.x,this.y,this.width,this.height)},b.matches=function(a,b,c,d){return!(this.x!==a||this.y!==b||this.width!==c||this.height!==d)},b.contains=function(a){return!(a.top<this.top||a.bottom>this.bottom||a.left<this.left||a.right>this.right)},b.containsVector=function(a){return!(a.y<this.top||a.y>this.bottom||a.x<this.left||a.x>this.right)},b.intersects=function(a){return!(a.bottom<this.top||a.top>this.bottom||a.right<this.left||a.left>this.right)},b.getIntersectionArea=function(a){var b=Math.max,c=Math.min,d=c(this.bottom,a.bottom)-b(this.top,a.top),e=c(this.right,a.right)-b(this.left,a.left),f=d*e;return f},a}(),platypus.ActionState=function(){"use strict";var a=function(a,b,c){this.event=a,this.trigger=c,this.active=!1,this.wasActive=!1,this.valid=!0,this.wasValid=!0,this.states=b||{},this.inputs=[],this.stateSummary={pressed:!1,released:!1,triggered:!1}},b=function(a){return a},c=a.prototype;return c.update=function(a){var c=this.stateSummary;return this.valid=this.isStateValid(a),this.active=this.inputs.some(b),c.pressed=this.valid&&this.active,c.released=this.wasActive&&(!this.valid&&this.wasValid||this.valid&&!this.active),c.triggered=this.valid&&this.active&&!this.wasActive,this.wasValid=this.valid,this.wasActive=this.active,c.pressed||c.released||c.triggered},c.resolve=function(){this.trigger(this.event,this.stateSummary)},c.isStateValid=function(a){var b="",c=this.states;for(b in c)if(c.hasOwnProperty(b)&&a.hasOwnProperty(b)&&c[b]!==a[b])return!1;return!0},a}(),platypus.CollisionData=function(){"use strict";var a=function(a,b,c,d,e,f,g,h,i){this.occurred=a||!1,this.direction=b||null,this.position=c||null,this.deltaMovement=d||null,this.aABB=e||null,this.thisShape=f||null,this.thatShape=g||null,this.vector=h||null,this.stuck=i||0},b=a.prototype;return b.copy=function(a){this.occurred=a.occurred,this.direction=a.direction,this.position=a.position,this.deltaMovement=a.deltaMovement,this.aABB=a.aABB,this.thisShape=a.thisShape,this.thatShape=a.thatShape,this.vector=a.vector,this.stuck=a.stuck},b.clear=function(){this.occurred=!1,this.direction=null,this.position=null,this.deltaMovement=null,this.aABB=null,this.thisShape=null,this.thatShape=null,this.vector=null,this.stuck=0},a}(),platypus.CollisionDataContainer=function(){"use strict";var a=function(){this.xData=[new platypus.CollisionData,new platypus.CollisionData],this.yData=[new platypus.CollisionData,new platypus.CollisionData],this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},b=a.prototype;return b.getXEntry=function(a){return this.xData[a]},b.getYEntry=function(a){return this.yData[a]},b.tryToAddX=function(a){return a.deltaMovement<this.xDeltaMovement?(this.xDeltaMovement=a.deltaMovement,this.xData[0].copy(a),this.xCount=1,!0):a.deltaMovement===this.xDeltaMovement?(this.ensureRoomX(),this.xData[this.xCount].copy(a),this.xCount+=1,!0):!1},b.tryToAddY=function(a){return a.deltaMovement<this.yDeltaMovement?(this.yDeltaMovement=a.deltaMovement,this.yData[0].copy(a),this.yCount=1,!0):a.deltaMovement===this.yDeltaMovement?(this.ensureRoomY(),this.yData[this.yCount].copy(a),this.yCount+=1,!0):!1},b.ensureRoomX=function(){var a=0,b=2*this.xData.length;if(this.xData.length<=this.xCount)for(a=this.xData.length;b>a;a++)this.xData[a]=new platypus.CollisionData},b.ensureRoomY=function(){var a=0,b=2*this.yData.length;if(this.yData.length<=this.yCount)for(a=this.yData.length;b>a;a++)this.yData[a]=new platypus.CollisionData},b.reset=function(){this.xCount=0,this.yCount=0,this.xDeltaMovement=1/0,this.yDeltaMovement=1/0},a}(),platypus.CollisionShape=function(){"use strict";var a=include("platypus.Vector"),b=function(b,c,d){var e=c.regX,f=c.regY,g=0,h=0;switch(this.owner=b,this.collisionType=d,this.width=c.width||2*c.radius||0,this.height=c.height||2*c.radius||0,this.radius=c.radius||0,"number"!=typeof e&&(e=this.width/2),"number"!=typeof f&&(f=this.height/2),a.assign(this,"offset","offsetX","offsetY"),this.offsetX=c.offsetX||this.width/2-e,this.offsetY=c.offsetY||this.height/2-f,a.assign(this,"position","x","y"),b?(this.x=b.x+this.offsetX,this.y=b.y+this.offsetY):(this.x=c.x+this.offsetX,this.y=c.y+this.offsetY),this.type=c.type||"rectangle",this.subType="",this.aABB=void 0,this.type){case"circle":g=h=2*this.radius;break;case"rectangle":g=this.width,h=this.height}a.assign(this,"size","width","height"),this.width=g,this.height=h,this.aABB=new platypus.AABB(this.x,this.y,g,h)},c=b.prototype;return c.update=function(a,b){this.x=a+this.offsetX,this.y=b+this.offsetY,this.aABB.move(this.x,this.y)},c.moveX=function(a){this.x=a,this.aABB.moveX(this.x)},c.moveY=function(a){this.y=a,this.aABB.moveY(this.y)},c.getAABB=function(){return this.aABB},c.setXWithEntityX=function(a){this.x=a+this.offsetX,this.aABB.moveX(this.x)},c.setYWithEntityY=function(a){this.y=a+this.offsetY,this.aABB.moveY(this.y)},c.destroy=function(){this.aABB=void 0},c.multiply=function(a){this.position.subtractVector(this.owner.position),this.position.multiply(a),this.offset.multiply(a),this.size.multiply(a),this.position.addVector(this.owner.position),this.width=Math.abs(this.width),this.height=Math.abs(this.height),this.aABB.setAll(this.x,this.y,this.width,this.height)},b}(),function(){"use strict";var a=include("platypus.Component"),b="",c=0,d=function(a,b,c){Object.defineProperty(b,a,{get:function(){return c[a]},set:function(b){c[a]=b},enumerable:!0})};platypus.components={},platypus.createComponentClass=function(e,f){var g=function(b,g){var h="",i="",j="",k="";if(a.call(this,e.id,b),f&&f.call(this),e.properties)for(h in e.properties)e.properties.hasOwnProperty(h)&&("undefined"!=typeof g[h]?this[h]=g[h]:"undefined"!=typeof this.owner[h]?this[h]=this.owner[h]:this[h]=e.properties[h]);if(e.publicProperties)for(h in e.publicProperties)e.publicProperties.hasOwnProperty(h)&&(d(h,this,b),"undefined"!=typeof g[h]?this[h]=g[h]:"undefined"!=typeof this.owner[h]?this[h]=this.owner[h]:this[h]=e.publicProperties[h]);if(e.events){c-=1;for(i in e.events)if(e.events.hasOwnProperty(i)&&(this.addEventListener(i,e.events[i],c),g.aliases))for(k in g.aliases)g.aliases.hasOwnProperty(k)&&g.aliases[k]===i&&this.addEventListener(k,e.events[i],c)}if(e.publicMethods)for(i in e.publicMethods)if(e.publicMethods.hasOwnProperty(i)){if(j=i,g.aliases)for(k in g.aliases)g.aliases.hasOwnProperty(k)&&g.aliases[k]===i&&(j=k);this.addMethod(j,e.publicMethods[i])}this.constructor&&this.constructor(g)},h=null,i=g.prototype;if(f){i=extend(g,f);for(b in a.prototype)i[b]=a.prototype[b]}else i=extend(g,a);if(i.constructor=e.constructor,e.methods)for(h in e.methods)e.methods.hasOwnProperty(h)&&("destroy"===h?i._destroy=e.methods[h]:i[h]=e.methods[h]);if(e.publicMethods)for(h in e.publicMethods)e.publicMethods.hasOwnProperty(h)&&(i[h]=e.publicMethods[h]);g.getAssetList=e.getAssetList||a.getAssetList,g.getLateAssetList=e.getLateAssetList||a.getLateAssetList,platypus.components[e.id]=g}}(),function(){"use strict";var a=include("springroll.Application"),b={},c=function(a,b){var c=0,d=a.width,e=a.height,f=a.regX||0,g=a.regY||0,h=0,i=0,j=0,k=0,l=[];for(c=0;c<b.length;c++)for(h=b[c].realWidth-d,i=b[c].realHeight-e,k=0;i>=k;k+=e)for(j=0;h>=j;j+=d)l.push([j,k,d,e,c,f,g]);return l},d=function(b){var c=0,d=[],e=null,f=a.instance.assetManager.cache;for(c=0;c<b.length;c++)e="string"==typeof b[c]?f.read(b[c])?{asset:f.read(b[c])}:null:{asset:b[c]},e?(e.texture||(e.texture=new PIXI.BaseTexture(e.asset)),d.push(e.texture)):console.warn('"'+b[c]+'" is not a loaded asset.');return d},e=function(a,b){return a[b[4]]+"-x"+b[0]+"y"+b[1]+"w"+b[2]+"h"+b[3]},f=function(a){var b=a.animations,c=0,d=a.images.join(","),e=a.frames,f="";for(c=0;c<a.images.length;c++)if("string"!=typeof a.images[c])return"";if(Array.isArray(e))for(c=0;c<e.length;c++)d+="-"+e[c].join(",");else d+="-w"+e.width+"h"+e.height+"rx"+e.regX+"ry"+e.regY;if(b)for(f in b)b.hasOwnProperty(f)&&(d+="-"+f);return d},g=function(a,b,c){var d=0,e=[];if(isNaN(b)){if(Array.isArray(b)){for(d=b[0];d<b[1]+1;d++)e.push(c[d]||PIXI.Texture.EMPTY);return{id:a,frames:e,next:b[2]||a,speed:b[3]||1}}for(d=0;d<b.frames.length;d++)e.push(c[b.frames[d]]||PIXI.Texture.EMPTY);return{id:a,frames:e,next:b.next||a,speed:b.speed||1}}return e.push(c[b]||PIXI.Texture.EMPTY),{id:a,frames:e,next:a,speed:1}},h=function(a,b){var c="",d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=g(c,a[c],b));return d},i=function(a){var b=0,e=null,f=null,i=null,j=a.images,k=null,l=[],m=d(j);for(i=Array.isArray(a.frames)?a.frames:c(a.frames,m),b=0;b<i.length;b++)f=i[b],k=new PIXI.Texture(m[f[4]],new PIXI.Rectangle(f[0],f[1],f[2],f[3])),l.push({texture:k,anchor:new PIXI.Point((f[5]||0)/k.width,(f[6]||0)/k.height)});return e=h(a.animations||{},l),e["default"]||(e["default"]=g("default",[0,l.length-1],l)),{textures:l,animations:e}},j=function(a,b){var f=0,i="",j=null,k=null,l=null,m=a.images,n=null,o=[],p=d(m);for(l=Array.isArray(a.frames)?a.frames:c(a.frames,p),f=0;f<l.length;f++)k=l[f],i=e(m,k),n=new PIXI.Texture(p[k[4]],new PIXI.Rectangle(k[0],k[1],k[2],k[3])),o.push({texture:n,anchor:new PIXI.Point((k[5]||0)/n.width,(k[6]||0)/n.height)});return j=h(a.animations||{},o),j["default"]||(j["default"]=g("default",[0,o.length-1],o)),{textures:o,animations:j,viable:1,cacheId:b}},k=function(a,c){var d=f(a),e=d?b[d]:null,g=(a.framerate||60)/60;d?e?e.viable+=1:(e=b[d]=j(a,d),this.cacheId=d):e=i(a),PIXI.Sprite.call(this,e.textures[0].texture),this._animations=e.animations,this._animation=null,this.animationSpeed=g,this.onComplete=null,this._currentTime=0,this.playing=!1,this._visible=!0,this._updating=!1,e.textures.length<2?this.gotoAndStop(c):this.gotoAndPlay(c)},l=k.prototype=Object.create(PIXI.Sprite.prototype);k.prototype.constructor=k,platypus.PIXIAnimation=k,Object.defineProperties(l,{visible:{get:function(){return this._visible},set:function(a){this._visible=a,this._syncUpdate()}},currentFrame:{get:function(){var a=this._animation.frames;return a[Math.floor(this._currentTime)%a.length]}}}),l.stop=function(){this.playing&&(this.playing=!1,this._syncUpdate())},l.play=function(){this.playing||(this.playing=!0,this._syncUpdate())},l._syncUpdate=function(){var a=this.playing&&this._visible;a!==this._updating&&(this._updating=a,a?PIXI.ticker.shared.add(this.update,this):PIXI.ticker.shared.remove(this.update,this))},l.gotoAndStop=function(a){this.stop(),this._currentTime=0,this._animation=this._animations[a],this._animation||(this._animation=this._animations["default"]),this._texture=this._animation.frames[0].texture,this.anchor=this._animation.frames[0].anchor},l.gotoAndPlay=function(a){this._currentTime=0,this._animation=this._animations[a],this._animation||(this._animation=this._animations["default"]),this._texture=this._animation.frames[0].texture,this.anchor=this._animation.frames[0].anchor,this.play()},l.update=function(a){var b=null,c="",d=0;this._currentTime+=this.animationSpeed*this._animation.speed*a,d=Math.floor(this._currentTime),0>d&&(d=0),d<this._animation.frames.length?(b=this._animation.frames[d%this._animation.frames.length],this._texture=b.texture,this.anchor=b.anchor):d>=this._animation.frames.length&&(c=this._animation.id,this.gotoAndPlay(this._animation.next),this.onComplete&&this.onComplete(c))},l.destroy=function(){this.stop(),PIXI.Sprite.prototype.destroy.call(this),this.cacheId&&(b[this.cacheId].viable-=1,b[this.cacheId].viable<=0&&delete b[this.cacheId])}}(),function(){"use strict";var a=function(a){return function(){return platypus.game.settings.debug&&console.log('"'+a+'" is not an available PIXI.Graphics method.'),this}},b=PIXI.Graphics.prototype;b.a=b.arc,b.at=b.arcTo,b.bt=b.bezierCurveTo,b.c=b.clear,b.dc=b.drawCircle,b.de=b.drawEllipse,b.dr=b.drawRect,b.ef=b.endFill,b.f=b.beginFill,b.lt=b.lineTo,b.mt=b.moveTo,b.qt=b.quadraticCurveTo,b.r=b.drawRect,b.rr=b.drawRoundedRect,b.cp=a("cp"),b.lf=a("lf"),b.rf=a("rf"),b.bf=a("bf"),b.ss=a("ss"),b.sd=a("sd"),b.s=a("s"),b.ls=a("ls"),b.rs=a("rs"),b.bs=a("bs"),b.es=a("es"),b.rc=a("rc"),b.dp=a("dp"),b.p=a("p")}(),function(){"use strict";var a=PIXI.Container.prototype;a.updateTransform=function(){var a=0,b=0;if(this.visible)for(this.transformMatrix?(this.transformMatrix.copy(this.worldTransform).prepend(this.parent.worldTransform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null):this.displayObjectUpdateTransform(),a=0,b=this.children.length;b>a;++a)this.children[a].updateTransform()},a.containerUpdateTransform=a.updateTransform}(),function(){"use strict";var a=include("springroll.Application"),b=include("springroll.ApplicationPlugin"),c=null,d=new b,e=null,f=function(){var b=function(a,b){return Math.floor(204*a/b)},c=function(a,c){var d=0,e=0,f="color: #ffffff; padding:3px 0; border-radius: 6px;",g=0,h=0,i=0,j=null;return c&&(j=c.split(".")),c&&3===j.length?(g=parseInt(j[0],10),h=parseInt(j[1],10),i=parseInt(j[2],10)):(g=a.charCodeAt(0)||0,h=a.charCodeAt(1)||0,i=a.charCodeAt(2)||0,e=Math.min(g,h,i),g-=e,h-=e,i-=e),d=Math.max(g,h,i,1),f+" background: rgb("+b(g,d)+","+b(h,d)+","+b(i,d)+");"};return function(b,d){var e=d.options,f=e.author?"by "+e.author:"",g=d.name||document.title||"",h=a.version||"(?)",i="Platypus "+platypus.version,j="Pixi.js "+PIXI.VERSION,k="SpringRoll "+h,l=e.version||"(?)";e.hideHello||("(?)"!==l&&(g+=" "+l),platypus.supports.firefox||platypus.supports.chrome?console.log("\n%c "+g+" %c "+f+" \n\nUsing %c "+k+" %c %c "+j+" %c %c "+i+" %c\n\n",c(g,l),"",c(k,h),"",c(j,PIXI.VERSION),"",c(i,platypus.version),""):console.log('--- "'+g+'" '+f+" - Using "+k+", "+j+", and "+i+" ---")),b.debug&&console.log("Game config loaded.",b)}}(),g=function(a){var b=null,c=null,d=null,e={};for(b in a)if(a[b].id)e[b]=a[b];else{c=g(a[b]);for(d in c)e[d]=c[d]}return e};PIXI.utils._saidHello=!0,d.setup=function(){var a="",b=document.getElementsByName("author"),c=this.options;b.length&&(a=b[0].getAttribute("content")||""),c.add("author",a,!0),c.add("hideHello",!1,!0)},d.preload=function(a){var b=this.config.platypus||this.config,d=null,h={delta:0};b?(this.options.debug&&(b.debug=!0),f(b,this),b.entities=g(b.entities),d=this.platypus=new platypus.Game(b,this),c=function(a){h.delta=a,d.tick(h)},this.on("update",c,320),e=function(a){d.currentScene&&d.currentScene.triggerOnChildren("resize",a)},this.on("resize",e)):console.warn("PlatypusPlugin: Platypus requires a game configuration."),a()},d.teardown=function(){this.platypus&&(this.off("update",c),this.off("resize",e),this.platypus.destroy(),delete this.platypus)}}(),function(){"use strict";var a=include("platypus.Vector"),b=new a;return platypus.createComponentClass({id:"AIChaser",properties:{accelerate:!1,chasing:!0},publicProperties:{speed:.3},constructor:function(b){this.target=this.owner.target||null,this.offset=new a(0,0)},events:{load:function(){return this.owner.addMover?void(this.direction=this.owner.addMover({vector:[this.speed,0,0],event:"chase",accelerator:this.accelerate}).vector):void console.warn('The "AIChaser" component requires a "Mover" component to function correctly.')},"handle-ai":function(){var a=b,c=0,d=!1;this.target&&this.chasing&&(a.set(this.offset).add(this.target.position).subtractVector(this.owner.position),c=a.magnitude(2),c&&(d=!0,this.direction.set(a).normalize().multiply(this.speed))),d!==this.owner.state.chasing&&(this.owner.state.chasing=d,this.owner.triggerEvent("chase",d))},"set-target":function(a){this.target=a,this.offset.x=0,this.offset.y=0},"set-target-offset":function(a){this.offset.x=a.x,this.offset.y=a.y},"start-chasing":function(a){a&&(this.target=a),this.chasing=!0},"stop-chasing":function(){this.chasing=!1}},methods:{destroy:function(){this.target=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"AIPacer",properties:{movement:"both",direction:null},constructor:function(a){this.lastDirection="",this.currentDirection=this.direction||("horizontal"===this.movement?"left":"up")},events:{"handle-ai":function(){this.currentDirection!==this.lastDirection&&(this.lastDirection=this.currentDirection,this.owner.triggerEvent("stop"),this.owner.triggerEvent("go-"+this.currentDirection))},"turn-around":function(a){("both"===this.movement||"horizontal"===this.movement)&&(a.x>0?this.currentDirection="left":a.x<0&&(this.currentDirection="right")),("both"===this.movement||"vertical"===this.movement)&&(a.y>0?this.currentDirection="up":a.y<0&&(this.currentDirection="down"))}}})}(),function(){"use strict";var a=include("springroll.Application"),b=function(a){var b=a.split("/");return b=b[b.length-1].split("."),b[0]},c=function(a,c){var d=0,e=!1;for(a.id||(a.id=b(a.src)),d=0;d<c.length;d++)if(c[d].id===a.id){e=!0;break}e||c.push(a)};return platypus.createComponentClass({id:"AssetLoader",properties:{automatic:!0,assets:null,cache:!0},constructor:function(b){this.assets=this.assets||platypus.game.settings.assets||[],this.app=a.instance,this.sound=this.app.sound,this.owner.assets={},this.progress=0,this.total=0,this.assetInterface=null,platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" is using the AssetLoader component which has been deprecated in favor of Spring Roll preloading and scene-specific asset loading.')},events:{load:function(){this.automatic&&this.owner.triggerEvent("load-assets")},"load-assets":function(){var a=function(a,b){var c=null;b&&b.id?(c=this.owner.assets[b.id]={data:b,asset:a},this.cache&&(platypus.assets[b.id]=c)):(a=null,b=null),this.progress+=1,this.owner.trigger("file-load",{asset:a,complete:this.progress===this.total,data:b,fraction:this.progress/this.total,progress:this.progress,total:this.total}),this.progress===this.total&&this.owner.triggerEvent("complete")}.bind(this);this.assets&&this.assets.length?this.load(a):this.owner.triggerEvent("complete")}},methods:{destroy:function(){delete this.owner.assets},load:function(a){var b=0,d=[],e=this.sound;for(b=0;b<this.assets.length;b++)"string"==typeof this.assets[b]?c({src:this.assets[b]},d):"string"==typeof this.assets[b].src&&c(this.assets[b],d);if(platypus.assets=platypus.assets||{},this.total=d.length,e)for(b=d.length-1;b>=0;b--)e.exists(d[b].id)&&(e.preload(d[b].id,a),d.splice(b,1));d.length&&this.app.load(d,{taskDone:a})}}})}(),function(){"use strict";var a=include("springroll.Application"),b={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1,next:!1,events:!1},c=function(a,b){return a.time-b.time},d=function(){var b=a.instance.voPlayer;this.play=function(a,c){var d=c.complete;return b.play(a,function(){d(!1)},function(){d(!0)}),this},this.stop=this.pause=function(){b.stop()},this.unpause=function(){},Object.defineProperty(this,"position",{get:function(){return b.playing?b.getElapsed():0}})},e=function(){var b=a.instance.sound;this.play=function(a,c){return b.play(a,c)}},f=function(a){var d=0,e="",f="",g=null;if("string"==typeof a)e=a,g={};else if(Array.isArray(a)){if("string"==typeof a[0])e=a[0],g={next:[]};else{e=a[0].sound,g={};for(f in a[0])a[0].hasOwnProperty(f)&&(g[f]=a[0][f]);g.next?g.next=g.next.slice():g.next=[]}for(d=1;d<a.length;d++)g.next.push(a[d])}else e=a.sound,g={interrupt:a.interrupt,delay:a.delay,offset:a.offset,loop:a.loop,volume:a.volume,pan:a.pan,startTime:a.startTime,duration:a.duration,mute:a.mute,paused:a.paused,next:a.next,events:a.events};return function(a){var d=0,f=null,h=!1,i=!1;if(a=a||g,a.stop)this.stopAudio(e,a.playthrough);else if(h=a.next||g.next||b.next,i=a.events||g.events||b.events,f=this.player.play(e,{interrupt:a.interrupt||g.interrupt||b.interrupt,delay:a.delay||g.delay||b.delay,loop:a.loop||g.loop||b.loop,offset:a.offset||g.offset||b.offset,volume:"undefined"!=typeof a.volume?a.volume:"undefined"!=typeof g.volume?g.volume:b.volume,pan:a.pan||g.pan||b.pan,mute:a.mute||g.mute||b.mute,paused:a.paused||g.paused||b.paused,complete:function(a){f&&(a?this.onComplete(f):this.onComplete(f,h))}.bind(this)})){if(i){for(f.sequenceEvents=[],d=0;d<i.length;d++)f.sequenceEvents.push({event:i[d].event,time:i[d].time||0,message:i[d].message});f.sequenceEvents.sort(c)}f.soundId=e,this.activeAudioClips.push(f)}}},g=function(a,b,c){var d=a.replace(/ /g,"").split(",");return"default"===a?function(b){return c.call(this),a}:function(b){var e=0;for(e=0;e<d.length;e++)if(!b[d[e]])return!1;return c.call(this),a}};return platypus.createComponentClass({id:"Audio",properties:{audioMap:null,forcePlayThrough:!0,voiceOver:!1},constructor:function(a){var b="",c=null;if(this.activeAudioClips=[],this.state=this.owner.state,this.stateChange=!1,this.currentState=!1,this.voiceOver?this.player=new d:this.player=new e,a.audioMap){this.checkStates=[];for(b in a.audioMap)a.audioMap.hasOwnProperty(b)&&(c=f(a.audioMap[b]),this.addEventListener(b,c),this.checkStates.push(g(b,a.audioMap[b],c)))}platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" is using the Audio component which has been deprecated in favor of AudioSFX for sound effects and AudioVO for voice-over.'),this.paused=!1},events:{"handle-render":function(){var a=0,b=null;if(!this.paused&&(this.getAllClips(function(a){this.checkTimeEvents(a)}.bind(this)),this.stateChange)){if(this.checkStates)for(this.currentState&&this.stopAudio(this.currentState.soundId,this.forcePlaythrough),this.currentState=!1,a=0;a<this.checkStates.length;a++)if(b=this.checkStates[a].call(this,this.state)){this.currentState=b;break}this.stateChange=!1}},"state-changed":function(){this.stateChange=!0},"toggle-mute":function(a){this.handleClip(a,function(a){a&&(a.unmuted?(a.volume=a.unmuted,delete a.unmuted):(a.unmuted=a.volume,a.volume=0))})},"stop-audio":function(a){a?"string"==typeof a?this.stopAudio(a):this.stopAudio(a.audioId||!1,a.playthrough||!1):this.stopAudio()},"mute-audio":function(a){this.handleClip(a,function(a){a&&(a.unmuted=a.volume,a.volume=0)})},"unmute-audio":function(a){this.handleClip(a,function(a){a&&(a.volume=a.unmuted,delete a.unmuted)})},"pause-audio":function(a){this.handleClip(a,function(a){a&&a.pause()})},"unpause-audio":function(a){this.handleClip(a,function(a){a&&a.unpause()})},"set-volume":function(a){var b=0,c=function(a){a.volume=b};"number"==typeof a?(b=a,this.getAllClips(c)):a.volume&&(b=a.volume,this.handleClip(a.soundId,c))}},methods:{handleClip:function(a,b){"string"==typeof a?this.getClipById(a,b):this.getAllClips(b)},getClipById:function(a,b){var c=0,d=this.activeAudioClips;for(c=0;c<d.length;c++)if(d[c].soundId===a)return b&&b(d[c]),d[c];return b&&b(null),null},getAllClips:function(a){var b=0,c=this.activeAudioClips;if(a)for(b=0;b<c.length;b++)a(c[b]);return c},stopAudio:function(a,b){var c=0,d=this.activeAudioClips,e=function(a){this.stopAudioInstance(a.currentTarget)}.bind(this);if(a)for(c=d.length-1;c>=0;c--)d[c].soundId===a&&(b?d[c].addEventListener("loop",e):(d[c].stop(),d.splice(c,1)));else if(b)for(c=0;c<d.length;c++)d[c].addEventListener("loop",e);else{for(c=0;c<this.activeAudioClips.length;c++)d[c].stop();d.length=0}},stopAudioInstance:function(a){var b=0,c=this.activeAudioClips;for(b=c.length-1;b>=0;b--)c[b]===a&&(c[b].stop(),c.splice(b,1))},checkTimeEvents:function(a,b){var c=a.sequenceEvents,d=0;if(c&&c.length)for(d=a.position;c.length&&(b||c[0].time<=d);)this.owner.trigger(c[0].event,c[0].message),c.splice(0,1)},onComplete:function(a,b){if(this.removeClip(a),this.checkTimeEvents(a,!0),this.owner.triggerEvent("clip-complete"),b&&b.length)if("string"==typeof b)f(b).call(this);else{var c=b.slice();c.splice(0,1),c.length>0?f(b[0]).call(this,{next:c}):f(b[0]).call(this)}else this.owner.triggerEvent("sequence-complete")},removeClip:function(a){var b=0;for(b=0;b<this.activeAudioClips.length;b++)if(this.activeAudioClips[b]===a){this.activeAudioClips.splice(b,1);break}},destroy:function(){this.stopAudio()}}})}(),function(){"use strict";return platypus.createComponentClass({id:"AudioMobile",properties:{button:{}},constructor:function(a){platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" is using the AudioMobile component which has been deprecated.')},events:{complete:function(){platypus.supports.mobile?(this.owner.removeComponent("RenderSprite"),this.owner.removeComponent("RenderProgress"),this.owner.addComponent(new platypus.components.RenderSprite(this.owner,{image:this.button.image,spriteSheet:this.button.spriteSheet,acceptInput:{click:!0,touch:!0}})),this.owner.addComponent(new platypus.components.LogicCanvasButton(this.owner,{onRelease:"audio-ready"})),isNaN(this.button.x)||(this.owner.x=this.button.x),isNaN(this.button.y)||(this.owner.y=this.button.y),this.owner.parent.triggerEvent("child-entity-updated",this.owner)):this.owner.triggerEvent("audio-ready")}}})}(),function(){"use strict";var a=include("springroll.Application"),b={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:!1,paused:!1},c=function(a){var c="",d=null;return"string"==typeof a?(c=a,d={}):(c=a.sound,d={interrupt:a.interrupt,delay:a.delay,offset:a.offset,loop:a.loop,volume:a.volume,pan:a.pan,startTime:a.startTime,duration:a.duration,mute:a.mute,paused:a.paused}),function(a){var e=null;a=a||d,
e=this.player.play(c,{interrupt:a.interrupt||d.interrupt||b.interrupt,delay:a.delay||d.delay||b.delay,loop:a.loop||d.loop||b.loop,offset:a.offset||d.offset||b.offset,volume:"undefined"!=typeof a.volume?a.volume:"undefined"!=typeof d.volume?d.volume:b.volume,pan:a.pan||d.pan||b.pan,mute:a.mute||d.mute||b.mute,paused:a.paused||d.paused||b.paused,complete:function(a){e&&this.onComplete(e)}.bind(this)}),e&&(e.soundId=c,this.activeAudioClips.push(e))}},d=function(a,b,c){var d=a.replace(/ /g,"").split(",");return"default"===a?function(b){return c.call(this),a}:function(b){var e=0;for(e=0;e<d.length;e++)if(!b[d[e]])return!1;return c.call(this),a}};return platypus.createComponentClass({id:"AudioSFX",properties:{audioMap:null,forcePlayThrough:!0},constructor:function(b){var e="",f=null;if(this.activeAudioClips=[],this.state=this.owner.state,this.stateChange=!1,this.currentState=!1,this.player=a.instance.sound,b.audioMap){this.checkStates=[];for(e in b.audioMap)b.audioMap.hasOwnProperty(e)&&(f=c(b.audioMap[e]),this.addEventListener(e,f),this.checkStates.push(d(e,b.audioMap[e],f)))}this.paused=!1},events:{"handle-render":function(){var a=0,b=null;if(!this.paused&&this.stateChange){if(this.checkStates)for(this.currentState&&this.stopAudio(this.currentState.soundId,this.forcePlaythrough),this.currentState=!1,a=0;a<this.checkStates.length;a++)if(b=this.checkStates[a].call(this,this.state)){this.currentState=b;break}this.stateChange=!1}},"state-changed":function(){this.stateChange=!0},"toggle-mute":function(a){this.handleClip(a,function(a){a&&(a.unmuted?(a.volume=a.unmuted,delete a.unmuted):(a.unmuted=a.volume,a.volume=0))})},"stop-audio":function(a){a?"string"==typeof a?this.stopAudio(a):this.stopAudio(a.audioId||!1,a.playthrough||!1):this.stopAudio()},"mute-audio":function(a){this.handleClip(a,function(a){a&&(a.unmuted=a.volume,a.volume=0)})},"unmute-audio":function(a){this.handleClip(a,function(a){a&&(a.volume=a.unmuted,delete a.unmuted)})},"pause-audio":function(a){this.handleClip(a,function(a){a&&a.pause()})},"unpause-audio":function(a){this.handleClip(a,function(a){a&&a.unpause()})},"set-volume":function(a){var b=0,c=function(a){a.volume=b};"number"==typeof a?(b=a,this.getAllClips(c)):a.volume&&(b=a.volume,this.handleClip(a.soundId,c))}},methods:{handleClip:function(a,b){"string"==typeof a?this.getClipById(a,b):this.getAllClips(b)},getClipById:function(a,b){var c=0,d=this.activeAudioClips;for(c=0;c<d.length;c++)if(d[c].soundId===a)return b&&b(d[c]),d[c];return b&&b(null),null},getAllClips:function(a){var b=0,c=this.activeAudioClips;if(a)for(b=0;b<c.length;b++)a(c[b]);return c},stopAudio:function(a,b){var c=0,d=this.activeAudioClips,e=function(a){this.stopAudioInstance(a.currentTarget)}.bind(this);if(a)for(c=d.length-1;c>=0;c--)d[c].soundId===a&&(b?d[c].addEventListener("loop",e):(d[c].stop(),d.splice(c,1)));else if(b)for(c=0;c<d.length;c++)d[c].addEventListener("loop",e);else{for(c=0;c<this.activeAudioClips.length;c++)d[c].stop();d.length=0}},stopAudioInstance:function(a){var b=0,c=this.activeAudioClips;for(b=c.length-1;b>=0;b--)c[b]===a&&(c[b].stop(),c.splice(b,1))},onComplete:function(a){this.removeClip(a),this.owner.triggerEvent("clip-complete")},removeClip:function(a){var b=this.activeAudioClips.indexOf(a);b>=0&&this.activeAudioClips.splice(b,1)},destroy:function(){this.stopAudio()}}})}(),function(){"use strict";var a=include("springroll.Application"),b=function(a,b){return a.time-b.time},c=function(a,c,d){return function(){var e=0,f=d.getElapsed();for(e=0;e<a.length;e++)c.push({event:a[e].event,time:(a[e].time||0)+f,message:a[e].message||null});e&&c.sort(b)}},d=function(a,c){var d=0;for(d=0;d<a.length;d++)c.push({event:a[d].event,time:a[d].time||0,message:a[d].message});return d&&c.sort(b),c},e=function(a){var c=null,e=[],f=!1;return"string"==typeof a?c=a:Array.isArray(a)?(c=a,f=!0):(c=a.sound,a.events&&(e=a.events.slice(),e.sort(b)),Array.isArray(c)?(c=c,f=!0):c=a.sound),function(a){var b=null;this.eventList=e.slice(),a&&a.events&&d(a.events,this.eventList),b=f?this.setupEventList(c):c,this.playingAudio=!0,this.player.play(b,function(){this.playingAudio=!1,this.onComplete(!0)}.bind(this),function(){this.playingAudio=!1,this.onComplete(!1)}.bind(this))}};return platypus.createComponentClass({id:"AudioVO",properties:{audioMap:null},constructor:function(b){var c="";if(this.eventList=[],this.playingAudio=!1,this.player=a.instance.voPlayer,b.audioMap)for(c in b.audioMap)b.audioMap.hasOwnProperty(c)&&this.addEventListener(c,e(b.audioMap[c]));this.paused=!1},events:{"handle-render":function(){this.paused||this.checkTimeEvents(!1)},"stop-audio":function(){this.player.stop()}},methods:{checkTimeEvents:function(a){var b=this.eventList,c=0;if(b&&b.length)for(c=this.player.getElapsed();b.length&&(a||b[0].time<=c);)this.owner.trigger(b[0].event,b[0].message),b.splice(0,1)},setupEventList:function(a){var b=0,d=[];for(b=0;b<a.length;b++)a[b].sound?(a[b].events&&d.push(c(a[b].events,this.eventList,this.player)),d.push(a[b].sound)):d.push(a[b]);return d},onComplete:function(a){this.checkTimeEvents(!0),this.owner.triggerEvent("sequence-complete")},destroy:function(){this.playingAudio&&this.player.stop()}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.AABB"),c=include("platypus.Vector");return platypus.createComponentClass({id:"Camera",properties:{width:0,height:0,mode:"static",overflow:!1,stretch:!1,threshold:1,rotate:!1,x:0,y:0},publicProperties:{canvas:null,transitionX:400,transitionY:600,transitionAngle:600,worldWidth:0,worldHeight:0},constructor:function(c){this.viewport=new b(0,0,0,0),this.worldCamera={viewport:new b(this.x,this.y,this.width,this.height),orientation:c.orientation||0},this.message={viewport:new b,scaleX:0,scaleY:0,orientation:0,stationary:!1},this.worldIsLoaded=!1,this.following=void 0,this.state="static","pan"===this.mode&&(this.state="mouse-pan"),this.boundingBox=new b(this.worldCamera.viewport.x,this.worldCamera.viewport.y,this.worldCamera.viewport.width/2,this.worldCamera.viewport.height/2),this.lastX=this.worldCamera.viewport.x,this.lastY=this.worldCamera.viewport.y,this.lastOrientation=this.worldCamera.orientation,this.forwardX=0,this.forwardY=0,this.forwardAngle=0,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=0,this.offsetY=0,this.offsetAngle=0,this.forwardFollower={x:this.lastX,y:this.lastY,orientation:this.lastOrientation},this.lastFollow={entity:null,mode:null,offsetX:0,offsetY:0,begin:0},this.xMagnitude=0,this.yMagnitude=0,this.xWaveLength=0,this.yWaveLength=0,this.xShakeTime=0,this.yShakeTime=0,this.shakeTime=0,this.shakeIncrementor=0,this.direction=!0,this.stationary=!1,this.viewportUpdate=!1,this.owner.container?this.parentContainer=this.owner.container:this.owner.stage?(this.canvas=this.canvas||a.instance.display.canvas,this.parentContainer=this.owner.stage,this.owner.width=this.canvas.width,this.owner.height=this.canvas.height):console.warn("Camera: There appears to be no Container on this entity for the camera to display."),this.container=new PIXI.Container,this.matrix=this.container.transformMatrix=new PIXI.Matrix,this.parentContainer.addChild(this.container)},events:{load:function(){this.resize()},"render-world":function(a){this.world=a.world,this.world.transformMatrix=this.world.transformMatrix||new PIXI.Matrix,this.container.addChild(this.world)},"child-entity-added":function(a){this.viewportUpdate=!0,this.worldIsLoaded&&a.triggerEvent("camera-loaded",{worldWidth:this.worldWidth,worldHeight:this.worldHeight,viewport:this.message.viewport})},"child-entity-updated":function(a){this.viewportUpdate=!0,this.worldIsLoaded&&a.triggerEvent("camera-update",this.message)},"world-loaded":function(a){var b=this.message;this.worldIsLoaded=!0,this.worldWidth=a.width,this.worldHeight=a.height,a.camera&&this.follow(a.camera),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-loaded",{viewport:b.viewport.set(this.worldCamera.viewport),worldWidth:this.worldWidth,worldHeight:this.worldHeight})},mousedown:function(a){"mouse-pan"===this.state&&(this.mouseVector||(this.mouseVector=new c,this.mouseWorldOrigin=new c),this.mouse=this.mouseVector,this.mouse.x=a.event.x,this.mouse.y=a.event.y,this.mouseWorldOrigin.x=this.worldCamera.viewport.x,this.mouseWorldOrigin.y=this.worldCamera.viewport.y)},pressmove:function(a){this.mouse&&this.move(this.mouseWorldOrigin.x+(this.mouse.x-a.event.x)/this.world.transformMatrix.a,this.mouseWorldOrigin.y+(this.mouse.y-a.event.y)/this.world.transformMatrix.d)&&(this.viewportUpdate=!0)},pressup:function(a){this.mouse=null},tick:function(a){var b=this.message,c=b.viewport,d=null;"following"===this.state&&this.followingFunction(this.following,a.delta)&&(this.viewportUpdate=!0),this.canvas&&(this.owner.width=this.canvas.width,this.owner.height=this.canvas.height),(this.owner.width!==this.lastWidth||this.owner.height!==this.lastHeight)&&(this.resize(),this.lastWidth=this.owner.width,this.lastHeight=this.owner.height),this.viewportUpdate?(this.viewportUpdate=!1,this.stationary=!1,b.stationary=!1,c.set(this.worldCamera.viewport),this.shakeIncrementor<this.shakeTime&&(this.viewportUpdate=!0,this.shakeIncrementor+=a.delta,this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime),this.shakeIncrementor<this.xShakeTime&&c.moveX(c.x+Math.sin(this.shakeIncrementor/this.xWaveLength*2*Math.PI)*this.xMagnitude),this.shakeIncrementor<this.yShakeTime&&c.moveY(c.y+Math.sin(this.shakeIncrementor/this.yWaveLength*2*Math.PI)*this.yMagnitude)),b.scaleX=this.windowPerWorldUnitWidth,b.scaleY=this.windowPerWorldUnitHeight,b.orientation=this.worldCamera.orientation,d=this.world.transformMatrix,d.a=b.scaleX,d.b=0,d.c=0,d.d=b.scaleY,b.orientation&&d.rotate(b.orientation),d.tx=(c.halfWidth-c.x)*b.scaleX,d.ty=(c.halfHeight-c.y)*b.scaleY,this.owner.trigger("camera-update",b),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",b)):this.stationary||(this.stationary=!0,b.stationary=!0,this.owner.trigger("camera-update",b),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("camera-update",b),this.owner.trigger("camera-stationary",b)),this.lastFollow.begin&&this.lastFollow.begin<Date.now()&&this.follow(this.lastFollow)},"resize-camera":function(a){this.worldCamera.viewport.resize(a.width,a.height),this.resize()},relocate:function(a){var b=null,d=function(){this.move(b.x,b.y)&&(this.viewportUpdate=!0)}.bind(this);a.time&&window.createjs&&createjs.Tween?(b=new c(this.worldCamera.viewport.x,this.worldCamera.viewport.y),createjs.Tween.get(b).to({x:a.x,y:a.y},a.time,a.ease).on("change",d)):this.move(a.x,a.y)&&(this.viewportUpdate=!0)},follow:function(a){this.follow(a)},shake:function(a){var b=a||{},c=b.xMagnitude||0,d=b.yMagnitude||0,e=b.xFrequency||0,f=b.yFrequency||0,g=b.time||0;this.viewportUpdate=!0,this.shakeIncrementor=0,this.xMagnitude=c,this.yMagnitude=d,0===e?(this.xWaveLength=1,this.xShakeTime=0):(this.xWaveLength=1e3/e,this.xShakeTime=Math.ceil(g/this.xWaveLength)*this.xWaveLength),0===f?(this.yWaveLength=1,this.yShakeTime=0):(this.yWaveLength=1e3/f,this.yShakeTime=Math.ceil(g/this.yWaveLength)*this.yWaveLength),this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function(a){switch(a.time?(this.lastFollow.begin||(this.lastFollow.entity=this.following,this.lastFollow.mode=this.mode,this.lastFollow.offsetX=this.offsetX,this.lastFollow.offsetY=this.offsetY),this.lastFollow.begin=Date.now()+a.time):this.lastFollow.begin&&(this.lastFollow.begin=0),this.mode=a.mode,a.mode){case"locked":this.state="following",this.following=a.entity,this.followingFunction=this.lockedFollow,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0;break;case"forward":this.state="following",this.followFocused=!1,this.following=a.entity,this.lastX=a.entity.x-a.offsetX||0,this.lastY=a.entity.y-a.offsetY||0,this.lastOrientation=a.entity.orientation||0,this.forwardX=a.movementX||this.transitionX/10,this.forwardY=a.movementY||this.transitionY/10,this.averageOffsetX=0,this.averageOffsetY=0,this.averageOffsetAngle=0,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following",this.following=a.entity,this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.offsetAngle=a.offsetAngle||0,this.boundingBox.setAll(a.x,a.y,a.width,a.height),this.followingFunction=this.boundingFollow;break;case"pan":this.state="mouse-pan",this.following=void 0,this.followingFunction=void 0,a&&"number"==typeof a.x&&"number"==typeof a.y&&(this.move(a.x,a.y,a.orientation||0),this.viewportUpdate=!0);break;default:this.state="static",this.following=void 0,this.followingFunction=void 0,a&&"number"==typeof a.x&&"number"==typeof a.y&&(this.move(a.x,a.y,a.orientation||0),this.viewportUpdate=!0)}a.begin&&(a.begin=0)},move:function(a,b,c){var d=this.moveX(a);return d=this.moveY(b)||d,this.rotate&&(d=this.reorient(c||0)||d),d},moveX:function(a){var b=this.worldCamera.viewport;return Math.abs(b.x-a)>this.threshold?(this.worldWidth&&0!==this.worldWidth&&this.worldWidth<b.width?b.moveX(this.worldWidth/2):this.worldWidth&&0!==this.worldWidth&&a+b.halfWidth>this.worldWidth?b.moveX(this.worldWidth-b.halfWidth):this.worldWidth&&0!==this.worldWidth&&a<b.halfWidth?b.moveX(b.halfWidth):b.moveX(a),!0):!1},moveY:function(a){var b=this.worldCamera.viewport;return Math.abs(b.y-a)>this.threshold?(this.worldHeight&&0!==this.worldHeight&&this.worldHeight<b.height?b.moveY(this.worldHeight/2):this.worldHeight&&0!==this.worldHeight&&a+b.halfHeight>this.worldHeight?b.moveY(this.worldHeight-b.halfHeight):this.worldHeight&&0!==this.worldHeight&&a<b.halfHeight?b.moveY(b.halfHeight):b.moveY(a),!0):!1},reorient:function(a){return Math.abs(this.worldCamera.orientation-a)>1e-4?(this.worldCamera.orientation=a,!0):!1},lockedFollow:function(){var a=Math.min,b=function(a,b,c){return c*b+(1-c)*a},c=function(b,c){return b?a(c/b,1):1};return function(a,d,e){var f=b(this.worldCamera.viewport.x,a.x,c(this.transitionX,d)),g=b(this.worldCamera.viewport.y,a.y,c(this.transitionY,d));return this.rotate?this.move(f,g,b(this.worldCamera.orientation,-(a.orientation||0),c(this.transitionAngle,d))):this.move(f,g,0)}}(),forwardFollow:function(a,b){var c=this.forwardFollower,d=15/b,e=!1,f=a.x+this.offsetX,g=a.y+this.offsetY,h=(a.orientation||0)+this.offsetAngle;return this.followFocused&&this.lastX===f&&this.lastY===g?this.lockedFollow(c,b):(this.averageOffsetX*=.9,this.averageOffsetY*=.9,this.averageOffsetX+=.1*(f-this.lastX)*d,this.averageOffsetY+=.1*(g-this.lastY)*d,Math.abs(this.averageOffsetX)>this.worldCamera.viewport.width/(2*this.forwardX)&&(this.averageOffsetX=0),Math.abs(this.averageOffsetY)>this.worldCamera.viewport.height/(2*this.forwardY)&&(this.averageOffsetY=0),this.rotate&&(this.averageOffsetAngle*=.9,this.averageOffsetAngle+=.1*(h-this.lastOrientation)*d,Math.abs(this.averageOffsetAngle)>this.worldCamera.orientation/(2*this.forwardAngle)&&(this.averageOffsetAngle=0)),c.x=this.averageOffsetX*this.forwardX+f,c.y=this.averageOffsetY*this.forwardY+g,c.orientation=this.averageOffsetAngle*this.forwardAngle+h,this.lastX=f,this.lastY=g,this.lastOrientation=h,e=this.lockedFollow(c,b),this.followFocused||e||(this.followFocused=!0),e)},boundingFollow:function(a,b){var c=0,d=0,e=this.transitionX?Math.min(b/this.transitionX,1):1,f=1-e,g=this.transitionY?Math.min(b/this.transitionY,1):1,h=1-g;return this.boundingBox.move(this.worldCamera.viewport.x,this.worldCamera.viewport.y),a.x>this.boundingBox.right?c=a.x-this.boundingBox.halfWidth:a.x<this.boundingBox.left&&(c=a.x+this.boundingBox.halfWidth),a.y>this.boundingBox.bottom?d=a.y-this.boundingBox.halfHeight:a.y<this.boundingBox.top&&(d=a.y+this.boundingBox.halfHeight),0!==c&&(c=this.moveX(e*c+f*this.worldCamera.viewport.x)),0!==d&&(d=this.moveY(g*d+h*this.worldCamera.viewport.y)),c||d},resize:function(){var a=this.width/this.height,b=this.owner.width/this.owner.height;this.viewport.setAll(this.owner.width/2,this.owner.height/2,this.owner.width,this.owner.height),this.stretch||(b>a?this.overflow?this.worldCamera.viewport.resize(this.height*b,this.height):this.viewport.resize(this.viewport.height*a,this.viewport.height):this.overflow?this.worldCamera.viewport.resize(this.width,this.width/b):this.viewport.resize(this.viewport.width,this.viewport.width/a)),this.worldPerWindowUnitWidth=this.worldCamera.viewport.width/this.viewport.width,this.worldPerWindowUnitHeight=this.worldCamera.viewport.height/this.viewport.height,this.windowPerWorldUnitWidth=this.viewport.width/this.worldCamera.viewport.width,this.windowPerWorldUnitHeight=this.viewport.height/this.worldCamera.viewport.height,this.matrix.tx=this.viewport.x-this.viewport.halfWidth,this.matrix.ty=this.viewport.y-this.viewport.halfHeight,this.viewportUpdate=!0},destroy:function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"CameraFollowMe",properties:{camera:{},mode:"forward",pause:!1},constructor:function(a){this.pauseGame=this.pause&&this.camera.time?{time:this.camera.time}:null,this.camera={entity:this.owner,mode:this.camera.mode||this.mode,top:this.camera.top,left:this.camera.left,offsetX:this.camera.offsetX,offsetY:this.camera.offsetY,width:this.camera.width,height:this.camera.height,time:this.camera.time}},events:{"follow-me":function(a){var b=this.camera;a&&(b={entity:this.owner,mode:a.mode||this.camera.mode,top:a.top||this.camera.top,left:a.left||this.camera.left,offsetX:a.offsetX||this.camera.offsetX,offsetY:a.offsetY||this.camera.offsetY,width:a.width||this.camera.width,height:a.height||this.camera.height,time:a.time||this.camera.time}),this.pauseGame&&(this.owner.parent.trigger("pause-logic",this.pauseGame),this.owner.parent.trigger("pause-render",this.pauseGame)),this.owner.parent.trigger("follow",b)}}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.CollisionShape"),c=include("platypus.Vector"),d=function(a,b,d){var e=0,f=b.stuck;f&&(e=a.magnitude(),b.thatShape.owner&&Math.abs(f)>1&&(f*=.05),(!e||e>Math.abs(f))&&(b.vector.x&&(a.x=f,a.y=0),b.vector.y&&(a.x=0,a.y=f),d.stuckWith=new c(b.thatShape.x,b.thatShape.y)))},e=function(a,b,c){return"string"==typeof a?function(d){d.myType===c&&d.hitType===b&&this.owner.triggerEvent(a,d)}:Array.isArray(a)?function(d){var e=0;if(d.myType===c&&d.hitType===b)for(e=0;e<a.length;e++)this.owner.triggerEvent(a[e],d)}:function(d){var e=d.x,f=d.y;!d.entity||e||f||(e=d.entity.x-this.owner.x,f=d.entity.y-this.owner.y),d.myType===c&&d.hitType===b&&(f>0&&a.bottom&&this.owner.trigger(a.bottom,d),0>f&&a.top&&this.owner.trigger(a.top,d),e>0&&a.right&&this.owner.trigger(a.right,d),0>e&&a.left&&this.owner.trigger(a.left,d),a.all&&this.owner.trigger(a.all,d))}},f=function(b,e){e.collisionFunctions||(e.collisionFunctions={},e.getAABB=function(b){var c=null,d="";if(b)return e.collisionFunctions[b]?e.collisionFunctions[b].getAABB():null;c=e.aabb=e.aabb||new a,c.reset();for(d in e.collisionFunctions)e.collisionFunctions.hasOwnProperty(d)&&c.include(e.collisionFunctions[d].getAABB());return c},e.getPreviousAABB=function(a){return e.collisionFunctions[a]?e.collisionFunctions[a].getPreviousAABB():null},e.getShapes=function(a){return e.collisionFunctions[a]?e.collisionFunctions[a].getShapes():null},e.getPrevShapes=function(a){return e.collisionFunctions[a]?e.collisionFunctions[a].getPrevShapes():null},e.prepareCollision=function(a,b){var c="";for(c in e.collisionFunctions)e.collisionFunctions.hasOwnProperty(c)&&e.collisionFunctions[c].prepareCollision(a,b)},e.relocateEntity=function(a,b){var f=null;b.xCount&&(f=new c(0,0,0),d(f,b.getXEntry(0),e)),b.yCount&&(f=f||new c(0,0,0),d(f,b.getYEntry(0),e)),e.triggerEvent("relocate-entity",{position:a,unstick:f})},e.movePreviousX=function(a){var b="";for(b in e.collisionFunctions)e.collisionFunctions.hasOwnProperty(b)&&e.collisionFunctions[b].movePreviousX(a)},e.getCollisionTypes=function(){return e.collisionTypes},e.getSolidCollisions=function(){return e.solidCollisionMap}),e.collisionFunctions[b.collisionType]={getAABB:function(){return b.getAABB()},getPreviousAABB:function(){return b.getPreviousAABB()},getShapes:function(){return b.getShapes()},getPrevShapes:function(){return b.getPrevShapes()},prepareCollision:function(a,c){b.prepareCollision(a,c)},movePreviousX:function(a){b.movePreviousX(a)}}};return platypus.createComponentClass({id:"CollisionBasic",properties:{collisionType:"none",shapeType:"rectangle",ignoreOrientation:!1,regX:null,regY:null,width:0,height:0,radius:0,softCollisions:null,solidCollisions:null,margin:0,shapes:null},publicProperties:{immobile:!1,bullet:!1,jumpThrough:!1},constructor:function(d){var g=0,h="",i=null,j=this.regX,k=this.regY,l=this.width,m=this.height,n=this.radius,o=0,p=0,q=0,r=0;for("number"==typeof this.margin?(o=this.margin,p=this.margin,q=this.margin,r=this.margin):(o=this.margin.left||0,p=this.margin.right||0,q=this.margin.top||0,r=this.margin.bottom||0),null===j&&(j=this.regX=l/2),null===k&&(k=this.regY=m/2),c.assign(this.owner,"position","x","y","z"),c.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.aabb=new a,this.prevAABB=new a,this.shapes?i=this.shapes:"circle"===this.shapeType?(n=n||((l||0)+(m||0))/4,i=[{regX:(isNaN(j)?n:j)-(p-o)/2,regY:(isNaN(k)?n:k)-(r-q)/2,radius:n,type:this.shapeType}]):i=[{regX:(isNaN(j)?(l||0)/2:j)+o,regY:(isNaN(k)?(m||0)/2:k)+q,points:d.points,width:(l||0)+o+p,height:(m||0)+q+r,type:this.shapeType}],this.owner.collisionTypes=this.owner.collisionTypes||[],this.owner.collisionTypes.push(this.collisionType),this.shapes=[],this.prevShapes=[],this.entities=void 0,g=0;g<i.length;g++)this.shapes.push(new b(this.owner,i[g],this.collisionType)),this.prevShapes.push(new b(this.owner,i[g],this.collisionType)),this.prevAABB.include(this.prevShapes[g].getAABB()),this.aabb.include(this.shapes[g].getAABB());if(f(this,this.owner),this.owner.solidCollisionMap=this.owner.solidCollisionMap||{},this.owner.solidCollisionMap[this.collisionType]=[],this.solidCollisions)for(h in this.solidCollisions)this.solidCollisions.hasOwnProperty(h)&&(this.owner.solidCollisionMap[this.collisionType].push(h),this.owner.collides=!0,this.solidCollisions[h]&&this.addEventListener("hit-by-"+h,e(this.solidCollisions[h],"solid",this.collisionType)));if(this.owner.softCollisionMap=this.owner.softCollisionMap||{},this.owner.softCollisionMap[this.collisionType]=[],this.softCollisions)for(h in this.softCollisions)this.softCollisions.hasOwnProperty(h)&&(this.owner.softCollisionMap[this.collisionType].push(h),this.softCollisions[h]&&this.addEventListener("hit-by-"+h,e(this.softCollisions[h],"soft",this.collisionType)));this.stuck=!1},events:{"collide-on":function(a){a&&a!==this.collisionType||(this.owner.collisionTypes.union([this.collisionType]),this.owner.parent.trigger("add-collision-entity",this.owner),this.active=!0)},"collide-off":function(a){var b=0;a&&a!==this.collisionType||(this.owner.parent.trigger("remove-collision-entity",this.owner),b=this.owner.collisionTypes.indexOf(this.collisionType),b>=0&&this.owner.collisionTypes.splice(b,1),this.active=!1),this.owner.collisionTypes.length&&this.owner.parent.trigger("add-collision-entity",this.owner)},"relocate-entity":function(a){var b=a.unstick,c=0,d=0;for(b&&(c=b.magnitude()),this.move=null,a.relative?this.owner.position.set(this.owner.previousPosition).add(a.position):this.owner.position.set(a.position),this.stuck&&(c>0?this.owner.position.add(b):this.stuck=!1),this.aabb.reset(),d=0;d<this.shapes.length;d++)this.shapes[d].update(this.owner.x,this.owner.y),this.aabb.include(this.shapes[d].getAABB());this.owner.previousPosition.set(this.owner.position),c>0&&(this.stuck||(this.stuck=!0),this.move=this.owner.stuckWith.copy().add(-this.owner.x,-this.owner.y).normalize())},"handle-logic":function(){this.move&&this.owner.position.add(this.move),this.owner.checkCollision=!0},"orientation-updated":function(a){var b=0;if(!this.ignoreOrientation)for(b=0;b<this.shapes.length;b++)this.shapes[b].multiply(a)}},methods:{getAABB:function(){return this.aabb},getPreviousAABB:function(){return this.prevAABB},getShapes:function(){return this.shapes},getPrevShapes:function(){return this.prevShapes},prepareCollision:function(a,b){var c=0,d=this.prevShapes;for(this.owner.x=a,this.owner.y=b,this.prevShapes=this.shapes,this.shapes=d,this.prevAABB.set(this.aabb),this.aabb.reset(),c=0;c<this.shapes.length;c++)this.shapes[c].update(this.owner.x,this.owner.y),this.aabb.include(this.shapes[c].getAABB())},movePreviousX:function(a){var b=0;for(this.prevAABB.moveX(a),b=0;b<this.prevShapes.length;b++)this.prevShapes[b].setXWithEntityX(a)},destroy:function(){var a=this.owner.collisionTypes.indexOf(this.collisionType);this.owner.parent.trigger("remove-collision-entity",this.owner),this.owner.collides=!1,delete this.aabb,delete this.prevAABB,a>=0&&this.owner.collisionTypes.splice(a,1),this.owner.solidCollisionMap[this.collisionType]&&(this.owner.solidCollisionMap[this.collisionType].length=0,delete this.owner.solidCollisionMap[this.collisionType]),Object.keys(this.owner.solidCollisionMap).length>0&&(this.owner.collides=!0),this.owner.softCollisionMap[this.collisionType]&&(this.owner.softCollisionMap[this.collisionType].length=0,delete this.owner.softCollisionMap[this.collisionType]),delete this.owner.collisionFunctions[this.collisionType],this.shapes.length=0,this.prevShapes.length=0,delete this.entities,this.owner.collisionTypes.length&&this.owner.parent.trigger("add-collision-entity",this.owner)}}})}(),function(){"use strict";var a=function(a,b,c){return function(d){a.state[b]&&a.trigger(c,d)}},b=function(a,b,c){return function(d){a.state[b]||a.trigger(c,d)}};return platypus.createComponentClass({id:"CollisionFilter",properties:{collisions:{},state:""},constructor:function(c){var d="",e=this.collisions,f=this.state;if(e)if("!"===f[0]){f=f.substring(1);for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,b(this.owner,f,e[d]))}else for(d in e)e.hasOwnProperty(d)&&this.addEventListener(d,a(this.owner,f,e[d]))}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.Vector");return platypus.createComponentClass({id:"CollisionGroup",constructor:function(c){this.solidEntities=[],this.terrain=void 0,this.aabb=new a(this.owner.x,this.owner.y),this.prevAABB=new a(this.owner.x,this.owner.y),b.assign(this.owner,"position","x","y","z"),b.assign(this.owner,"previousPosition","previousX","previousY","previousZ"),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.collisionGroup=this.owner.collisionGroup={getAllEntities:function(){var a=0,b=0,c=null;for(a=0;a<this.solidEntities.length;a++)c=this.solidEntities[a],b+=c!==this.owner&&c.collisionGroup?c.collisionGroup.getAllEntities():1;return b}.bind(this),getSize:function(){return this.solidEntities.length}.bind(this),getCollisionTypes:function(){return this.getCollisionTypes()}.bind(this),getSolidCollisions:function(){return this.getSolidCollisions()}.bind(this),getAABB:function(a){return this.getAABB(a)}.bind(this),getPreviousAABB:function(a){return this.getPreviousAABB(a)}.bind(this),getShapes:function(a){return this.getShapes(a)}.bind(this),getPrevShapes:function(a){return this.getPrevShapes(a)}.bind(this),prepareCollision:function(a,b){return this.prepareCollision(a,b)}.bind(this),relocateEntity:function(a,b){return this.relocateEntity(a,b)}.bind(this),movePreviousX:function(a){return this.movePreviousX(a)}.bind(this),getSolidEntities:function(){return this.solidEntities}.bind(this),jumpThrough:!1}},events:{"child-entity-added":function(a){this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"relocate-entity":function(){this.owner.previousPosition.set(this.owner.position),this.updateAABB()}},methods:{addCollisionEntity:function(a){var b=0,c=a.collisionTypes;if(c){for(b=0;b<c.length;b++)a.solidCollisionMap[c[b]].length&&!a.immobile&&(this.solidEntities[this.solidEntities.length]=a);this.updateAABB()}},removeCollisionEntity:function(a){var b=0,c=0,d=a.collisionTypes;if(d){for(c=0;c<d.length;c++)a.solidCollisionMap[d[c]].length&&(b=this.solidEntities.indexOf(a),b>=0&&this.solidEntities.splice(b,1));this.updateAABB()}},getCollisionTypes:function(){var a=0,b=null,c=[];for(a=0;a<this.solidEntities.length;a++)b=this.solidEntities[a],b!==this.owner&&b.collisionGroup&&(b=b.collisionGroup),c.union(b.getCollisionTypes());return c},getSolidCollisions:function(){var a=0,b="",c=null,d={},e=null;for(a=0;a<this.solidEntities.length;a++){c=this.solidEntities[a],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),e=c.getSolidCollisions();for(b in e)e.hasOwnProperty(b)&&(d[b]||(d[b]=[]),d[b].union(e[b]))}return d},getAABB:function(b){var c=0,d=null,e=null;if(b){for(d=new a,c=0;c<this.solidEntities.length;c++)e=this.solidEntities[c],e!==this.owner&&e.collisionGroup&&(e=e.collisionGroup),d.include(e.getAABB(b));return d}return this.aabb},getPreviousAABB:function(b){var c=0,d=null,e=null;if(b){for(d=new a,c=0;c<this.solidEntities.length;c++)e=this.solidEntities[c],e!==this.owner&&e.collisionGroup&&(e=e.collisionGroup),d.include(e.getPreviousAABB(b));return d}return this.prevAABB},updateAABB:function(){var a=0;for(this.aabb.reset(),a=0;a<this.solidEntities.length;a++)this.aabb.include(this.solidEntities[a]!==this.owner&&this.solidEntities[a].getCollisionGroupAABB?this.solidEntities[a].getCollisionGroupAABB():this.solidEntities[a].getAABB())},getShapes:function(a){var b=0,c=null,d=[],e=null;for(b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),e=c.getShapes(a),e&&(d=d.concat(e));return d},getPrevShapes:function(a){var b=0,c=null,d=null,e=[];for(b=0;b<this.solidEntities.length;b++)c=this.solidEntities[b],c!==this.owner&&c.collisionGroup&&(c=c.collisionGroup),d=c.getPrevShapes(a),d&&(e=e.concat(d));return e},prepareCollision:function(a,b){var c=0,d=null,e=0,f=0;for(c=0;c<this.solidEntities.length;c++)d=this.solidEntities[c],d.saveDX=d.x-d.previousX,d.saveDY=d.y-d.previousY,e=d.saveOX=this.owner.previousX-d.previousX,f=d.saveOY=this.owner.previousY-d.previousY,d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),d.prepareCollision(a-e,b-f)},movePreviousX:function(a){var b=null,c=0,d=0;for(d=0;d<this.solidEntities.length;d++)b=this.solidEntities[d],c=b.saveOX,b!==this.owner&&b.collisionGroup&&(b=b.collisionGroup),b.movePreviousX(a-c)},relocateEntity:function(a,c){var d=null,e=null,f=0;for(this.owner.saveDX-=a.x-this.owner.previousX,this.owner.saveDY-=a.y-this.owner.previousY,f=0;f<c.xCount;f++)if(c.getXEntry(f).thisShape.owner===this.owner){this.owner.saveDX=0;break}for(f=0;f<c.yCount;f++)if(c.getYEntry(f).thisShape.owner===this.owner){this.owner.saveDY=0;break}for(f=0;f<this.solidEntities.length;f++)d=e=this.solidEntities[f],d!==this.owner&&d.collisionGroup&&(d=d.collisionGroup),d.relocateEntity(new b(a.x-e.saveOX,a.y-e.saveOY,d.z),c),e.x+=e.saveDX,e.y+=e.saveDY,e!==this.owner&&(e.x+=this.owner.saveDX,e.y+=this.owner.saveDY)},destroy:function(){this.solidEntities.length=0}},publicMethods:{getCollisionGroupAABB:function(){return this.getAABB()},getWorldEntities:function(){return this.owner.parent.getWorldEntities()},getWorldTerrain:function(){return this.owner.parent.getWorldTerrain()}}})}(),function(){"use strict";var a=[],b=0,c=[],d=function(a,b){return-1>a?(a=Math.abs(a)-2,b[a]):a},e=function(a,b,c,d,e){var f=0,g=0,h=[];for(g=0;e>g;g++)for(h[g]=[],f=0;d>f;f++)h[g][f]=a[b+f][c+g];return h},f=function(a,b,c,d,e){var f=0,g=0,h=[];for(g=0;e>g;g++)for(h[g]=[],
f=0;d>f;f++)h[g][f]=a[b+f][c+g],a[b+f][c+g]=-1;return h},g=function(a,b,c,d,e,f){var g=0,h=0;for(h=0;f>h;h++)for(g=0;e>g;g++)a[c+g][d+h]=b[h][g];return a},h={diagonal:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-5,-4,-3,-2];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+i][c+j]=d(h[i][j],k);return a},"diagonal-inverse":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-3,-2,-5,-4];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+g-j-1]=d(h[i][j],k);return a},horizontal:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-2,-5,-4,-3];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+j]=d(h[j][i],k);return a},vertical:function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-4,-3,-2,-5];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+i][c+g-j-1]=d(h[j][i],k);return a},"rotate-90":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-3,-4,-5,-2];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+g-j-1][c+i]=d(h[j][i],k);return a},"rotate-180":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-4,-5,-2,-3];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+f-i-1][c+g-j-1]=d(h[j][i],k);return a},"rotate-270":function(a,b,c,f,g){var h=e(a,b,c,f,g),i=0,j=0,k=[-5,-2,-3,-4];for(j=0;g>j;j++)for(i=0;f>i;i++)a[b+j][c+f-i-1]=d(h[j][i],k);return a},translate:function(a,b,c,d,e,g,h){var i=f(a,b,c,d,e),j=0,k=0;for(k=0;e>k;k++)for(j=0;d>j;j++)a[b+j+g][c+k+h]=i[k][j];return a}};return platypus.createComponentClass({id:"CollisionTiles",publicProperties:{collisionMap:[],tileWidth:10,tileHeight:10},constructor:function(a){this.tileHalfWidth=this.tileWidth/2,this.tileHalfHeight=this.tileHeight/2},events:{transform:function(a){this.transform(a)},translate:function(a){this.translate(a)}},methods:{getShape:function(c,d,e){var f=null;return b<a.length?(f=a[b],f.update(d*this.tileWidth+this.tileHalfWidth,e*this.tileHeight+this.tileHalfHeight)):(a.push(new platypus.CollisionShape(null,{x:d*this.tileWidth+this.tileHalfWidth,y:e*this.tileHeight+this.tileHalfHeight,type:"rectangle",width:this.tileWidth,height:this.tileHeight},"tiles")),f=a[b]),b+=1,f},addShape:function(a,b,c,d){if(this.collisionMap[c][d]>-1)a.push(this.getShape(b,c,d));else if(this.collisionMap[c][d]<-1)switch(this.collisionMap[c][d]){case-2:b.bottom<=d*this.tileHeight&&a.push(this.getShape(b,c,d));break;case-3:b.left>=(c+1)*this.tileWidth&&a.push(this.getShape(b,c,d));break;case-4:b.top>=(d+1)*this.tileHeight&&a.push(this.getShape(b,c,d));break;case-5:b.right<=c*this.tileWidth&&a.push(this.getShape(b,c,d))}return a}},publicMethods:{getAABB:function(){return{left:0,top:0,right:this.tileWidth*this.collisionMap.length,bottom:this.tileHeight*this.collisionMap.length[0]}},isTile:function(a,b){return!(0>a||0>b||a>=this.collisionMap.length||b>=this.collisionMap[0].length||-1===this.collisionMap[a][b])},getTileShapes:function(a,d){var e=Math.max(Math.floor(a.left/this.tileWidth),0),f=Math.max(Math.floor(a.top/this.tileHeight),0),g=Math.min(Math.ceil(a.right/this.tileWidth),this.collisionMap.length),h=Math.min(Math.ceil(a.bottom/this.tileHeight),this.collisionMap[0].length),i=0,j=0,k=c;for(c.length=0,b=0,i=e;g>i;i++)for(j=f;h>j;j++)this.addShape(k,d,i,j);return k},transform:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.collisionMap[0].length,f=b.height||this.collisionMap.length,g=b.type||"horizontal";return h[g]?h[g](this.collisionMap,c,d,e,f):null},translate:function(a){var b=a||{},c=b.left||0,d=b.top||0,e=b.width||this.collisionMap[0].length,f=b.height||this.collisionMap.length,g=b.dx||0,i=b.dy||0;return h.translate(this.collisionMap,c,d,e,f,g,i)},getCollisionMatrix:function(a,b,c,d){return e(this.collisionMap,a,b,c,d)},setCollisionMatrix:function(a,b,c,d,e){return g(this.collisionMap,a,b,c,d,e)}}})}(),function(){"use strict";var a=function(a){this.switches.push(a)};return platypus.createComponentClass({id:"ComponentSwitcher",properties:{componentMap:null},constructor:function(b){var c="";if(this.switches=[],this.componentMap)for(c in this.componentMap)this.componentMap.hasOwnProperty(c)&&this.addEventListener(c,a.bind(this,c))},events:{"prepare-logic":function(){var a=0;if(this.switches.length){for(a=0;a<this.switches.length;a++)this.switchComponents(this.componentMap[this.switches[a]]);this.switches.length=0}}},methods:{switchComponents:function(a){var b=0,c=0,d=this.owner,e=d.components,f=a.remove,g=a.add;if(f)if(Array.isArray(f))for(b=0;b<f.length;b++)for(c=e.length-1;c>-1;c--)e[c].type===f[b]&&d.removeComponent(e[c]);else for(b=e.length-1;b>-1;b--)e[b].type===f&&d.removeComponent(e[b]);if(g)if(Array.isArray(g))for(b=0;b<g.length;b++)d.addComponent(new platypus.components[g[b].type](d,g[b]));else d.addComponent(new platypus.components[g.type](d,g));d.parent&&d.parent.triggerEvent("child-entity-updated",d),d.triggerEvent("add-remove-component-complete")}},getAssetList:function(a,b,c){var d=a.componentMap||b.componentMap||c.componentMap,e="",f=0,g=null,h=[];for(e in d)if(d.hasOwnProperty(e))for(f=0;f<d[e].add.length;f++)g=platypus.components[d[e].add[f].type],g&&h.union(g.getAssetList(d[e].add[f],b,c));return h}})}(),function(){"use strict";return platypus.createComponentClass({id:"Counter",publicProperties:{total:0},constructor:function(a){this.count=0,this.lastTotal=0,this.lastCount=0},events:{"handle-logic":function(){var a="",b=!1;this.total!==this.lastTotal&&(this.lastTotal=this.total,b=!0),this.count!==this.lastCount&&(this.lastCount=this.count,b=!0),b&&(a=this.total?String(this.count)+"/"+String(this.total):String(this.count),this.owner.triggerEvent("update-content",{text:a}))},"change-total":function(a){this.total=a},"change-count":function(a){this.count=a},"increment-count":function(){this.count+=1}}})}(),function(){"use strict";var a=include("platypus.Entity"),b=function(a){return function(b,c){this.triggerOnChildren(a,b,c)}};return platypus.createComponentClass({id:"EntityContainer",properties:{childEvents:[]},constructor:function(a){var b=0,c=this.childEvents;for(this.entityDefinitions=null,a.entities&&this.owner.entities?this.entityDefinitions=a.entities.concat(this.owner.entities):this.entityDefinitions=a.entities||this.owner.entities||null,this.owner.entities=this.entities=[],this.childEvents=[],b=0;b<c.length;b++)this.addNewPublicEvent(c[b]);this.addNewPrivateEvent("peer-entity-added"),this.addNewPrivateEvent("peer-entity-removed")},events:{load:function(){var a=0,b=this.entityDefinitions;if(b)for(a=0;a<b.length;a++)this.addEntity(b[a]);delete this.entityDefinitions},"add-entity":function(a){this.addEntity(a)},"remove-entity":function(a){this.removeEntity(a)},"child-entity-updated":function(a){this.updateChildEventListeners(a)}},methods:{addNewPublicEvent:function(a){var c=0;for(this.addNewPrivateEvent(a),c=0;c<this.childEvents.length;c++)if(this.childEvents[c]===a)return!1;this.childEvents.push(a),this.addEventListener(a,b(a))},addNewPrivateEvent:function(a){var b=0,c=0;if(this._listeners[a])return!1;for(this._listeners[a]=[],b=0;b<this.entities.length;b++)if(this.entities[b]._listeners[a])for(c=0;c<this.entities[b]._listeners[a].length;c++)this.addChildEventListener(this.entities[b],a,this.entities[b]._listeners[a][c])},updateChildEventListeners:function(a){this.removeChildEventListeners(a),this.addChildEventListeners(a)},addChildEventListeners:function(a){var b=0,c="";for(c in this._listeners)if(this._listeners.hasOwnProperty(c)&&a._listeners[c])for(b=0;b<a._listeners[c].length;b++)this.addChildEventListener(a,c,a._listeners[c][b])},removeChildEventListeners:function(a){var b=0,c=null,d=null;if(a.containerListener){for(c=a.containerListener.events,d=a.containerListener.messages,b=0;b<c.length;b++)this.removeChildEventListener(a,c[b],d[b]);a.containerListener=null}},addChildEventListener:function(a,b,c){a.containerListener||(a.containerListener={events:[],messages:[]}),a.containerListener.events.push(b),a.containerListener.messages.push(c),this.on(b,c)},removeChildEventListener:function(a,b,c){var d=0,e=a.containerListener.events,f=a.containerListener.messages;for(d=0;d<e.length;d++)e[d]!==b||c&&f[d]!==c||this.off(b,f[d])},destroy:function(){var a=0;for(a=0;a<this.entities.length;a++)this.removeChildEventListeners(this.entities[a]),this.entities[a].destroy();this.entities.length=0}},publicMethods:{getEntityById:function(a){var b=0,c=null;for(b=0;b<this.entities.length;b++){if(this.entities[b].id===a)return this.entities[b];if(this.entities[b].getEntityById&&(c=this.entities[b].getEntityById(a)))return c}return void 0},getEntitiesByType:function(a){var b=0,c=null,d=[];for(b=0;b<this.entities.length;b++)this.entities[b].type===a&&d.push(this.entities[b]),this.entities[b].getEntitiesByType&&(c=this.entities[b].getEntitiesByType(a),c&&(d=d.concat(c)));return d},addEntity:function(b){var c=null,d=0;for(b instanceof a?c=b:(c="string"==typeof b?new a(platypus.game.settings.entities[b]):b.id?new a(b):new a(platypus.game.settings.entities[b.type],b),this.owner.triggerEvent("entity-created",c)),c.parent=this.owner,c.triggerEvent("adopted",c),d=0;d<this.entities.length&&c.triggerEvent("peer-entity-added",this.entities[d]);d++);return this.triggerEventOnChildren("peer-entity-added",c),this.addChildEventListeners(c),this.entities.push(c),this.owner.triggerEvent("child-entity-added",c),c},removeEntity:function(a){var b=0;for(b=0;b<this.entities.length;b++)if(this.entities[b]===a)return this.removeChildEventListeners(a),this.entities.splice(b,1),this.triggerEventOnChildren("peer-entity-removed",a),this.owner.triggerEvent("child-entity-removed",a),a.destroy(),a.parent=null,a;return!1},triggerEventOnChildren:function(a,b,c){return this._listeners[a]||this.addNewPrivateEvent(a),this.triggerEvent(a,b,c)},triggerOnChildren:function(a,b,c){return this._listeners[a]||this.addNewPrivateEvent(a),this.trigger(a,b,c)}},getAssetList:function(b,c,d){var e=0,f=[],g=[];for(b.entities&&(g=g.concat(b.entities)),c&&c.entities?g=g.concat(c.entities):d&&d.entities&&(g=g.concat(d.entities)),e=0;e<g.length;e++)f.union(a.getAssetList(g[e]));return f}},platypus.Messenger)}(),function(){"use strict";var a=include("platypus.ActionState"),b=[],c=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},d=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=0,g=2*Math.PI;return c?(f=Math.acos(d/c),0>e&&(f=g-f),f):f},e=[null,null,null,null,["east","south","west","north"],null,null,null,["east","southeast","south","southwest","west","northwest","north","northeast"],null,null,null,null,null,null,null,["east","east-southeast","southeast","south-southeast","south","south-southwest","southwest","west-southwest","west","west-northwest","northwest","north-northwest","north","north-northeast","northeast","east-northeast"]],f=["left-button","middle-button","right-button"],g=function(a){var b=a.split(","),c=0,d={},e="";for(c=0;c<b.length;c++)e=b[c],e&&("!"===e.substring(0,1)?d[e.substring(1)]=!1:d[e]=!0);return d},h=function(a,b){this.paused||this.owner.trigger(a,b)},i=function(a,b,c){!this.paused&&c[a]&&this.owner.trigger(b,c)};return platypus.createComponentClass({id:"EntityController",properties:{controlMap:{},stateMaps:{}},publicProperties:{paused:!1},constructor:function(a){var b="";if(this.actions={},this.maps={},this.stateMaps)for(b in this.stateMaps)this.stateMaps.hasOwnProperty(b)&&this.addMap(this.stateMaps[b],g(b));this.addMap(this.controlMap),a.joystick&&(this.joystick={},this.joystick.directions=a.joystick.directions||4,this.joystick.handleEdge=a.joystick.handleEdge||!1,this.joystick.innerRadius=a.joystick.innerRadius||0,this.joystick.outerRadius=a.joystick.outerRadius||1/0)},events:{"handle-controller":function(){var a=0,c="",d=b;if(d.length=0,this.actions)for(c in this.actions)this.actions.hasOwnProperty(c)&&this.actions[c].update(this.owner.state)&&d.push(this.actions[c]);for(a=0;a<d.length;a++)d[a].resolve()},mousedown:function(a){this.owner.trigger("mouse:"+f[a.event.button||0]+":down",a.event),this.joystick&&(this.owner.trigger("joystick:down",a.event),this.handleJoy(a))},pressup:function(a){this.owner.trigger("mouse:"+f[a.event.button||0]+":up",a.event),this.joystick&&(this.owner.trigger("joystick:up",a.event),this.handleJoy(a))},pressmove:function(a){this.joystick&&this.handleJoy(a)},"pause-controls":function(){this.paused=!0},"unpause-controls":function(){this.paused=!1}},methods:{handleJoy:function(a){var b=Math.PI/(this.joystick.directions/2),f=c(this.owner,a),g=0,h="",i="";f>this.joystick.outerRadius||f<this.joystick.innerRadius||this.paused||(g=d(this.owner,a,f),h=e[this.joystick.directions][Math.floor((g+b/2)%(2*Math.PI)/b)],this.joystick.handleEdge&&(b=Math.PI/this.joystick.directions,i=e[2*this.joystick.directions][Math.floor((g+b/2)%(2*Math.PI)/b)],i!==h&&this.owner.trigger(i.replace(h,"").replace("-",""),a)),this.owner.trigger(h,a),this.owner.trigger("joystick-orientation",g))},addController:function(){var b=function(a){this.inputs[a]=!1},c=function(a){this.inputs[a]=!0};return function(d,e,f,g,j){var k=this.actions,l=e+"-"+f+"-"+(j||"all"),m=k[l];m||(m=j?k[l]=new a(f,g,i.bind(this,j)):k[l]=new a(f,g,h.bind(this))),this.addEventListener(d+":up",b.bind(m,m.inputs.length)),this.addEventListener(d+":down",c.bind(m,m.inputs.length)),m.inputs.push(!1)}}(),addMap:function(a,b){var c=null,d=0,e="",f="",g=JSON.stringify(b)||"default";for(f in a)if(a.hasOwnProperty(f))if(c=a[f],"string"==typeof c)this.addController(f,g,c,b);else if(Array.isArray(c))for(d=0;d<c.length;d++)this.addController(f,g,c[d],b);else for(e in c)if(c.hasOwnProperty(e))if("string"==typeof c[e])this.addController(f,g,c[e],b,e);else for(d=0;d<c[e].length;d++)this.addController(f,g,c[e][d],b,e)}}})}(),function(){"use strict";var a=include("platypus.CollisionDataContainer"),b=new a,c={entity:null,type:null,x:0,y:0,hitType:null,myType:null},d=function(a,b){return a.collisionGroup.getAllEntities()-b.collisionGroup.getAllEntities()},e=function(a,b){return!(a.left>=b.right||a.right<=b.left||a.top>=b.bottom||a.bottom<=b.top)},f=function(a,b){var c=0,d=0,e=null,f=null,g=0,h=0,i=null,j=0;if("rectangle"===a.type&&"rectangle"===b.type)return!0;if("circle"===a.type&&"circle"===b.type){if(c=Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2),d=Math.pow(a.radius+b.radius,2),d>=c)return!0}else if("circle"===a.type&&"rectangle"===b.type||"rectangle"===a.type&&"circle"===b.type){if("circle"===a.type?(e=a,f=b):(e=b,f=a),i=f.getAABB(),g=Math.abs(e.x-f.x),h=Math.abs(e.y-f.y),g>=i.halfWidth+e.radius)return!1;if(h>=i.halfHeight+e.radius)return!1;if(g<i.halfWidth)return!0;if(h<i.halfHeight)return!0;if(j=Math.pow(g-i.halfWidth,2)+Math.pow(h-i.halfHeight,2),j<Math.pow(e.radius,2))return!0}return!1};return platypus.createComponentClass({id:"HandlerCollision",constructor:function(a){this.entitiesByType={},this.entitiesByTypeLive={},this.allEntities=[],this.solidEntitiesLive=[],this.softEntitiesLive=[],this.allEntitiesLive=[],this.groupsLive=[],this.nonColliders=[],this.terrain=void 0,this.aabb=new platypus.AABB(this.owner.x,this.owner.y),this.prevAABB=new platypus.AABB(this.owner.x,this.owner.y),this.owner.previousX=this.owner.previousX||this.owner.x,this.owner.previousY=this.owner.previousY||this.owner.y,this.updateLiveList=!0,this.cameraLogicAABB=new platypus.AABB(0,0),this.cameraCollisionAABB=new platypus.AABB(0,0),this.timeElapsed={name:"Col",time:0}},events:{"child-entity-added":function(a){a.collideOff||this.addCollisionEntity(a)},"add-collision-entity":function(a){this.addCollisionEntity(a)},"child-entity-removed":function(a){this.removeCollisionEntity(a)},"remove-collision-entity":function(a){this.removeCollisionEntity(a)},"child-entity-updated":function(a){this.removeCollisionEntity(a),this.addCollisionEntity(a)},"check-collision-group":function(a){a.camera?this.checkCamera(a.camera):this.updateLists(),this.prepareCollisions(a),this.checkGroupCollisions(),this.checkSolidCollisions(),this.resolveNonCollisions(),this.checkSoftCollisions(a)}},methods:{addCollisionEntity:function(a){var b=0,c=a.collisionTypes;if("tile-layer"===a.type||"collision-layer"===a.type)this.terrain=a,this.updateLiveList=!0;else if(c){for(b=0;b<c.length;b++)this.entitiesByType[c[b]]||(this.entitiesByType[c[b]]=[],this.entitiesByTypeLive[c[b]]=[]),this.entitiesByType[c[b]][this.entitiesByType[c[b]].length]=a;a.immobile||(this.allEntities[this.allEntities.length]=a),this.updateLiveList=!0}},removeCollisionEntity:function(a){var b=0,c=0,d=a.collisionTypes;if(d){for(c=0;c<d.length;c++)b=this.entitiesByType[d[c]].indexOf(a),b>=0&&this.entitiesByType[d[c]].splice(b,1);a.immobile||(c=this.allEntities.indexOf(a),c>=0&&this.allEntities.splice(c,1)),this.updateLiveList=!0}},checkCamera:function(a,b){var c=0,f=0,g="",h=0,i=null,j=null,k=null,l=null,m=null,n=a.width,o=a.height,p=a.left+n/2,q=a.top+o/2,r=a.buffer,s=null,t=null,u=e,v=this.cameraLogicAABB,w=this.cameraCollisionAABB,x=null;if(n+=2*r,o+=2*r,this.updateLiveList||!v.matches(p,q,n,o)){for(v.setAll(p,q,n,o),this.updateLiveList=!1,j=this.allEntitiesLive,j.length=0,l=this.solidEntitiesLive,l.length=0,k=this.softEntitiesLive,k.length=0,m=this.groupsLive,m.length=0,h=this.allEntities.length,c=0;h>c;c++)if(t=this.allEntities[c],t.alwaysOn||t.checkCollision||u(t.getAABB(),v)){if(t.checkCollision=!1,j[j.length]=t,x=t.collisionTypes,t!==this.owner)for(f=0;f<x.length;f++)if(t.solidCollisionMap[x[f]].length){l[l.length]=t;break}for(f=0;f<x.length;f++)if(t.softCollisionMap[x[f]].length){k[k.length]=t;break}t.collisionGroup&&m.push(t)}m.sort(d),w.setAll(p,q,n+2*r,o+2*r);for(g in this.entitiesByType)if(this.entitiesByType.hasOwnProperty(g))for(s=this.entitiesByType[g],i=this.entitiesByTypeLive[g],i.length=0,h=s.length,f=0;h>f;f++)t=s[f],(t.alwaysOn||u(t.getAABB(),w))&&(i[i.length]=t)}},updateLists:function(){var a=0,b=0,c="",e=0,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null;if(this.updateLiveList){for(this.updateLiveList=!1,g=this.allEntitiesLive,g.length=0,i=this.solidEntitiesLive,i.length=0,h=this.softEntitiesLive,h.length=0,j=this.groupsLive,j.length=0,e=this.allEntities.length,a=0;e>a;a++){if(l=this.allEntities[a],l.checkCollision=!1,g[g.length]=l,m=l.collisionTypes,l!==this.owner)for(b=0;b<m.length;b++)if(l.solidCollisionMap[m[b]].length){i[i.length]=l;break}for(b=0;b<m.length;b++)if(l.softCollisionMap[m[b]].length){h[h.length]=l;break}l.collisionGroup&&j.push(l)}j.sort(d);for(c in this.entitiesByType)if(this.entitiesByType.hasOwnProperty(c))for(k=this.entitiesByType[c],f=this.entitiesByTypeLive[c],f.length=0,e=k.length,b=0;e>b;b++)l=k[b],f[f.length]=l}},prepareCollisions:function(a){var b=0,c=null;for(this.nonColliders.length=0,b=this.allEntitiesLive.length-1;b>-1;b--)c=this.allEntitiesLive[b],c.triggerEvent("prepare-for-collision",a),c.collides||this.nonColliders.push(c)},resolveNonCollisions:function(){var a=0,b=null,c={position:new platypus.Vector,relative:!1};for(a=this.nonColliders.length-1;a>-1;a--)b=this.nonColliders[a],c.position.set(b.position),b.trigger("relocate-entity",c)},checkGroupCollisions:function(){var a=function(a,b,d,e,f,g,h,i){c.entity=b,c.myType=d,c.type=e,c.x=f,c.y=g,c.direction=i,c.hitType=h,a.triggerEvent("hit-by-"+e,c),b&&(c.entity=a,c.type=d,c.myType=e,c.x=-f,c.y=-g,c.direction=i.getInverse(),c.hitType=h,b.triggerEvent("hit-by-"+d,c))};return function(){var c=0,d=0,e=this.groupsLive,f=new platypus.Vector,g=null;for(c=e.length-1;c>-1;c--)if(e[c].collisionGroup.getSize()>1){for(b.reset(),f.set(0,0,0),f=this.checkSolidEntityCollision(e[c],e[c].collisionGroup,b,f),d=0;d<b.xCount;d++)g=b.getXEntry(d),a(g.thisShape.owner,g.thatShape.owner,g.thisShape.collisionType,g.thatShape.collisionType,g.direction,0,"solid",g.vector);for(d=0;d<b.yCount;d++)g=b.getYEntry(d),a(g.thisShape.owner,g.thatShape.owner,g.thisShape.collisionType,g.thatShape.collisionType,0,g.direction,"solid",g.vector)}}}(),checkSolidCollisions:function(){var a=function(a,b,d,e,f,g,h,i){c.entity=b,c.myType=d,c.type=e,c.x=f,c.y=g,c.direction=i,c.hitType=h,a.triggerEvent("hit-by-"+e,c),b&&(c.entity=a,c.type=d,c.myType=e,c.x=-f,c.y=-g,c.direction=i.getInverse(),c.hitType=h,b.triggerEvent("hit-by-"+d,c))};return function(){var c=0,d=0,e=null,f=this.solidEntitiesLive,g=new platypus.Vector;for(c=f.length-1;c>-1;c--){for(b.reset(),g.set(0,0,0),g=this.checkSolidEntityCollision(f[c],f[c],b,g),d=0;d<b.xCount;d++)e=b.getXEntry(d),a(e.thisShape.owner,e.thatShape.owner,e.thisShape.collisionType,e.thatShape.collisionType,e.direction,0,"solid",e.vector);for(d=0;d<b.yCount;d++)e=b.getYEntry(d),a(e.thisShape.owner,e.thatShape.owner,e.thisShape.collisionType,e.thatShape.collisionType,0,e.direction,"solid",e.vector)}}}(),checkSolidEntityCollision:function(a,b,c,d){var e=0,f=0,g=0,h=d,i=a.x-a.previousX,j=a.y-a.previousY,k=null,l=0,m=0,n=1/0,o=1/0,p=b.getCollisionTypes(),q=!1;if(b.getSolidEntities&&(q=b.getSolidEntities()),h.set(a.position),i||j){if(a.bullet){for(g=0;g<p.length;g++)k=b.getAABB(p[g]),n=Math.min(n,k.width),o=Math.min(o,k.height);e=Math.ceil(Math.max(Math.abs(i)/n,Math.abs(j)/o)),e=Math.min(e,100),l=i/e,m=j/e}else e=1,l=i,m=j;for(f=0;e>f;f++){if(b.prepareCollision(a.previousX+l,a.previousY+m),h.set(a.position),h=this.processCollisionStep(a,b,q,c,h,l,m,p),h.x===a.previousX&&h.y===a.previousY){b.relocateEntity(h,c);break}b.relocateEntity(h,c)}}return h},processCollisionStep:function(){var a=new platypus.AABB,b=function(a,b,c,d,e){var f=0,g=c.getAABB(d);if(c===a)return!1;if(c.jumpThrough&&b.bottom>g.top)return!1;if(a.jumpThrough&&g.bottom>b.top)return!1;if(e)for(f=0;f<e.length;f++)if(c===e[f])return!1;return!0};return function(c,d,f,g,h,i,j,k){var l=0,m=0,n=0,o=0,p=!1,q=[],r=null,s=null,t=null,u=null,v="",w=null,x=this.getWorldEntities(),y=null,z=this.getWorldTerrain(),A=d.getSolidCollisions();for(l=0;l<k.length;l++)for(q[l]=[],t=k[l],r=d.getPreviousAABB(t),s=d.getAABB(t),a.reset(),a.include(s),a.include(r),m=0;m<A[t].length;m++)if(v=A[t][m],x[v]){for(y=x[v],n=0;n<y.length;n++)if(u=y[n],b(c,r,u,v,f)&&e(a,u.getAABB(v))){for(w=u.getShapes(v),o=0;o<w.length;o++)q[l].push(w[o]);p=!0}}else if(z&&"tiles"===v)for(w=z.getTileShapes(a,r),o=0;o<w.length;o++)q[l].push(w[o]),p=!0;return p&&(h=this.resolveCollisionPosition(c,d,h,q,g,k,i,j)),h}}(),resolveCollisionPosition:function(){var a=new platypus.CollisionData;return function(b,c,d,e,f,g,h,i){var j=0;if(0!==h)for(j=0;j<g.length;j++)a.clear(),a=this.findMinAxisMovement(b,c,g[j],"x",e[j],a),a.occurred&&f.tryToAddX(a);if(f.xCount>0?(a.copy(f.getXEntry(0)),d.x=b.previousX+a.deltaMovement*a.direction):d.x=b.x,c.movePreviousX(d.x),0!==i)for(j=0;j<g.length;j++)a.clear(),a=this.findMinAxisMovement(b,c,g[j],"y",e[j],a),a.occurred&&f.tryToAddY(a);return f.yCount>0?(a.copy(f.getYEntry(0)),d.y=b.previousY+a.deltaMovement*a.direction):d.y=b.y,d}}(),findMinAxisMovement:function(){var a=new platypus.CollisionData;return function(b,c,d,e,f,g){var h=0,i=c.getShapes(d),j=c.getPrevShapes(d);for(h=0;h<i.length;h++)a.clear(),a=this.findMinShapeMovementCollision(j[h],i[h],e,f,a),a.occurred&&!g.occurred?g.copy(a):a.occurred&&g.occurred&&a.deltaMovement<g.deltaMovement&&g.copy(a);return g}}(),findMinShapeMovementCollision:function(){var a=function(a,b,c,d,e,f,g){a.occurred=!0,a.direction=b,a.position=c,a.deltaMovement=Math.abs(c-d),a.aABB=f.getAABB(),a.thisShape=e,a.thatShape=f,a.vector=g.copy()},b=function(){var a=new platypus.Vector,b={position:0,contactVector:a},c=function(a,b){return Math.sqrt(Math.pow(b,2)-Math.pow(a,2))},d=function(a,b,c){var d=a-b;return d-d/Math.abs(d)*c},e=function(a,b,c){return"x"===a?c.halfWidth+b.halfWidth:"y"===a?c.halfHeight+b.halfHeight:void 0},f=function(b,e,f,g,h){var i=0;return"x"===b?e.y>=f.aABB.top&&e.y<=f.aABB.bottom?f.aABB.halfWidth+e.radius:(a.y=d(e.y,f.y,f.aABB.halfHeight),i=f.aABB.halfWidth+c(a.y,e.radius),g===e?(a.x=-d(e.x-h*i,f.x,f.aABB.halfWidth)/2,a.y=-a.y):a.x=d(e.x,f.x-h*i,f.aABB.halfWidth)/2,a.normalize(),i):"y"===b?e.x>=f.aABB.left&&e.x<=f.aABB.right?f.aABB.halfHeight+e.radius:(a.x=d(e.x,f.x,f.aABB.halfWidth),i=f.aABB.halfHeight+c(a.x,e.radius),g===e?(a.x=-a.x,a.y=-d(e.y-h*i,f.y,f.aABB.halfWidth)/2):a.y=d(e.y,f.y-h*i,f.aABB.halfWidth)/2,a.normalize(),i):void 0},g=function(a,b,d){return"x"===a?c(b.y-d.y,b.radius+d.radius):"y"===a?c(b.x-d.x,b.radius+d.radius):void 0};return function(c,d,h,i){if("rectangle"===h.type){if("rectangle"===i.type)return b.position=i[c]-d*e(c,h.getAABB(),i.getAABB()),a.x=0,a.y=0,a[c]=d,b;if("circle"===i.type)return a.x=0,a.y=0,a[c]=d,b.position=i[c]-d*f(c,i,h,h,d),b}else if("circle"===h.type){if("rectangle"===i.type)return a.x=0,a.y=0,a[c]=d,b.position=i[c]-d*f(c,h,i,h,d),b;if("circle"===i.type)return b.position=i[c]-d*g(c,h,i),a.x=i.x-h.x,a.y=i.y-h.y,a[c]=i[c]-b.position,a.normalize(),b}}}();return function(c,d,g,h,i){var j=0,k=c[g],l=d[g],m=c,n=l>k?1:-1,o=l,p=null,q=l;if(k!==l)for("x"===g?m.moveX(l):"y"===g&&m.moveY(l),j=0;j<h.length;j++)o=l,e(m.getAABB(),h[j].getAABB())&&f(m,h[j])&&(p=b(g,n,m,h[j]),o=p.position,n>0?q>o&&(k>o&&(o=k),q=o,a(i,n,q,k,d,h[j],p.contactVector)):o>q&&(o>k&&(o=k),q=o,a(i,n,q,k,d,h[j],p.contactVector)));return i}}(),checkSoftCollisions:function(a){var b=0,c=function(a){return function(b){a.trigger("hit-by-"+b.type,b)}};for(b=0;b<this.softEntitiesLive.length;b++)this.checkEntityForSoftCollisions(this.softEntitiesLive[b],this.getWorldEntities(),c(this.softEntitiesLive[b]))},checkEntityForSoftCollisions:function(a,b,d){var g=null,h=c,i=0,j=0,k=0,l=0,m=0,n=e,o=null,p=null,q=null,r=null,s=null,t=!1;for(h.x=0,h.y=0,i=0;i<a.collisionTypes.length;i++)for(o=a.softCollisionMap[a.collisionTypes[i]],l=0;l<o.length;l++)if(q=o[l],p=b[q])for(m=0;m<p.length;m++)if(t=!1,g=p[m],g!==a&&n(a.getAABB(a.collisionTypes[i]),g.getAABB(q)))for(r=a.getShapes(a.collisionTypes[i]),s=g.getShapes(q),j=0;j<r.length;j++){for(k=0;k<s.length&&(f(r[j],s[k])&&(h.entity=g,h.type=q,h.myType=a.collisionTypes[i],h.shape=s[k],h.hitType="soft",d(h),t=!0),!t);k++);if(t)break}},destroy:function(){var a="";this.allEntities.length=0,this.allEntitiesLive.length=0,this.softEntitiesLive.length=0,this.solidEntitiesLive.length=0;for(a in this.entitiesByType)this.entitiesByType.hasOwnProperty(a)&&(this.entitiesByType[a].length=0)}},publicMethods:{getWorldEntities:function(){return this.entitiesByTypeLive},getWorldTerrain:function(){return this.terrain},getEntityCollisions:function(a,b){var c=[];return this.checkEntityForSoftCollisions(a,b||this.entitiesByTypeLive,function(a){var b="",d={};for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);c.push(d)}),c}}})}(),function(){"use strict";var a={kc0:"unknown",kc8:"backspace",kc9:"tab",kc12:"numpad-5-shift",kc13:"enter",kc16:"shift",kc17:"ctrl",kc18:"alt",kc19:"pause",kc20:"caps-lock",kc27:"esc",kc32:"space",kc33:"page-up",kc34:"page-down",kc35:"end",kc36:"home",kc37:"left-arrow",kc38:"up-arrow",kc39:"right-arrow",kc40:"down-arrow",kc42:"numpad-multiply",kc43:"numpad-add",kc44:"print-screen",kc45:"insert",kc46:"delete",kc47:"numpad-division",kc48:"0",kc49:"1",kc50:"2",kc51:"3",kc52:"4",kc53:"5",kc54:"6",kc55:"7",kc56:"8",kc57:"9",kc59:"semicolon",kc61:"equals",kc65:"a",kc66:"b",kc67:"c",kc68:"d",kc69:"e",kc70:"f",kc71:"g",kc72:"h",kc73:"i",kc74:"j",kc75:"k",kc76:"l",kc77:"m",kc78:"n",kc79:"o",kc80:"p",kc81:"q",kc82:"r",kc83:"s",kc84:"t",kc85:"u",kc86:"v",kc87:"w",kc88:"x",kc89:"y",kc90:"z",kc91:"left-windows-start",kc92:"right-windows-start",kc93:"windows-menu",kc96:"back-quote",kc106:"numpad-multiply",kc107:"numpad-add",kc109:"numpad-minus",kc110:"numpad-period",kc111:"numpad-division",kc112:"f1",kc113:"f2",kc114:"f3",kc115:"f4",kc116:"f5",kc117:"f6",kc118:"f7",kc119:"f8",kc120:"f9",kc121:"f10",kc122:"f11",kc123:"f12",kc144:"num-lock",kc145:"scroll-lock",kc186:"semicolon",kc187:"equals",kc188:"comma",kc189:"hyphen",kc190:"period",kc191:"forward-slash",kc192:"back-quote",kc219:"open-bracket",kc220:"back-slash",kc221:"close-bracket",kc222:"quote"};return platypus.createComponentClass({id:"HandlerController",constructor:function(a){this.callbackKeyUp=null,this.callbackKeyDown=null,platypus.game.settings.debug?(this.callbackKeyDown=function(a){this.keyDown(a)}.bind(this),this.callbackKeyUp=function(a){this.keyUp(a)}.bind(this)):(this.callbackKeyDown=function(a){this.keyDown(a),a.preventDefault()}.bind(this),this.callbackKeyUp=function(a){this.keyUp(a),a.preventDefault()}.bind(this)),window.addEventListener("keydown",this.callbackKeyDown,!0),window.addEventListener("keyup",this.callbackKeyUp,!0)},events:{tick:function(a){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-controller",a)}},methods:{keyDown:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":down",b)},keyUp:function(b){this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("key:"+(a["kc"+b.keyCode]||"key-code-"+b.keyCode)+":up",b)},destroy:function(){window.removeEventListener("keydown",this.callbackKeyDown),window.removeEventListener("keyup",this.callbackKeyUp)}}})}(),function(){"use strict";var a=function(a,b){var c=0;for(b.length=0,c=a.length-1;c>-1;c--)b.push(a[c])},b=function(a,b,c){var d=0,e=null;for(b.length=0,d=a.length-1;d>-1;d--)e=a[d],(e.alwaysOn||"undefined"==typeof e.x||e.x>=c.left-c.buffer&&e.x<=c.left+c.width+c.buffer&&e.y>=c.top-c.buffer&&e.y<=c.top+c.height+c.buffer)&&b.push(e)},c=function(a){var b=null,c=!1;for(b in a.state)a.state[b]!==a.lastState[b]&&(a.lastState[b]=a.state[b],c=!0);return c};return platypus.createComponentClass({id:"HandlerLogic",properties:{alwaysOn:!1},publicProperties:{buffer:-1,stepLength:5,maxStepsPerTick:100,timeMultiplier:1},constructor:function(c){this.entities=[],this.activeEntities=[],this.alwaysOn?(this.updateList=a,this.camera=null):(this.updateList=b,this.camera={left:0,top:0,width:0,height:0,buffer:this.buffer,active:!1}),this.paused=0,this.leftoverTime=0,this.message={delta:this.stepLength,tick:null,camera:this.camera,movers:this.activeEntities}},events:{"child-entity-added":function(a){var b=0,c=a.getMessageIds();for(b=0;b<c.length;b++)if("handle-logic"===c[b]||"handle-post-collision-logic"===c[b]){this.entities.push(a);break}},"child-entity-removed":function(a){var b=this.entities.indexOf(a);b>=0&&this.entities.splice(b,1)},"pause-logic":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-logic":function(){this.paused=0},"camera-update":function(a){this.camera&&(this.camera.left=a.viewport.left,this.camera.top=a.viewport.top,this.camera.width=a.viewport.width,this.camera.height=a.viewport.height,-1===this.camera.buffer&&(this.camera.buffer=this.camera.width/10),this.camera.active=!0)},tick:function(a){var b=0,d=0,e=0,f=null;for(this.leftoverTime+=a.delta*this.timeMultiplier,e=Math.floor(this.leftoverTime/this.stepLength)||1,this.message.delta=this.stepLength,this.leftoverTime=Math.max(this.leftoverTime-e*this.stepLength,0),this.message.tick=a,this.updateList(this.entities,this.activeEntities,this.camera),e=Math.min(e,this.maxStepsPerTick),b=0;e>b;b++)if(this.paused>0&&(this.paused-=this.stepLength,this.paused<0&&(this.paused=0)),!this.paused){for(this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-ai",this.message),d=this.activeEntities.length-1;d>-1;d--)this.activeEntities[d].triggerEvent("prepare-logic",this.message),this.activeEntities[d].triggerEvent("handle-logic",this.message),this.activeEntities[d].triggerEvent("handle-movement",this.message);if(this.owner.triggerEvent("check-collision-group",this.message))for(d=this.activeEntities.length-1;d>-1;d--)f=this.activeEntities[d],f.triggerEvent("handle-post-collision-logic",this.message),c(f)&&f.triggerEvent("state-changed",f.state);else for(d=this.activeEntities.length-1;d>-1;d--)f=this.activeEntities[d],c(f)&&f.triggerEvent("state-changed",f.state)}}}})}(),function(){"use strict";return platypus.createComponentClass({id:"HandlerRender",properties:{acceptInput:null},publicProperties:{},constructor:function(a){this.container=new PIXI.Container,this.camera={x:0,y:0},this.acceptInput&&(this.click=this.acceptInput.click,this.cameraMovementMovesMouse=this.acceptInput.camera,this.hover=this.acceptInput.hover,(this.click||this.hover)&&this.addInputs()),this.renderMessage={delta:0,container:this.container}},events:{load:function(){this.owner.triggerEvent("render-world",{
world:this.container})},"child-entity-added":function(a){a.triggerEvent("handle-render-load",this.renderMessage)},"pause-render":function(a){a&&a.time?this.paused=a.time:this.paused=-1},"unpause-render":function(){this.paused=0},tick:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=null,e=this.renderMessage;if(e.delta=b.delta,this.paused>0&&(this.paused-=b.delta,this.paused<0&&(this.paused=0)),this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-render",e),this.container){for(c=this.container.children.length-1;c>-1;c--)d=this.container.children[c],d.visible&&(d.paused&&!this.paused?d.paused=!1:this.paused&&(d.paused=!0));this.container.reorder&&(this.container.reorder=!1,this.container.children.sort(a))}}}(),"camera-update":function(a){this.camera.x=a.viewport.left,this.camera.y=a.viewport.top,this.moveMouse&&this.moveMouse()}},methods:{addInputs:function(){var a=function(a,b){return function(c){var d=c.data.global.x,e=c.data.global.y,f=c.data.originalEvent,g=0,h=0;a.container&&(g=d/a.container.transformMatrix.a+a.camera.x,h=e/a.container.transformMatrix.d+a.camera.y,c.target.mouseTarget=!0,a.owner.trigger(b,{event:f,pixiEvent:c,x:g,y:h,entity:a.owner}),a.cameraMovementMovesMouse&&("pressup"===b?(c.target.mouseTarget=!1,a.moveMouse=null,c.target.removeDisplayObject&&c.target.removeDisplayObject()):a.moveMouse=function(){a.owner.trigger("pressmove",{event:f,x:d/a.container.transformMatrix.a+a.camera.x,y:e/a.container.transformMatrix.d+a.camera.y,entity:a.owner})}))}};return function(){var b=this.container,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=!1;this.click&&(b.interactive=!0,k=a(this,"mousedown"),c=function(a){k(a),l=!0}.bind(this),i=a(this,"pressmove"),f=function(a){l&&i(a)}.bind(this),j=a(this,"pressup"),g=function(a){j(a),l=!1}.bind(this),h=a(this,"click"),b.addListener("mousedown",c),b.addListener("touchstart",c),b.addListener("mouseup",g),b.addListener("touchend",g),b.addListener("mouseupoutside",g),b.addListener("touchendoutside",g),b.addListener("mousemove",f),b.addListener("touchmove",f),b.addListener("click",h),b.addListener("tap",h)),this.hover&&(b.interactive=!0,d=a(this,"mouseover"),e=a(this,"mouseout"),b.addListener("mouseover",d),b.addListener("mouseout",e)),this.removeInputListeners=function(){this.click&&(b.removeListener("mousedown",c),b.removeListener("touchstart",c),b.removeListener("mouseup",g),b.removeListener("touchend",g),b.removeListener("mouseupoutside",g),b.removeListener("touchendoutside",g),b.removeListener("mousemove",f),b.removeListener("touchmove",f),b.removeListener("click",h),b.removeListener("tap",h)),this.hover&&(b.removeListener("mouseover",d),b.removeListener("mouseout",e)),this.removeInputListeners=null}}}(),destroy:function(){this.container.mouseTarget?(this.container.visible=!1,this.container.removeDisplayObject=function(){this.container=null}.bind(this)):this.container=null}},publicMethods:{windowToWorld:function(a,b,c){var d=c||new Vector;return d.x=a.x*this.worldPerWindowUnitWidth,d.y=a.y*this.worldPerWindowUnitHeight,b!==!1&&(d.x-=this.viewport.x*this.worldPerWindowUnitWidth,d.y-=this.viewport.y*this.worldPerWindowUnitHeight),d},worldToWindow:function(a,b,c){var d=c||new Vector;return d.x=a.x*this.windowPerWorldUnitWidth,d.y=a.y*this.windowPerWorldUnitHeight,b!==!1&&(d.x+=this.viewport.x,d.y+=this.viewport.y),d}}})}(),function(){"use strict";var a=function(a,b,c,d,e,f){var g=0,h=0,i=0,j=a.slice();if("horizontal"===f){for(h=e-1;h>=0;h--)for(g=h*d,i=0;(h+1)*d>g;g++,i++)j.splice((h+1)*b+i,0,c[g]);return j}return"vertical"===f?a.concat(c):void 0},b=function(a,b,c,d){var e=0,f=0,g=a.slice(),h=null;for(e=0;e<b.length;e++){h={};for(f in b[e])b[e].hasOwnProperty(f)&&(h[f]=b[e][f]);"horizontal"===d?h.x+=c:"vertical"===d&&(h.y+=c),g.push(h)}return g},c=function(c,d,e){var f=0,g=0;for(c.tilewidth||c.tileheight?(c.tilewidth!==d.tilewidth||c.tileheight!==d.tileheight)&&console.warn("Tiled-Loader: Your map has segments with different tile sizes. All tile sizes must match. Segment: "+d):(c.tilewidth=d.tilewidth,c.tileheight=d.tileheight),"horizontal"===e?0===c.height?c.height=d.height:c.height!==d.height&&console.warn("Tiled-Loader: You are trying to merge segments with different heights. All segments need to have the same height. Level: "+c+" Segment: "+d):"vertical"===e&&(0===c.width?c.width=d.width:c.width!==d.width&&console.warn("Tiled-Loader: You are trying to merge segments with different widths. All segments need to have the same width. Level: "+c+" Segment: "+d)),f=0;f<d.layers.length;f++)if(c.layers[f])c.layers[f].type===d.layers[f].type?c.layers[f].data&&d.layers[f].data?"horizontal"===e?(c.layers[f].data=a(c.layers[f].data,c.width,d.layers[f].data,d.width,c.height,e),c.layers[f].width+=d.width):"vertical"===e&&(c.layers[f].data=a(c.layers[f].data,c.height,d.layers[f].data,d.height,c.width,e),c.layers[f].height+=d.height):c.layers[f].objects&&d.layers[f].objects&&("horizontal"===e?c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.width*c.tilewidth,e):"vertical"===e&&(c.layers[f].objects=b(c.layers[f].objects,d.layers[f].objects,c.height*c.tileheight,e))):console.warn("Tiled-Loader: The layers in your level segments do not match. Level: "+c+" Segment: "+d);else{c.layers[f]={};for(g in d.layers[f])d.layers[f].hasOwnProperty(g)&&(c.layers[f][g]=d.layers[f][g])}"horizontal"===e?c.width+=d.width:"vertical"===e&&(c.height+=d.height);for(f in d)d.hasOwnProperty(f)&&!c[f]&&(c[f]=d[f])},d=function(a){var b=0,d=0,e=platypus.game.settings.levels,f={height:0,width:0,layers:[]},g={height:0,width:0,layers:[]},h=a[b].length;for(b=0;b<a.length;b++){for(h!==a[b].length&&console.warn("Tiled-Loader: Your map is not square. Maps must have an equal number of segments in every row."),f={height:0,width:0,layers:[]},d=0;d<a[b].length;d++)"string"==typeof a[b][d]?c(f,e[a[b][d]],"horizontal"):c(f,a[b][d],"horizontal");c(g,f,"vertical")}return g};return platypus.createComponentClass({id:"LevelBuilder",properties:{useUniques:!0,levelTemplate:null,levelPieces:null},publicProperties:{},constructor:function(a){this.levelMessage={level:null,persistentData:null}},events:{"scene-loaded":function(a){var b=null,c=null,e="",f=0,g=0,h=0;if(this.levelMessage.persistentData=a,this.levelTemplate=a.levelTemplate||this.levelTemplate,this.useUniques=a.useUniques||this.useUniques,c=a.levelPieces||this.levelPieces,this.levelPieces={},c)for(e in c)if(c.hasOwnProperty(e))if("string"==typeof c[e])this.levelPieces[e]=c[e];else{if(!c[e].length)throw"Level Builder: Level pieces of incorrect type: "+c[e];for(this.levelPieces[e]=[],f=0;f<c[e].length;f++)this.levelPieces[e].push(c[e][f])}if(!this.levelTemplate)throw"Level Builder: There is no level template.";if(!this.levelTemplate)throw"Level Builder: Template is not defined";for(this.levelMessage.level=[],g=0;g<this.levelTemplate.length;g++)if(b=this.levelTemplate[g],"string"==typeof b)this.levelMessage.level[g]=this.getLevelPiece(b);else{if(!b.length)throw"Level Builder: Template row is neither a string or array. What is it?";for(this.levelMessage.level[g]=[],h=0;h<b.length;h++)this.levelMessage.level[g][h]=this.getLevelPiece(b[h])}this.levelMessage.level&&(this.levelMessage.level=d(this.levelMessage.level),this.owner.triggerEvent("load-level",this.levelMessage))}},methods:{getLevelPiece:function(a){var b=this.levelPieces[a]||a,c=null,d=0;if(b){if("string"==typeof b)return this.useUniques?(c=b,this.levelPieces[a]=null,c):b;if(b.length)return d=Math.floor(Math.random()*b.length),this.useUniques?this.levelPieces[a].splice(d,1)[0]:b[d];throw"Level Builder: There are no MORE level pieces of type: "+a}throw"Level Builder: There are no level pieces of type: "+a},destroy:function(){this.levelMessage.level=null,this.levelMessage.persistentData=null,this.levelMessage=null}},publicMethods:{mergeLevels:function(a){return d(a)}},getAssetList:function(a,b,c){var d=0,e=[],f="",g=null;if(a&&a.levelPieces?g=a.levelPieces:b&&b.levelPieces?g=b.levelPieces:c&&c.levelPieces&&(g=c.levelPieces),g)for(f in g)if(g.hasOwnProperty(f))if(Array.isArray(g[f]))for(d=0;d<g[f].length;d++)e.union(platypus.components.TiledLoader.getAssetList({level:g[f][d]}));else e.union(platypus.components.TiledLoader.getAssetList({level:g[f]}));return e}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicAngularMovement",properties:{maxVelocity:3,acceleration:.01,visualOffset:0,startAngle:0},publicProperties:{},constructor:function(a){this.angle=this.startAngle,this.v=[0,0],this.moving=!1,this.piOverTwo=Math.PI/2,this.owner.rotation=this.owner.rotation||this.visualOffset},events:{"handle-logic":function(a){var b=a.delta,c=0;this.moving&&(this.v[0]+=this.acceleration*Math.cos(this.angle)*b,this.v[1]+=this.acceleration*Math.sin(this.angle)*b,0===this.v[0]?c=this.v[1]>0?this.piOverTwo:this.v[1]<0?-this.piOverTwo:this.angle:(c=Math.atan(this.v[1]/this.v[0]),this.v[0]<0&&(c=Math.PI+c)),this.v[0]>=0?this.v[0]=Math.min(this.v[0],this.maxVelocity*Math.cos(c)):this.v[0]=Math.max(this.v[0],this.maxVelocity*Math.cos(c)),this.v[1]>=0?this.v[1]=Math.min(this.v[1],this.maxVelocity*Math.sin(c)):this.v[1]=Math.max(this.v[1],this.maxVelocity*Math.sin(c)),this.owner.x+=this.v[0],this.owner.y+=this.v[1],this.owner.rotation=c*(180/Math.PI)+this.visualOffset)},"set-angle":function(a){this.angle=a},move:function(){this.moving=!0},stop:function(){this.moving=!1,this.v[0]=0,this.v[1]=0},"set-max-velocity":function(a){this.maxVelocity=a}}})}(),function(){"use strict";var a=include("platypus.Entity"),b=0;return platypus.createComponentClass({id:"LogicAttachment",properties:{attachState:"attached",attachment:"",offsetX:0,offsetY:0,offsetZ:.01},publicProperties:{},constructor:function(a){this.state=this.owner.state,this.owner.linkId||(this.owner.linkId="attachment-link-"+b,b+=1),this.state[this.attachState]=!1,this.attachmentPosition={x:0,y:0,z:0,dx:0,dy:0,linkId:this.owner.linkId},this.attachmentProperties={type:this.attachment,properties:this.attachmentPosition},this.attachment=null,this.isAttached=!1},events:{"handle-logic":function(a){var b=0,c=this.state;this.isAttached?(this.attachment||(this.attachmentPosition.x=this.owner.x,this.attachmentPosition.y=this.owner.y,this.attachmentPosition.z=this.owner.z,this.attachment=this.owner.parent.addEntity(this.attachmentProperties)),this.attachment.destroyed?(this.owner.parent.removeEntity(this.attachment),this.attachment=null,this.isAttached=!1):(this.attachment.x=this.owner.x,b=this.offsetX,c.left?(b*=-1,this.attachment.rotation=180):c.right&&(this.attachment.rotation=0),this.attachment.x+=b,this.attachment.y=this.owner.y,b=this.offsetY,c.top?(b*=-1,this.attachment.rotation=90):c.bottom&&(this.attachment.rotation=-90),this.attachment.y+=b,this.attachment.z=this.owner.z,this.attachment.z+=this.offsetZ)):this.attachment&&(this.owner.parent.removeEntity(this.attachment),this.attachment=null),c[this.attachState]!==this.isAttached&&(c[this.attachState]=this.isAttached)},attach:function(a){this.isAttached=!a||a.pressed!==!1},detach:function(){this.isAttached=!1}},methods:{destroy:function(){this.state[this.attachState]=!1,this.attachment&&(this.owner.parent.removeEntity(this.attachment),this.attachment=null),this.isAttached=!1}},getAssetList:function(b,c,d){var e=b.attachment||c.attachment||d.attachment;return e?a.getAssetList({type:e}):null}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicButton",constructor:function(a){this.state=this.owner.state,this.state.released=!0,this.state.pressed=!1,this.toggle=!!a.toggle,"pressed"===a.state&&(this.state.released=!1,this.state.pressed=!0)},events:{mousedown:function(a){platypus.supports.mobile&&"touchstart"!==a.event.type||this.toggle||this.updateState("pressed")},pressup:function(a){platypus.supports.mobile&&"touchend"!==a.event.type&&"touchcancel"!==a.event.type||(this.toggle?this.state.pressed?this.updateState("released"):this.updateState("pressed"):this.updateState("released"))},"handle-logic":function(){}},methods:{updateState:function(a){this.state.released&&"pressed"===a?(this.state.pressed=!0,this.state.released=!1,this.owner.triggerEvent(a,this.state)):this.state.pressed&&"released"===a&&(this.state.pressed=!1,this.state.released=!0,this.owner.triggerEvent(a,this.state))}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCanvasButton",properties:{onPress:"",onRelease:"",onCancel:"",useOnce:!1,disabled:!1},publicProperties:{},constructor:function(a){this.owner.state.disabled=this.disabled,this.owner.state.down=!1,this.owner.buttonMode=!this.disabled,this.cancelled=!1,this.used=!1,this.last=null},events:{"handle-logic":function(a){this.last!==(this.disabled===this.owner.state.disabled)&&(this.last=this.disabled===this.owner.state.disabled)},mousedown:function(a){this.owner.state.down=!0,this.owner.state.disabled||this.useOnce&&this.used||this.onPress&&(this.owner.trigger(this.onPress),a.pixiEvent.stopPropagation(),this.used=!0)},pressup:function(a){this.owner.state.disabled||this.useOnce&&this.used||(this.cancelled?this.onCancel&&(this.owner.trigger(this.onCancel),this.used=!0):this.onRelease&&(this.owner.trigger(this.onRelease),this.used=!0),a.pixiEvent.stopPropagation()),this.owner.state.down=!1,this.cancelled=!1},mouseover:function(){this.owner.state.down&&(this.cancelled=!1)},mouseout:function(){this.owner.state.down&&(this.cancelled=!0)},disable:function(){this.owner.state.disabled=!0,this.owner.buttonMode=!1},enable:function(){this.owner.state.disabled=!1,this.owner.buttonMode=!0},"toggle-disabled":function(){this.owner.buttonMode=this.owner.state.disabled,this.owner.state.disabled=!this.owner.state.disabled}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicCarrier",constructor:function(a){},events:{load:function(a){this.owner.trigger("add-collision-entity",this.owner)||(this.owner.addComponent(new platypus.components.CollisionGroup(this.owner,{})),this.owner.trigger("add-collision-entity",this.owner))},"carry-me":function(a){this.owner.trigger("add-collision-entity",a.entity)},"release-me":function(a){this.owner.trigger("remove-collision-entity",a.entity)}}})}(),function(){"use strict";var a=function(a){var b=function(a,b){return b&&!a.message?{event:a.event,message:b,delay:a.delay,repeat:a.repeat}:a};return a.singleInstance?function(c){var d=0,e=!0;for(d=0;d<this.queue.length;d++)this.queue[d].event===a.event&&(e=!1);e&&(this.queue.push(b(a,c)),this.queueTimes.push(a.delay))}:function(c){this.queue.push(b(a,c)),this.queueTimes.push(a.delay)}},b=function(a){return function(){var b=0;for(b=this.queue.length-1;b>-1;b--)this.queue[b]===a&&(this.queueTimes.splice(b,1),this.queue.splice(b,1))}};return platypus.createComponentClass({id:"LogicDelayMessage",constructor:function(c){var d="";if(this.queueTimes=[],this.queue=[],c.events)for(d in c.events)c.events.hasOwnProperty(d)&&(this.addEventListener(d,a(c.events[d])),c.events[d].cancelEvent&&this.addEventListener(c.events[d].cancelEvent,b(c.events[d])))},events:{"handle-logic":function(a){var b=0;for(b=this.queue.length-1;b>-1;b--)this.queueTimes[b]-=a.delta,this.queueTimes[b]<=0&&(this.owner.trigger(this.queue[b].event,this.queue[b].message),this.queue[b]&&(this.queue[b].repeat?this.queueTimes[b]+=this.queue[b].delay:(this.queueTimes.splice(b,1),this.queue.splice(b,1))))}},methods:{destroy:function(){this.queueTimes.length=0,this.queue.length=0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDestroyMe",properties:{delay:0,destroyed:!1},events:{"handle-logic":function(a){var b=a.delta;this.destroyed&&!this.owner.state.paused&&(this.delay-=b,this.delay<=0&&this.owner.parent.removeEntity(this.owner))},"destroy-me":function(){this.destroyed=!0}}})}(),function(){"use strict";var a=function(a){return function(b){this[a]=!b||b.pressed!==!1}},b=function(){},c={x:function(a,b){a!==b&&(a>180&&180>=b||180>=a&&b>180)&&this.owner.triggerEvent("transform","vertical")},y:function(a,b){a!==b&&(a>90&&270>=a&&(90>=b||b>270)||(90>=a||a>270)&&b>90&&270>=b)&&this.owner.triggerEvent("transform","horizontal")},z:function(a,b){a!==b&&this.owner.triggerEvent("replace-transform","rotate-"+a)}};return platypus.createComponentClass({id:"LogicDirectionalMovement",properties:{axis:"y",speed:.3},constructor:function(a){var d=this.state=this.owner.state;"number"==typeof this.speed&&(this.speed=[this.speed,0,0]),this.initialVector=new platypus.Vector(this.speed),this.reorient=c[this.axis],this.reorient||(this.reorient=b),this.moving=d.moving=!1,this.left=d.left=!1,this.right=d.right=!1,this.up=d.up=!1,this.down=d.down=!1,this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1,this.heading=0,this.owner.heading=this.owner.heading||0},events:{"component-added":function(a){if(a===this){if(!this.owner.addMover)return void console.warn('The "LogicDirectionalMovement" component requires a "Mover" component to function correctly.');this.direction=this.owner.addMover({velocity:this.speed,drag:0,friction:0,stopOnCollision:!1,orient:!1,aliases:{moving:"control-velocity"}}).velocity,this.owner.heading!==this.heading&&(this.direction.set(this.initialVector).rotate(this.owner.heading/180*Math.PI),this.heading=this.owner.heading),this.owner.triggerEvent("moving",this.moving)}},"handle-logic":function(){var a=this.up||this.upLeft||this.downLeft,b=this.upLeft||this.up&&this.left,c=this.left||this.upLeft||this.downLeft,d=this.downLeft||this.down&&this.left,e=this.down||this.downLeft||this.downRight,f=this.downRight||this.down&&this.right,g=this.right||this.upRight||this.downRight,h=this.upRight||this.up&&this.right;if(c&&g||a&&e)this.moving=!1;else if(b)this.moving=!0,this.heading=225;else if(h)this.moving=!0,this.heading=315;else if(d)this.moving=!0,this.heading=135;else if(f)this.moving=!0,this.heading=45;else if(c)this.moving=!0,this.heading=180;else if(g)this.moving=!0,this.heading=0;else if(a)this.moving=!0,this.heading=270;else if(e)this.moving=!0,this.heading=90;else switch(this.moving=!1,this.heading){case 270:a=!0;break;case 90:e=!0;break;case 180:c=!0;break;case 225:a=!0,c=!0;break;case 315:a=!0,g=!0;break;case 135:e=!0,c=!0;break;case 45:e=!0,g=!0;break;case 0:default:g=!0}this.owner.heading!==this.heading&&(this.direction.set(this.initialVector).rotate(this.heading/180*Math.PI),this.reorient(this.heading,this.owner.heading),this.owner.heading=this.heading),this.state.moving!==this.moving&&(this.owner.triggerEvent("moving",this.moving),this.state.moving=this.moving),this.state.up!==a&&(this.state.up=a),this.state.right!==g&&(this.state.right=g),this.state.down!==e&&(this.state.down=e),this.state.left!==c&&(this.state.left=c)},"go-down":a("down"),"go-south":a("down"),"go-down-left":a("downLeft"),"go-southwest":a("downLeft"),"go-left":a("left"),"go-west":a("left"),"go-up-left":a("upLeft"),"go-northwest":a("upLeft"),"go-up":a("up"),"go-north":a("up"),"go-up-right":a("upRight"),"go-northeast":a("upRight"),"go-right":a("right"),"go-east":a("right"),"go-down-right":a("downRight"),"go-southeast":a("downRight"),stop:function(a){a&&a.pressed===!1||(this.left=!1,this.right=!1,this.up=!1,this.down=!1,this.upLeft=!1,this.upRight=!1,this.downLeft=!1,this.downRight=!1)},accelerate:function(a){this.initialVector.normalize().multiply(a),this.direction.normalize().multiply(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicDragDrop",constructor:function(a){this.nextX=this.owner.x,this.nextY=this.owner.y,this.grabOffsetX=0,this.grabOffsetY=0,this.owner.state.dragging=!1,this.owner.state.noDrop=!1,this.tryDrop=!1,this.hitSomething=!1},events:{"handle-logic":function(a){this.owner.x=this.nextX,this.owner.y=this.nextY,this.owner.state.noDrop=!1},"handle-post-collision-logic":function(a){this.tryDrop?(this.tryDrop=!1,this.hitSomething?(this.dropFailed=!1,this.owner.state.noDrop=!0,this.owner.state.dragging=!0):(this.owner.state.noDrop=!1,this.owner.state.dragging=!1)):this.hitSomething&&(this.owner.state.noDrop=!0),this.hitSomething=!1},mousedown:function(a){this.grabOffsetX=a.x-this.owner.x,this.grabOffsetY=a.y-this.owner.y,this.owner.state.dragging=!0},mouseup:function(a){this.tryDrop=!0},pressmove:function(a){this.nextX=a.x-this.grabOffsetX,this.nextY=a.y-this.grabOffsetY},"no-drop":function(a){this.hitSomething=!0}},methods:{destroy:function(){this.owner.state.dragging=null,this.owner.state.noDrop=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicImpactLaunch",properties:{accelerationX:-.3,accelerationY:-.8,flipX:!0,flipY:!1},constructor:function(a){this.stunState=a.state||"stunned",this.flipX=this.flipX?-1:1,this.flipY=this.flipY?-1:1,this.justJumped=!1,this.stunned=!1,this.state=this.owner.state,this.state.impact=!1,this.state[this.stunState]=!1},events:{"component-added":function(a){if(a===this){if(!this.owner.addMover)return void console.warn('The "LogicDirectionalMovement" component requires a "Mover" component to function correctly.');this.direction=this.owner.addMover({velocity:[0,0,0],orient:!1}).velocity,this.vector=new platypus.Vector}},"handle-logic":function(){this.state.impact!==this.justJumped&&(this.state.impact=this.justJumped),this.state[this.stunState]!==this.stunned&&(this.state[this.stunState]=this.stunned),this.justJumped&&(this.direction.set(this.vector),this.justJumped=!1,this.stunned=!0)},"impact-launch":function(a){var b=a.x,c=a.y;a.entity&&(b=a.entity.x-this.owner.x,c=a.entity.y-this.owner.y),this.stunned||(this.justJumped=!0,b>=0?this.vector.x=this.accelerationX:0>b&&(this.vector.x=this.accelerationX*this.flipX),c>=0?this.vector.y=this.accelerationY:0>c&&(this.vector.y=this.accelerationY*this.flipY))},"hit-solid":function(a){this.stunned&&a.y>0&&(this.direction.x=0,this.direction.y=0,this.stunned=!1)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPacingPlatform",constructor:function(a){this.ang=this.owner.angle||a.angle||0,this.dist=this.owner.distance||a.distance||128,this.period=this.owner.period||a.period||4e3,this.time=0,this.startPos=this.owner.startPos||a.startPos||0,this.offset=0,this.originX=this.owner.x,this.originY=this.owner.y},events:{"handle-logic":function(a){var b=a.delta;this.time+=b,this.time>this.period&&(this.time=this.time%this.period),this.offset=this.time/this.period*2*Math.PI,this.owner.x=this.originX+Math.sin(this.offset+this.startPos)*this.dist*Math.cos(this.ang),this.owner.y=this.originY+Math.sin(this.offset+this.startPos)*this.dist*Math.sin(this.ang)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPortable",constructor:function(a){this.portableDirections=a.portableDirections||{down:!0},this.carrier=this.lastCarrier=void 0,this.message={entity:this.owner}},events:{"handle-logic":function(a){this.carrierConnected?(this.carrier!==this.lastCarrier&&(this.lastCarrier&&this.lastCarrier.trigger("release-me",this.message),this.carrier.trigger("carry-me",this.message)),this.carrierConnected=!1):this.carrier&&(this.carrier.trigger("release-me",this.message),this.carrier=void 0),this.lastCarrier=this.carrier},"hit-solid":function(a){a.y>0?this.updateCarrier(a.entity,"down"):a.y<0?this.updateCarrier(a.entity,"up"):a.x<0?this.updateCarrier(a.entity,"left"):a.x>0&&this.updateCarrier(a.entity,"right")}},methods:{updateCarrier:function(a,b){this.portableDirections[b]&&a&&(a!==this.carrier&&(this.carrier=a),this.carrierConnected=!0)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicPortal",constructor:function(a){var b=0,c=a.entrants||a.entrant;if(this.destination=this.owner.destination||a.destination,this.used=!1,this.ready=!1,this.wasReady=!1,c)if(this.entrants={},Array.isArray(c))for(b=0;b<c.length;b++)this.entrants[c[b]]=!1;else this.entrants[c]=!1},events:{"handle-logic":function(){var a="";!this.used&&this.activated?(this.owner.trigger("port-"+this.destination),this.used=!0):this.ready&&!this.wasReady?(this.owner.triggerEvent("portal-waiting"),this.wasReady=!0):this.wasReady&&!this.ready&&(this.owner.triggerEvent("portal-not-waiting"),this.wasReady=!1),this.owner.state.occupied=!1,this.owner.state.ready=!0;for(a in this.entrants)this.entrants.hasOwnProperty(a)&&(this.entrants[a]?(this.owner.state.occupied=!0,this.entrants[a]=!1):this.owner.state.ready=!1);this.ready=!1},"occupied-portal":function(a){var b="";this.entrants[a.entity.type]=!0;for(b in this.entrants)if(this.entrants.hasOwnProperty(b)&&!this.entrants[b])return;this.ready=!0},"activate-portal":function(){this.activated=!0}}})}(),function(){"use strict";var a=function(a,b){return a/Math.abs(a)*b};return platypus.createComponentClass({id:"LogicPushable",constructor:function(a){this.yPush=a.push||a.yPush||0,this.xPush=a.push||a.xPush||.1,a.roll?(this.radius=a.radius||this.owner.radius||(this.owner.width||this.owner.height||2)/2,this.owner.orientation=this.owner.orientation||0):this.radius=0,this.currentPushX=0,this.currentPushY=0,this.lastX=this.owner.x,this.lastY=this.owner.y,this.pushers=[]},events:{"handle-logic":function(b){var c=0,d=b.delta;for(this.currentPushY&&(this.owner.y+=a(this.currentPushY,this.yPush*d),this.currentPushY=0),this.currentPushX&&(this.owner.x+=a(this.currentPushX,this.xPush*d),this.currentPushX=0),(this.lastX!==this.owner.x||this.lastY!==this.owner.y)&&(this.radius&&(this.owner.orientation+=(this.owner.x+this.owner.y-this.lastX-this.lastY)/this.radius),this.lastX=this.owner.x,this.lastY=this.owner.y),c=0;c<this.pushers.length;c++)this.pushers[c].triggerEvent("pushed",this.owner);this.pushers.length=0},"push-entity":function(a){var b=a.x||0,c=a.y||0;this.currentPushX-=b,this.currentPushY-=c,(this.yPush&&c||this.xPush&&b)&&this.pushers.push(a.entity)},"hit-solid":function(a){return a.y>0&&this.vY>0||a.y<0&&this.vY<0?this.vY=0:(a.x<0&&this.vX<0||a.x>0&&this.vX>0)&&(this.vX=0),!0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicRebounder",constructor:function(a){platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.owner.mass=this.owner.mass||a.mass||1,this.elasticity=a.elasticity||.8,this.v=new platypus.Vector(0,0,0),this.incidentVector=new platypus.Vector(0,0,0),this.staticCollisionOccurred=!1,this.nonStaticCollisionOccurred=!1,this.hitThisTick=[],this.otherV=new platypus.Vector(0,0,0),this.otherVelocityData=[]},events:{"handle-logic":function(a){this.hitThisTick=[],this.otherVelocityData.length=0},"hit-static":function(a){var b=0,c=a.entity,d=0;for(d=0;d<this.hitThisTick.length;d++)if(c===this.hitThisTick[d])return;this.hitThisTick.push(c),this.v.set(this.owner.velocity),this.incidentVector.set(a.direction),b=this.v.scalarProjection(this.incidentVector),isNaN(b)||(this.incidentVector.scale(b*(1+this.elasticity)),this.v.subtractVector(this.incidentVector)),this.owner.velocity.set(this.v)},"hit-non-static":function(a){var b=0,c=a.entity,d=!1,e=0,f=0,g=0;if(b=this.hitThisTick.indexOf(c),!(b>=0)){for(this.hitThisTick.push(c),b=0;b<this.otherVelocityData.length;b++)if(c===this.otherVelocityData[b].entity){this.otherV.set(this.otherVelocityData[b].velocity),d=!0;break}d||(this.otherV.set(c.velocity),c.triggerEvent("share-velocity",this.owner)),this.v.set(this.owner.velocity),this.incidentVector.set(a.direction),e=this.v.scalarProjection(this.incidentVector),e=isNaN(e)?0:e,f=this.otherV.scalarProjection(this.incidentVector),f=isNaN(f)?0:f,g=(e*(this.owner.mass-c.mass)+2*c.mass*f)/(this.owner.mass+c.mass),this.incidentVector.scale(g-e),this.owner.velocity.set(this.incidentVector)}},"share-velocity":function(a){this.otherVelocityData.push({entity:a,velocity:new platypus.Vector(a.velocity)})}},methods:{destroy:function(){this.v=null,this.otherV=null,this.incidentVector=null,this.hitThisTick=null}},publicMethods:{}})}(),function(){"use strict";var a=include("platypus.Entity");return platypus.createComponentClass({id:"LogicRegionSpawner",constructor:function(a){var b=0,c=0,d=1,e=1,f=0,g=0,h=0,i=0;if(this.spawnPosition={x:0,y:0},this.spawnProperties={properties:this.spawnPosition},this.regions=null,this.usedRegions=null,this.regionWidth=0,this.regionHeight=0,a.regions)for(this.regions=[],this.usedRegions=[],this.regionWidth=f=a.regions.width||this.owner.width,this.regionHeight=g=a.regions.height||this.owner.height,d=Math.round(this.owner.width/f),e=Math.round(this.owner.height/g),b=0;d>b;b++)for(c=0;e>c;c++)h=Math.min(f,this.owner.width-b*f),i=Math.min(g,this.owner.height-c*g),this.regions.push({x:b*f,y:c*g,width:h,height:i});this.entityClass=platypus.game.settings.entities[a.spawn],this.interval=this.owner.interval||a.interval||1e3,this.time=0},events:{"handle-logic":function(a){var b=this.regions,c=null;this.time+=a.delta,this.time>this.interval&&(this.time-=this.interval,b?(b.length||(this.regions=this.usedRegions,this.usedRegions=b,b=this.regions),c=b[Math.floor(b.length*Math.random())],this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+(c.x+Math.random()*c.width),this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+(c.y+Math.random()*c.height)):(this.spawnPosition.x=this.owner.x-(this.owner.regX||0)+Math.random()*this.owner.width,this.spawnPosition.y=this.owner.y-(this.owner.regY||0)+Math.random()*this.owner.height),this.owner.triggerEvent("entity-created",this.owner.parent.addEntity(new platypus.Entity(this.entityClass,this.spawnProperties))))}},getAssetList:function(b,c,d){var e=b.spawn||c.spawn||d.spawn;return e?a.getAssetList({type:e}):null}})}(),function(){"use strict";var a=(Math.PI,Math.cos),b=Math.sin,c=function(b,c){return b*a(c)},d=function(a,c){return a*b(c)};return platypus.createComponentClass({id:"LogicRotationalMovement",constructor:function(a){this.speed=a.speed||.3,this.magnitude=0,this.degree=a.degree||1,this.angle=a.angle||0,this.state=this.owner.state,this.state.moving=!1,this.state.turningRight=!1,this.state.turningLeft=!1,this.owner.orientation=0,this.moving=!1,this.turningRight=!1,this.turningLeft=!1},events:{"handle-logic":function(a){var b=0,e=0;this.turningRight&&(this.angle+=this.degree*a.delta/15),this.turningLeft&&(this.angle-=this.degree*a.delta/15),this.moving&&(b=c(this.magnitude,this.angle),e=d(this.magnitude,this.angle)),this.owner.x+=b*a.delta,this.owner.y+=e*a.delta,this.state.moving!==this.moving&&(this.state.moving=this.moving),this.state.turningLeft!==this.turningLeft&&(this.state.turningLeft=this.turningLeft),this.state.turningRight!==this.turningRight&&(this.state.turningRight=this.turningRight),this.owner.rotation!==this.angle&&(this.owner.rotation=this.angle)},"turn-right":function(a){a?this.turningRight=a.pressed:this.turningRight=!0},"turn-left":function(a){a?this.turningLeft=a.pressed:this.turningLeft=!0},"go-forward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=this.speed):this.moving=!1},"go-backward":function(a){!a||a.pressed?(this.moving=!0,this.magnitude=-this.speed):this.moving=!1},stop:function(a){(!a||a.pressed)&&(this.moving=!1,this.turningLeft=!1,this.turningRight=!1)},"stop-moving":function(a){(!a||a.pressed)&&(this.moving=!1)},"stop-turning":function(a){(!a||a.pressed)&&(this.turningLeft=!1,this.turningRight=!1)}}})}(),function(){"use strict";var a=include("platypus.Entity");return platypus.createComponentClass({id:"LogicSpawner",constructor:function(a){var b=this.owner.spawneeClass||a.spawneeClass,c="",d=0;if(this.state=this.owner.state,this.stateName=a.state||"spawning",this.entityClass=platypus.game.settings.entities[b],this.speed=a.speed||this.owner.speed||0,this.state[this.stateName]=!1,this.spawneeProperties={x:0,y:0,z:0,dx:0,dy:0,spawner:this.owner},a.passOnProperties)for(d=0;d<a.passOnProperties.length;d++)c=a.passOnProperties[d],this.owner[c]&&(this.spawneeProperties[c]=this.owner[c]);this.propertiesContainer={properties:this.spawneeProperties},this.offsetX=this.owner.offsetX||a.offsetX||0,this.offsetY=this.owner.offsetY||a.offsetY||0,this.firing=!1},events:{"handle-logic":function(){var a=0,b=0,c=this.state;this.firing&&(this.spawneeProperties.x=this.owner.x,this.spawneeProperties.y=this.owner.y,
b=this.entityClass.properties&&this.entityClass.properties.z?this.entityClass.properties.z:0,this.spawneeProperties.z=this.owner.z+b,a=this.offsetX,c.left&&(a*=-1),this.spawneeProperties.x+=a,a=this.offsetY,c.top&&(a*=-1),this.spawneeProperties.y+=a,this.speed?(c.top?this.spawneeProperties.dy=-this.speed:c.bottom?this.spawneeProperties.dy=this.speed:delete this.spawneeProperties.dy,c.left?this.spawneeProperties.dx=-this.speed:c.right?this.spawneeProperties.dx=this.speed:delete this.spawneeProperties.dx):(delete this.spawneeProperties.dx,delete this.spawneeProperties.dy),this.parent&&this.owner.triggerEvent("entity-created",this.parent.addEntity(new platypus.Entity(this.entityClass,this.propertiesContainer)))),c[this.stateName]!==this.firing&&(c[this.stateName]=this.firing),this.firing=!1},spawn:function(a){this.firing=!a||a.pressed!==!1,this.parent=this.owner.parent}},getAssetList:function(b,c,d){var e=b.spawneeClass||c.spawneeClass||d.spawneeClass;return e?a.getAssetList({type:e}):null}})}(),function(){"use strict";var a=function(a,b){return function(c){var d=null;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}},b=function(a,b){return function(c){b[a]=!0}},c=null,d=null;return c=function(a,b,e,f,g,h,i){var j=0,k="",l=!1,m=f.message||0===f.message||f.message===!1;if(g)if("string"==typeof f)h.trigger(f),l=!0;else if(Array.isArray(f)){for(j=0;j<f.length;j++)c(a,b,e,f[j],g,h,i);l=!0}else f.event&&(m||f.delay)?(f.delay?i.push(f):h.trigger(f.event,f.message),l=!0):f["true"]&&c(a,b,e,f["true"],g,h,i);if(!l)for(k in f)f.hasOwnProperty(k)&&"true"!==k&&d(k,b,e,f[k],g,h,i)},d=function(a,b,d,e,f,g,h){var i=f,j=!1;"!"===a.charAt(0)?(j=b[a.substring(1)]===!1,"outputs"!==a&&d[a.substring(1)]!==b[a.substring(1)]&&(i=!0)):(j=b[a]===!0,"outputs"!==a&&d[a]!==b[a]&&(i=!0)),(j||"outputs"===a)&&c(a,b,d,e,i,g,h)},platypus.createComponentClass({id:"LogicStateMachine",constructor:function(c){var d=null;if(this.state=this.owner.state,c.inputs)for(d in c.inputs)c.inputs.hasOwnProperty(d)&&this.addEventListener(d,a(c.inputs[d],this.state));if(this.sustainedState={},c["sustained-inputs"])for(d in c["sustained-inputs"])c["sustained-inputs"].hasOwnProperty(d)&&(this.addEventListener(d,b(c["sustained-inputs"][d],this.sustainedState)),this.sustainedState[c["sustained-inputs"][d]]=!1);this.snapshot={},this.last={},this.tempQueue=[],this.queueTimes=[],this.queue=[],this.outputs=c.outputs||null},events:{"handle-logic":function(a){var b="";for(b in this.sustainedState)this.sustainedState.hasOwnProperty(b)&&(this.owner.state[b]!==this.sustainedState[b]&&(this.owner.state[b]=this.sustainedState[b]),this.sustainedState[b]=!1);for(b=this.queue.length-1;b>-1;b--)this.queueTimes[b]-=a.delta,this.queueTimes[b]<=0&&(this.owner.trigger(this.queue[b].event,this.queue[b].message),this.queueTimes.splice(b,1),this.queue.splice(b,1))},"update-state":function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this.state[b]=a[b])},"state-changed":function(a){var b=null;if(this.outputs){for(b in a)a[b]!==this.snapshot[b]&&(this.snapshot[b]=a[b]);for(this.tempQueue.length=0,d("outputs",this.snapshot,this.last,this.outputs,!1,this.owner,this.tempQueue),b=0;b<this.tempQueue.length;b++)this.queue.push(this.tempQueue[b]),this.queueTimes.push(this.tempQueue[b].delay);for(b in this.snapshot)this.snapshot[b]!==this.last[b]&&(this.last[b]=this.snapshot[b])}}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicSwitch",constructor:function(a){this.state=this.owner.state,this.pressed=!1,this.wasPressed=this.pressed,this.sticky=a.sticky||!1,this.state.pressed=!1,this.initialPress=!0},events:{"handle-logic":function(){this.sticky?this.pressed&&!this.wasPressed&&(this.state.pressed=!0,this.wasPressed=!0,this.owner.trigger("switch-on")):(this.pressed!==this.wasPressed&&(this.pressed?(this.state.pressed=!0,this.owner.trigger("switch-on")):(this.state.pressed=!1,this.owner.trigger("switch-off"))),this.wasPressed=this.pressed,this.pressed=!1)},"switch-pressed":function(){this.pressed=!0,this.initialPress&&(this.owner.trigger("initial-press"),this.initialPress=!1)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTeleportee",constructor:function(a){this.teleportDestination=new platypus.Vector,this.teleportNow=!1,this.DestinationSet=!1},events:{"handle-logic":function(){this.teleportNow&&(this.owner.trigger("relocate-entity",{position:this.teleportDestination}),this.teleportNow=!1,this.owner.trigger("teleport-complete"))},teleport:function(){this.destinationSet&&(this.teleportNow=!0)},"set-destination":function(a){this.setDestination(a)},"hit-telepoint":function(a){this.setDestination(a.entity)}},methods:{setDestination:function(a){this.teleportDestination.set(a.x,a.y,this.owner.z),this.destinationSet=!0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTeleporter",constructor:function(a){this.destination=void 0,this.linkId=this.owner.teleportId||a.teleportId,this.facing=this.owner.facing||a.facing||!1,this.facing&&(this.owner.state["facing-"+this.facing]=!0)},events:{"peer-entity-added":function(a){this.destination||a.linkId!==this.linkId||(this.destination=a)},"teleport-entity":function(a){switch(this.facing){case"up":a.y<0&&a.entity.trigger("teleport",this.destination);break;case"right":a.x>0&&a.entity.trigger("teleport",this.destination);break;case"down":a.y>0&&a.entity.trigger("teleport",this.destination);break;case"left":a.x<0&&a.entity.trigger("teleport",this.destination);break;default:a.entity.trigger("teleport",this.destination)}}},methods:{destroy:function(){this.destination=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicTimer",constructor:function(a){this.time=this.owner.time||a.time||0,this.prevTime=this.time,this.alarmTime=this.owner.alarmTime||a.alarmTime||void 0,this.isInterval=this.owner.isInterval||a.isInterval||!1,this.alarmMessage=this.owner.alarmMessage||a.alarmMessage||"",this.updateMessage=this.owner.updateMessage||a.updateMessage||"",this.isOn=this.owner.on||a.on||!0,this.isIncrementing=this.owner.isIncrementing||a.isIncrementing||!0,this.maxTime=this.owner.maxTime||a.maxTime||36e5},events:{"handle-logic":function(a){this.isOn&&(this.prevTime=this.time,this.isIncrementing?this.time+=a.delta:this.time-=a.delta,Math.abs(this.time)>this.maxTime&&(this.time>0?this.time=this.maxTime:this.time<0&&(this.time=-this.maxTime),this["stop-timer"]()),"undefined"!=typeof this.alarmTime&&(this.isInterval?this.isIncrementing?Math.floor(this.time/this.alarmTime)>Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):Math.floor(this.time/this.alarmTime)<Math.floor(this.prevTime/this.alarmTime)&&this.owner.trigger(this.alarmMessage):this.isIncrementing?this.time>this.alarmTime&&this.prevTime<this.alarmTime&&this.owner.trigger(this.alarmMessage):this.time<this.alarmTime&&this.prevTime>this.alarmTime&&this.owner.trigger(this.alarmMessage))),this.owner.trigger(this.updateMessage,{time:this.time})},"set-timer":function(a){this.time=a.time},"start-timer":function(){this.isOn=!0},"stop-timer":function(){this.isOn=!1}}})}(),function(){"use strict";return platypus.createComponentClass({id:"LogicWindUpRacer",constructor:function(a){this.windTime=a.windTime||500,this.raceTime=a.raceTime||5e3,this.speed=a.speed||this.owner.speed||.3,this.windProgress=0,this.winding=!1,this.racing=!1,this.blocked=!1,this.right=!1,this.left=!1,this.state=this.owner.state,this.state.windingUp=!1,this.state.racing=!1,this.state.blocked=!1},events:{"handle-logic":function(a){this.racing?!this.blocked&&this.right&&this.state.right?(this.owner.x+=this.speed*a.delta,this.owner.trigger("racing")):!this.blocked&&this.left&&this.state.left?(this.owner.x-=this.speed*a.delta,this.owner.trigger("racing")):(this.racing=!1,this.owner.trigger("stopped-racing")):this.winding?((this.right&&this.state.right||this.left&&this.state.left)&&(this.windProgress+=a.delta),this.owner.trigger("winding")):this.windProgress&&(this.windProgress>this.windTime&&(this.racing=!0),this.windProgress=0,this.owner.trigger("stopped-winding")),this.state.windingUp!==this.winding&&(this.state.windingUp=this.winding),this.state.racing!==this.racing&&(this.state.racing=this.racing),this.state.blocked!==this.blocked&&(this.state.blocked=this.blocked),this.blocked=!1},"stop-racing":function(a){this.racing=!1,this.owner.trigger("stopped-racing")},"wind-up":function(a){this.winding=!a||a.pressed!==!1,this.right=this.state.right,this.left=this.state.left},"hit-solid":function(a){a.x&&this.racing&&(this.right&&a.x>0||this.left&&a.x<0)&&(this.blocked=!0,this.owner.trigger("blocked",a))}},methods:{destroy:function(){this.state.windingUp=!1,this.state.racing=!1,this.state.blocked=!1}}})}(),function(){"use strict";var a=new platypus.Vector,b=function(a,b,c,d){platypus.game.settings.debug&&console.warn('"'+a+'" Motion: The "'+b+'" property has been deprecated. Use "aliases": {"'+c+'": "'+d+'"} instead.')},c=function(){return!0},d=function(a,d){var e=c,f=c,g=c,h=a.owner.state,i=d.controlState,j=d.instantState,k=d.instantSuccess;i&&(a.accelerator?e=function(){return h[i]}:f=function(){return h[i]}),d.event&&(b(a.owner.type,"event",d.event,"control-"+(a.accelerator?"acceleration":"velocity")),a.addEventListener(d.event,function(a){this.active=a&&a.pressed!==!1})),a.instant||d.instantEvent||j||d.instantBegin||d.instantEnd?(j&&(g=function(){return h[j]}),a.instant=!0,(d.instantEvent||d.instantBegin||d.instantEnd)&&(d.instantEvent&&(b(a.owner.type,"instantEvent",d.instantEvent,"instant-motion"),a.addEventListener(d.instantEvent,function(a){this.enact=a&&a.pressed!==!1})),d.instantBegin&&(b(a.owner.type,"instantBegin",d.instantBegin,"instant-begin"),a.addEventListener(d.instantBegin,function(){this.enact=!0})),d.instantEnd&&(b(a.owner.type,"instantEnd",d.instantEnd,"instant-end"),a.addEventListener(d.instantEnd,function(){this.enact=!1}))),a.update=function(a){var b=g(),c=f();if(this.vector&&(this.accelerator?this.activeAcceleration=this.active:this.activeVelocity=this.active),this.activeVelocity){if(this.enact&&!c&&(this.ready=!1),this.ready&&this.enact&&b)this.ready=!1,this.velocity.set(this.instant),k&&this.owner.triggerEvent(k);else if(this.ready||this.enact&&b){if(c)return null}else this.ready=!0,this.decay();return this.velocity}return null}):a.update=function(a){return this.vector&&(this.accelerator?this.activeAcceleration=this.active:this.activeVelocity=this.active),this.activeVelocity&&f()?(this.activeAcceleration&&e()&&this.move(a),this.velocity):null}};return platypus.createComponentClass({id:"Motion",properties:{orient:!0,acceleration:0,accelerator:!1,active:!0,activeAcceleration:!0,activeVelocity:!0,maxMagnitude:1/0,event:"",controlState:"",instantEvent:"",instantBegin:"",instantEnd:"",instant:!1,instantState:"",instantSuccess:"",instantDecay:null,vector:0,velocity:0,stopOnCollision:!0,drag:-1,friction:-1},constructor:function(a){var b=this.vector;this.acceleration||(this.activeAcceleration=!1),this.acceleration=new platypus.Vector(this.acceleration),this.velocity=new platypus.Vector(this.velocity),this.triggered=!1,this.ready=!0,"number"==typeof this.instantDecay?this.capMagnitude=this.velocity.magnitude()*this.instantDecay:this.capMagnitude=-1,d(this,a),this.vector&&(this.accelerator&&!this.instant?(this.activeAcceleration=!0,platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" Motion: "vector" and "accelerator" are deprecated. Set "acceleration" to "'+this.vector.toString()+'" instead.'),Object.defineProperty(this,"vector",{get:function(){return this.acceleration}.bind(this),set:function(a){this.acceleration=a}.bind(this)})):(this.activeAcceleration=!1,platypus.game.settings.debug&&console.warn('"'+this.owner.type+'" Motion: "vector" and "accelerator" are deprecated. Set "velocity" to "'+this.vector.toString()+'" instead.'),Object.defineProperty(this,"vector",{get:function(){return this.velocity}.bind(this),set:function(a){this.velocity=a}.bind(this)})),this.vector.set(b)),this.instant&&(this.enact=!1,this.instant=new platypus.Vector(this.velocity),this.velocity.set(0,0,0)),this.orient&&(this.owner.triggerEvent("orient-vector",this.velocity),this.owner.triggerEvent("orient-vector",this.acceleration))},events:{"control-velocity":function(a){this.activeVelocity=a&&a.pressed!==!1},"stop-velocity":function(){this.activeVelocity=!1},"start-velocity":function(){this.activeVelocity=!0},"control-acceleration":function(a){this.activeAcceleration=a&&a.pressed!==!1},"stop-acceleration":function(){this.activeAcceleration=!1},"start-acceleration":function(){this.activeAcceleration=!0},"instant-motion":function(a){this.enact=a&&a.triggered!==!1},"instant-begin":function(){this.enact=!0},"instant-end":function(){this.enact=!1},"set-vector":function(a){this.vector.set(a),"number"==typeof this.instantDecay?this.capMagnitude=this.vector.magnitude()*this.instantDecay:this.capMagnitude=-1,platypus.game.settings.debug&&!this.setVectorWarning&&(this.setVectorWarning=!0,this.accelerator?console.warn('"'+this.owner.type+'" Motion: The "set-vector" message is deprecated. Trigger "set-motion" with a {"acceleration": '+JSON.stringify(a)+"} message instead."):console.warn('"'+this.owner.type+'" Motion: The "set-vector" message is deprecated. Trigger "set-motion" with a {"velocity": '+JSON.stringify(a)+"} message instead."))},"set-motion":function(a){a.acceleration&&this.acceleration.set(a.acceleration),a.velocity&&(this.velocity.set(a.velocity),"number"==typeof this.instantDecay?this.capMagnitude=this.velocity.magnitude()*this.instantDecay:this.capMagnitude=-1),"number"==typeof a.maxMagnitude&&(this.maxMagnitude=a.maxMagnitude)}},methods:{move:function(b){return this.velocity.add(a.set(this.acceleration).multiply(b)),this.velocity.magnitude()>this.maxMagnitude&&this.velocity.normalize().multiply(this.maxMagnitude),this.velocity},decay:function(){this.capMagnitude>=0&&this.velocity.magnitude()>this.capMagnitude&&this.velocity.normalize().multiply(this.capMagnitude)},destroy:function(){this.orient&&(this.owner.triggerEvent("remove-vector",this.acceleration),this.owner.triggerEvent("remove-vector",this.velocity))}},publicMethods:{}})}(),function(){"use strict";var a=new platypus.Vector,b=function(a,b,c,d){return a&&b!==c?c>b?Math.min(b+a*d,c):Math.max(b-a*d,c):b},c=function(a,c){var d=this.maxMagnitudeInterim=b(this.maxMagnitudeDelta,this.maxMagnitudeInterim,this.maxMagnitude,c);a.magnitude()>d&&a.normalize().multiply(d)},d=function(a,c){var d=this.maxMagnitude,e=this.maxMagnitudeDelta,f=this.maxMagnitudeInterim;f.up=b(e,f.up,d.up,c),f.right=b(e,f.right,d.right,c),f.down=b(e,f.down,d.down,c),f.left=b(e,f.left,d.left,c),a.x>0?a.x>f.right&&(a.x=f.right):a.x<0&&a.x<-f.left&&(a.x=-f.left),a.y>0?a.y>f.down&&(a.y=f.down):a.y<0&&a.y<-f.up&&(a.y=-f.up)};return platypus.createComponentClass({id:"Mover",properties:{ground:[0,1]},publicProperties:{movers:[],gravity:0,jump:0,speed:0,drag:.01,friction:.06,maxMagnitude:1/0,maxMagnitudeDelta:0},constructor:function(a){var b=1/0,e=this.maxMagnitude;platypus.Vector.assign(this.owner,"position","x","y","z"),platypus.Vector.assign(this.owner,"velocity","dx","dy","dz"),this.position=this.owner.position,this.velocity=this.owner.velocity,this.pause=!1,this.moversCopy=this.movers,this.movers=[],this.ground=new platypus.Vector(this.ground),Object.defineProperty(this.owner,"maxMagnitude",{get:function(){return b},set:function(a){"number"==typeof a?(this.clamp=c,b=a,this.maxMagnitudeDelta||(this.maxMagnitudeInterim=a)):(this.clamp=d,"number"==typeof b&&(b={up:b,right:b,down:b,left:b}),"number"==typeof a.up&&(b.up=a.up),"number"==typeof a.right&&(b.right=a.right),"number"==typeof a.down&&(b.down=a.down),"number"==typeof a.left&&(b.left=a.left),"number"==typeof this.maxMagnitudeInterim?this.maxMagnitudeDelta?this.maxMagnitudeInterim={up:this.maxMagnitudeInterim,right:this.maxMagnitudeInterim,down:this.maxMagnitudeInterim,left:this.maxMagnitudeInterim}:this.maxMagnitudeInterim={up:b.up,right:b.right,down:b.down,left:b.left}:this.maxMagnitudeDelta||(this.maxMagnitudeInterim.up=b.up,this.maxMagnitudeInterim.right=b.right,this.maxMagnitudeInterim.down=b.down,this.maxMagnitudeInterim.left=b.left))}.bind(this)}),this.maxMagnitudeInterim=0,this.maxMagnitude=e},events:{"component-added":function(a){"Motion"===a.type&&this.movers.push(a)},"component-removed":function(a){var b=0;"Motion"===a.type&&(b=this.movers.indexOf(a),b>=0&&this.movers.splice(b,1))},load:function(){var a=0,b=this.moversCopy;for(delete this.moversCopy,a=0;a<b.length;a++)this.addMover(b[a]);this.speed&&(isNaN(this.speed)||(this.speed=[this.speed,0,0]),this.speed=this.addMover({velocity:this.speed,controlState:"moving"}).velocity),this.gravity&&(isNaN(this.gravity)||(this.gravity=[0,this.gravity,0]),this.gravity=this.addMover({acceleration:this.gravity,orient:!1,aliases:{gravitate:"control-acceleration"}}).acceleration),this.jump&&(isNaN(this.jump)||(this.jump=[0,this.jump,0]),this.jump=this.addMover({velocity:this.jump,instant:!0,controlState:"grounded",state:"jumping",instantSuccess:"just-jumped",instantDecay:.2,aliases:{jump:"instant-motion"}}).instant)},"handle-movement":function(b){var c=0,d=b.delta,e=null,f=a,g=this.velocity,h=this.position;if(!this.owner.state.paused&&!this.paused){for(g.set(0,0,0),c=0;c<this.movers.length;c++)e=this.movers[c].update(d),e&&(this.grounded?-1!==this.movers[c].friction?e.multiply(1-this.movers[c].friction):e.multiply(1-this.friction):-1!==this.movers[c].drag?e.multiply(1-this.movers[c].drag):e.multiply(1-this.drag),g.add(e));this.clamp(g,d),f.set(g).multiply(d),h.add(f),this.grounded!==this.owner.state.grounded&&(this.owner.state.grounded=this.grounded),this.grounded=!1}},"hit-solid":function(b){var c=0,d=null,e=0,f=a;for(b.direction.dot(this.ground)>0&&(this.grounded=!0),c=0;c<this.movers.length;c++)d=this.movers[c],d.stopOnCollision&&(e=d.velocity.scalarProjection(b.direction),f.set(b.direction).normalize().multiply(e).dot(d.velocity)>0&&d.velocity.subtractVector(f))},"set-mover":function(a){"number"==typeof a.maxMagnitudeDelta&&(this.maxMagnitudeDelta=a.maxMagnitudeDelta),a.maxMagnitude&&(this.maxMagnitude=a.maxMagnitude)},"pause-movement":function(){this.paused=!0},"unpause-movement":function(){this.paused=!1}},methods:{destroy:function(){var a=0,b=this.maxMagnitude;for(a=this.movers.length-1;a>=0;a--)this.removeMover(this.movers[a]);delete this.owner.maxMagnitude,this.owner.maxMagnitude=b}},publicMethods:{addMover:function(a){var b=this.owner.addComponent(new platypus.components.Motion(this.owner,a));return b},removeMover:function(a){this.owner.removeComponent(a)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"Node",publicProperties:{x:0,y:0,z:0},constructor:function(a){this.nodeId=a.nodeId||this.owner.nodeId||this.owner.id||String(Math.random()),"string"!=typeof this.nodeId&&this.nodeId.length&&(this.nodeId=a.nodeId.join("|")),this.owner.nodeId=this.nodeId,this.owner.isNode=!0,this.map=this.owner.map=this.owner.map||null,this.contains=this.owner.contains=[],this.edgesContain=this.owner.edgesContain=[],platypus.Vector.assign(this.owner,"position","x","y","z"),this.neighbors=this.owner.neighbors=a.neighbors||this.owner.neighbors||{}},events:{"add-neighbors":function(a){var b=0,c=null;for(c in a)a.hasOwnProperty(c)&&(this.neighbors[c]=a[c]);for(b=0;b<this.contains.length;b++)this.contains[b].triggerEvent("set-directions")},"remove-neighbor":function(a){var b=null,c=a;"string"!=typeof c&&(c=c.nodeId);for(b in this.neighbors)if(this.neighbors.hasOwnProperty(b))if("string"==typeof this.neighbors[b]){if(this.neighbors[b]===c){delete this.neighbors[b];break}}else if(this.neighbors[b].nodeId===c){delete this.neighbors[b];break}}},publicMethods:{getNode:function(a){var b=null;if(!this.map&&this.owner.map&&(this.map=this.owner.map),this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(b.length&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},addToNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},removeFromNode:function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.splice(b,1)[0];return!1},addToEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return!1;return this.edgesContain.push(a),a},removeFromEdge:function(a){var b=0;for(b=0;b<this.edgesContain.length;b++)if(this.edgesContain[b]===a)return this.edgesContain.splice(b,1)[0];return!1}}})}(),function(){"use strict";var a=function(a,b){a.id?"string"==typeof a.id?this.id=a.id:Array.isArray(a.id)?this.id=a.id.join("|"):this.id=String(Math.random()):this.id=String(Math.random()),this.isNode=!0,this.map=b,this.contains=[],this.type=a.type||"",this.x=a.x||0,this.y=a.y||0,this.z=a.z||0,this.neighbors=a.neighbors||{}},b=a.prototype;return b.getNode=function(a){var b=null;if(this.neighbors[a]){if(b=this.neighbors[a],b.isNode)return b;if("string"==typeof b){if(b=this.map.getNode(b))return this.neighbors[a]=b,b}else if(Array.isArray(b)&&(b=this.map.getNode(b.join("|"))))return this.neighbors[a]=b,b;return null}return null},b.add=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return!1;return this.contains.push(a),a},b.remove=function(a){var b=0;for(b=0;b<this.contains.length;b++)if(this.contains[b]===a)return this.contains.splice(b,1)[0];return!1},platypus.createComponentClass({id:"NodeMap",publicProperties:{map:[]},constructor:function(b){var c=0,d=this.map;for(this.map=[],this.nodes={},this.residentsAwaitingNode=[],c=0;c<d.length;c++)this.addNode(new a(d[c],this))},events:{"add-node":function(b){var c=0,d=null,e=null;for(b.isNode?(e=b,b.map=this):e=new a(b,this),this.addNode(e),c=this.residentsAwaitingNode.length-1;c>=0;c--)d=this.residentsAwaitingNode[c],e.id===d.nodeId&&(this.residentsAwaitingNode.splice(c,1),d.node=this.getNode(d.nodeId),d.triggerEvent("on-node",d.node))},"child-entity-added":function(a){a.isNode?this.owner.triggerEvent("add-node",a):a.nodeId&&(a.node=this.getNode(a.nodeId),a.node?a.triggerEvent("on-node",a.node):this.residentsAwaitingNode.push(a))}},methods:{addNode:function(a){this.map.push(a),this.nodes[a.id]=a}},publicMethods:{getNode:function(){var a=0,b="",c="",d=arguments;if(1===d.length){if(d[0].isNode)return d[0];Array.isArray(d[0])&&(d=d[0])}for(a=0;a<d.length;a++)b+=c+d[a],c="|";return this.nodes[b]||null},getClosestNode:function(){var a=new platypus.Vector(0,0,0),b=new platypus.Vector(0,0,0);return function(c,d,e){var f=0,g=0,h=a.set(c),i=b,j=0,k=d||this.map,l=null,m=1/0;for(f=0;f<k.length;f++)if(j=i.set(h).subtractVector(k[f].position).magnitude(),m>j){if(e&&(g=e.indexOf(k[f]),g>=0))break;m=j,l=k[f]}return l}}()}})}(),function(){"use strict";var a=function(a,b,c){return function(d){var e=b.getNode(a);return this.isPassable(e)?(this.destinationNodes.length=0,this.destinationNodes.push(e),this.node?this.onEdge(e):this.distance=0,this.progress=0,this.setState("going-"+c),!0):!1}},b=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=b.z-a.z;return Math.sqrt(c*c+d*d+e*e)},c=function(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=0;return a.rotation&&b.rotation?(e=(a.rotation+180)%360,f=(b.rotation+180)%360,(e*(1-d)+f*d+180)%360):c?(g=Math.acos(e/c),0>f&&(g=2*Math.PI-g),180*g/Math.PI):g},d=function(a,b,c,d){return b*(1-a)+c*a+d},e=function(a,b){var c=0,d=0,e=!1;if(null===b)return!0;for(c=0;c<a.length;c++){for(d=0;d<b.length;d++)a[c].type===b[d]&&(e=!0);if(!e)return!1;e=!1}return!0};return platypus.createComponentClass({id:"NodeResident",publicProperties:{speed:0},constructor:function(a){var c=a.offset||this.owner.nodeOffset||{};this.nodeId=this.owner.nodeId=a.nodeId||this.owner.nodeId,this.neighbors={},this.friendlyNodes=a.nodes||null,this.friendlyEntities=a.shares||null,this.snapToNodes=a.snapToNodes||!1,this.updateOrientation=a.updateOrientation||!1,this.distance=0,this.buffer=a.buffer||0,this.progress=0,this.offset={x:c.x||0,y:c.y||0,z:c.z||0},this.destinationNodes=[],this.algorithm=a.algorithm||b,this.state=this.owner.state,this.currentState=""},events:{"set-algorithm":function(a){this.algorithm=a||b},"handle-logic":function(a){var b=0,e=0,f=0,g=null;if(this.owner.node||(this.owner.triggerEvent("on-node",this.owner.parent.getClosestNode([this.owner.x,this.owner.y])),this.owner.triggerEvent("in-location",this.owner)),this.followEntity?(g=this.followEntity.node||this.followEntity,g&&g.isNode&&g!==this.node?(this.lag=0,this.state.moving=this.gotoNode(),this.followDistance&&(f=this.lag)):this.followEntity=null):f=this.speed*a.delta,this.blocked&&(this.blocked=!1,this.goingToNode&&this.owner.triggerEvent("goto-closest-node",this.goingToNode)),this.destinationNodes.length){if(this.state.moving=0!==this.speed,this.node)this.onEdge(this.destinationNodes[0]);else if(!this.lastNode&&(this.owner.triggerEvent("on-node",this.destinationNodes[0]),this.destinationNodes.splice(0,1),!this.destinationNodes.length))return void(this.state.moving=!1);if(this.snapToNodes){for(b=0;b<this.destinationNodes.length;b++)this.owner.triggerEvent("on-node",this.destinationNodes[b]);this.destinationNodes.length=0}else for(;this.destinationNodes.length&&f;)this.progress+f>=this.distance?(g=this.destinationNodes[0],f-=this.distance-this.progress,this.progress=0,this.destinationNodes.splice(0,1),this.owner.triggerEvent("on-node",g),this.destinationNodes.length&&f&&this.onEdge(this.destinationNodes[0])):(this.progress+=f,e=this.progress/this.distance,this.owner.x=d(e,this.lastNode.x,this.destinationNodes[0].x,this.offset.x),this.owner.y=d(e,this.lastNode.y,this.destinationNodes[0].y,this.offset.y),this.owner.z=d(e,this.lastNode.z,this.destinationNodes[0].z,this.offset.z),this.updateOrientation&&(this.owner.rotation=c(this.lastNode,this.destinationNodes[0],this.distanc,e)),f=0)}else this.state.moving=!1},"on-node":function(a){var b=0,c=null;for(this.owner.node=this.node=a,this.node.removeFromEdge(this.owner),this.lastNode&&this.lastNode.removeFromEdge(this.owner),this.node.addToNode(this.owner),this.setState("on-node"),this.owner.x=this.node.x+this.offset.x,this.owner.y=this.node.y+this.offset.y,this.owner.z=this.node.z+this.offset.z,this.updateOrientation&&this.node.rotation&&(this.owner.rotation=this.node.rotation),this.owner.triggerEvent("set-directions"),this.friendlyNodes&&this.friendlyNodes[a.type]&&this.owner.trigger(this.friendlyNodes[a.type],a),c=a.contains,b=0;b<c.length;b++)this.owner!==c[b]&&(c[b].triggerEvent("with-"+this.owner.type,this.owner),this.owner.triggerEvent("with-"+c[b].type,c[b]))},"leave-node":function(){this.node&&(this.node.removeFromNode(this.owner),this.owner.triggerEvent("left-node",this.node),this.owner.triggerEvent("remove-directions")),this.lastNode=this.node,this.node=null},"goto-node":function(a){this.gotoNode(a)},follow:function(a){a.entity?(this.followDistance=a.distance,this.followEntity=a.entity):(this.followDistance=0,this.followEntity=a)},"goto-closest-node":function(){var a=function(a,b){var c=0;for(c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},b=function(a,b){return a.type===b},c=function(a,b){return a.type===b.type};return function(d){var e=null,f=20,g=this.node||this.lastNode,h=null,i=d.steps||0;if(this.goingToNode=d,h="string"==typeof d?b:"string"==typeof d.type?c:a,g&&d&&!h(g,d))if(e=this.traverseNode({depth:f,origin:g,position:g,test:h,destination:d,nodes:[],shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),e.distance-=this.progress,e.found){if(!this.followEntity)return this.setPath(e,i);if(!this.followDistance)return this.setPath(e,i);if(e.distance+(this.followEntity.progress||0)>this.followDistance)return this.lag=e.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(e,i);this.lag=0}else if(e.blocked)return this.blocked=!0,!1;return!1}}(),"set-directions":function(){var b="",c=0,d=null,e=this.node,f=null;this.owner.triggerEvent("remove-directions");for(b in e.neighbors)if(e.neighbors.hasOwnProperty(b)&&(this.neighbors[b]=a(e.neighbors[b],e.map,b),this.addEventListener(b,this.neighbors[b]),f=e.map.getNode(e.neighbors[b])))for(d=f.contains,c=0;c<d.length;c++)d[c].triggerEvent("next-to-"+this.owner.type,this.owner),this.owner.triggerEvent("next-to-"+d[c].type,d[c])},"remove-directions":function(){var a="";for(a in this.neighbors)this.neighbors.hasOwnProperty(a)&&(this.removeEventListener(a,this.neighbors[a]),delete this.neighbors[a])}},methods:{gotoNode:function(){var a=function(a,b){return a===b};return function(b){var c=null,d=20,e=this.node||this.lastNode;if(!b&&this.followEntity&&(b=this.followEntity.node||this.followEntity.lastNode||this.followEntity),e&&b&&this.node!==b)if(c=this.traverseNode({depth:d,origin:e,position:e,test:a,destination:b,nodes:[],shortestPath:1/0,distance:0,found:!1,algorithm:this.algorithm,blocked:!1}),c.distance-=this.progress,c.found){if(!this.followEntity)return this.setPath(c);if(!this.followDistance)return this.setPath(c);if(c.distance+(this.followEntity.progress||0)>this.followDistance)return this.lag=c.distance+(this.followEntity.progress||0)-this.followDistance,this.setPath(c);this.lag=0}else if(c.blocked)return this.blocked=!0,!1;return!1}}(),isPassable:function(a){return!(!a||this.node===a||this.friendlyNodes&&"undefined"==typeof this.friendlyNodes[a.type]||a.contains.length&&!e(a.contains,this.friendlyEntities))},traverseNode:function(a){var c=1,d="",e=a.position.map,f=null,g=null,h=null,i=null,j=a.algorithm||b,k={shortestPath:1/0,found:!1,blocked:!1},l=!0,m=!1;if(0===a.depth||a.distance>a.shortestPath)return a;if(a.test(a.position,a.destination))return a.found=!0,a.shortestPath=a.distance,a;for(h=a.nodes,c=1;c<h.length-1;c++)if(h[c]===a.position)return a;f=a.position.neighbors;for(d in f)f.hasOwnProperty(d)&&(g=e.getNode(f[d]),m=!0,this.isPassable(g)&&(h=a.nodes.slice(),h.push(g),i=this.traverseNode({depth:a.depth-1,origin:a.origin,position:g,destination:a.destination,test:a.test,algorithm:j,nodes:h,shortestPath:a.shortestPath,distance:a.distance+j(a.position,g),gateway:a.gateway||d,found:!1,blocked:!1}),i.found&&k.shortestPath>i.shortestPath&&(k=i),l=!1));return k.blocked=m&&l,k},setPath:function(a,b){a.nodes[0]===this.node&&a.nodes.splice(0,1),this.destinationNodes=a.nodes,b&&(this.destinationNodes.length=Math.min(b,this.destinationNodes.length))},setState:function(a){"on-node"===a?this.state["on-node"]=!0:(this.state["on-node"]=!1,this.currentState&&(this.state[this.currentState]=!1),this.currentState=a,this.state[a]=!0)},onEdge:function(a){this.distance=b(this.node,a),this.updateOrientation&&(this.owner.rotation=c(this.node,a,this.distance,this.progress/this.distance)),this.node.addToEdge(this.owner),a.addToEdge(this.owner),this.owner.triggerEvent("leave-node")}}})}(),function(){"use strict";var a=include("platypus.Vector"),b=new a,c=new a,d={horizontal:[[-1,0,0],[0,1,0],[0,0,-1]],vertical:[[1,0,0],[0,-1,0],[0,0,-1]],diagonal:[[0,1,0],[1,0,0],[0,0,-1]],"diagonal-inverse":[[0,-1,0],[-1,0,0],[0,0,-1]],"rotate-90":[[0,-1,0],[1,0,0],[0,0,1]],"rotate-180":[[-1,0,0],[0,-1,0],[0,0,1]],"rotate-270":[[0,1,0],[-1,0,0],[0,0,1]]},e=function(){var a=function(a,b,c){var d=0,e=0;for(d=0;d<a.length;d++)e+=a[d]*c[d][b];return e};return function(b,c,d){var e=0,f=0,g=[];for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)g.push(a(b[e],f,c));for(e=0;e<b.length;e++)for(f=0;f<b[0].length;f++)d[e][f]=g.splice(0,1)[0]}}(),f=function(a){var b=0,c=0;for(b=0;3>b;b++)for(c=0;3>c;c++)b===c?a[b][c]=1:a[b][c]=0;return a};return platypus.createComponentClass({id:"Orientation",publicProperties:{scaleX:1,scaleY:1,rotation:0,orientation:0,orientationMatrix:null},constructor:function(){var b=function(b,c){var d=new a([0,0,1]),g=new a([1,0,0]),h=new a([1,0,0]),i=b.owner,j=[[1,0,0],[0,1,0],[0,0,1]];return Object.defineProperty(i,"orientationMatrix",{get:function(){return e(b.matrixTween,b.matrix,f(j)),j},enumerable:!0}),delete i.orientation,
Object.defineProperty(i,"orientation",{get:function(){return h.signedAngleTo(g,d)},set:function(a){h.set(g).rotate(a)},enumerable:!0}),c&&(isNaN(c)?h.set(c):h.rotate(c)),h};return function(a){this.loadedOrientationMatrix=this.orientationMatrix,this.matrix=[[1,0,0],[0,1,0],[0,0,1]],this.matrixTween=[[1,0,0],[0,1,0],[0,0,1]],this.vectors=[],this.inverses=[],this.tweens=[],this.owner.triggerEvent("orient-vector",b(this,this.orientation))}}(),events:{load:function(){this.loadedOrientationMatrix?this.transform(this.loadedOrientationMatrix):(this.scaleX&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.transform("horizontal")),this.scaleY&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.transform("vertical")),this.rotation&&((this.rotation+270)%360===0?(this.rotation=0,this.transform("rotate-90")):(this.rotation+180)%360===0?(this.rotation=0,this.transform("rotate-180")):(this.rotation+90)%360===0&&(this.rotation=0,this.transform("rotate-270")))),delete this.loadedOrientationMatrix},"handle-logic":function(a){var b=0,c=a.delta,d=this.owner.state,e=[],g=null;if(this.tweens.length){for(d.reorienting=!0,f(this.matrixTween),b=this.tweens.length-1;b>=0;b--)this.updateTween(this.tweens[b],c)&&e.push(this.tweens.splice(b,1)[0]);for(b=0;b<this.vectors.length;b++)this.updateVector(this.vectors[b],this.inverses[b]);for(b=0;b<e.length;b++)g=e[b],this.transform(g.endMatrix),g.anchor&&(g.offset.multiply(g.endMatrix).addVector(g.anchor),this.owner.triggerEvent("relocate-entity",{position:g.offset})),g.onFinished(g.endMatrix)}else d.reorienting&&(f(this.matrixTween),d.reorienting=!1)},"complete-tweens":function(){var a=0;for(a=0;a<this.tweens.length;a++)this.tweens[a].time=this.tweens[a].endTime},"drop-tweens":function(){var a=0;for(this.tweens.length=0,a=0;a<this.vectors.length;a++)this.updateVector(this.vectors[a],this.inverses[a])},"orient-vector":function(b){var c=b.aligned||!1;b.vector&&(b=b.vector),-1===this.vectors.indexOf(b)&&(c||b.multiply(this.matrix),this.vectors.push(b),this.inverses.push(new a))},"remove-vector":function(a){var b=this.vectors.indexOf(a);b>=0&&(this.vectors.splice(b,1),this.inverses.splice(b,1))},"tween-transform":function(){var a=function(){},b=function(){return!0},c=function(a){return a};return function(e){var f=e.angle||0,g=e.matrix,h=null;if(g||(g=d[e.transform]),!f&&0===e.transform.indexOf("rotate"))switch(e.transform){case"rotate-90":f=Math.PI/2;break;case"rotate-180":f=Math.PI;break;case"rotate-270":f=-Math.PI/2;break;default:f=e.transform.split("-")[1]/180*Math.PI}e.anchor&&(h=e.offset||this.owner.position.copy().subtractVector(e.anchor,2)),this.tweens.push({transform:e.transform,anchor:e.anchor,offset:h,endTime:e.time||0,time:0,endMatrix:g,angle:f,tween:e.tween||c,onFinished:e.onFinished||a,beforeTick:e.beforeTick||b,afterTick:e.onTick||e.afterTick||a})}}(),transform:function(a){this.transform(a)},"prepend-transform":function(a){this.transform(a)},"append-transform":function(a){this.transform(a,!0)},"replace-transform":function(a){this.replace(a)}},methods:{transform:function(a,b){Array.isArray(a)?this.multiply(a,b):"string"==typeof a&&d[a]&&this.multiply(d[a],b)},multiply:function(){return function(a,b){var c=0;for(b?e(this.matrix,a,this.matrix):e(a,this.matrix,this.matrix),c=0;c<this.vectors.length;c++)this.vectors[c].multiply(a),this.inverses[c].multiply(a);this.owner.triggerEvent("orientation-updated",a)}}(),replace:function(){var a=function(a,b,c,d){return a*d-b*c},b=function(a){var b=0,c=0;for(b=0;3>b;b++)c+=a[b][0]*a[(b+1)%3][1]*a[(b+2)%3][2],c-=a[b][2]*a[(b+1)%3][1]*a[(b+2)%3][0];return c},c=function(c){var d=[[],[],[]],e=1/b(c);return d[0].push(a(c[1][1],c[1][2],c[2][1],c[2][2])*e),d[0].push(a(c[0][2],c[0][1],c[2][2],c[2][1])*e),d[0].push(a(c[0][1],c[0][2],c[1][1],c[1][2])*e),d[1].push(a(c[1][2],c[1][0],c[2][2],c[2][0])*e),d[1].push(a(c[0][0],c[0][2],c[2][0],c[2][2])*e),d[1].push(a(c[0][2],c[0][0],c[1][2],c[1][0])*e),d[2].push(a(c[1][0],c[1][1],c[2][0],c[2][1])*e),d[2].push(a(c[0][1],c[0][0],c[2][1],c[2][0])*e),d[2].push(a(c[0][0],c[0][1],c[1][0],c[1][1])*e),d};return function(a){this.multiply(c(this.matrix)),this.multiply(a)}}(),updateTween:function(){var a=function(a,b,c){return a*(1-c)+b*c};return function(d,f){var g=0,h=1,i=0,j=0,k=1,l=1,m=0,n=d.endMatrix,o=null,p=b,q=c;return d.beforeTick(d.time)&&(d.time+=f),d.time>=d.endTime?!0:(g=d.tween(d.time/d.endTime),d.angle?(m=g*d.angle,h=k=Math.cos(m),i=Math.sin(m),j=-i):(h=a(h,n[0][0],g),i=a(i,n[1][0],g),j=a(j,n[0][1],g),k=a(k,n[1][1],g),l=a(l,n[2][2],g)),o=[[h,j,0],[i,k,0],[0,0,l]],e(o,this.matrixTween,this.matrixTween),d.anchor&&(p.set(d.offset).multiply(1-g),q.set(d.offset).multiply(g),this.owner.triggerEvent("relocate-entity",{position:p.add(q).multiply(o).addVector(d.anchor)})),void d.afterTick(g,o))}}(),updateVector:function(a,b){b.set(a.add(b)),a.multiply(this.matrixTween),b.subtractVector(a)},destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a[Math.floor(Math.random()*a.length)],b,c)}};return platypus.createComponentClass({id:"RandomEvents",constructor:function(b){var c="";if(b.events)for(c in b.events)b.events.hasOwnProperty(c)&&this.addEventListener(c,a(b.events[c]))}})}(),function(){"use strict";var a=function(a,b,c,d){var e=0;for(e=0;e<a.length;e++)a[e].trigger(b,c,d)},b=function(b){return function(c,d){a(this.owner.familyLinks,b,c,d)}};return platypus.createComponentClass({id:"RelayFamily",properties:{events:null},publicProperties:{},constructor:function(a){var c="";if(this.events)for(c in this.events)this.events.hasOwnProperty(c)&&this.addEventListener(c,b(this.events[c]));this.owner.familyLinks=[this.owner]},events:{"link-family":function(b){var c=0,d=this.owner.familyLinks,e=b.concat(d);for(c=0;c<e.length;c++)e[c].familyLinks=e;a(b,"family-members-added",d),a(d,"family-members-added",b)},"entity-created":function(a){a.triggerEvent("link-family",this.owner.familyLinks)||(a.addComponent(new platypus.components.RelayFamily(a,{})),a.triggerEvent("link-family",this.owner.familyLinks))}},methods:{destroy:function(){var b=this.owner.familyLinks.indexOf(this.owner);b>=0&&this.owner.familyLinks.splice(b,1),a(this.owner.familyLinks,"family-member-removed",this.owner),this.events=null}}})}(),function(){"use strict";var a=function(a){return function(b,c){platypus.game.currentScene.triggerOnChildren(a,b,c)}};return platypus.createComponentClass({id:"RelayGame",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a=function(a){return function(b,c){var d=0;for(d=0;d<this.links.length;d++)this.links[d].trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayLinker",properties:{linkId:"linked",events:null},publicProperties:{},constructor:function(b){var c=0,d="";if(this.events)for(d in this.events)this.events.hasOwnProperty(d)&&this.addEventListener(d,a(this.events[d]));if(this.owner.linkId||(this.owner.linkId=this.linkId),this.addEventListener("to-"+this.linkId+"-entities",a("from-"+this.linkId+"-entities")),this.addEventListener("from-"+this.linkId+"-entities",function(a){this.owner.trigger(a.message,a.value,a.debug)}.bind(this)),this.links=[],this.owner.linkEntities)for(c=0;c<this.owner.linkEntities.length;c++)this.links.push(this.owner.linkEntities[c]);this.message={message:"",value:null},this.linkMessage={entity:this.owner,linkId:this.linkId,reciprocate:!1},this.owner.parent&&this.resolveAdoption()},events:{adopted:function(a){this.resolveAdoption(a)},"link-entity":function(a){a.linkId===this.linkId&&a.entity!==this.owner&&-1===this.links.indexOf(a.entity)&&(this.links.push(a.entity),a.reciprocate&&(this.linkMessage.reciprocate=!1,a.entity.trigger("link-entity",this.linkMessage)))},"unlink-entity":function(a){var b=this.links.indexOf(a.entity);b>=0&&this.links.splice(b,1)}},methods:{resolveAdoption:function(a){for(var b=this.owner.parent;b.parent;)b=b.parent;this.linkMessage.reciprocate=!0,b.triggerOnChildren("link-entity",this.linkMessage,!0)},destroy:function(){var a=0;for(a=0;a<this.links.length;a++)this.links[a].trigger("unlink-entity",this.linkMessage);this.links.length=0,this.events=null}}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.parent&&this.owner.parent.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelayParent",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a=function(a){return function(b,c){this.owner.trigger(a,b,c)}};return platypus.createComponentClass({id:"RelaySelf",properties:{events:{}},constructor:function(){var b="";for(b in this.events)this.events.hasOwnProperty(b)&&this.addEventListener(b,a(this.events[b]))}})}(),function(){"use strict";var a={aabb:16746751,render:8947848,collision:16711935,group:65280},b=function(b,c,d,e,f,g,h){var i=null;switch(b){case"rectangle":i=(new PIXI.Graphics).beginFill(a[c],.1).drawRect(d,e,f,g);break;case"circle":i=(new PIXI.Graphics).beginFill(a[c],.1).drawCircle(0,0,f)}return i.z=h,i};return platypus.createComponentClass({id:"RenderDebug",constructor:function(a){this.regX=a.regX||0,this.regY=a.regY||0,this.parentContainer=null,this.shapes=[],this.isOutdated=!0},events:{"handle-render-load":function(a){platypus.game.settings.debug?!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container):this.owner.removeComponent(this)},"handle-render":function(a){var b=0,c=null;if(!this.parentContainer){if(!platypus.game.settings.debug)return void this.owner.removeComponent(this);if(!a.container)return console.warn('No Container, removing render debug component from "'+this.owner.type+'".'),void this.owner.removeComponent(this);this.parentContainer=a.container}for(this.isOutdated&&(this.updateSprites(),this.isOutdated=!1),b=0;b<this.shapes.length;b++)this.shapes[b].x=this.owner.x,this.shapes[b].y=this.owner.y;this.owner.getCollisionGroupAABB&&(c=this.owner.getCollisionGroupAABB(),this.groupShape||(this.groupShape=(new PIXI.Graphics).beginFill("rgba(255,255,0,0.2)").drawRect(-.5,-.5,1,1),this.groupShape.z=(this.owner.z||0)+1e4,this.parentContainer.addChild(this.groupShape)),this.groupShape.scaleX=c.width,this.groupShape.scaleY=c.height,this.groupShape.x=c.x,this.groupShape.y=c.y)},"orientation-updated":function(){this.isOutdated=!0}},methods:{updateSprites:function(){var a=(this.owner.z||0)+1e4,c=0,d=0,e=this.owner.width=this.owner.width||300,f=this.owner.height=this.owner.height||100,g=null,h=null,i=null;for(c=0;c<this.shapes.length;c++)this.parentContainer.removeChild(this.shapes[c]);if(this.shapes.length=0,this.owner.getAABB)for(d=0;d<this.owner.collisionTypes.length;d++)for(h=this.owner.getAABB(this.owner.collisionTypes[d]),e=this.initialWidth=h.width,f=this.initialHeight=h.height,g=this.owner.getShapes(this.owner.collisionTypes[d]),i=b("rectangle","aabb",h.left-this.owner.x,h.top-this.owner.y,e,f,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i),c=0;c<g.length;c++)i=b(g[c].type,"collision",g[c].offsetX-g[c].width/2,g[c].offsetY-g[c].height/2,g[c].radius||g[c].width,g[c].height,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i);else i=b("rectangle","render",-e/2,-f/2,e,f,a--),this.shapes.push(i),this.parentContainer.addChild(i),this.addInput(i)},addInput:function(){var a=null,b=function(b){return function(c){return a!==b.owner&&(a=b.owner,console.log('Entity "'+a.type+'":',a)),!1}};return function(a){a.interactive=!0,a.addListener("rightdown",b(this))}}(),destroy:function(){var a=0;for(a=0;a<this.shapes.length;a++)this.parentContainer.removeChild(this.shapes[a]);this.shapes.length=0,this.parentContainer=void 0}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderDestroyMe",constructor:function(a){this.animationIds=null,a.animationId?this.animationIds=[a.animationId]:a.animationIds&&(this.animationIds=a.animationIds)},events:{"animation-ended":function(a){var b=a.name;(!this.animationIds||this.animationIds.indexOf(b)>=0)&&this.owner.parent.removeEntity(this.owner)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"RenderProgress",properties:{backgroundColor:0,color:16777215,rotate:!1,mirror:!1,flip:!1,width:100,height:20,regX:0,regY:0},publicProperties:{x:0,y:0,z:0},constructor:function(a){var b=new PIXI.Graphics,c=new PIXI.Graphics,d=new PIXI.Container;this.parentContainer=null,this.background=b,this.progress=c,this.container=d,"string"==typeof this.backgroundColor&&(this.backgroundColor=+this.backgroundColor.replace("#","0x")),"string"==typeof this.color&&(this.color=+this.color.replace("#","0x")),b.f(this.backgroundColor).r(-this.regX,-this.regY,this.width,this.height),c.f(this.color).r(-this.regX,-this.regY,this.width,this.height),c.scale=new PIXI.Point(1e-4,1),d.addChild(b),d.addChild(c)},events:{"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container))},"handle-render":function(a){this.container&&(this.parentContainer||(a&&a.container?(this.parentContainer=a.container,this.parentContainer.addChild(this.container)):(console.warn('No PIXI Stage, removing ProgressRender component from "'+this.owner.type+'".'),this.owner.removeComponent(this))),this.container.x=this.x,this.container.y=this.y,this.container.z=this.z)},"update-progress":function(a){isNaN(a)?"number"==typeof a.fraction?this.progress.scale.x=a.fraction:"number"==typeof a.total&&"number"==typeof a.progress&&(this.progress.scale.x=a.progress/a.total):this.progress.scale.x=a}},methods:{destroy:function(){this.parentContainer&&(this.parentContainer.removeChild(this.container),this.parentContainer=null),this.container=null}}})}(),function(){"use strict";var a=new PIXI.Matrix,b=function(a){return function(b){this.animationFinished||this.lastState>=-1?(this.currentAnimation=a,this.lastState=-1,this.animationFinished=!1,this.sprite.gotoAndPlay(a)):(this.waitingAnimation=a,this.waitingState=-1)}},c=function(a,b){var c=0,d=a.replace(/ /g,"").split(",");return"default"===a?function(a){return b}:function(a){for(c=0;c<d.length;c++)if(!a[d[c]])return!1;return b}},d=function(){var a=function(a,b){var c=0,d=b.indexOf("("),e=b.substring(0,d),f=b.substring(d+1,b.indexOf(")"));if(f.length){for(f=f.split(","),c=0;c<f.length;c++)f[c]=+f[c];a[e].apply(a,f)}else a[e]()};return function(b,c){var d=0,e=c.split(".");for(d=0;d<e.length;d++)a(b,e[d])}}();return platypus.createComponentClass({id:"RenderSprite",properties:{spriteSheet:null,animationMap:null,mask:null,acceptInput:null,pinLocations:null,pinTo:null,offsetZ:0,rotate:!1,mirror:!1,flip:!1,visible:!0,eventBased:!1,stateBased:!0,cache:!1,forcePlayThrough:!1,ignoreOpacity:!1},publicProperties:{buttonMode:!1,scaleX:1,scaleY:1,skewX:0,skewY:0,rotation:0,x:0,y:0,z:0},constructor:function(){var a=function(a,b){var c=null,d="";if(a)return a;if(Array.isArray(b.frames)&&1===b.frames.length)return null;c={};for(d in b.animations)b.animations.hasOwnProperty(d)&&(c[d]=d);return c},d=function(a,d){var e="",f="";a.followThroughs={},a.checkStates=[];for(e in d)d.hasOwnProperty(e)&&(f=d[e],"!"===f[f.length-1]?(f=f.substring(0,f.length-1),a.followThroughs[f]=!0):a.followThroughs[f]=!1,a.eventBased&&a.addEventListener(e,b(f)),a.stateBased&&a.checkStates.push(c(e,f)))};return function(b){var c=null,e=null;this.spriteSheet?c="string"==typeof this.spriteSheet?platypus.game.settings.spriteSheets[this.spriteSheet]:this.spriteSheet:(c={},console.warn(this.owner.type+" - RenderSprite: Sprite Sheet not defined.")),e=a(this.animationMap,c),this.parentContainer=null,this.stateBased=e&&this.stateBased,this.eventBased=e&&this.eventBased,this.hover=!1,this.click=!1,this.wasVisible=this.visible,this.lastX=this.owner.x,this.lastY=this.owner.y,this.camera=new platypus.AABB,(this.eventBased||this.stateBased)&&(d(this,e),this.currentAnimation=e["default"]||""),this.sprite=new platypus.PIXIAnimation(c,this.currentAnimation||0),this.sprite.onComplete=function(a){this.owner.trigger("animation-ended",a),this.waitingAnimation?(this.currentAnimation=this.waitingAnimation,this.waitingAnimation=!1,this.lastState=this.waitingState,this.animationFinished=!1,this.sprite.gotoAndPlay(this.currentAnimation)):this.animationFinished=!0}.bind(this),this.affine=new PIXI.Matrix,this.pinLocations?(this.container=new PIXI.Container,this.container.transformMatrix=new PIXI.Matrix,this.container.addChild(this.sprite),this.sprite.z=0,this.addPins(this.pinLocations,c.frames),this.sprite.transformMatrix=new PIXI.Matrix):(this.container=this.sprite,this.sprite.transformMatrix=new PIXI.Matrix),this.pinTo&&this.owner.triggerEvent("pin-me",this.pinTo),this.acceptInput&&(this.hover=this.acceptInput.hover||!1,this.click=this.acceptInput.click||!1,this.acceptInput.hitArea&&(this.container.hitArea=this.setHitArea(this.acceptInput.hitArea))),this.isOnCamera=!0,this.state=this.owner.state,this.stateChange=!0,this.lastState=-1,this.waitingAnimation=!1,this.waitingState=0,this.playWaiting=!1,this.animationFinished=!1,this.cache&&(this.updateSprite(!1),this.owner.cacheRender=this.container)}}(),events:{cache:function(){this.updateSprite(!1),this.owner.cacheRender=this.container,this.cache=!0,this.owner.parent&&this.owner.parent.triggerEventOnChildren?this.owner.parent.triggerEventOnChildren("cache-sprite",this.owner):console.warn("Unable to cache sprite for "+this.owner.type)},"camera-update":function(a){this.camera.set(a.viewport),this.sprite&&this.checkCameraBounds()},"handle-render-load":function(a){!this.parentContainer&&a&&a.container&&(this.addStage(a.container),this.updateSprite(!0))},"handle-render":function(a){if(this.container){if(!this.parentContainer){if(this.pinTo)return;if(!this.addStage(a.container))return console.warn('No PIXI Stage, removing render component from "'+this.owner.type+'".'),void this.owner.removeComponent(this)}this.updateSprite(!0)}},"state-changed":function(){this.stateChange=!0},"hide-sprite":function(){this.visible=!1},"show-sprite":function(){this.visible=!0},"pin-me":function(a){this.pins&&this.pins[a]&&this.owner.trigger("attach-pin",this.pins[a])},"attach-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer=a.container,this.parentContainer.addChild(this.container),this.addInputs(),this.pinnedTo=a,this.updateSprite(!0))},"remove-pin":function(a){a.pinId===this.pinTo&&(this.parentContainer.removeChild(this.container),this.parentContainer=null,this.pinnedTo=null)},"dispatch-event":function(a){this.sprite.dispatchEvent(this.sprite,a.event,a.data)},"input-on":function(){this.removeInputListeners||this.addInputs()},"input-off":function(){this.removeInputListeners&&this.removeInputListeners()},"set-mask":function(a){this.setMask(a)}},methods:{checkCameraBounds:function(){var b=null,c=this.sprite,d=null,e=null;for(d=c.transformMatrix.copy(a),e=this.pinnedTo;e;)d.prepend(e.container.transformMatrix),e=e.pinnedTo;c._currentBounds=null,b=c.getBounds(d),b&&(b.x+b.width<this.camera.left||b.x>this.camera.right||b.y+b.height<this.camera.top||b.y>this.camera.bottom)?this.isOnCamera=!1:this.isOnCamera=!0},addStage:function(a){return a&&!this.pinTo?(this.parentContainer=a,this.parentContainer.addChild(this.container),this.mask&&this.setMask(this.mask),this.addInputs(),a):null},updateSprite:function(){var a=function(a,b){return a.z-b.z};return function(b){var c=0,d=0,e=0,f=null,g=0,h=!1,i=1,j=1,k=null,l=this.affine.copy(this.container.transformMatrix),m=PIXI.Matrix.TEMP_MATRIX;if(this.buttonMode!==this.container.buttonMode&&(this.container.buttonMode=this.buttonMode),this.pinnedTo?this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame]?(d=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].x,e=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].y,this.container.z!==this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z),g=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].angle||0,this.visible=!0):this.pinnedTo.defaultPin?(d=this.pinnedTo.defaultPin.x,e=this.pinnedTo.defaultPin.y,this.container.z!==this.pinnedTo.defaultPin.z&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.pinnedTo.defaultPin.z),g=this.pinnedTo.defaultPin.angle||0,this.visible=!0):this.visible=!1:(d=this.owner.x,e=this.owner.y,this.rotate&&(g=this.rotation),this.container.z!==this.owner.z+this.offsetZ&&(this.parentContainer&&(this.parentContainer.reorder=!0),this.container.z=this.owner.z+this.offsetZ),this.ignoreOpacity||!this.owner.opacity&&0!==this.owner.opacity||(this.container.alpha=this.owner.opacity)),this.container.reorder&&(this.container.reorder=!1,this.container.children.sort(a)),(this.mirror||this.flip)&&(k=this.rotation%360,this.mirror&&k>90&&270>k&&(i=-1),this.flip&&180>k&&(j=-1)),this.stateBased&&this.stateChange){if(void 0!==this.state.visible&&(this.visible=this.state.visible),this.checkStates)for(c=0;c<this.checkStates.length;c++)if(h=this.checkStates[c](this.state)){this.currentAnimation!==h?!this.followThroughs[this.currentAnimation]&&(!this.forcePlaythrough||this.animationFinished||this.lastState>=+c)?(this.currentAnimation=h,this.lastState=+c,this.animationFinished=!1,b?this.sprite.gotoAndPlay(h):this.sprite.gotoAndStop(h)):(this.waitingAnimation=h,this.waitingState=+c):this.waitingAnimation&&!this.followThroughs[this.currentAnimation]&&(this.waitingAnimation=!1);break}this.stateChange=!1}g&&l.rotate(g/180*Math.PI),this.pinnedTo?(m.tx=d,m.ty=e,m.a=i,m.b=0,m.c=0,m.d=j,l.prepend(m)):(this.owner.orientationMatrix&&(f=this.owner.orientationMatrix,m.tx=f[0][2],m.ty=f[1][2],m.a=f[0][0],m.b=f[1][0],m.c=f[0][1],m.d=f[1][1],l.prepend(m)),m.tx=d,m.ty=e,m.a=this.scaleX*i,m.b=this.owner.skewX,m.c=this.owner.skewY,m.d=this.scaleY*j,l.prepend(m)),this.sprite&&(!this.wasVisible&&this.visible||this.lastX!==this.owner.x||this.lastY!==this.owner.y)&&this.checkCameraBounds(),this.lastX=this.owner.x,this.lastY=this.owner.y,this.wasVisible=this.visible,this.container.visible=this.visible&&this.isOnCamera}}(),triggerInput:function(a,b){this.container&&this.owner.trigger(b,{event:a.data.originalEvent,pixiEvent:a,x:a.data.global.x/this.parentContainer.transformMatrix.a+this.camera.left,y:a.data.global.y/this.parentContainer.transformMatrix.d+this.camera.top,entity:this.owner})},addInputs:function(){var a=!1,b=this.container,c=null,d=null,e=null,f=null,g=null,h=null;this.click&&(b.interactive=!0,c=function(b){a||(this.triggerInput(b,"mousedown"),b.target.mouseTarget=!0,a=!0)}.bind(this),f=function(b){a?(this.triggerInput(b,"pressmove"),b.target.mouseTarget=!0):this.triggerInput(b,"mousemove")}.bind(this),g=function(b){a&&(this.triggerInput(b,"pressup"),b.target.mouseTarget=!1,a=!1,b.target.removeDisplayObject&&b.target.removeDisplayObject())}.bind(this),h=function(a){this.triggerInput(a,"click")}.bind(this),b.addListener("mousedown",c),b.addListener("touchstart",c),b.addListener("mouseup",g),b.addListener("touchend",g),b.addListener("mouseupoutside",g),b.addListener("touchendoutside",g),b.addListener("mousemove",f),b.addListener("touchmove",f),b.addListener("click",h),b.addListener("tap",h)),this.hover&&(b.interactive=!0,d=function(a){this.triggerInput(a,"mouseover")}.bind(this),e=function(a){this.triggerInput(a,"mouseout")}.bind(this),b.addListener("mouseover",d),b.addListener("mouseout",e)),this.removeInputListeners=function(){this.click&&(b.removeListener("mousedown",c),b.removeListener("touchstart",c),b.removeListener("mouseup",g),b.removeListener("touchend",g),b.removeListener("mouseupoutside",g),b.removeListener("touchendoutside",g),b.removeListener("mousemove",f),b.removeListener("touchmove",f),b.removeListener("click",h),b.removeListener("tap",h)),this.hover&&(b.removeListener("mouseover",d),b.removeListener("mouseout",e)),b.interactive=!1,this.removeInputListeners=null}},addPins:function(a,b){var c=0,d=0,e=null,f=b.regX||0,g=b.regY||0,h=Array.isArray(b);for(this.pinsToRemove=this.pinsToRemove||[],this.pins={},c=0;c<a.length;c++){if(this.pinsToRemove.push(a[c].pinId),h&&(f=b[0][5]||0,g=b[0][6]||0),this.pins[a[c].pinId]=e={pinId:a[c].pinId,sprite:this.sprite,container:this.container},"number"==typeof a[c].x&&"number"==typeof a[c].y&&(e.defaultPin={x:a[c].x-f,y:a[c].y-g,z:a[c].z||1e-8,angle:a[c].angle||0}),a[c].frames)for(e.frames=[],d=0;d<a[c].frames.length;d++)a[c].frames[d]?(h&&(f=b[d][5]||0,g=b[d][6]||0),"number"==typeof a[c].frames[d].x&&"number"==typeof a[c].frames[d].y?e.frames.push({x:a[c].frames[d].x-f,y:a[c].frames[d].y-g,z:a[c].frames[d].z||(e.defaultPin?e.defaultPin.z:1e-8),angle:a[c].frames[d].angle||(e.defaultPin?e.defaultPin.angle:0)}):e.defaultPin?"number"==typeof a[c].frames[d].x?e.frames.push({x:a[c].frames[d].x-f,y:e.defaultPin.y,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):"number"==typeof a[c].frames[d].y?e.frames.push({x:e.defaultPin.x,y:a[c].frames[d].y-g,z:a[c].frames[d].z||e.defaultPin.z,angle:a[c].frames[d].angle||e.defaultPin.angle}):e.frames.push(null):e.frames.push(null)):e.frames.push(null);this.owner.trigger("attach-pin",e)}},removePins:function(){var a=0;if(this.pins&&this.pinsToRemove){for(a=0;a<this.pinsToRemove.length;a++)this.owner.trigger("remove-pin",this.pins[this.pinsToRemove[a]].pinId),delete this.pins[this.pinsToRemove[a]];this.pinsToRemove.length=0}},setMask:function(a){var b=null;return this.mask&&this.parentContainer&&this.parentContainer.removeChild(this.mask),a?(a instanceof PIXI.Graphics?b=a:(b=new PIXI.Graphics,b.beginFill(0,1),"string"==typeof a?d(b,a):a.radius?b.dc(a.x||0,a.y||0,a.radius):a.width&&a.height&&b.r(a.x||0,a.y||0,a.width,a.height),b.endFill()),b.isMask=!0,this.mask=this.container.mask=b,void(this.parentContainer&&this.parentContainer.addChild(this.mask))):void(this.mask=this.container.mask=null)},setHitArea:function(){var a={};return function(b){var c=null,d="";return d=JSON.stringify(b),c=a[d],c||(c=b.radius?new PIXI.Circle(b.x||0,b.y||0,b.radius):new PIXI.Rectangle(b.x||0,b.y||0,b.width||this.owner.width||0,b.height||this.owner.height||0),a[d]=c),c}}(),destroy:function(){this.removeInputListeners&&this.removeInputListeners(),this.parentContainer&&(this.container.mouseTarget?(this.container.visible=!1,this.container.removeDisplayObject=function(){this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null}.bind(this)):(this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null)),this.removePins(),this.followThroughs=null,this.cache||this.sprite.destroy(),this.sprite=null}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d?platypus.game.settings.spriteSheets[d].images:d.images}})}(),function(){"use strict";var a=include("platypus.AABB"),b=include("platypus.PIXIAnimation"),c=include("springroll.Application"),d=include("PIXI.CanvasRenderer"),e=include("PIXI.Container"),f=include("PIXI.Graphics"),g=include("PIXI.ParticleContainer"),h=include("PIXI.RenderTexture"),i=include("PIXI.Sprite"),j=function(){return null},k=new a,l=function(a,b){return a.z-b.z},m=function(a){for(var b=1;a>b;)b*=2;return b},n=function(a,b){var c=+a.substring(4),d=0;return 2147483648&c&&(b.scale.x=-1),1073741824&c&&(b.scale.y=-1),536870912&c&&(d=b.scale.x,b.scale.x=b.scale.y,b.scale.y=-d,b.rotation=Math.PI/2),268435455&c},o=function(a,b){this.id=b,this.instances=[a],this.index=0,a.template=this},p={getNext:j,destroy:j},q=o.prototype;return q.getNext=function(){var a=this.instances[this.index],b=null;return a||(b=this.instances[0],a=this.instances[this.index]=new i(b.texture),a.scale=b.scale,a.rotation=b.rotation,a.anchor=b.anchor),this.index+=1,a},q.clear=function(){this.index=0},q.destroy=function(){var a=0;for(a=0;a<this.instances.length;a++)this.instances[a].destroy();this.instances.length=0},platypus.createComponentClass({id:"RenderTiles",properties:{buffer:0,cacheAll:!1,entityCache:!1,imageMap:[],maximumBuffer:2048,scaleX:1,scaleY:1,spriteSheet:null,tileCache:!0,tileHeight:10,tileWidth:10},constructor:function(b){var f=this.imageMap;this.doMap=null,this.cachedDisplayObjects=null,this.populate=this.populateTiles,this.tiles={},this.renderer=c.instance.display.renderer,this.tilesSprite=null,this.cacheTexture=null,this.mapContainer=null,this.laxCam=new a,this.worldWidth=this.tileWidth,this.worldHeight=this.tileHeight,this.cache=new a,this.cachePixels=new a,this.spriteSheet&&"string"==typeof this.spriteSheet&&(this.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]),this.tileContainer=this.spriteSheet.images.length>1||this.renderer instanceof d?new e:new g(15e3,{position:!0,rotation:!0,scale:!0}),this.mapContainer=new e,this.mapContainer.addChild(this.tileContainer),this.reorderedStage=!1,this.updateCache=!1,this.imageMap=[this.createMap(f)],this.tilesWidth=this.imageMap[0].length,this.tilesHeight=this.imageMap[0][0].length,this.layerWidth=this.tilesWidth*this.tileWidth,this.layerHeight=this.tilesHeight*this.tileHeight,this.cacheWidth=Math.min(m(this.layerWidth),this.maximumBuffer),this.cacheHeight=Math.min(m(this.layerHeight),this.maximumBuffer),this.tileCache||(this.buffer=0,this.cacheAll=!1)},events:{"handle-render-load":function(a){var b=this.owner.z,c=this.renderer,d=null;a&&a.container&&(d=this.parentContainer=a.container,d&&!this.reorderedStage&&(d.reorder=!0,this.reorderedStage=!0),this.updateRegion(),this.tileCache?(this.render=this.renderCache,this.mapContainerWrapper=new e,this.mapContainerWrapper.addChild(this.mapContainer),this.layerWidth<=this.cacheWidth&&this.layerHeight<=this.cacheHeight?(this.cacheAll=!0,this.cacheTexture=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSprite=new i(this.cacheTexture),this.tilesSprite.scaleX=this.scaleX,this.tilesSprite.scaleY=this.scaleY,this.tilesSprite.z=b,this.cache.setBounds(0,0,this.tilesWidth-1,this.tilesHeight-1),this.update(this.cacheTexture,this.cache),d.addChild(this.tilesSprite)):this.cacheAll||this.layerWidth<=2*this.cacheWidth&&this.layerHeight<=this.cacheHeight||this.layerWidth<=this.cacheWidth&&this.layerHeight<=2*this.cacheHeight?(this.cacheAll=!0,this.cacheGrid=[],this.createGrid=function(){var a=0,b=0,e=0,f=0,g=this.owner.z,j=null,k=null;for(e=0;e<this.tilesWidth;e+=this.cacheTilesWidth)for(j=[],this.cacheGrid.push(j),f=0;f<this.tilesHeight;f+=this.cacheTilesHeight)a=Math.min(m((this.tilesWidth-e)*this.tileWidth),this.cacheWidth),b=Math.min(m((this.tilesHeight-f)*this.tileHeight),this.cacheHeight),k=new h(c,a,b),k=new i(k),k.x=e*this.tileWidth,k.y=f*this.tileHeight,k.z=g,k.scaleX=this.scaleX,k.scaleY=this.scaleY,j.push(k),d.addChild(k),g-=1e-6}.bind(this),this.updateCache=!0):(this.cacheAll=!1,this.cacheTexture=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSprite=new i(this.cacheTexture),this.tilesSprite.scaleX=this.scaleX,this.tilesSprite.scaleY=this.scaleY,this.tilesSprite.z=b,this.cacheTexture.alternate=new h(c,this.cacheWidth,this.cacheHeight),this.tilesSpriteCache=new i(this.cacheTexture.alternate),this.cacheTexture.alternate.alternate=this.cacheTexture,d.addChild(this.tilesSprite))):(this.render=j,this.mapContainer.scaleX=this.scaleX,this.mapContainer.scaleY=this.scaleY,this.mapContainer.z=b,d.addChild(this.mapContainer)))},"cache-sprite":function(a){this.cacheSprite(a)},"peer-entity-added":function(a){this.cacheSprite(a)},"add-tiles":function(a){var b=a.imageMap;b&&(this.imageMap.push(this.createMap(b)),this.updateCache=!0)},"camera-loaded":function(a){this.worldWidth=a.worldWidth,this.worldHeight=a.worldHeight,this.buffer&&!this.cacheAll&&this.updateBufferRegion(a.viewport)},"camera-update":function(a){var b=0,c=0,d=!1,e=null,f=0,g=0,h=0,i=0,j=this.cache,l=this.cachePixels,m=a.viewport,n=this.buffer&&(m.width!==this.laxCam.width||m.height!==this.laxCam.height),o=k,p=this.convertCamera(m);
if(!this.cacheAll&&(l.empty||!l.contains(p))&&this.imageMap.length>0&&(n&&this.updateBufferRegion(p),f=this.cacheTilesWidth-1,g=this.cacheTilesHeight-1,h=f/2,i=g/2,o.setAll(Math.round(p.x/this.tileWidth-h)+h,Math.round(p.y/this.tileHeight-i)+i,f,g),o.left<0?o.moveX(o.halfWidth):o.right>this.tilesWidth-1&&o.moveX(this.tilesWidth-1-o.halfWidth),o.top<0?o.moveY(o.halfHeight):o.bottom>this.tilesHeight-1&&o.moveY(this.tilesHeight-1-o.halfHeight),this.tileCache?(j.empty||!o.contains(j))&&(this.tilesSpriteCache.texture=this.cacheTexture,this.cacheTexture=this.cacheTexture.alternate,this.tilesSprite.texture=this.cacheTexture,this.update(this.cacheTexture,o,this.tilesSpriteCache,j)):this.update(null,o),l.set(j).setAll((l.x+.5)*this.tileWidth,(l.y+.5)*this.tileHeight,(l.width+1)*this.tileWidth,(l.height+1)*this.tileHeight)),this.cacheGrid)for(b=0;b<this.cacheGrid.length;b++)for(c=0;c<this.cacheGrid[b].length;c++)e=this.cacheGrid[b][c],l.setAll((b+.5)*this.cacheClipWidth,(c+.5)*this.cacheClipHeight,this.cacheClipWidth,this.cacheClipHeight),d=l.intersects(p),e.visible&&!d?e.visible=!1:!e.visible&&d&&(e.visible=!0),e.visible&&d&&(e.x=a.viewport.left-p.left+b*this.cacheClipWidth,e.y=a.viewport.top-p.top+c*this.cacheClipHeight);else this.tileCache&&(this.tilesSprite.x=a.viewport.left-p.left+j.left*this.tileWidth,this.tilesSprite.y=a.viewport.top-p.top+j.top*this.tileHeight)},"handle-render":function(a){this.updateCache&&(this.updateCache=!1,this.cacheGrid?this.updateGrid():this.update(this.cacheTexture,this.cache))}},methods:{cacheSprite:function(a){var b=0,c=0,d=a.cacheRender,e=null,f=0,g=0,h=0,i=0;if(this.entityCache&&d){for(this.doMap||(this.doMap=[],this.cachedDisplayObjects=[],this.populate=this.populateTilesAndEntities),this.cachedDisplayObjects.push(d),e=d.getBounds(d.transformMatrix),f=Math.max(0,Math.floor(e.y/this.tileHeight)),g=Math.min(this.tilesHeight,Math.ceil((e.y+e.height)/this.tileHeight)),i=Math.max(0,Math.floor(e.x/this.tileWidth)),h=Math.min(this.tilesWidth,Math.ceil((e.x+e.width)/this.tileWidth)),b=i;h>b;b++)for(this.doMap[b]||(this.doMap[b]=[]),c=f;g>c;c++)this.doMap[b][c]||(this.doMap[b][c]=[]),this.doMap[b][c].push(d);a.removeComponent("RenderSprite"),this.updateCache=!0}},convertCamera:function(a){var b=this.worldWidth/this.scaleX,c=b-a.width,d=this.worldHeight/this.scaleY,e=d-a.height,f=this.laxCam;return b!==this.layerWidth&&c?f.moveX(a.left*(this.layerWidth-a.width)/c+a.halfWidth):f.moveX(a.x),d!==this.layerHeight&&e?f.moveY(a.top*(this.layerHeight-a.height)/e+a.halfHeight):f.moveY(a.y),(a.width!==f.width||a.height!==f.height)&&f.resize(a.width,a.height),f},createTile:function(a){var c=null,d="";return"tile-1"===a?p:(c=new b(this.spriteSheet),d="tile"+n(a,c),c.gotoAndStop(d),new o(c,a))},createMap:function(a){var b=0,c=0,d="",e=null,f=this.tiles,g=null;if("string"!=typeof a[0][0])return a;for(e=[],b=0;b<a.length;b++)for(e[b]=[],c=0;c<a[b].length;c++)d=a[b][c],d.id&&(d=d.id),g=f[d],g||null===g||(g=f[d]=this.createTile(d)),e[b][c]=f[d];return e},updateRegion:function(){var a=Math.floor(this.cacheWidth/this.tileWidth),b=Math.floor(this.cacheHeight/this.tileHeight);this.cacheTilesWidth=Math.min(this.tilesWidth,a),this.cacheTilesHeight=Math.min(this.tilesHeight,b),this.cacheClipWidth=this.cacheTilesWidth*this.tileWidth,this.cacheClipHeight=this.cacheTilesHeight*this.tileHeight,this.tileCache&&(this.mapContainer.mask=(new f).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill())},updateBufferRegion:function(a){var b=Math.floor(this.cacheWidth/this.tileWidth),c=Math.floor(this.cacheHeight/this.tileHeight);this.cacheTilesWidth=Math.min(this.tilesWidth,Math.ceil((a.width+2*this.buffer)/this.tileWidth),b),this.cacheTilesHeight=Math.min(this.tilesHeight,Math.ceil((a.height+2*this.buffer)/this.tileHeight),c),this.cacheClipWidth=this.cacheTilesWidth*this.tileWidth,this.cacheClipHeight=this.cacheTilesHeight*this.tileHeight,this.mapContainer.mask=(new f).beginFill(0).drawRect(0,0,this.cacheClipWidth,this.cacheClipHeight).endFill()},update:function(a,b,c,d){this.populate(b,d),this.render(b,a,this.mapContainer,this.mapContainerWrapper,c,d),d&&d.set(b)},populateTiles:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=[];for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left)for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&h.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));for(e=0;e<h.length;e++)h[e].clear()},populateTilesAndEntities:function(a,b){var c=0,d=0,e=0,f=0,g=null,h=null,i=[],j=[],k=null;for(this.tileContainer.removeChildren(),c=a.left;c<=a.right;c++)for(d=a.top;d<=a.bottom;d++)if(!b||b.empty||d>b.bottom||d<b.top||c>b.right||c<b.left){for(f=0;f<this.imageMap.length;f++)g=this.imageMap[f][c][d].getNext(),g&&(g.template&&j.push(g.template),g.x=(c+.5)*this.tileWidth,g.y=(d+.5)*this.tileHeight,this.tileContainer.addChild(g));if(this.doMap[c]&&this.doMap[c][d])for(k=this.doMap[c][d],e=0;e<k.length;e++)k[e].drawn||(k[e].drawn=!0,i.push(k[e]))}if(this.mapContainer.removeChildren(),this.mapContainer.addChild(this.tileContainer),i.length)for(i.sort(l),e=0;e<i.length;e++)h=i[e],delete h.drawn,this.mapContainer.addChild(h),h.mask&&this.mapContainer.addChild(h.mask);for(e=0;e<j.length;e++)j[e].clear()},renderCache:function(a,b,c,d,e,f){e&&!f.empty&&(e.x=f.left*this.tileWidth,e.y=f.top*this.tileHeight,c.addChild(e)),c.x=-a.left*this.tileWidth,c.y=-a.top*this.tileHeight,b.clear(),b.render(d),b.requiresUpdate=!0},updateGrid:function(){var a=0,b=0,c=this.cacheGrid;for(this.createGrid&&(this.createGrid(),this.createGrid=null),a=0;a<c.length;a++)for(b=0;b<c[a].length;b++)this.cache.setBounds(a*this.cacheTilesWidth,b*this.cacheTilesHeight,Math.min((a+1)*this.cacheTilesWidth,this.tilesWidth-1),Math.min((b+1)*this.cacheTilesHeight,this.tilesHeight-1)),this.update(c[a][b].texture,this.cache)},destroy:function(){var a=0,b=0,c="",d=this.cacheGrid;if(d){for(a=0;a<d.length;a++)for(b=0;b<d[a].length;b++)d[a][b].texture.destroy(!0),this.parentContainer.removeChild(d[a][b]);delete this.cacheGrid}else this.tilesSprite?(this.tilesSprite.texture.alternate&&this.tilesSprite.texture.alternate.destroy(!0),this.tilesSprite.texture.destroy(!0),this.parentContainer.removeChild(this.tilesSprite)):this.parentContainer.removeChild(this.mapContainer);this.imageMap.length=0;for(c in this.tiles)this.tiles.hasOwnProperty(c)&&this.tiles[c].destroy();if(this.tiles=null,this.parentContainer=null,this.tilesSprite=null,this.cachedDisplayObjects){for(a=0;a<this.cachedDisplayObjects.length;a++)this.cachedDisplayObjects[a].destroy();this.cachedDisplayObjects.length=0}}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d?platypus.game.settings.spriteSheets[d].images:d.images}})}(),function(){"use strict";return platypus.createComponentClass({id:"SceneChanger",constructor:function(a){this.scene=this.owner.scene||a.scene,this.persistentData=a.persistentData||{},this.preload=a.preload||!1,a.message&&console.warn('"'+this.type+'" components no longer accept "message": "'+a.message+'" as a definition parameter. Use "aliases": {"'+a.message+'": "new-scene"} instead.')},events:{"scene-live":function(){this.preload&&platypus.game.loadScene(this.scene,this.transition,this.persistentData,!0)},"new-scene":function(a){var b=a||this,c=b.scene||this.scene,d=b.persistentData||this.persistentData;platypus.game.loadScene(c,d)},"set-scene":function(a){this.scene=a},"set-persistent-scene-data":function(a){var b="";for(b in a)a.hasOwnProperty(b)&&(this.persistentData[b]=a[b])}}})}(),function(){"use strict";var a=include("springroll.Application"),b=include("platypus.Entity"),c=function(){var a=function(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)>>>0},b=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)>>>0};return function(c,d){var e=4,f=[],g=atob(c.replace(/\\/g,""));if("zlib"===d)for(g=pako.inflate(g);e<=g.length;)f.push(b(g,e-4)),e+=4;else for(;e<=g.length;)f.push(a(g.substr(e-4,4))),e+=4;return f}}(),d=function(a){var b=!!(536870912&a),c=!!(1073741824&a),d=!!(2147483648&a);return b&&d?-3:b?-5:c?-4:-2},e={x:1,y:1,id:-1},f=function(a){var b=e,c=!!(1073741824&a),d=!!(2147483648&a);return b.id=268435455&a,b.x=1,b.y=1,c&&(b.y=-1),d&&(b.x=-1),b},g=function(a,b){var c=0,d=a.gid||-1,g={},i={gid:-1,transform:null,properties:g,type:""},j=null,k=null;for(-1!==d&&(i.transform=f(d),d=i.gid=e.id),c=0;c<b.length&&!(b[c].firstgid>d);c++)k=b[c];return k&&k.tileproperties&&k.tileproperties[d-k.firstgid]&&(j=k.tileproperties[d-k.firstgid]),""!==a.type?i.type=a.type:""!==a.name?i.type=a.name:j&&(i.type=j.entity||j.type||""),i.type?(i.transform?(g.scaleX=i.transform.x,g.scaleY=i.transform.y):(g.scaleX=1,g.scaleY=1),h(j,i.properties),h(a.properties,i.properties),i):null},h=function(a,b){var c="";if(a&&b)for(c in a)a.hasOwnProperty(c)&&(b[c]=i(a[c]));return b},i=function(a){var b=0;if("string"==typeof a){if(b=parseFloat(a),0===b||b)return b;if("true"===a)return!0;if("false"===a)return!1;if(a.length>1&&("{"===a[0]&&"}"===a[a.length-1]||"["===a[0]&&"]"===a[a.length-1]))try{return JSON.parse(a)}catch(c){}}return a},j=function(a,c){var d=0,e=0,f=[],h=[],i=null,j=null;if("string"==typeof a&&(a=platypus.game.settings.levels[a]),a)if(a.tilesets=m(a.tilesets),a.assets)h.union(a.assets);else{for(d=0;d<a.layers.length;d++)if("objectgroup"===a.layers[d].type)for(e=0;e<a.layers[d].objects.length;e++)i=g(a.layers[d].objects[e],a.tilesets),i&&(j=b.getAssetList(i),j&&h.union(j));else"imagelayer"===a.layers[d].type&&h.union([a.layers[d].name]);if(!c){for(d=0;d<a.tilesets.length;d++)f.push(a.tilesets[d].name);h.union(f)}a.assets=h.slice()}return h},k={"render-layer":{id:"render-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import",entityCache:!0}]},"collision-layer":{id:"collision-layer",components:[{type:"CollisionTiles",collisionMap:"import"}]},"image-layer":{id:"image-layer",components:[{type:"RenderTiles",spriteSheet:"import",imageMap:"import"}]}},l=function(a){var b="",c=platypus.game.settings.levels[a.source.replace(".json","")];for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return delete a.source,a},m=function(a){var b=0;for(b=0;b<a.length;b++)a[b].source&&(a[b]=l(a[b]));return a};return platypus.createComponentClass({id:"TiledLoader",properties:{showCollisionTiles:!1,images:null,layerIncrement:1e3,separateTiles:!1,spriteSheet:null},publicProperties:{level:null,unitsPerPixel:1,imagesScale:1,entityPositionX:"center",entityPositionY:"bottom",manuallyLoad:!1},constructor:function(b){this.assetCache=a.instance.assetManager.cache,this.entities=[],this.layerZ=0,this.followEntity=!1},events:{"scene-loaded":function(a){this.manuallyLoad||this.loadLevel({level:this.level||a.level,persistentData:a})},"load-level":function(a){this.loadLevel(a)}},methods:{loadLevel:function(a){var b=a.level,c=0,d=!1;for("string"==typeof b&&(b=platypus.game.settings.levels[b]),c=0;c<b.layers.length;c++)d=this.setupLayer(b.layers[c],b,d),this.separateTiles&&(d=!1);this.owner.trigger("world-loaded",{width:b.width*b.tilewidth*this.unitsPerPixel,height:b.height*b.tileheight*this.unitsPerPixel,tile:{width:b.tilewidth,height:b.tileheight},camera:this.followEntity}),this.owner.removeComponent(this)},setupLayer:function(a,e,f){var h=this.images||[],i=e.tilesets,j=e.tilewidth,l=e.tileheight,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=null,v=0,w=null,x="",y="",z="",A=-1,B=1/0,C=-(1/0),D=1/0,E=-(1/0),F=null,G=null,H=!0,I=null,J=0,K=0,L=function(a){var b=0,c=0,d=a.properties||{},e={data:[],image:"",height:1,name:a.name,type:"tilelayer",width:1,tileheight:l,tilewidth:j,x:a.x,y:a.y,properties:d};for(d.repeat&&(e.width=+d.repeat,e.height=+d.repeat),d["repeat-x"]&&(e.width=+d["repeat-x"]),d["repeat-y"]&&(e.height=+d["repeat-y"]),c=e.width*e.height,b=0;c>b;b++)e.data.push(1);return this.assetCache.read(a.name)?(e.image=a.name,e.tileheight=this.assetCache.read(a.name).height,e.tilewidth=this.assetCache.read(a.name).width):(console.warn('Component TiledLoader: Cannot find the "'+a.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+a.name+'".'),e.image=a.image),e}.bind(this),M=function(a,e){var g=null,m=e.width,n=e.height,o=e.tileheight||l,p=e.tilewidth||j,q=0,r=0,s=0,t=null,u=null,v=null,w=null,x=!1,y=null,z=null,A=0,B=0,C=0,D="",E=e.data;if("base64"===e.encoding&&(E=e.data=c(E,e.compression),e.encoding="csv"),e.properties&&(e.properties.width&&(q=parseInt(e.properties.width,10)),e.properties.height&&(r=parseInt(e.properties.height,10)),q||r)){for(q=q||m,r=r||n,E=[],B=0;q>B;B++)for(C=0;r>C;C++)m>B&&n>C?E[B+C*q]=e.data[B+C*m]:E[B+C*q]=0;m=q,n=r}if(t=JSON.parse(JSON.stringify(platypus.game.settings.entities[a]||k[a])),u={},v=[],w=[],"collision-layer"===a)for(z=[],B=0;B<i.length;B++)if(y=i[B],y.tileproperties)for(D in y.tileproperties)y.tileproperties.hasOwnProperty(D)&&y.tileproperties[D].jumpThrough&&z.push(y.firstgid+parseInt(D,10)-1);for(t.properties=t.properties||{},t.properties.width=p*m*this.unitsPerPixel,t.properties.height=o*n*this.unitsPerPixel,t.properties.columns=m,t.properties.rows=n,t.properties.tileWidth=p*this.unitsPerPixel,t.properties.tileHeight=o*this.unitsPerPixel,t.properties.scaleX=this.imagesScale,t.properties.scaleY=this.imagesScale,t.properties.layerZ=this.layerZ,t.properties.z=t.properties.z||this.layerZ,s=i[i.length-1].imagewidth/p*(i[i.length-1].imageheight/o)+i[i.length-1].firstgid,B=-1;s>B;B++)u["tile"+B]=B;for(B=0;m>B;B++)for(v[B]=[],w[B]=[],C=0;n>C;C++)A=+E[B+C*m]-1,w[B][C]="tile"+A,z&&z.length&&z[0]===(268435455&A)&&(A=d(A)),v[B][C]=A;for(B=0;B<t.components.length;B++)"RenderTiles"===t.components[B].type&&(x=t.components[B]),"import"===t.components[B].spriteSheet?t.components[B].spriteSheet={images:e.image?[e.image]:h,frames:{width:p*this.unitsPerPixel/this.imagesScale,height:o*this.unitsPerPixel/this.imagesScale,regX:p*this.unitsPerPixel/this.imagesScale/2,regY:o*this.unitsPerPixel/this.imagesScale/2},animations:u}:t.components[B].spriteSheet&&("string"==typeof t.components[B].spriteSheet&&platypus.game.settings.spriteSheets[t.components[B].spriteSheet]&&(t.components[B].spriteSheet=platypus.game.settings.spriteSheets[t.components[B].spriteSheet]),t.components[B].spriteSheet.animations||(t.components[B].spriteSheet.animations=u)),"import"===t.components[B].collisionMap&&(t.components[B].collisionMap=v),"import"===t.components[B].imageMap&&(t.components[B].imageMap=w);return this.layerZ+=this.layerIncrement,"render-layer"===a&&f&&f.tileHeight===o&&f.tileWidth===p&&f.columns===m&&f.rows===n?(f.trigger("add-tiles",x),f):(g={},"render-layer"===a&&this.spriteSheet&&("string"==typeof this.spriteSheet?g.spriteSheet=platypus.game.settings.spriteSheets[this.spriteSheet]:g.spriteSheet=this.spriteSheet,g.spriteSheet.animations||(g.spriteSheet.animations=u)),this.owner.addEntity(new b(t,{properties:g})))}.bind(this);if(i=m(i),0===h.length)for(p=0;p<i.length;p++)this.assetCache.read(i[p].name)?h.push(i[p].name):(console.warn('Component TiledLoader: Cannot find the "'+i[p].name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+i[p].name+'".'),h.push(i[p].image));else h=h.slice();if("tilelayer"===a.type){if(w="render-layer",a.properties&&a.properties.entity)w=a.properties.entity;else switch(a.name){case"collision":w="collision-layer";break;case"action":for(w="tile-layer",p=0;p<e.layers.length;p++)("collision"===e.layers[p].name||e.layers[p].properties&&"collision-layer"===e.layers[p].properties.entity)&&(H=!1);H||(w="render-layer")}if("tile-layer"===w||this.showCollisionTiles&&platypus.game.settings.debug)return M("collision-layer",a),M("render-layer",a);if("collision-layer"!==w)return M(w,a);M("collision-layer",a)}else{if("imagelayer"===a.type)return M("image-layer",L(a));if("objectgroup"===a.type){for(x=this.entityPositionX,y=this.entityPositionY,a.properties&&(a.properties.entityPositionX&&(x=a.properties.entityPositionX),a.properties.entityPositionY&&(y=a.properties.entityPositionY)),v=0;v<a.objects.length;v++)if(w=a.objects[v],F=g(w,i)){if(A=F.gid,z=F.type,G=F.properties,w.polygon||w.polyline){for(B=1/0,C=-(1/0),D=1/0,E=-(1/0),I=null,w.polygon?I=w.polygon:w.polyline&&(I=w.polyline),p=0;p<I.length;p++)I[p].x>C&&(C=I[p].x),I[p].x<B&&(B=I[p].x),I[p].y>E&&(E=I[p].y),I[p].y<D&&(D=I[p].y);if(G.width=C-B,G.height=E-D,G.x=w.x+B,G.y=w.y+D,n=0,o=0,G.width=G.width*this.unitsPerPixel,G.height=G.height*this.unitsPerPixel,G.x=G.x*this.unitsPerPixel,G.y=G.y*this.unitsPerPixel,w.polygon)for(G.shape={},G.shape.type="polygon",G.shape.points=[],q=0;q<I.length;q++)G.shape.points.push({x:(I[q].x-B)*this.unitsPerPixel,y:(I[q].y-D)*this.unitsPerPixel});else if(w.polyline)for(G.shape={},G.shape.type="polyline",G.shape.points=[],q=0;q<I.length;q++)G.shape.points.push({x:(I[q].x-B)*this.unitsPerPixel,y:(I[q].y-D)*this.unitsPerPixel})}else J=j*this.unitsPerPixel,K=l*this.unitsPerPixel,n=0,o=0,G.width=(w.width||0)*this.unitsPerPixel,G.height=(w.height||0)*this.unitsPerPixel,z&&platypus.game.settings.entities[z]&&platypus.game.settings.entities[z].properties&&(platypus.game.settings.entities[z].properties.width&&(G.width=platypus.game.settings.entities[z].properties.width||0,n=J),platypus.game.settings.entities[z].properties.height&&(G.height=platypus.game.settings.entities[z].properties.height||0,o=K)),G.width||(G.width=J),G.height||(G.height=K),n=n||G.width,o=o||G.height,G.x=w.x*this.unitsPerPixel,G.y=w.y*this.unitsPerPixel,w.rotation&&(r=(w.width||J)/2,s=(w.height||K)/2,t=w.rotation/180%2*Math.PI,u=new platypus.Vector(r,-s).rotate(t),G.rotation=w.rotation,G.x=Math.round(1e3*(G.x+u.x-r))/1e3,G.y=Math.round(1e3*(G.y+u.y+s))/1e3),"left"===x?G.regX=0:"center"===x?(G.regX=G.width/2,G.x+=n/2):"right"===x&&(G.regX=G.width,G.x+=n),-1===A&&(G.y+=G.height),"bottom"===y?G.regY=G.height:"center"===y?(G.regY=G.height/2,G.y-=o/2):"top"===y&&(G.regY=0,G.y-=o),w.ellipse?(G.shape={},G.shape.type="ellipse",G.shape.width=G.width*this.unitsPerPixel,G.shape.height=G.height*this.unitsPerPixel):w.width&&w.height&&(G.shape={},G.shape.type="rectangle",G.shape.width=G.width*this.unitsPerPixel,G.shape.height=G.height*this.unitsPerPixel);platypus.game.settings.entities[z].properties?(G.scaleX*=this.imagesScale*(platypus.game.settings.entities[z].properties.scaleX||1),G.scaleY*=this.imagesScale*(platypus.game.settings.entities[z].properties.scaleY||1)):(G.scaleX*=this.imagesScale,G.scaleY*=this.imagesScale),G.layerZ=this.layerZ,G.z?G.z+=this.layerZ:z&&platypus.game.settings.entities[z]&&platypus.game.settings.entities[z].properties&&platypus.game.settings.entities[z].properties.z?G.z=this.layerZ+platypus.game.settings.entities[z].properties.z:G.z=this.layerZ,G.parent=this.owner,w=this.owner.addEntity(new b(platypus.game.settings.entities[z],{properties:G})),w&&(w.camera&&(this.followEntity={entity:w,mode:w.camera}),this.owner.triggerEvent("entity-created",w))}return this.layerZ+=this.layerIncrement,!1}}},destroy:function(){this.entities.length=0}},getAssetList:function(a,b,c){var d=b||{},e=c||{},f=a.spriteSheet||d.spriteSheet||e.spriteSheet,g=a.images||d.images||e.images,h=[];return h.union(j(a.level||d.level||e.level,f)),f&&("string"==typeof f?h.union(platypus.game.settings.spriteSheets[f].images):h.union(f.images)),g&&h.union(g),h},getLateAssetList:function(a,b,c,d){var e=b||{},f=c||{},g=a.spriteSheet||e.spriteSheet||f.spriteSheet;return d&&d.level?j(d.level,g):[]}})}(),function(){"use strict";var a=function(a,b,c,d){return function(){a.trigger(b,c,d)}},b=function(b){return function(c){var d=0,e=b,f=null,g=null,h=createjs.Tween.get(this.owner);if(Array.isArray(c))e=c;else if(!Array.isArray(e))return;for(d=0;d<e.length;d++)f=e[d],"string"==typeof f?h.call(a(this.owner,f)):Array.isArray(f)?"call"===f[0]&&"string"==typeof f[1]?h.call(a(this.owner,f[1])):(g=f.slice(),g.splice(0,1),h[f[0]].apply(h,g)):"call"===f.method&&"string"==typeof f.params?h.call(a(this.owner,f.params)):h[f.method].apply(h,f.params)}};return platypus.createComponentClass({id:"Tween",constructor:function(a){var c="";if(a.events)for(c in a.events)a.events.hasOwnProperty(c)&&this.addEventListener(c,b(a.events[c]))}})}(),function(){"use strict";var a=function(a,b){return" "===b?a+"default":a+b},b=function(b,c,d,e){var f=0,g="",h={},i=0,j="",k="",l=b.voice;if("string"==typeof b.sound)h.sound=b.sound,h.events=[];else{for(g in b.sound)b.sound.hasOwnProperty(g)&&(h[g]=b.sound[g]);h.events?h.events=h.events.slice():h.events=[]}if(l)for(l+=" ",f=0;f<l.length;f++)k=l[f],k!==j&&(j=k,h.events.push({time:i,event:a(d,k)})),i+=e;return h},c=function(a,c,d,e){var f=0,g=[];if(c[" "]||(c[" "]=c["default"]),Array.isArray(a)){for(f=0;f<a.length;f++)g.push(b(a[f],c,d,e));return g}return b(a,c,d,e)};return platypus.createComponentClass({id:"VoiceOver",properties:{animationMap:{"default":"default"},frameLength:100,messagePrefix:"VoiceOver",voiceOverMap:{}},constructor:function(b){var d="",e={audioMap:{},aliases:b.aliases},f={acceptInput:b.acceptInput,aliases:b.aliases,animationMap:{},eventBased:!0,flip:b.flip,hidden:b.hidden,mask:b.mask,mirror:b.mirror,offsetZ:b.offsetZ,pins:b.pins,pinTo:b.pinTo,rotate:b.rotate,scaleX:b.scaleX,scaleY:b.scaleY,spriteSheet:b.spriteSheet,stateBased:b.stateBased||!1};this.message=this.messagePrefix+"-";for(d in this.animationMap)this.animationMap.hasOwnProperty(d)&&(f.animationMap[a(this.message,d)]=this.animationMap[d]);f.animationMap["default"]=this.animationMap["default"],this.owner.addComponent(new platypus.components.RenderSprite(this.owner,f));for(d in this.voiceOverMap)this.voiceOverMap.hasOwnProperty(d)&&(e.audioMap[d]=c(this.voiceOverMap[d],this.animationMap,this.message,this.frameLength));this.owner.addComponent(new platypus.components.AudioVO(this.owner,e))},events:{load:function(){this.owner.removeComponent(this)}},getAssetList:function(a,b,c){var d=a.spriteSheet||b.spriteSheet||c.spriteSheet;return"string"==typeof d?platypus.game.settings.spriteSheets[d].images:d.images}})}(),function(){"use strict";return platypus.createComponentClass({id:"XHR",properties:{method:"GET",path:"",responseType:"text",withCredentials:!1},constructor:function(a){this.setProperties(a)},events:{request:function(a){if(this.setProperties(a),"GET"===this.method)this.get();else{if("POST"!==this.method)throw"Method must be GET or POST";this.post()}}},methods:{setProperties:function(a){var b="",c="",d=a||this;if(this.method=d.method||this.method||"GET",this.path=d.path||this.path||null,this.responseType=d.responseType||this.responseType||"text",this.withCredentials=d.withCredentials||this.withCredentials||!1,d!==this&&d.data){this.data="";for(b in d.data)d.data.hasOwnProperty(b)&&(this.data+=c+b+"="+d.data[b],c="&")}else this.data="";this.onload=d.onload||this.onload||function(a){200===this.status&&this.owner.trigger("response",this.responseText)}.bind(this)},get:function(){var a=new XMLHttpRequest,b=this.path;this.data&&(b+="?"+this.data),a.open(this.method,b,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.onload=this.onload,a.send()},post:function(){var a=new XMLHttpRequest;a.open(this.method,this.path,!0),a.withCredentials=this.withCredentials,a.responseType=this.responseType,a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=this.onload,a.send(this.data)}}})}(),function(a,b){a.prototype.union||b.defineProperty(a.prototype,"union",{enumerable:!1,writable:!1,value:function(a){var b=0,c=a.length;for(b=0;c>b;b++)-1===this.indexOf(a[b])&&this.push(a[b]);return this}})}(Array,Object);