(function () {var a={};PBS=this.PBS||{};PBS.KIDS=this.PBS.KIDS||{};PBS.KIDS.platformer=a;a.settings={global:{autoLoad:true,initialScene:"load",fps:60,rootElement:"root",aspectRatio:1.333,nativeAssetResolution:960,resizeFont:true,plugins:["js/pngquant-plugin.js","js/manifest-plugin.js","js/scripts-plugin.js","js/language-plugin.js","js/assets-plugin.js","js/compression-plugin.js","js/write-plugin.js"]},manifest:{audio:{firefox:"ogg",opera:"ogg",chrome:"ogg",android:"m4a",silk:"m4a",ipod:"m4a",ipad:"m4a",iphone:"m4a",msie:"mp3",safari:"mp3",trident:"mp3"}},version:"0.0.5",timestamp:"Wed Mar 25 11:17:58 EDT 2015",buildIndex:5,assets:{buttons:{id:"buttons",src:"i/buttons.png"},"audio-sprite":{id:"audio-sprite",src:"a/combined.m4a",data:{audioSprite:[{id:"walk",startTime:3200,duration:330},{id:"jump",startTime:1600,duration:250}]}},mookie:{id:"mookie",src:"i/mookie.png",data:{spritesheet:{framerate:15,images:["mookie"],frames:{width:65,height:83,regY:82,regX:33},animations:{standing:[2],walking:{frames:[3,0,1,2]},jumping:{frames:[0]}}},rows:4,columns:4}},"game-sprites":{id:"game-sprites",src:"i/game-sprites.png",data:{rows:4,columns:4}},"title-screen":{id:"title-screen",src:"i/title-screen.png",compression:64}},includes:{"../engine/main.js":{src:"../engine/main.js",id:"../engine/main.js"},"css/button.css":{src:"../game/css/button.css",id:"css/button.css"},"css/main.css":{src:"../game/css/main.css",id:"css/main.css"},"css/game.css":{src:"../game/css/game.css",id:"css/game.css"},"css/gui.css":{src:"../game/css/gui.css",id:"css/gui.css"},"css/fullscreen.css":{src:"../game/css/fullscreen.css",id:"css/fullscreen.css"},"../engine/collision-shape.js":{src:"../engine/collision-shape.js",id:"../engine/collision-shape.js"},"../engine/aabb.js":{src:"../engine/aabb.js",id:"../engine/aabb.js"},"../engine/vector2D.js":{src:"../engine/vector2D.js",id:"../engine/vector2D.js"},"../engine/collision-data-container.js":{src:"../engine/collision-data-container.js",id:"../engine/collision-data-container.js"},"../engine/messenger.js":{src:"../engine/messenger.js",id:"../engine/messenger.js"},"https://code.createjs.com/createjs-2014.12.12.min.js":{src:"https://code.createjs.com/createjs-2014.12.12.min.js",id:"https://code.createjs.com/createjs-2014.12.12.min.js"},"../engine/browser.js":{src:"../engine/browser.js",id:"../engine/browser.js"},"../engine/game.js":{src:"../engine/game.js",id:"../engine/game.js"},"../engine/scene.js":{src:"../engine/scene.js",id:"../engine/scene.js"},"../engine/entity.js":{src:"../engine/entity.js",id:"../engine/entity.js"},"../engine/factory.js":{src:"../engine/factory.js",id:"../engine/factory.js"}},entities:{"action-layer":{id:"action-layer",components:[{type:"handler-controller"},{type:"handler-ai"},{type:"handler-logic"},{type:"handler-collision"},{type:"camera",width:960},{type:"handler-render-createjs"},{type:"entity-container"},{type:"tiled-loader"}]},"desktop-interface-layer":{id:"desktop-interface-layer",filter:{excludes:["mobile"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-mute"},{type:"button-fullscreen"},{type:"button-play"},{type:"gui"},{type:"fps-counter"}],childEvents:["time-elapsed"]}]},"multitouch-interface-layer":{id:"multitouch-interface-layer",filter:{includes:["mobile","multitouch"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-fullscreen"},{type:"button-jump"},{type:"button-pickaxe"},{type:"button-left"},{type:"button-right"},{type:"gui"},{type:"fps-counter"}],childEvents:["gui-gem-collected","time-elapsed"]}]},"touch-interface-layer":{id:"touch-interface-layer",filter:{includes:["mobile","touch"],excludes:["multitouch"]},components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"button-fullscreen"},{type:"button-jump-left"},{type:"button-jump-right"},{type:"button-jump",properties:{className:"game-button jump-center-button"}},{type:"button-left"},{type:"button-right"},{type:"gui"},{type:"fps-counter"}],childEvents:["time-elapsed"]}]},"tile-layer":{id:"tile-layer",components:[{type:"render-tiles",spriteSheet:"import",imageMap:"import"},{type:"collision-tiles",collisionMap:"import"}]},"render-layer":{id:"render-layer",components:[{type:"render-tiles",spriteSheet:"import",imageMap:"import"}]},"collision-layer":{id:"collision-layer",components:[{type:"collision-tiles",collisionMap:"import"}]},"button-fullscreen":{id:"button-fullscreen",components:[{type:"dom-element",element:"div",className:"button-fullscreen",onmouseup:"toggle-fullscreen",ontouchend:"toggle-fullscreen"},{type:"fullscreen"}]},"button-jump":{id:"button-jump",components:[{type:"dom-element",element:"div",className:"game-button jump-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":"button-jump:down","stop-jump":"button-jump:up"}}]},"button-jump-left":{id:"button-jump-left",components:[{type:"dom-element",element:"div",className:"game-button jump-left-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":["button-jump:down","button-left:down"],"stop-jump":["button-jump:up","button-left:up"]}}]},"button-jump-right":{id:"button-jump-right",components:[{type:"dom-element",element:"div",className:"game-button jump-right-button",onmousedown:"start-jump",ontouchstart:"start-jump",onmouseup:"stop-jump",ontouchend:"stop-jump",ontouchcancel:"stop-jump"},{type:"broadcast-events",events:{"start-jump":["button-jump:down","button-right:down"],"stop-jump":["button-jump:up","button-right:up"]}}]},"button-left":{id:"button-left",components:[{type:"dom-element",element:"div",className:"game-button go-left-button",onmousedown:"start-move",ontouchstart:"start-move",onmouseup:"stop-move",ontouchend:"stop-move",ontouchcancel:"stop-move"},{type:"broadcast-events",events:{"start-move":"button-left:down","stop-move":"button-left:up"}}]},"button-play-game":{id:"button-play-game",components:[{type:"dom-element",element:"div",innerHTML:"Play Game",className:"menu-button",onmouseup:"new-scene",ontouchend:"new-scene"},{type:"change-scene",scene:"scene-level-1",transition:"fade-to-black"}]},"button-right":{id:"button-right",components:[{type:"dom-element",element:"div",className:"game-button go-right-button",onmousedown:"start-move",ontouchstart:"start-move",onmouseup:"stop-move",ontouchend:"stop-move",ontouchcancel:"stop-move"},{type:"broadcast-events",events:{"start-move":"button-right:down","stop-move":"button-right:up"}}]},"button-mute":{id:"button-mute",components:[{type:"logic-button",toggle:true,state:"pressed"},{type:"dom-element",element:"div",className:"game-button mute-button",updateClassName:true,onmouseup:["audio-mute-toggle","mouseup"],ontouchend:["audio-mute-toggle","mouseup"]},{type:"audio"}],properties:{x:10,y:10,z:400,width:400,height:400}},hero:{id:"hero",components:[{type:"entity-controller",controlMap:{"button-jump":"jump","key:z":"jump","key:space":"jump","key:up-arrow":"jump","key:w":"jump","key:left-arrow":"go-left","key:a":"go-left","button-left":"go-left","key:right-arrow":"go-right","key:d":"go-right","button-right":"go-right"}},{type:"logic-gravity",yGravity:0.003},{type:"logic-jump",accelerationY:-1.2},{type:"logic-hero"},{type:"logic-directional-movement",speed:0.6},{type:"collision-basic",collisionType:"hero",solidCollisions:{block:"hit-solid",dirt:"hit-solid",tiles:"hit-solid"}},{type:"render-sprite",mirror:"true",animationMap:{falling:"jumping",moving:"walking","default":"standing"},image:"mookie"},{type:"audio",audioMap:{"grounded,moving":{sound:"walk",loop:5000},"just-jumped":"jump"}}],properties:{alwaysOn:true,z:200,width:24,height:72,camera:"forward"}},"level-portal":{id:"level-portal",components:[{type:"logic-portal"},{type:"collision-basic",collisionType:"portal",immobile:true,softCollisions:{hero:"occupied-portal"}},{type:"change-scene",transition:"fade-to-black"}],properties:{z:0}},"title-screen":{id:"title-screen",components:[{type:"dom-element",element:"div",className:"title-screen"}]},"fps-counter":{id:"fps-counter",components:[{type:"logic-fps-counter"},{type:"dom-element",className:"fps-counter",style:{position:"absolute",left:"0.1em",top:"0.1em",color:"white",fontSize:"0.4em",fontWeight:"bold",fontFamily:"Arial",pointerEvents:"none",zIndex:11}}]}},scenes:{load:{id:"load",layers:[{id:"load-layer",components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"entity-container",entities:[{type:"title-screen"},{id:"progress-bar",components:[{type:"audio-mobile",audioId:"audio-sprite"},{type:"asset-loader",progressBar:"progress-bar",automatic:false},{type:"dom-element",id:"mobile-start",innerHTML:"Play",className:"mobile-start",updateClassName:true,ontouchstart:"activate-audio"},{type:"dom-element",id:"progress-bar-container",updateClassName:true},{type:"dom-element",id:"progress-bar",parent:"progress-bar-container"},{type:"change-scene",scene:"menu",aliases:{complete:"new-scene"}}]}],childEvents:["link-entity"]}]}]},menu:{id:"menu",layers:[{id:"menu-layer",components:[{type:"handler-logic"},{type:"handler-render-dom"},{type:"handler-controller"},{type:"entity-container",entities:[{type:"title-screen"},{type:"button-play-game"}]}]}]},"scene-level-1":{id:"scene-level-1",layers:[{type:"action-layer",properties:{level:"level-1"}},{type:"multitouch-interface-layer"},{type:"touch-interface-layer"},{type:"desktop-interface-layer"}]}},levels:{"level-1":{height:10,layers:[{data:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,11,11,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,5,6,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,11,9,10,11,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],height:10,name:"background",opacity:1,type:"tilelayer",visible:true,width:30,x:0,y:0},{data:[2147483650,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,3,3,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2147483656,7,7,7,7,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2147483656,7,7,7,7,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2147483656,7,7,7,7,8,0,0,0,0,0,0,0,0,0,0,0,0,2,2147483651,2147483650,0,0,0,0,0,0,0,0,0,1073741826,3221225475,3221225475,3221225475,2147483652,8,0,0,0,0,0,0,0,0,2,3,2147483650,0,0,0,0,0,2,2147483651,2147483650,0,0,0,0,0,0,0,0,0,2147483656,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2147483656,1073741828,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3221225476,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],height:10,name:"action",opacity:1,type:"tilelayer",visible:true,width:30,x:0,y:0},{height:10,name:"entities",objects:[{gid:12,height:0,name:"",properties:{},type:"",visible:true,width:0,x:144,y:504},{height:144,name:"",properties:{destination:"menu"},type:"level-portal",visible:true,width:144,x:1872,y:360}],opacity:1,type:"objectgroup",visible:true,width:30,x:0,y:0}],orientation:"orthogonal",properties:{},tileheight:72,tilesets:[{firstgid:1,image:"../game/images/game-sprites.png",imageheight:216,imagewidth:288,margin:0,name:"game-sprites",properties:{},spacing:0,tileheight:72,tileproperties:{"11":{entity:"hero"}},tilewidth:72}],tilewidth:72,version:1,width:30,id:"level-1"}},components:{"handler-controller":{id:"handler-controller",src:"../engine/components/handler-controller.js"},"handler-ai":{id:"handler-ai",src:"../engine/components/handler-ai.js"},"handler-logic":{id:"handler-logic",src:"../engine/components/handler-logic.js"},"handler-collision":{id:"handler-collision",src:"../engine/components/handler-collision.js"},camera:{id:"camera",src:"../engine/components/camera.js"},"handler-render-createjs":{id:"handler-render-createjs",src:"../engine/components/handler-render-createjs.js"},"entity-container":{id:"entity-container",src:"../engine/components/entity-container.js"},"tiled-loader":{id:"tiled-loader",src:"../engine/components/tiled-loader.js"},"handler-render-dom":{id:"handler-render-dom",src:"../engine/components/handler-render-dom.js"},"render-tiles":{id:"render-tiles",src:"../engine/components/render-tiles.js"},"collision-tiles":{id:"collision-tiles",src:"../engine/components/collision-tiles.js"},"dom-element":{id:"dom-element",src:"../engine/components/dom-element.js"},fullscreen:{id:"fullscreen",src:"../engine/components/fullscreen.js"},"broadcast-events":{id:"broadcast-events",src:"../engine/components/broadcast-events.js"},"change-scene":{id:"change-scene",src:"../engine/components/change-scene.js"},"logic-button":{id:"logic-button",src:"../engine/components/logic-button.js"},audio:{id:"audio",src:"../engine/components/audio.js"},"entity-controller":{id:"entity-controller",src:"../engine/components/entity-controller.js"},"logic-gravity":{id:"logic-gravity",src:"../engine/components/logic-gravity.js"},"logic-jump":{id:"logic-jump",src:"../engine/components/logic-jump.js"},"logic-hero":{id:"logic-hero",src:"../game/components/logic-hero.js"},"logic-directional-movement":{id:"logic-directional-movement",src:"../engine/components/logic-directional-movement.js"},"collision-basic":{id:"collision-basic",src:"../engine/components/collision-basic.js"},"render-sprite":{id:"render-sprite",src:"../engine/components/render-sprite.js"},"logic-portal":{id:"logic-portal",src:"../engine/components/logic-portal.js"},"logic-fps-counter":{id:"logic-fps-counter",src:"../engine/components/logic-fps-counter.js"},"audio-mobile":{id:"audio-mobile",src:"../engine/components/audio-mobile.js"},"asset-loader":{id:"asset-loader",src:"../engine/components/asset-loader.js"}},debug:false};(function (c) {if (c) {if (!c.console) {var b=c.console={};b.log=b.warn=b.error=function () {}}if (c.Array&&!c.Array.isArray) {c.Array.isArray=function (d) {return(d instanceof Array)}}}})(window);window.addEventListener("load",function () {if (a.settings&&a.settings.global&&(a.settings.global.autoLoad!==false)) {new a.Game(a.settings)}},false);a.CollisionShape=(function () {var b=function (e,f,h) {var j=f.regX,i=f.regY;this.owner=e;this.collisionType=h;this.width=f.width||f.radius||0;this.height=f.height||f.radius||0;this.radius=f.radius||0;if (typeof j!=="number") {j=this.width/2}if (typeof i!=="number") {i=this.height/2}this.offsetX=f.offsetX||((this.width/2)-j);this.offsetY=f.offsetY||((this.height/2)-i);if (e) {this.x=e.x+this.offsetX;this.y=e.y+this.offsetY}else{this.x=f.x+this.offsetX;this.y=f.y+this.offsetY}this.type=f.type||"rectangle";this.subType="";this.points=f.points;this.aABB=undefined;var g=0;var d=0;switch(this.type) {case"circle":g=d=this.radius*2;break;case"rectangle":g=this.width;d=this.height;break;case"triangle":if (this.points[0][1]==this.points[1][1]&&this.points[0][0]==this.points[2][0]) {if (this.points[0][0]<this.points[1][0]) {this.subType="tl";g=this.points[1][0]-this.points[0][0];d=this.points[2][1]-this.points[0][1]}else{this.subType="br";g=this.points[0][0]-this.points[1][0];d=this.points[0][1]-this.points[2][1]}}else{if (this.points[0][1]==this.points[2][1]&&this.points[0][0]==this.points[1][0]) {if (this.points[0][1]<this.points[1][1]) {this.subType="tr";g=this.points[0][0]-this.points[2][0];d=this.points[1][1]-this.points[0][1]}else{this.subType="bl";g=this.points[2][0]-this.points[0][0];d=this.points[0][1]-this.points[1][1]}}}}this.aABB=new a.AABB(this.x,this.y,g,d)};var c=b.prototype;c.update=function (e,d) {this.x=e+this.offsetX;this.y=d+this.offsetY;this.aABB.move(this.x,this.y)};c.moveX=function (d) {this.x=d;this.aABB.moveX(this.x)};c.moveY=function (d) {this.y=d;this.aABB.moveY(this.y)};c.moveXBy=function (d) {this.x+=d;this.aABB.moveX(this.x)};c.moveYBy=function (d) {this.y+=d;this.aABB.moveY(this.y)};c.getXY=function () {return[this.x,this.y]};c.getX=function () {return this.x};c.getY=function () {return this.y};c.getAABB=function () {return this.aABB};c.getXOffset=function () {return this.offsetX};c.getYOffset=function () {return this.offsetY};c.setXWithEntityX=function (d) {this.x=d+this.offsetX;this.aABB.moveX(this.x)};c.setYWithEntityY=function (d) {this.y=d+this.offsetY;this.aABB.moveY(this.y)};c.destroy=function () {this.aABB=undefined;this.points=undefined};return b}());a.AABB=(function () {var c=function (e,g,f,d) {this.empty=true;this.setAll(e,g,f,d)};var b=c.prototype;b.setAll=function (e,g,f,d) {this.empty=false;this.x=e;this.y=g;this.width=f||0;this.height=d||0;this.halfWidth=this.width/2;this.halfHeight=this.height/2;if (typeof e==="undefined") {this.empty=true}else{this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x}if (typeof g==="undefined") {this.empty=true}else{this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y}return this};b.set=function (d) {this.empty=d.empty;this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height;this.halfWidth=d.halfWidth;this.halfHeight=d.halfHeight;this.left=d.left;this.right=d.right;this.top=d.top;this.bottom=d.bottom;return this};b.reset=function () {this.empty=true;return this};b.include=function (d) {if (d) {if (this.empty) {this.set(d)}else{if (this.left>d.left) {this.left=d.left}if (this.right<d.right) {this.right=d.right}if (this.top>d.top) {this.top=d.top}if (this.bottom<d.bottom) {this.bottom=d.bottom}this.width=this.right-this.left;this.height=this.bottom-this.top;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=this.left+this.halfWidth;this.y=this.top+this.halfHeight}}};b.move=function (d,e) {this.moveX(d);this.moveY(e);return this};b.moveX=function (d) {this.x=d;this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x;return this};b.moveY=function (d) {this.y=d;this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y;return this};b.moveXBy=function (d) {this.x+=d;this.left=-this.halfWidth+this.x;this.right=this.halfWidth+this.x;return this};b.moveYBy=function (d) {this.y+=d;this.top=-this.halfHeight+this.y;this.bottom=this.halfHeight+this.y;return this};b.getCopy=function () {return new c(this.x,this.y,this.width,this.height)};b.matches=function (e,g,f,d) {return !((this.x!==e)||(this.y!==g)||(this.width!==f)||(this.height!==d))};b.contains=function (d) {return !((d.top<this.top)||(d.bottom>this.bottom)||(d.left<this.left)||(d.right>this.right))};b.containsVector=function (d) {return !((d.y<this.top)||(d.y>this.bottom)||(d.x<this.left)||(d.x>this.right))};b.intersects=function (d) {return !((d.bottom<this.top)||(d.top>this.bottom)||(d.right<this.left)||(d.left>this.right))};return c}());a.Vector2D=(function () {var b=function (d,e) {this.x=d||0;this.y=e||0};var c=b.prototype;c.set=function (d,e) {this.x=d;this.y=e;return this};c.copyValues=function (d) {this.x=d.x;this.y=d.y;return this};c.setX=function (d) {this.x=d;return this};c.setY=function (d) {this.y=d;return this};c.getX=function () {return this.x};c.getY=function () {return this.y};c.magnitude=function () {return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))};c.direction=function () {var d=this.magnitude();var e=0;if (d!=0) {e=Math.acos(this.x/d);if (this.y<0) {e=(Math.PI*2)-e}}return e};c.getUnit=function () {var d=this.magnitude();if (d==0) {return new a.Vector2D(0,0)}else{return new a.Vector2D(this.x/d,this.y/d)}};c.getInverse=function () {return new a.Vector2D(-this.x,-this.y)};c.normalize=function () {var d=this.magnitude();if (d!=0) {this.x/=d;this.y/=d}return this};c.rotate=function (e) {var d=this.x;var f=this.y;this.x=d*Math.cos(e)-f*Math.sin(e);this.y=d*Math.sin(e)+f*Math.cos(e);return this};c.add=function (d,e) {this.x+=d;this.y+=e;return this};c.addVector=function (d) {this.x+=d.x;this.y+=d.y;return this};c.subtractVector=function (d) {this.x-=d.x;this.y-=d.y;return this};c.scale=function (d) {this.x*=d;this.y*=d;return this};c.dot=function (d) {return this.x*d.x+this.y*d.y};c.shortestAngleTo=function (d) {return Math.acos(this.dot(d)/(this.magnitude()*d.magnitude()))};c.scalarProjection=function (e) {var f=0;var d=null;if (typeof e=="number") {f=e}else{d=e;f=this.shortestAngleTo(d)}return this.magnitude()*Math.cos(f)};c.copy=function () {return new b(this.x,this.y)};return b}());a.CollisionData=(function () {var c=function (f,j,d,h,k,i,g,e) {this.occurred=f||false;this.direction=j||null;this.position=d||null;this.deltaMovement=h||null;this.aABB=k||null;this.thisShape=i||null;this.thatShape=g||null;this.vector=e||null};var b=c.prototype;b.copy=function (d) {this.occurred=d.occurred;this.direction=d.direction;this.position=d.position;this.deltaMovement=d.deltaMovement;this.aABB=d.aABB;this.thisShape=d.thisShape;this.thatShape=d.thatShape;this.vector=d.vector};b.clear=function () {this.occurred=false;this.direction=null;this.position=null;this.deltaMovement=null;this.aABB=null;this.thisShape=null;this.thatShape=null;this.vector=null};return c}());a.CollisionDataContainer=(function () {var b=function () {this.xData=[new a.CollisionData(),new a.CollisionData()];this.yData=[new a.CollisionData(),new a.CollisionData()];this.xCount=0;this.yCount=0;this.xDeltaMovement=Infinity;this.yDeltaMovement=Infinity};var c=b.prototype;c.getXEntry=function (d) {return this.xData[d]};c.getYEntry=function (d) {return this.yData[d]};c.tryToAddX=function (d) {if (d.deltaMovement<this.xDeltaMovement) {this.xDeltaMovement=d.deltaMovement;this.xData[0].copy(d);this.xCount=1;return true}else{if (d.deltaMovement==this.xDeltaMovement) {this.ensureRoomX();this.xData[this.xCount].copy(d);this.xCount++;return true}}return false};c.tryToAddY=function (d) {if (d.deltaMovement<this.yDeltaMovement) {this.yDeltaMovement=d.deltaMovement;this.yData[0].copy(d);this.yCount=1;return true}else{if (d.deltaMovement==this.yDeltaMovement) {this.ensureRoomY();this.yData[this.yCount].copy(d);this.yCount++;return true}}return false};c.ensureRoomX=function () {var e=this.xData.length*2;if (this.xData.length<=this.xCount) {for (var d=this.xData.length;d<e;d++) {this.xData[d]=new a.CollisionData()}}};c.ensureRoomY=function () {var e=this.yData.length*2;if (this.yData.length<=this.yCount) {for (var d=this.yData.length;d<e;d++) {this.yData[d]=new a.CollisionData()}}};c.reset=function () {this.xCount=0;this.yCount=0;this.xDeltaMovement=Infinity;this.yDeltaMovement=Infinity};return b}());a.Messenger=(function () {var c=function () {this.messages={};this.loopCheck=[];this.unbindLater=[]},b=c.prototype;b.toString=function () {return"[messenger Object]"};b.bind=function (e,f,d) {if (!this.messages[e]) {this.messages[e]=[]}this.messages[e].push({callback:f,scope:d})};b.unbind=function (f,h,e) {var g=false,d=0;if (this.loopCheck.length) {for (d=0;d<this.loopCheck.length;d++) {if (this.loopCheck[d]===f) {g=true;break}}}if (g) {this.unbindLater.push({event:f,callback:h,scope:e})}else{this.safelyUnbind(f,h,e)}};b.safelyUnbind=function (f,g,e) {if (!this.messages[f]) {this.messages[f]=[]}for (var d in this.messages[f]) {if ((this.messages[f][d].callback===g)&&(this.messages[f][d].scope===e)) {this.messages[f].splice(d,1);break}}};b.trigger=function (f,h,d) {var e=0,g=0;if (typeof f==="string") {return this.triggerEvent(f,h,d)}else{if (Array.isArray(f)) {for (;e<f.length;e++) {g+=this.trigger(f[e],h,d)}return g}else{if (f.event) {return this.triggerEvent(f.event,f.message||h,f.debug||d)}else{console.warn('Event incorrectly formatted: must be string, array, or object containing an "event" property.',f);return 0}}}};b.triggerEvent=function (g,h,d) {var f=0,e=0,k=0;if (this.debug||d||(h&&h.debug)) {if (this.messages[g]&&this.messages[g].length) {console.log('Entity "'+this.type+'": Event "'+g+'" has '+this.messages[g].length+" subscriber"+((this.messages[g].length>1)?"s":"")+".",h)}else{console.warn('Entity "'+this.type+'": Event "'+g+'" has no subscribers.',h)}for (f=0;f<this.loopCheck.length;f++) {if (this.loopCheck[f]===g) {k+=1;if (k>5) {throw"Endless loop detected for '"+g+"'."}else{console.warn("Event '"+g+"' is nested inside another '"+g+"' event.")}}}f=0}this.loopCheck.push(g);if (this.messages[g]) {for (f=0;f<this.messages[g].length;f++) {this.messages[g][f].callback.call(this.messages[g][f].scope||this,h,d)}}this.loopCheck.length=this.loopCheck.length-1;if (!this.loopCheck.length&&this.unbindLater.length) {for (e=0;e<this.unbindLater.length;e++) {this.safelyUnbind(this.unbindLater[e].event,this.unbindLater[e].callback,this.unbindLater[e].scope)}this.unbindLater.length=0}return f};b.getMessageIds=function () {var d=[];for (var e in this.messages) {d.push(e)}return d};b.copyEventHandlers=function (d) {return this.messages[events]||null};return c}());(function () {var d=navigator.userAgent.toLowerCase(),m=document.createElement("audio"),p={canvas:false,touch:!!("ontouchstart" in window),iPod:(d.search("ipod")>-1),iPhone:(d.search("iphone")>-1),iPad:(d.search("ipad")>-1),safari:(d.search("safari")>-1),ie:(d.search("msie")>-1)||(d.search("trident")>-1),firefox:(d.search("firefox")>-1),android:(d.search("android")>-1),chrome:(d.search("chrome")>-1),silk:(d.search("silk")>-1),iPhone4:false,iPad2:false,iOS:false,mobile:false,desktop:false,multitouch:false,audioAPI:false,ogg:true,m4a:true,mp3:true},o=a.settings.manifest,l=0,h=0,g=0,c=false,f="";p.iPhone4=p.iPhone&&(window.screen.height==(960/2));p.iPad2=p.iPad&&(!window.devicePixelRatio||(window.devicePixelRatio===1));p.iOS=p.iPod||p.iPhone||p.iPad;p.mobile=p.iOS||p.android||p.silk;p.desktop=!p.mobile;p.audioAPI=!p.iOS||(!p.iPad2&&!p.iPhone4);if (p.touch) {if (p.android) {if (parseInt(d.slice(d.indexOf("android")+8))>2) {p.multitouch=true}}else{p.multitouch=true}}if ((m.canPlayType)&&!(!!m.canPlayType&&""!=m.canPlayType('audio/ogg; codecs="vorbis"'))) {p.ogg=false;if (p.ie||!(!!m.canPlayType&&""!=m.canPlayType("audio/mp4"))) {p.m4a=false}}var b=document.createElement("canvas");try{p.canvas=!!(b.getContext("2d"))}catch(n) {p.canvas=!!(b.getContext)}delete b;a.settings.manifest={};for (l in o) {c=false;f="";for (h in o[l]) {f+=" "+h;if (d.search(h)>-1) {c=o[l][h];break}}if (!c) {console.warn("This browser doesn't support any of the following: "+f)}else{for (h in o[l]) {a.settings.manifest[o[l][h]]=c}}}if (window.createjs&&createjs.Sound) {if (createjs.HTMLAudioPlugin) {createjs.HTMLAudioPlugin.enableIOS=true}if (!p.audioAPI) {createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin])}else{if (p.ie) {createjs.FlashPlugin.swfPath="./";createjs.Sound.registerPlugins([createjs.FlashPlugin,createjs.HTMLAudioPlugin])}else{createjs.Sound.initializeDefaultPlugins()}}p.audioAPI=(createjs.Sound.activePlugin.toString()==="[WebAudioPlugin]")}a.settings.supports=p}());a.Game=(function () {var d=function (e,f) {return function (g) {f(e,g)}};var b=function (j,g) {var e=document.createElement("div"),k=null;a.game=this;this.currentScene=undefined;this.loaded=null;this.settings=j;if (!j.aspects) {j.aspects=a.settings.aspects}if (!j.supports) {j.supports=a.settings.supports}if (!j.classes) {j.classes=a.settings.classes}if (!j.components) {j.components=a.settings.components}if (document.getElementById(j.global.rootElement||"root")) {k=document.getElementById(j.global.rootElement||"root")}else{k=document.createElement("div");k.id=j.global.rootElement||"root";document.getElementsByTagName("body")[0].appendChild(k)}for (var h in j.supports) {if (j.supports[h]) {k.className+=" supports-"+h}}e.id="inner-"+k.id;k.appendChild(e);this.rootElement=e;this.containerElement=k;this.loadScene(j.global.initialScene);var f=this,l=null;if (j.debug) {l=function (i,m) {f.currentScene.trigger(i,m)}}else{l=function (i,m) {f.currentScene.trigger(i,m);m.preventDefault()}}this.bindings=[];this.addEventListener(window,"keydown",l);this.addEventListener(window,"keyup",l);if (j.global.aspectRatio) {l=function (p,q) {var n=e;var o=j.global.aspectRatio;var r=k.offsetWidth;var m=k.offsetHeight;if (j.global.maxWidth&&(j.global.maxWidth<r)) {r=j.global.maxWidth}var i=r/m;if (i>o) {n.style.height=m+"px";r=m*o;n.style.width=r+"px"}else{n.style.width=r+"px";m=r/o;n.style.height=m+"px"}if (j.global.resizeFont) {k.style.fontSize=Math.round(r/20)+"px"}n.style.marginTop="-"+Math.round(m/2)+"px";n.style.marginLeft="-"+Math.round(r/2)+"px";n.style.top="50%";n.style.left="50%";f.currentScene.trigger(p,q)};l("resize")}else{if (j.global.resizeFont) {l=function (i,m) {k.style.fontSize=Math.round(f.rootElement.offsetWidth/20)+"px";f.currentScene.trigger(i,m)};l("resize")}}this.addEventListener(window,"orientationchange",l);this.addEventListener(window,"resize",l);if (g) {g(this)}createjs.Ticker.timingMode="raf";createjs.Ticker.setFPS(j.global.fps||60);this.tickWrapper=function (i) {f.tick(i)};createjs.Ticker.addEventListener("tick",this.tickWrapper);if (window) {window.getEntityById=function (i) {return f.getEntityById(i)};window.getEntitiesByType=function (i) {return f.getEntitiesByType(i)}}};var c=b.prototype;c.tick=function (e) {if (this.loadedScene) {this.loadedScene.trigger("tick",e)}if (this.currentScene) {this.currentScene.trigger("tick",e)}};c.loadScene=function (g,l,f,e) {var o=this;if (this.leavingScene) {this.leavingScene.destroy()}this.inTransition=true;this.leavingScene=this.currentScene;if (e) {this.loadNextScene(g);return}else{if (this.loadedScene) {this.loadedScene.destroy();this.loadedScene=null}}switch(l) {case"fade-to-black":var k=document.createElement("div");this.rootElement.appendChild(k);k.style.width="100%";k.style.height="100%";k.style.position="absolute";k.style.zIndex="12";k.style.opacity="0";k.style.background="#000";new createjs.Tween(k.style).to({opacity:0},500).to({opacity:1},500).call(function (i) {if (!this.loaded) {o.loadNextScene(g,f)}o.completeSceneTransition(f)}).wait(500).to({opacity:0},500).call(function (i) {o.rootElement.removeChild(k);k=undefined});break;case"crossfade":var m=null,k=null,n=false,j=this.loaded;if (!this.loaded) {o.loadNextScene(g,f);j=this.loaded}m=this.loadedScene.layers;for (var h=0;h<m.length;h++) {if (m[h].element) {k=m[h].element.style;k.opacity="0";if (!n) {n=true;new createjs.Tween.get(k).to({opacity:0},5).to({opacity:1},1000).call(function (i) {if (j===o.loaded) {o.completeSceneTransition(f)}})}else{new createjs.Tween.get(k).to({opacity:0},5).to({opacity:1},1000)}}}if (!n) {o.completeSceneTransition(f)}break;case"instant":default:if (!this.loaded) {o.loadNextScene(g,f)}this.completeSceneTransition(f)}};c.loadNextScene=function (e,g) {var f=null;if (typeof e==="string") {f=this.settings.scenes[e]}else{f=e}this.loaded=e;this.loadedScene=new a.Scene(f,this.rootElement);console.log("Scene loaded: "+e);this.loadedScene.trigger("scene-loaded",g)};c.completeSceneTransition=function (f) {var e=this.loaded;if (this.loadedScene) {this.currentScene=this.loadedScene;this.loadedScene=null;this.loaded=false;this.inTransition=false;if (this.leavingScene) {this.leavingScene.destroy();this.leavingScene=false}console.log("Scene live: "+e);this.currentScene.trigger("scene-live",f)}};c.addEventListener=function (e,f,g) {this.bindings[f]={element:e,event:f,callback:d(f,g)};e.addEventListener(f,this.bindings[f].callback,true)};c.getEntityById=function (e) {if (this.currentScene) {return this.currentScene.getEntityById(e)}else{return undefined}};c.getEntitiesByType=function (e) {if (this.currentScene) {return this.currentScene.getEntitiesByType(e)}else{return[]}};c.destroy=function () {createjs.Ticker.removeEventListener("tick",this.tickWrapper);for (var e in this.bindings) {this.bindings[e].element.removeEventListener(this.bindings[e].event,this.bindings[e].callback)}this.bindings.length=0};return b}());a.Scene=(function () {var c=function (f,d) {var j=f.layers,k=true,n=false,m=false,g=null;this.id=f.id;this.storedMessages=[];this.rootElement=d;this.layers=[];for (var l in j) {n=j[l];m={rootElement:this.rootElement,parent:this};if (n.properties) {for (h in n.properties) {m[h]=n.properties[h]}}if (n.type) {n=a.game.settings.entities[n.type]}k=true;if (n.filter) {if (n.filter.includes) {k=false;for (var e in n.filter.includes) {if (a.game.settings.supports[n.filter.includes[e]]) {k=true}}}if (n.filter.excludes) {for (var e in n.filter.excludes) {if (a.game.settings.supports[n.filter.excludes[e]]) {k=false}}}}if (k) {this.layers.push(new a.Entity(n,{properties:m}))}}g=this.storedMessages;this.storedMessages=false;for (var h=0;h<g.length;h++) {this.trigger(g[h].message,g[h].value)}g.length=0;this.time=new Date().getTime();this.timeElapsed={name:"",time:0}};var b=c.prototype;b.trigger=function (e,f) {var d=0,g=0;if (this.storedMessages) {this.storedMessages.push({message:e,value:f})}else{if (e==="tick") {g=new Date().getTime();this.timeElapsed.name="Non-Engine";this.timeElapsed.time=g-this.time;this.trigger("time-elapsed",this.timeElapsed);this.time=g}for (;d<this.layers.length;d++) {this.layers[d].trigger(e,f)}if (e==="tick") {g=new Date().getTime();this.timeElapsed.name="Engine Total";this.timeElapsed.time=g-this.time;this.trigger("time-elapsed",this.timeElapsed);this.time=g}}};b.getEntityById=function (f) {var d=0,e=null;for (;d<this.layers.length;d++) {if (this.layers[d].id===f) {return this.layers[d]}if (this.layers[d].getEntityById) {e=this.layers[d].getEntityById(f);if (e) {return e}}}return undefined};b.getEntitiesByType=function (f) {var d=0,e=null,g=[];for (;d<this.layers.length;d++) {if (this.layers[d].type===f) {g.push(this.layers[d])}if (this.layers[d].getEntitiesByType(f)) {e=this.layers[d].getEntitiesByType(f);if (e) {g=g.concat(e)}}}return g};b.destroy=function () {for (var d in this.layers) {this.layers[d].destroy()}this.layers.length=0};return c}());a.Entity=(function () {var d={},b=function (h,f) {var n=this,k=undefined,j=undefined,g=h||{},e=g.components||[],m=g.properties||{},l=f||{},i=l.properties||{};a.Messenger.call(this);n.components=[];n.type=g.id||"none";n.id=f.id||i.id;if (!n.id) {if (!d[n.type]) {d[n.type]=0}n.id=n.type+"-"+d[n.type];d[n.type]+=1}this.setProperty(m);this.setProperty(i);this.bind("set-property",function (o) {n.setProperty(o)});if (!n.state) {n.state={}}n.lastState={};for (k in e) {j=e[k];if (a.components[j.type]) {n.addComponent(new a.components[j.type](n,j))}else{console.warn("Component '"+j.type+"' is not defined.",j)}}n.triggerEvent("load")};var c=b.prototype=new a.Messenger();c.toString=function () {return"[entity "+this.type+"]"};c.addComponent=function (e) {this.components.push(e);this.triggerEvent("component-added",e);return e};c.removeComponent=function (f) {var e="";if (typeof f==="string") {for (e in this.components) {if (this.components[e].type===f) {f=this.components[e];this.components.splice(e,1);this.triggerEvent("component-removed",this.components[e]);f.destroy();return f}}}else{for (e in this.components) {if (this.components[e]===f) {this.components.splice(e,1);this.triggerEvent("component-removed",this.components[e]);f.destroy();return f}}}return false};c.setProperty=function (f) {var e="";for (e in f) {this[e]=f[e]}};c.destroy=function () {for (var e in this.components) {this.components[e].destroy()}this.components.length=0};return b}());(function (b) {b.components={};b.createComponentClass=function (e,d) {var c=function (h,k) {var l=null,i="";if (d) {d.call(this)}this.owner=h;this.listener={events:[],messages:[]};this.publicMethods={};this.type=e.id;if (e.events) {for (l in e.events) {this.addEventListener(l,e.events[l]);if (k.aliases) {for (var j in k.aliases) {if (k.aliases[j]===l) {this.addEventListener(j,e.events[l])}}}}}if (e.publicMethods) {for (l in e.publicMethods) {i=l;if (k.aliases) {for (var j in k.aliases) {if (k.aliases[j]===l) {i=j}}}this.addMethod(i,e.publicMethods[l])}}if (this.constructor) {this.constructor(k)}},g=null,f=c.prototype;if (d) {f=c.prototype=new d()}f.constructor=e.constructor;if (e.methods) {for (g in e.methods) {if (g==="destroy") {f["___"+g]=e.methods[g]}else{f[g]=e.methods[g]}}}if (e.publicMethods) {for (g in e.publicMethods) {f[g]=e.publicMethods[g]}}f.toString=function () {return"[component "+this.type+"]"};f.destroy=function () {if (this.___destroy) {this.___destroy()}for (g in this.publicMethods) {this.removeMethod(g)}this.removeEventListeners()};f.setProperty=function (i,h) {this[i]=h};f.addListeners=function () {console.warn('Component "'+this.type+'": "component.addListeners()" is deprecated. Use "component.addEventListener()".')};f.addListener=function () {console.warn('Component "'+this.type+'": "component.addListener()" is deprecated. Use "component.addEventListener()".')};f.removeListeners=function () {console.warn('Component "'+this.type+'": "component.removeListeners()" is deprecated. Use "component.removeEventListeners()".')};f.removeListener=function () {console.warn('Component "'+this.type+'": "component.removeListener()" is deprecated. Use "component.removeEventListener()".')};f.removeEventListeners=function (k) {var j=null,l=null;if (!k) {j=this.listener.events;l=this.listener.messages;for (var h=0;h<j.length;h++) {this.removeEventListener(j[h],l[h])}}else{j=k;for (var h=0;h<j.length;h++) {this.removeEventListener(j[h])}}};f.addEventListener=function (h,i) {this.listener.events.push(h);this.listener.messages.push(i);this.owner.bind(h,i,this)};f.addMethod=function (i,j) {var h=this;if (this.owner[i]) {console.warn(this.owner.type+': Entity already has a method called "'+i+'". Method not added.')}else{this.owner[i]=function () {return j.apply(h,arguments)};this.publicMethods[i]=j}};f.removeEventListener=function (l,m) {var j=this.listener.events,k=this.listener.messages;for (var h=0;h<j.length;h++) {if ((j[h]===l)&&(!m||(k[h]===m))) {this.owner.unbind(l,k[h],this)}}};f.removeMethod=function (h) {if (!this.owner[h]) {console.warn(owner.type+': Entity does not have a method called "'+h+'".')}else{delete this.owner[h]}delete this.publicMethods[h]};b.components[e.id]=c}})(a);a.components={};(function () {var b=function (f,e) {return function (h) {if (h.released) {f+=":up"}else{if (h.pressed) {f+=":down"}}for (var g=0;g<e.entities.length;g++) {e.entities[g].trigger(f,h)}}},d=function (f,e) {return function (h) {for (var g=0;g<e.entities.length;g++) {e.entities[g].trigger(f,h)}}},c={kc0:"unknown",kc8:"backspace",kc9:"tab",kc12:"numpad-5-shift",kc13:"enter",kc16:"shift",kc17:"ctrl",kc18:"alt",kc19:"pause",kc20:"caps-lock",kc27:"esc",kc32:"space",kc33:"page-up",kc34:"page-down",kc35:"end",kc36:"home",kc37:"left-arrow",kc38:"up-arrow",kc39:"right-arrow",kc40:"down-arrow",kc42:"numpad-multiply",kc43:"numpad-add",kc44:"print-screen",kc45:"insert",kc46:"delete",kc47:"numpad-division",kc48:"0",kc49:"1",kc50:"2",kc51:"3",kc52:"4",kc53:"5",kc54:"6",kc55:"7",kc56:"8",kc57:"9",kc59:"semicolon",kc61:"equals",kc65:"a",kc66:"b",kc67:"c",kc68:"d",kc69:"e",kc70:"f",kc71:"g",kc72:"h",kc73:"i",kc74:"j",kc75:"k",kc76:"l",kc77:"m",kc78:"n",kc79:"o",kc80:"p",kc81:"q",kc82:"r",kc83:"s",kc84:"t",kc85:"u",kc86:"v",kc87:"w",kc88:"x",kc89:"y",kc90:"z",kc91:"left-windows-start",kc92:"right-windows-start",kc93:"windows-menu",kc96:"back-quote",kc106:"numpad-multiply",kc107:"numpad-add",kc109:"numpad-minus",kc110:"numpad-period",kc111:"numpad-division",kc112:"f1",kc113:"f2",kc114:"f3",kc115:"f4",kc116:"f5",kc117:"f6",kc118:"f7",kc119:"f8",kc120:"f9",kc121:"f10",kc122:"f11",kc123:"f12",kc144:"num-lock",kc145:"scroll-lock",kc186:"semicolon",kc187:"equals",kc188:"comma",kc189:"hyphen",kc190:"period",kc191:"forward-slash",kc192:"back-quote",kc219:"open-bracket",kc220:"back-slash",kc221:"close-bracket",kc222:"quote"};return a.createComponentClass({id:"handler-controller",constructor:function (e) {this.entities=[];this.timeElapsed={name:"Controller",time:0}},events:{keydown:function (f) {for (var e=0;e<this.entities.length;e++) {this.entities[e].trigger("key:"+(c["kc"+f.keyCode]||("key-code-"+f.keyCode))+":down",f)}},keyup:function (f) {for (var e=0;e<this.entities.length;e++) {this.entities[e].trigger("key:"+(c["kc"+f.keyCode]||("key-code-"+f.keyCode))+":up",f)}},tick:function (g) {var f=new Date().getTime();for (var e=this.entities.length-1;e>-1;e--) {if (!this.entities[e].trigger("handle-controller",g)) {this.entities.splice(e,1)}}this.timeElapsed.time=new Date().getTime()-f;a.game.currentScene.trigger("time-elapsed",this.timeElapsed)},"child-entity-added":function (e) {this.updateEntity(e)},"child-entity-updated":function (e) {this.updateEntity(e)}},methods:{updateEntity:function (f) {var h=f.getMessageIds(),k=false;for (var e=0;e<h.length;e++) {if (h[e]=="handle-controller") {for (var g=0;g<this.entities.length;g++) {if (this.entities[g]==f) {k=true;break}}if (!k) {if (f.controlMap) {for (var i in f.controlMap) {if ((i.indexOf("key:")<0)&&(i.indexOf("mouse:")<0)) {if (!this[i]) {this.addEventListener(i,b(i,this));this.addEventListener(i+":up",d(i+":up",this));this.addEventListener(i+":down",d(i+":down",this))}}}}this.entities.push(f);f.trigger("controller-load")}break}}},destroy:function () {this.entities.length=0}}})}());(function () {return a.createComponentClass({id:"handler-ai",constructor:function (b) {},events:{tick:function (b) {if (this.owner.triggerEventOnChildren) {this.owner.triggerEventOnChildren("handle-ai",b)}}},methods:{destroy:function () {}}})}());(function () {var b=function (c) {var d=null,e=false;for (d in c.state) {if (c.state[d]!==c.lastState[d]) {c.lastState[d]=c.state[d];e=true}}return e};return a.createComponentClass({id:"handler-logic",constructor:function (c) {this.entities=[];this.activeEntities=this.entities;this.paused=0;this.stepLength=c.stepLength||30;this.leftoverTime=0;this.maximumStepsPerTick=10;this.camera={left:0,top:0,width:0,height:0,bufferLeft:c.bufferLeft||c.bufferWidth||c.buffer||-1,bufferRight:c.bufferRight||c.bufferWidth||c.buffer||-1,bufferTop:c.bufferTop||c.bufferHeight||c.buffer||-1,bufferBottom:c.bufferBottom||c.bufferHeight||c.buffer||-1,active:false};this.message={delta:this.stepLength,tick:null,camera:this.camera,movers:this.activeEntities};this.timeElapsed={name:"Logic",time:0}},events:{"child-entity-added":function (d) {var e=d.getMessageIds();for (var c=0;c<e.length;c++) {if (e[c]=="handle-logic"||e[c]=="handle-post-collision-logic") {this.entities.push(d);this.updateNeeded=this.camera.active;break}}},"child-entity-removed":function (c) {for (var d=this.entities.length-1;d>-1;d--) {if (this.entities[d]===c) {this.entities.splice(d,1);break}}},"pause-logic":function (c) {if (c&&c.time) {this.paused=c.time}else{this.paused=-1}},"unpause-logic":function () {this.paused=0},"camera-update":function (c) {this.camera.left=c.viewportLeft;this.camera.top=c.viewportTop;this.camera.width=c.viewportWidth;this.camera.height=c.viewportHeight;if (this.camera.bufferLeft==-1) {this.camera.bufferLeft=this.camera.width/10}if (this.camera.bufferRight==-1) {this.camera.bufferRight=this.camera.width/10}if (this.camera.bufferTop==-1) {this.camera.bufferTop=this.camera.width/10}if (this.camera.bufferBottom==-1) {this.camera.bufferBottom=this.camera.width/10}this.camera.active=true;this.updateNeeded=true},tick:function (g) {var f=0,h=undefined,e=new Date().getTime();this.leftoverTime+=g.delta;f=Math.floor(this.leftoverTime/this.stepLength)||1;this.message.delta=Math.min(this.leftoverTime,this.stepLength);this.leftoverTime=Math.max(this.leftoverTime-(f*this.stepLength),0);if (this.paused>0) {this.paused-=g.delta;if (this.paused<0) {this.paused=0}}if (!this.paused) {if (!this.message.tick) {this.message.tick=g}if (this.activeEntities===this.entities) {this.message.movers=this.activeEntities=[]}this.activeEntities.length=0;for (var c=this.entities.length-1;c>-1;c--) {h=this.entities[c];if (h.alwaysOn||(typeof h.x==="undefined")||((h.x>=this.camera.left-this.camera.bufferLeft)&&(h.x<=this.camera.left+this.camera.width+this.camera.bufferRight)&&(h.y>=this.camera.top-this.camera.bufferTop)&&(h.y<=this.camera.top+this.camera.height+this.camera.bufferBottom))) {this.activeEntities.push(h)}}f=Math.min(f,this.maximumStepsPerTick);for (var d=0;d<f;d++) {for (var c=this.activeEntities.length-1;c>-1;c--) {h=this.activeEntities[c];if (h.triggerEvent("handle-logic",this.message)) {h.checkCollision=true}}this.timeElapsed.name="Logic";this.timeElapsed.time=new Date().getTime()-e;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);e+=this.timeElapsed.time;if (this.owner.triggerEvent("check-collision-group",this.message)) {this.timeElapsed.name="Collision";this.timeElapsed.time=new Date().getTime()-e;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);e+=this.timeElapsed.time;for (var c=this.activeEntities.length-1;c>-1;c--) {h=this.activeEntities[c];h.triggerEvent("handle-post-collision-logic",this.message);if (b(h)) {h.triggerEvent("logical-state",h.state)}}this.timeElapsed.name="Collision Logic";this.timeElapsed.time=new Date().getTime()-e;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);e+=this.timeElapsed.time}else{for (var c=this.activeEntities.length-1;c>-1;c--) {h=this.activeEntities[c];if (b(h)) {h.triggerEvent("logical-state",h.state)}}}}}this.timeElapsed.time=new Date().getTime()-e;a.game.currentScene.trigger("time-elapsed",this.timeElapsed)}}})}());(function () {var b={entity:null,type:null,x:0,y:0,hitType:null,myType:null},e={x:0,y:0,relative:false},g=function (h) {h.x=0;h.y=0;h.relative=false},d=new a.CollisionDataContainer(),f=function (i,h) {if (i.left>=h.right) {return false}if (i.right<=h.left) {return false}if (i.top>=h.bottom) {return false}if (i.bottom<=h.top) {return false}return true},c=function (k,j) {var l=0;var o=0;var h=undefined;var n=undefined;var q=0;var p=0;var m=undefined;var i=0;if (k.type=="rectangle"&&j.type=="rectangle") {return true}else{if (k.type=="circle"&&j.type=="circle") {l=Math.pow((k.x-j.x),2)+Math.pow((k.y-j.y),2);o=Math.pow((k.radius+j.radius),2);if (l<=o) {return true}}else{if (k.type=="circle"&&j.type=="rectangle"||k.type=="rectangle"&&j.type=="circle") {if (k.type=="circle") {h=k;n=j}else{h=j;n=k}m=n.getAABB();q=Math.abs(h.x-n.x);p=Math.abs(h.y-n.y);if (q>=(m.halfWidth+h.radius)) {return false}if (p>=(m.halfHeight+h.radius)) {return false}if (q<(m.halfWidth)) {return true}if (p<(m.halfHeight)) {return true}i=Math.pow((q-m.halfWidth),2)+Math.pow((p-m.halfHeight),2);if (i<Math.pow(h.radius,2)) {return true}}}}return false};return a.createComponentClass({id:"handler-collision",constructor:function (h) {this.entitiesByType={};this.entitiesByTypeLive={};this.allEntities=[];this.solidEntitiesLive=[];this.softEntitiesLive=[];this.allEntitiesLive=[];this.groupsLive=[];this.nonColliders=[];this.terrain=undefined;this.aabb=new a.AABB(this.owner.x,this.owner.y);this.prevAABB=new a.AABB(this.owner.x,this.owner.y);this.owner.previousX=this.owner.previousX||this.owner.x;this.owner.previousY=this.owner.previousY||this.owner.y;this.updateLiveList=true;this.cameraLogicAABB=new a.AABB(0,0);this.cameraCollisionAABB=new a.AABB(0,0);this.timeElapsed={name:"Col",time:0}},events:{"child-entity-added":function (h) {if (!h.collideOff) {this.addCollisionEntity(h)}},"add-collision-entity":function (h) {this.addCollisionEntity(h)},"child-entity-removed":function (h) {this.removeCollisionEntity(h)},"remove-collision-entity":function (h) {this.removeCollisionEntity(h)},"check-collision-group":function (i) {var h=new Date().getTime();if (i.camera) {this.checkCamera(i.camera)}this.timeElapsed.name="Col-Cam";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time;this.prepareCollisions(i);this.timeElapsed.name="Col-Prep";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time;this.checkGroupCollisions();this.timeElapsed.name="Col-Group";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time;this.checkSolidCollisions();this.timeElapsed.name="Col-Solid";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time;this.resolveNonCollisions(i);this.timeElapsed.name="Col-None";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time;this.checkSoftCollisions(i);this.timeElapsed.name="Col-Soft";this.timeElapsed.time=new Date().getTime()-h;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);h+=this.timeElapsed.time}},methods:{addCollisionEntity:function (h) {var k=0,j=h.collisionTypes;if ((h.type=="tile-layer")||(h.type=="collision-layer")) {this.terrain=h;this.updateLiveList=true}else{if (j) {for (;k<j.length;k++) {if (!this.entitiesByType[j[k]]) {this.entitiesByType[j[k]]=[];this.entitiesByTypeLive[j[k]]=[]}this.entitiesByType[j[k]][this.entitiesByType[j[k]].length]=h}if (!h.immobile) {this.allEntities[this.allEntities.length]=h;this.updateLiveList=true}}}},removeCollisionEntity:function (k) {var h=0,n=0,l=0,m=k.collisionTypes;if (m) {for (;n<m.length;n++) {for (h in this.entitiesByType[m[n]]) {if (this.entitiesByType[m[n]][h]===k) {this.entitiesByType[m[n]].splice(h,1);break}}}if (!k.immobile) {for (l=0;l<this.allEntities.length;l++) {if (this.allEntities[l]===k) {this.allEntities.splice(l,1);break}}this.updateLiveList=true}}},checkCamera:(function () {var h=function (j,i) {return j.collisionGroup.getAllEntities()-i.collisionGroup.getAllEntities()};return function (E,z) {var C=0,B=0,m=0,F=null,k=null,I=null,o=null,A=E.width,v=E.height,s=E.left+A/2,q=E.top+v/2,H=E.bufferLeft,p=E.bufferRight,w=E.bufferTop,r=E.bufferBottom,l=undefined,u=undefined,G=f,n=this.cameraLogicAABB,D=this.cameraCollisionAABB,t=null;A+=H+p;v+=w+r;if (this.updateLiveList||!n.matches(s,q,A,v)) {n.setAll(s,q,A,v);this.updateLiveList=false;k=this.allEntitiesLive;k.length=0;o=this.solidEntitiesLive;o.length=0;I=this.softEntitiesLive;I.length=0;groups=this.groupsLive;groups.length=0;m=this.allEntities.length;for (C=0;C<m;C++) {u=this.allEntities[C];if (u.alwaysOn||u.checkCollision||G(u.getAABB(),n)) {u.checkCollision=false;k[k.length]=u;t=u.collisionTypes;if (u!==this.owner) {for (B=0;B<t.length;B++) {if (u.solidCollisions[t[B]].length) {o[o.length]=u;break}}}for (B=0;B<t.length;B++) {if (u.softCollisions[t[B]].length) {I[I.length]=u;break}}if (u.collisionGroup) {groups.push(u)}}}groups.sort(h);D.setAll(s,q,A+H+p,v+w+r);for (C in this.entitiesByType) {l=this.entitiesByType[C];F=this.entitiesByTypeLive[C];F.length=0;m=l.length;for (B=0;B<m;B++) {u=l[B];if (u.alwaysOn||G(u.getAABB(),D)) {F[F.length]=u}}}}}}()),prepareCollisions:function (j) {var i=null;this.nonColliders.length=0;for (var h=this.allEntitiesLive.length-1;h>-1;h--) {i=this.allEntitiesLive[h];i.triggerEvent("prepare-for-collision",j);if (!i.collides) {this.nonColliders.push(i)}}},resolveNonCollisions:function (k) {var i=null,j=e;j.relative=false;for (var h=this.nonColliders.length-1;h>-1;h--) {i=this.nonColliders[h];j.x=i.x;j.y=i.y;i.trigger("relocate-entity",j)}},checkGroupCollisions:(function () {var h=function (k,n,l,m,i,p,o,j) {b.entity=n;b.myType=l;b.type=m;b.x=i;b.y=p;b.direction=j;b.hitType=o;k.triggerEvent("hit-by-"+m,b);if (n) {b.entity=k;b.type=l;b.myType=m;b.x=-i;b.y=-p;b.direction=j.getInverse();b.hitType=o;n.triggerEvent("hit-by-"+l,b)}};return function () {var l=this.groupsLive;for (var j=l.length-1;j>-1;j--) {if (l[j].collisionGroup.getSize()>1) {d.reset();g(e);e=this.checkSolidEntityCollision(l[j],l[j].collisionGroup,d,e);for (var k=0;k<d.xCount;k++) {messageData=d.getXEntry(k);h(messageData.thisShape.owner,messageData.thatShape.owner,messageData.thisShape.collisionType,messageData.thatShape.collisionType,messageData.direction,0,"solid",messageData.vector)}for (k=0;k<d.yCount;k++) {messageData=d.getYEntry(k);h(messageData.thisShape.owner,messageData.thatShape.owner,messageData.thisShape.collisionType,messageData.thatShape.collisionType,0,messageData.direction,"solid",messageData.vector)}}}}}()),checkSolidCollisions:(function () {var h=function (k,n,l,m,i,p,o,j) {b.entity=n;b.myType=l;b.type=m;b.x=i;b.y=p;b.direction=j;b.hitType=o;k.triggerEvent("hit-by-"+m,b);if (n) {b.entity=k;b.type=l;b.myType=m;b.x=-i;b.y=-p;b.direction=j.getInverse();b.hitType=o;n.triggerEvent("hit-by-"+l,b)}};return function () {var l=null,m=this.solidEntitiesLive;for (var j=m.length-1;j>-1;j--) {d.reset();g(e);e=this.checkSolidEntityCollision(m[j],m[j],d,e);for (var k=0;k<d.xCount;k++) {l=d.getXEntry(k);h(l.thisShape.owner,l.thatShape.owner,l.thisShape.collisionType,l.thatShape.collisionType,l.direction,0,"solid",l.vector)}for (k=0;k<d.yCount;k++) {l=d.getYEntry(k);h(l.thisShape.owner,l.thatShape.owner,l.thisShape.collisionType,l.thatShape.collisionType,0,l.direction,"solid",l.vector)}}}}()),checkSolidEntityCollision:function (t,u,q,w) {var v=0,m=0,n=w,k=t.x-t.previousX,h=t.y-t.previousY,s=null,p=0,o=0,l=Infinity,y=Infinity,j=u.getCollisionTypes(),x=false;if (u.getSolidEntities) {x=u.getSolidEntities()}n.x=t.x;n.y=t.y;if (k||h) {if (t.bullet) {for (var r in j) {s=u.getAABB(j[r]);l=Math.min(l,s.width);y=Math.min(y,s.height)}v=Math.ceil(Math.max(Math.abs(k)/l,Math.abs(h)/y));v=Math.min(v,100);p=k/v;o=h/v}else{v=1;p=k;o=h}for (m=0;m<v;m++) {u.prepareCollision(t.previousX+p,t.previousY+o);n.x=t.x;n.y=t.y;n=this.processCollisionStep(t,u,x,q,n,p,o,j);if ((n.x===t.previousX)&&(n.y===t.previousY)) {u.relocateEntity(n.x,n.y,q);break}else{u.relocateEntity(n.x,n.y,q)}}}return n},processCollisionStep:(function () {var h=new a.AABB(),i=function (k,j,n,p,o) {var m=n.getAABB(p);if (n===k) {return false}else{if (n.jumpThrough&&(j.bottom>m.top)) {return false}else{if (k.jumpThrough&&(m.bottom>j.top)) {return false}else{if (o) {for (var l=0;l<o.length;l++) {if (n===o[l]) {return false}}}}}}return true};return function (E,m,D,o,C,G,F,J) {var k=false;var j=[];var t=null;var I=null;var w=null;var n=null;var x="";var r=null;var B=this.getWorldEntities();var H=null;var l=this.getWorldTerrain(),u=m.getSolidCollisions();for (var A=0;A<J.length;A++) {j[A]=[];w=J[A];t=m.getPreviousAABB(w);I=m.getAABB(w);h.reset();h.include(I);h.include(t);for (var s=0;s<u[w].length;s++) {x=u[w][s];if (B[x]) {H=B[x];for (var p=0;p<H.length;p++) {n=H[p];if (i(E,t,n,x,D)&&(f(h,n.getAABB(x)))) {r=n.getShapes(x);for (var v=0;v<r.length;v++) {j[A].push(r[v])}k=true}}}else{if (l&&(x==="tiles")) {r=l.getTileShapes(h,t);for (var v=0;v<r.length;v++) {j[A].push(r[v]);k=true}}}}}if (k) {C=this.resolveCollisionPosition(E,m,C,j,o,J,G,F)}return C}}()),resolveCollisionPosition:(function () {var h=new a.CollisionData();return function (p,q,m,r,o,k,l,i) {if (l!=0) {for (var n=0;n<k.length;n++) {h.clear();h=this.findMinAxisMovement(p,q,k[n],"x",r[n],h);if (h.occurred) {o.tryToAddX(h)}}}if (o.xCount>0) {h.copy(o.getXEntry(0));m.x=p.previousX+h.deltaMovement*h.direction}else{m.x=p.x}q.movePreviousX(m.x);if (i!=0) {for (var n=0;n<k.length;n++) {h.clear();h=this.findMinAxisMovement(p,q,k[n],"y",r[n],h);if (h.occurred) {o.tryToAddY(h)}}}if (o.yCount>0) {h.copy(o.getYEntry(0));m.y=p.previousY+h.deltaMovement*h.direction}else{m.y=p.y}return m}}()),findMinAxisMovement:(function () {var h=new a.CollisionData();return function (p,q,l,k,r,o) {var j=q.getShapes(l);var n=q.getPrevShapes(l);for (var m=0;m<j.length;m++) {h.clear();h=this.findMinShapeMovementCollision(n[m],j[m],k,r,h);if (h.occurred&&!o.occurred) {o.copy(h)}else{if (h.occurred&&o.occurred&&(h.deltaMovement<o.deltaMovement)) {o.copy(h)}}}return o}}()),findMinShapeMovementCollision:(function () {var i=function (p,o,j,l,n,m,k) {p.occurred=true;p.direction=o;p.position=j;p.deltaMovement=Math.abs(j-l);p.aABB=m.getAABB();p.thisShape=n;p.thatShape=m;p.vector=k.copy()},h=(function () {var j=new a.Vector2D(),m={position:0,contactVector:j},p=function (r,q) {return Math.sqrt(Math.pow(q,2)-Math.pow(r,2))},l=function (s,q,r) {var t=s-q;return t-(t/Math.abs(t))*r},n=function (q,r,s) {if (q==="x") {return s.halfWidth+r.halfWidth}else{if (q==="y") {return s.halfHeight+r.halfHeight}}},o=function (r,u,s,q,t) {var v=0;if (r==="x") {if (u.y>=s.aABB.top&&u.y<=s.aABB.bottom) {return s.aABB.halfWidth+u.radius}else{j.y=l(u.y,s.y,s.aABB.halfHeight);v=s.aABB.halfWidth+p(j.y,u.radius);if (q===u) {j.x=-l(u.x-t*v,s.x,s.aABB.halfWidth)/2;j.y=-j.y}else{j.x=l(u.x,s.x-t*v,s.aABB.halfWidth)/2}j.normalize();return v}}else{if (r==="y") {if (u.x>=s.aABB.left&&u.x<=s.aABB.right) {return s.aABB.halfHeight+u.radius}else{j.x=l(u.x,s.x,s.aABB.halfWidth);v=s.aABB.halfHeight+p(j.x,u.radius);if (q===u) {j.x=-j.x;j.y=-l(u.y-t*v,s.y,s.aABB.halfWidth)/2}else{j.y=l(u.y,s.y-t*v,s.aABB.halfWidth)/2}j.normalize();return v}}}},k=function (q,s,r) {if (q==="x") {return p(s.y-r.y,s.radius+r.radius)}else{if (q==="y") {return p(s.x-r.x,s.radius+r.radius)}}};return function (q,t,s,r) {if (s.type=="rectangle") {if (r.type=="rectangle") {m.position=r[q]-t*n(q,s.getAABB(),r.getAABB());j.x=0;j.y=0;j[q]=t;return m}else{if (r.type=="circle") {j.x=0;j.y=0;j[q]=t;m.position=r[q]-t*o(q,r,s,s,t);return m}}}else{if (s.type=="circle") {if (r.type=="rectangle") {j.x=0;j.y=0;j[q]=t;m.position=r[q]-t*o(q,s,r,s,t);return m}else{if (r.type=="circle") {m.position=r[q]-t*k(q,s,r);j.x=r.x-s.x;j.y=r.y-s.y;j[q]=r[q]-m.position;j.normalize();return m}}}}}}());return function (m,p,l,q,j) {var u=m[l];var s=p[l];var k=m;var r=(u<s)?1:-1;var o=s;var t=null;var v=s;if (u!=s) {if (l==="x") {k.moveX(s)}else{if (l==="y") {k.moveY(s)}}for (var n=0;n<q.length;n++) {o=s;if (f(k.getAABB(),q[n].getAABB())) {if (c(k,q[n])) {t=h(l,r,k,q[n]);o=t.position;if (r>0) {if (o<v) {if (o<u) {o=u}v=o;i(j,r,v,u,p,q[n],t.contactVector)}}else{if (o>v) {if (o>u) {o=u}v=o;i(j,r,v,u,p,q[n],t.contactVector)}}}}}}return j}}()),checkSoftCollisions:function (j) {var h=0,i=this;for (h=0;h<this.softEntitiesLive.length;h++) {this.checkEntityForSoftCollisions(this.softEntitiesLive[h],this.getWorldEntities(),function (k) {i.softEntitiesLive[h].trigger("hit-by-"+k.type,k)})}},checkEntityForSoftCollisions:function (s,A,x) {var B=undefined,C=b,o=0,n=0,m=0,v=0,u=0,l=f,r=null,q=null,w=null,h=null,t=null,p=false;C.x=0;C.y=0;for (o=0;o<s.collisionTypes.length;o++) {r=s.softCollisions[s.collisionTypes[o]];for (v=0;v<r.length;v++) {w=r[v];q=A[w];if (q) {for (u=0;u<q.length;u++) {p=false;B=q[u];if ((B!==s)&&(l(s.getAABB(s.collisionTypes[o]),B.getAABB(w)))) {h=s.getShapes(s.collisionTypes[o]);t=B.getShapes(w);for (n=0;n<h.length;n++) {for (m=0;m<t.length;m++) {if (c(h[n],t[m])) {C.entity=B;C.type=w;C.myType=s.collisionTypes[o];C.shape=t[m];C.hitType="soft";x(C);p=true}if (p) {break}}if (p) {break}}}}}}}},destroy:function () {this.allEntities.length=0;this.allEntitiesLive.length=0;this.softEntitiesLive.length=0;this.solidEntitiesLive.length=0;for (var h in this.entitiesByType) {this.entitiesByType[h].length=0}}},publicMethods:{getWorldEntities:function () {return this.entitiesByTypeLive},getWorldTerrain:function () {return this.terrain},getEntityCollisions:function (h,j) {var i=[];this.checkEntityForSoftCollisions(h,j||this.entitiesByTypeLive,function (m) {var k="",l={};for (k in m) {l[k]=m[k]}i.push(l)});return i}}})}());(function () {var b=function (c) {c.window.viewportTop=c.element.offsetTop;c.window.viewportLeft=c.element.offsetLeft;c.window.viewportWidth=c.element.offsetWidth||c.worldWidth;c.window.viewportHeight=c.element.offsetHeight||c.worldHeight;if (c.scaleWidth) {c.world.viewportWidth=c.window.viewportWidth/Math.ceil(c.window.viewportWidth/c.scaleWidth)}if (!c.stretch||c.scaleWidth) {c.world.viewportHeight=c.window.viewportHeight*c.world.viewportWidth/c.window.viewportWidth}c.worldPerWindowUnitWidth=c.world.viewportWidth/c.window.viewportWidth;c.worldPerWindowUnitHeight=c.world.viewportHeight/c.window.viewportHeight;c.windowPerWorldUnitWidth=c.window.viewportWidth/c.world.viewportWidth;c.windowPerWorldUnitHeight=c.window.viewportHeight/c.world.viewportHeight;c.viewportUpdate=true};return a.createComponentClass({id:"camera",constructor:function (c) {this.entities=[];this.stretch=c.stretch||false;this.rotate=c.rotate||false;this.transitionX=c.transitionX||c.transition;this.transitionY=c.transitionY||c.transition;this.transitionAngle=c.transitionAngle||c.transition;if (isNaN(this.transitionX)) {this.transitionX=400}if (isNaN(this.transitionY)) {this.transitionY=600}if (isNaN(this.transitionAngle)) {this.transitionAngle=400}this.threshold=c.threshold||1;this.element=null;this.window={viewportTop:0,viewportLeft:0,viewportWidth:0,viewportHeight:0};this.world={viewportWidth:this.owner.width||c.width||0,viewportHeight:this.owner.height||c.height||0,viewportLeft:c.left||0,viewportTop:c.top||0,viewportOrientation:c.orientation||0};this.message={viewportWidth:0,viewportHeight:0,viewportLeft:0,viewportTop:0,scaleX:0,scaleY:0,orientation:0};this.scaleWidth=c.scaleWidth||0;this.worldIsLoaded=false;this.worldWidth=c.worldWidth||c.width||0;this.worldHeight=c.worldHeight||c.height||0;this.following=undefined;this.state="static";this.bBBorderX=0;this.bBBorderY=0;this.bBInnerWidth=0;this.bBInnerHeight=0;this.setBoundingArea();this.lastLeft=this.world.viewportLeft;this.lastTop=this.world.viewportTop;this.lastOrientation=this.world.viewportOrientation;this.forwardX=0;this.forwardY=0;this.forwardAngle=0;this.averageOffsetX=0;this.averageOffsetY=0;this.averageOffsetAngle=0;this.offsetX=0;this.offsetY=0;this.offsetAngle=0;this.forwardFollower={x:this.lastLeft,y:this.lastTop,orientation:this.lastOrientation};this.lastFollow={entity:null,mode:null,offsetX:0,offsetY:0,begin:0};this.shakeOffsetX=0;this.shakeOffsetY=0;this.xMagnitude=0;this.yMagnitude=0;this.xWaveLength=0;this.yWaveLength=0;this.xShakeTime=0;this.yShakeTime=0;this.shakeTime=0;this.shakeIncrementor=0;this.direction=true;this.stationary=false;this.viewportUpdate=false},events:{load:function () {this.element=this.owner.canvas||this.owner.element||this.owner.rootElement;b(this)},"child-entity-added":function (d) {var e=d.getMessageIds();for (var c=0;c<e.length;c++) {if (e[c]=="camera-update") {this.entities.push(d);this.viewportUpdate=true;if (this.worldIsLoaded) {d.trigger("camera-loaded",{width:this.worldWidth,height:this.worldHeight})}break}}},"child-entity-removed":function (d) {var c=0;for (c in this.entities) {if (this.entities[c]===d) {this.entities.splice(c,1);break}}},"world-loaded":function (d) {this.worldIsLoaded=true;this.worldWidth=this.owner.worldWidth=d.width;this.worldHeight=this.owner.worldHeight=d.height;if (d.camera) {this.follow(d.camera)}for (var c=this.entities.length-1;c>-1;c--) {this.entities[c].trigger("camera-loaded",d)}},tick:function (d) {switch(this.state) {case"following":if (this.followingfunction (this.following,d.delta)) {this.viewportUpdate=true}break;case"static":default:break}if (this.viewportUpdate) {this.viewportUpdate=false;this.stationary=false;if (this.shakeIncrementor<this.shakeTime) {this.viewportUpdate=true;this.shakeIncrementor+=d.delta;this.shakeIncrementor=Math.min(this.shakeIncrementor,this.shakeTime);if (this.shakeIncrementor<this.xShakeTime) {this.shakeOffsetX=Math.sin((this.shakeIncrementor/this.xWaveLength)*(Math.PI*2))*this.xMagnitude}else{this.shakeOffsetX=0}if (this.shakeIncrementor<this.yShakeTime) {this.shakeOffsetY=Math.sin((this.shakeIncrementor/this.yWaveLength)*(Math.PI*2))*this.yMagnitude}else{this.shakeOffsetY=0}}this.message.viewportLeft=this.world.viewportLeft+this.shakeOffsetX;this.message.viewportTop=this.world.viewportTop+this.shakeOffsetY;this.message.viewportWidth=this.world.viewportWidth;this.message.viewportHeight=this.world.viewportHeight;this.message.scaleX=this.windowPerWorldUnitWidth;this.message.scaleY=this.windowPerWorldUnitHeight;this.message.orientation=this.world.viewportOrientation;this.owner.trigger("camera-update",this.message);for (var c=this.entities.length-1;c>-1;c--) {if (!this.entities[c].trigger("camera-update",this.message)) {this.entities.splice(c,1)}}}else{if (!this.stationary) {this.owner.trigger("camera-stationary",this.message);this.stationary=true}}if (this.lastFollow.begin) {if (this.lastFollow.begin<new Date().getTime()) {this.follow(this.lastFollow)}}},resize:function () {b(this)},relocate:function (c) {if (this.move(c.x,c.y)) {this.viewportUpdate=true}},orientationchange:function () {b(this)},follow:function (c) {this.follow(c)},shake:function (d) {var g=d||{},f=g.xMagnitude||0,c=g.yMagnitude||0,i=g.xFrequency||0,e=g.yFrequency||0,h=g.time||0;this.viewportUpdate=true;this.shakeOffsetX=0;this.shakeOffsetY=0;this.shakeIncrementor=0;this.xMagnitude=f;this.yMagnitude=c;if (i==0) {this.xWaveLength=1;this.xShakeTime=0}else{this.xWaveLength=(1000/i);this.xShakeTime=Math.ceil(h/this.xWaveLength)*this.xWaveLength}if (e==0) {this.yWaveLength=1;this.yShakeTime=0}else{this.yWaveLength=(1000/e);this.yShakeTime=Math.ceil(h/this.yWaveLength)*this.yWaveLength}this.shakeTime=Math.max(this.xShakeTime,this.yShakeTime)}},methods:{follow:function (c) {if (c.time) {if (!this.lastFollow.begin) {this.lastFollow.entity=this.following;this.lastFollow.mode=this.mode;this.lastFollow.offsetX=this.offsetX;this.lastFollow.offsetY=this.offsetY}this.lastFollow.begin=new Date().getTime()+c.time}else{if (this.lastFollow.begin) {this.lastFollow.begin=0}}this.mode=c.mode;switch(c.mode) {case"locked":this.state="following";this.following=c.entity;this.followingFunction=this.lockedFollow;this.offsetX=c.offsetX||0;this.offsetY=c.offsetY||0;this.offsetAngle=c.offsetAngle||0;break;case"forward":this.state="following";this.followFocused=false;this.following=c.entity;this.lastLeft=c.entity.x||0;this.lastTop=c.entity.y||0;this.lastorientation=c.entity.orientation||0;this.forwardX=c.movementX||(this.transitionX/10);this.forwardY=c.movementY||(this.transitionY/10);this.averageOffsetX=0;this.averageOffsetY=0;this.averageOffsetAngle=0;this.offsetX=c.offsetX||0;this.offsetY=c.offsetY||0;this.offsetAngle=c.offsetAngle||0;this.followingFunction=this.forwardFollow;break;case"bounding":this.state="following";this.following=c.entity;this.offsetX=c.offsetX||0;this.offsetY=c.offsetY||0;this.offsetAngle=c.offsetAngle||0;this.setBoundingArea(c.top,c.left,c.width,c.height);this.followingFunction=this.boundingFollow;break;case"static":default:this.state="static";this.following=undefined;this.followingFunction=undefined;if (c&&(typeof c.top==="number")&&(typeof c.left==="number")) {this.move(c.left,c.top,c.orientation||0);this.viewportUpdate=true}break}if (c.begin) {c.begin=0}},move:function (f,d,c) {var e=this.moveLeft(f);e=this.moveTop(d)||e;if (this.rotate) {e=this.reorient(c||0)||e}return e},moveLeft:function (c) {if (Math.abs(this.world.viewportLeft-c)>this.threshold) {if (this.worldWidth&&this.worldWidth!=0&&this.worldWidth<this.world.viewportWidth) {this.world.viewportLeft=(this.worldWidth-this.world.viewportWidth)/2}else{if (this.worldWidth&&this.worldWidth!=0&&(c+this.world.viewportWidth>this.worldWidth)) {this.world.viewportLeft=this.worldWidth-this.world.viewportWidth}else{if (this.worldWidth&&this.worldWidth!=0&&(c<0)) {this.world.viewportLeft=0}else{this.world.viewportLeft=c}}}return true}return false},moveTop:function (c) {if (Math.abs(this.world.viewportTop-c)>this.threshold) {if (this.worldHeight&&this.worldHeight!=0&&this.worldHeight<this.world.viewportHeight) {this.world.viewportTop=(this.worldHeight-this.world.viewportHeight)/2}else{if (this.worldHeight&&this.worldHeight!=0&&(c+this.world.viewportHeight>this.worldHeight)) {this.world.viewportTop=this.worldHeight-this.world.viewportHeight}else{if (this.worldHeight&&this.worldHeight!=0&&(c<0)) {this.world.viewportTop=0}else{this.world.viewportTop=c}}}return true}return false},reorient:function (c) {if (Math.abs(this.world.viewportOrientation-c)>0.0001) {this.world.viewportOrientation=c;return true}return false},lockedFollow:(function () {var c=Math.min;getTransitionalPoint=function (e,d,f) {return f*d+(1-f)*e},getRatio=function (e,d) {if (e) {return c(d/e,1)}else{return 1}};return function (e,g,f) {var d=getTransitionalPoint(this.world.viewportLeft,e.x-(this.world.viewportWidth/2),getRatio(this.transitionX,g)),h=getTransitionalPoint(this.world.viewportTop,e.y-(this.world.viewportHeight/2),getRatio(this.transitionY,g));if (this.rotate) {return this.move(d,h,getTransitionalPoint(this.world.viewportOrientation,-(e.orientation||0),getRatio(this.transitionAngle,g)))}else{return this.move(d,h,0)}}}()),forwardFollow:function (f,h) {var e=this.forwardFollower,i=15/h,g=false,c=f.x+this.offsetX,j=f.y+this.offsetY,d=(f.orientation||0)+this.offsetAngle;if (this.followFocused&&(this.lastLeft===c)&&(this.lastTop===j)) {return this.lockedFollow(e,h)}else{this.averageOffsetX*=0.9;this.averageOffsetY*=0.9;this.averageOffsetX+=0.1*(c-this.lastLeft)*i;this.averageOffsetY+=0.1*(j-this.lastTop)*i;if (Math.abs(this.averageOffsetX)>(this.world.viewportWidth/(this.forwardX*2))) {this.averageOffsetX=0}if (Math.abs(this.averageOffsetY)>(this.world.viewportHeight/(this.forwardY*2))) {this.averageOffsetY=0}if (this.rotate) {this.averageOffsetAngle*=0.9;this.averageOffsetAngle+=0.1*(d-this.lastOrientation)*i;if (Math.abs(this.averageOffsetAngle)>(this.world.viewportOrientation/(this.forwardAngle*2))) {this.averageOffsetAngle=0}}e.x=this.averageOffsetX*this.forwardX+c;e.y=this.averageOffsetY*this.forwardY+j;e.orientation=this.averageOffsetAngle*this.forwardAngle+d;this.lastLeft=c;this.lastTop=j;this.lastOrientation=d;g=this.lockedFollow(e,h);if (!this.followFocused&&!g) {this.followFocused=true}return g}},setBoundingArea:function (f,e,d,c) {this.bBBorderY=(typeof f!=="undefined")?f:this.world.viewportHeight*0.25;this.bBBorderX=(typeof e!=="undefined")?e:this.world.viewportWidth*0.4;this.bBInnerWidth=(typeof d!=="undefined")?d:this.world.viewportWidth-(2*this.bBBorderX);this.bBInnerHeight=(typeof c!=="undefined")?c:this.world.viewportHeight-(2*this.bBBorderY)},boundingFollow:function (e,g) {var f=null,d=null,c=(this.transitionX?Math.min(g/this.transitionX,1):1),j=1-c,i=(this.transitionY?Math.min(g/this.transitionY,1):1),h=1-i;if (e.x>this.world.viewportLeft+this.bBBorderX+this.bBInnerWidth) {f=e.x-(this.bBBorderX+this.bBInnerWidth)}else{if (e.x<this.world.viewportLeft+this.bBBorderX) {f=e.x-this.bBBorderX}}if (e.y>this.world.viewportTop+this.bBBorderY+this.bBInnerHeight) {d=e.y-(this.bBBorderY+this.bBInnerHeight)}else{if (e.y<this.world.viewportTop+this.bBBorderY) {d=e.y-this.bBBorderY}}if (typeof f!=="null") {f=this.moveLeft(c*f+j*this.world.viewportLeft)}if (typeof d!=="null") {d=this.moveTop(i*d+h*this.world.viewportTop)}return f||d},windowToWorld:function (c) {var d=[];d[0]=Math.round((c[0]-this.window.viewportLeft)*this.worldPerWindowUnitWidth);d[1]=Math.round((c[1]-this.window.viewportTop)*this.worldPerWindowUnitHeight);return d},worldToWindow:function (d) {var c=[];c[0]=Math.round((d[0]*this.windowPerWorldUnitWidth)+this.window.viewportLeft);c[1]=Math.round((d[1]*this.windowPerWorldUnitHeight)+this.window.viewportTop);return c},destroy:function () {this.entities.length=0}}})}());(function () {var b=navigator.userAgent.toLowerCase(),c=(b.indexOf("android 4.1")>-1)||(b.indexOf("android 4.2")>-1)||false,d=window.devicePixelRatio||1;return a.createComponentClass({id:"handler-render-createjs",constructor:function (f) {var e=this;this.canvas=this.owner.canvas=document.createElement("canvas");this.canvas.id=f.canvasId||"";this.owner.canvasParent=null;if (this.owner.element) {this.owner.canvasParent=this.owner.element;this.owner.element.appendChild(this.canvas)}else{this.owner.canvasParent=this.owner.rootElement;this.owner.rootElement.appendChild(this.canvas);this.owner.element=this.canvas}this.stage=new createjs.Stage(this.canvas);if (f.autoClear!==true) {this.stage.autoClear=false}if (f.acceptInput) {if (f.acceptInput.click||f.acceptInput.touch) {this.setupInput(f.acceptInput.touch,f.acceptInput.movement,f.acceptInput.camera)}}this.camera={left:0,top:0,width:0,height:0,bufferLeft:f.bufferLeft||f.bufferWidth||f.buffer||-1,bufferRight:f.bufferRight||f.bufferWidth||f.buffer||-1,bufferTop:f.bufferTop||f.bufferHeight||f.buffer||-1,bufferBottom:f.bufferBottom||f.bufferHeight||f.buffer||-1};this.timeElapsed={name:"Render",time:0};this.renderMessage={delta:0,stage:this.stage};this.handleChildren=true;this.extraContent=false},events:{load:function () {var e=0,f=null;for (;e<this.owner.components.length;e++) {if ((this.owner.components[e]===this)||(this.owner.components[e].type.substring(0,14)==="handler-render")) {f=this.owner.components[e]}}if (f!==this) {this.handleChildren=false}else{this.addEventListener("handle-render-addition",function (g) {var h="";if (!this.extraContent) {this.extraContent={}}for (h in g) {this.extraContent[h]=g[h]}})}},"child-entity-added":function (f) {var e=this;f.triggerEvent("handle-render-load",{stage:e.stage,parentElement:e.owner.rootElement})},"pause-render":function (e) {if (e&&e.time) {this.paused=e.time}else{this.paused=-1}},"unpause-render":function () {this.paused=0},tick:(function () {var e=function (g,f) {return g.z-f.z};return function (k) {var g="",l=undefined,j=new Date().getTime(),h=this.renderMessage;h.delta=k.delta;if (this.paused>0) {this.paused-=k.delta;if (this.paused<0) {this.paused=0}}if (this.handleChildren) {if (this.extraContent) {for (g in this.extraContent) {h[g]=this.extraContent[g]}}if (this.owner.triggerEventOnChildren) {this.owner.triggerEventOnChildren("handle-render",h)}if (this.extraContent) {for (g in this.extraContent) {delete this.extraContent[g];delete h[g]}}}else{this.owner.triggerEvent("handle-render-addition",h)}if (this.stage) {for (var f=this.stage.children.length-1;f>-1;f--) {l=this.stage.children[f];if (l.hidden) {if (l.visible) {l.visible=false}}else{if (l.name!=="entity-managed") {if ((l.x>=this.camera.x-this.camera.bufferLeft)&&(l.x<=this.camera.x+this.camera.width+this.camera.bufferRight)&&(l.y>=this.camera.y-this.camera.bufferTop)&&(l.y<=this.camera.y+this.camera.height+this.camera.bufferBottom)) {if (!l.visible) {l.visible=true}}else{if (l.visible) {l.visible=false}}}}if (l.visible) {if (l.paused&&!this.paused) {l.paused=false}else{if (this.paused) {l.paused=true}}}}if (this.stage.reorder) {this.stage.reorder=false;this.stage.sortChildren(e)}this.timeElapsed.name="Render-Prep";this.timeElapsed.time=new Date().getTime()-j;a.game.currentScene.trigger("time-elapsed",this.timeElapsed);j+=this.timeElapsed.time;this.stage.update(k);if (c&&this.stage.autoClear) {this.canvas.style.opacity=0.99;setTimeout(function () {this.canvas.style.opacity=1},0)}this.timeElapsed.name="Render";this.timeElapsed.time=new Date().getTime()-j;a.game.currentScene.trigger("time-elapsed",this.timeElapsed)}}}()),"camera-update":function (h) {var e=(window.devicePixelRatio||1),g=h.viewportLeft+h.viewportWidth/2,f=h.viewportTop+h.viewportHeight/2;this.camera.x=h.viewportLeft;this.camera.y=h.viewportTop;this.camera.width=h.viewportWidth;this.camera.height=h.viewportHeight;if (this.camera.bufferLeft==-1) {this.camera.bufferLeft=this.camera.width/12}if (this.camera.bufferRight==-1) {this.camera.bufferRight=this.camera.width/12}if (this.camera.bufferTop==-1) {this.camera.bufferTop=this.camera.width/12}if (this.camera.bufferBottom==-1) {this.camera.bufferBottom=this.camera.width/12}this.canvas.width=this.canvas.offsetWidth*e;this.canvas.height=this.canvas.offsetHeight*e;this.stage.setTransform((h.viewportWidth/2)*h.scaleX*e,(h.viewportHeight/2)*h.scaleY*e,h.scaleX*e,h.scaleY*e,(h.orientation||0)*180/Math.PI,0,0,g,f);if (this.moveMouse) {this.moveMouse(h)}}},methods:{setupInput:(function () {return function (n,i,m) {var o=this,e=null,l=0,k=0,h=function (p) {e=p;l=(p.stageX/d)/o.stage.scaleX+o.camera.x;k=(p.stageY/d)/o.stage.scaleY+o.camera.y},f=function (p) {h(p);o.owner.trigger("mousedown",{event:p.nativeEvent,x:l,y:k,entity:o.owner});if (m) {o.moveMouse=function () {h(e);o.owner.trigger("mousemove",{event:p.nativeEvent,x:l,y:k,entity:o.owner})}}},g=function (p) {h(p);o.owner.trigger("mouseup",{event:p.nativeEvent,x:l,y:k,entity:o.owner});if (m) {o.moveMouse=null}},j=function (p) {h(p);if (i||p.nativeEvent.which||p.nativeEvent.touches) {o.owner.trigger("mousemove",{event:p.nativeEvent,x:l,y:k,entity:o.owner})}};if (n&&!this.stage.__touch) {createjs.Touch.enable(this.stage)}this.stage.addEventListener("stagemousedown",f);this.stage.addEventListener("stagemouseup",g);this.stage.addEventListener("stagemousemove",j);this.removeStageListeners=function () {this.stage.removeEventListener("stagemousedown",f);this.stage.removeEventListener("stagemouseup",g);this.stage.removeEventListener("stagemousemove",j)}}}()),destroy:function () {if (this.removeStageListeners) {this.removeStageListeners()}this.stage=undefined;this.owner.canvasParent.removeChild(this.canvas);this.owner.canvasParent=null;this.owner.element=null;this.canvas=undefined}},publicMethods:{getWorldPointFromScreen:function (e) {return{x:(e.x*d)/this.stage.scaleX+this.camera.x,y:(e.y*d)/this.stage.scaleY+this.camera.y}}}})}());(function () {var b=function (c) {return function (e,d) {this.triggerOnChildren(c,e,d)}};return a.createComponentClass({id:"entity-container",constructor:function (d) {var c=this;this.entities=[];this.definedEntities=null;if (d.entities&&this.owner.entities) {this.definedEntities=d.entities.concat(this.owner.entities)}else{this.definedEntities=d.entities||this.owner.entities||null}this.owner.entities=c.entities;this.childEvents=[];if (d.childEvents) {for (var e in d.childEvents) {this.addNewPublicEvent(d.childEvents[e])}}this.addNewPrivateEvent("peer-entity-added");this.addNewPrivateEvent("peer-entity-removed")},events:{load:function () {var f=0,d=0,c=0,g=this.definedEntities,e=null;this.definedEntities=false;if (g) {for (f=0;f<g.length;f++) {e={properties:{parent:this.owner}};for (d in g[f]) {if (d==="properties") {for (c in g[f].properties) {e.properties[c]=g[f].properties[c]}}else{e[d]=g[f][d]}}this.owner.triggerEvent("entity-created",this.addEntity(new a.Entity(g[f].id?g[f]:a.game.settings.entities[g[f].type],e)))}}},"add-entity":function (c) {this.addEntity(c)},"remove-entity":function (c) {this.removeEntity(c)},"child-entity-updated":function (c) {this.updateChildEventListeners(c)}},methods:{addNewPublicEvent:function (d) {this.addNewPrivateEvent(d);for (var c=0;c<this.childEvents.length;c++) {if (this.childEvents[c]===d) {return false}}this.childEvents.push(d);this.addEventListener(d,b(d))},addNewPrivateEvent:function (d) {if (this.messages[d]) {return false}this.messages[d]=[];for (var c=0;c<this.entities.length;c++) {if (this.entities[c].messages[d]) {for (var e=0;e<this.entities[c].messages[d].length;e++) {this.addChildEventListener(this.entities[c],d,this.entities[c].messages[d][e].callback,this.entities[c].messages[d][e].scope)}}}},updateChildEventListeners:function (c) {this.removeChildEventListeners(c);this.addChildEventListeners(c)},addChildEventListeners:function (c) {var d="";for (d in this.messages) {if (c.messages[d]) {for (var e=0;e<c.messages[d].length;e++) {this.addChildEventListener(c,d,c.messages[d][e].callback,c.messages[d][e].scope)}}}},removeChildEventListeners:function (c) {var e=null,g=null,f=null;if (c.containerListener) {e=c.containerListener.events;g=c.containerListener.messages;f=c.containerListener.scopes;for (var d=0;d<e.length;d++) {this.removeChildEventListener(c,e[d],g[d],f[d])}c.containerListener=null}},addChildEventListener:function (c,e,f,d) {if (!c.containerListener) {c.containerListener={events:[],messages:[],scopes:[]}}c.containerListener.events.push(e);c.containerListener.messages.push(f);c.containerListener.scopes.push(d);this.bind(e,f,d)},removeChildEventListener:function (c,j,k,f) {var e=c.containerListener.events,h=c.containerListener.messages,g=c.containerListener.scopes;for (var d=0;d<e.length;d++) {if ((e[d]===j)&&(!k||(h[d]===k))&&(!f||(g[d]===f))) {this.unbind(j,h[d],g[d])}}},destroy:function () {for (var c in this.entities) {this.removeChildEventListeners(this.entities[c]);this.entities[c].destroy()}this.entities.length=0}},publicMethods:{getEntityById:function (e) {var c=0,d=null;for (;c<this.entities.length;c++) {if (this.entities[c].id===e) {return this.entities[c]}if (this.entities[c].getEntityById) {d=this.entities[c].getEntityById(e);if (d) {return d}}}return undefined},getEntitiesByType:function (e) {var c=0,d=null,f=[];for (;c<this.entities.length;c++) {if (this.entities[c].type===e) {f.push(this.entities[c])}if (this.entities[c].getEntitiesByType) {d=this.entities[c].getEntitiesByType(e);if (d) {f=f.concat(d)}}}return f},addEntity:function (d) {d.parent=this.owner;d.trigger("adopted");for (var c=0;c<this.entities.length;c++) {if (!d.triggerEvent("peer-entity-added",this.entities[c])) {break}}this.triggerEventOnChildren("peer-entity-added",d);this.addChildEventListeners(d);this.entities.push(d);this.owner.trigger("child-entity-added",d);return d},removeEntity:function (d) {for (var c=0;c<this.entities.length;c++) {if (this.entities[c]===d) {this.removeChildEventListeners(d);this.entities.splice(c,1);this.triggerEventOnChildren("peer-entity-removed",d);this.owner.trigger("child-entity-removed",d);d.destroy();d.parent=null;return d}}return false},triggerEventOnChildren:function (e,d,c) {if (!this.messages[e]) {this.addNewPrivateEvent(e)}return this.triggerEvent(e,d,c)},triggerOnChildren:function (e,d,c) {if (!this.messages[e]) {this.addNewPrivateEvent(e)}return this.trigger(e,d,c)}}},a.Messenger)}());(function () {var b=function (f) {var e=!!(536870912&f),d=!!(1073741824&f),g=!!(2147483648&f);if (e&&g) {return -3}else{if (e) {return -5}else{if (d) {return -4}else{return -2}}}};return a.createComponentClass({id:"tiled-loader",constructor:function (c) {this.entities=[];this.layerZ=0;this.followEntity=false;this.manuallyLoad=c.manuallyLoad||false;this.level=this.owner.level||c.level||null;this.unitsPerPixel=this.owner.unitsPerPixel||c.unitsPerPixel||1;this.images=this.owner.images||c.images||false;this.imagesScale=this.owner.imagesScale||c.imagesScale||this.unitsPerPixel;this.layerZStep=this.owner.zStep||c.zStep||1000;this.separateTiles=this.owner.separateTiles||c.separateTiles||false;this.entityPositionX=this.owner.entityPositionX||c.entityPositionX||"center";this.entityPositionY=this.owner.entityPositionY||c.entityPositionY||"bottom"},events:{"scene-loaded":function (c) {if (!this.manuallyLoad) {this.loadLevel({level:this.level||c.level,persistentData:c})}},"load-level":function (c) {this.loadLevel(c)}},methods:{loadLevel:function (e) {var f=e.level,d=0,c=false;if (typeof f==="string") {f=a.game.settings.levels[f]}for (;d<f.layers.length;d++) {c=this.setupLayer(f.layers[d],f,c);if (this.separateTiles) {c=false}}this.owner.trigger("world-loaded",{width:f.width*f.tilewidth*this.unitsPerPixel,height:f.height*f.tileheight*this.unitsPerPixel,camera:this.followEntity});this.owner.removeComponent(this)},setupLayer:function (G,f,l) {var A=this,r=A.images||[],D=f.tilesets,d=f.tilewidth,m=f.tileheight,h=0,v=0,q=0,o=0,u=0,s=null,i=null,C="",z=null,j=null,g=true,w=false,t=null,n=0,c=0,F=function (e) {var x=0,p=0,y=e.properties||{},H={data:[],image:"",height:1,name:e.name,type:"tilelayer",width:1,tileheight:m,tilewidth:d,x:e.x,y:e.y,properties:y};if (y.repeat) {H.width=+y.repeat;H.height=+y.repeat}if (y["repeat-x"]) {H.width=+y["repeat-x"]}if (y["repeat-y"]) {H.height=+y["repeat-y"]}p=H.width*H.height;for (x=0;x<p;x++) {H.data.push(1)}if (a.assets[e.name]) {H.image=a.assets[e.name];H.tileheight=H.image.height;H.tilewidth=H.image.width}else{console.warn('Component tiled-loader: Cannot find the "'+e.name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+e.name+'".');H.image=e.image}return H},k=function (T,V) {var S=V.width,P=V.height,N=V.tileheight||m,e=V.tilewidth||d,U=0,L=null,M=null,I=null,W=null,Q=false,O=null,R=null,p=0,K=0,J=0;L=JSON.parse(JSON.stringify(a.game.settings.entities[T]));M={};I=[];W=[];if (T==="collision-layer") {R=[];for (K=0;K<D.length;K++) {O=D[K];if (O.tileproperties) {for (J in O.tileproperties) {if (O.tileproperties[J].jumpThrough) {R.push(O.firstgid+ +J-1)}}}}}L.properties=L.properties||{};L.properties.width=e*S*A.unitsPerPixel;L.properties.height=N*P*A.unitsPerPixel;L.properties.columns=S;L.properties.rows=P;L.properties.tileWidth=e*A.unitsPerPixel;L.properties.tileHeight=N*A.unitsPerPixel;L.properties.scaleX=A.imagesScale;L.properties.scaleY=A.imagesScale;L.properties.layerZ=A.layerZ;L.properties.z=L.properties.z||A.layerZ;if (V.image) {U=(V.image.width/e)*(V.image.height/N)}else{U=(D[D.length-1].imagewidth/e)*(D[D.length-1].imageheight/N)+D[D.length-1].firstgid}for (K=-1;K<U;K++) {M["tile"+K]=K}for (K=0;K<S;K++) {I[K]=[];W[K]=[];for (J=0;J<P;J++) {p=+V.data[K+J*S]-1;W[K][J]="tile"+p;if (R) {for (var H=0;H<R.length;H++) {if (R[H]===(268435455&p)) {p=b(p)}break}}I[K][J]=p}}for (K=0;K<L.components.length;K++) {if (L.components[K].type==="render-tiles") {Q=L.components[K]}if (L.components[K].spriteSheet=="import") {L.components[K].spriteSheet={images:(V.image?[V.image]:r),frames:{width:e*A.unitsPerPixel/A.imagesScale,height:N*A.unitsPerPixel/A.imagesScale},animations:M}}if (L.components[K].collisionMap=="import") {L.components[K].collisionMap=I}if (L.components[K].imageMap=="import") {L.components[K].imageMap=W}}A.layerZ+=A.layerZStep;if ((T==="render-layer")&&l&&(l.tileHeight===N)&&(l.tileWidth===e)) {l.trigger("add-tiles",Q);return l}else{return A.owner.addEntity(new a.Entity(L,{properties:{}}))}};if (r.length==0) {for (q=0;q<D.length;q++) {if (a.assets[D[q].name]) {r.push(a.assets[D[q].name])}else{console.warn('Component tiled-loader: Cannot find the "'+D[q].name+'" sprite sheet. Add it to the list of assets in config.json and give it the id "'+D[q].name+'".');r.push(D[q].image)}}}else{r=r.slice();for (q=0;q<r.length;q++) {if (a.assets[r[q]]) {r[q]=a.assets[r[q]]}}}if (G.type=="tilelayer") {s="render-layer";if (G.properties&&G.properties.entity) {s=G.properties.entity}else{switch(G.name) {case"collision":s="collision-layer";break;case"action":s="tile-layer";for (q=0;q<f.layers.length;q++) {if (f.layers[q].name==="collision"||(f.layers[q].properties&&f.layers[q].properties.entity==="collision-layer")) {g=false}}if (!g) {s="render-layer"}break}}if (s==="tile-layer") {k("collision-layer",G);return k("render-layer",G)}else{if (s==="collision-layer") {k(s,G)}else{return k(s,G)}}}else{if (G.type=="imagelayer") {return k("render-layer",F(G))}else{if (G.type=="objectgroup") {for (u=0;u<G.objects.length;u++) {s=G.objects[u];for (q=0;q<D.length;q++) {if (D[q].firstgid>s.gid) {break}else{z=D[q]}}C="";if (s.type!=="") {C=s.type}else{if (s.name!=="") {C=s.name}else{if (z.tileproperties[s.gid-z.firstgid]) {if (z.tileproperties[s.gid-z.firstgid].entity) {C=z.tileproperties[s.gid-z.firstgid].entity}else{if (z.tileproperties[s.gid-z.firstgid].type) {C=z.tileproperties[s.gid-z.firstgid].type}}}}}if (C!=="") {j={};if (z.tileproperties&&z.tileproperties[s.gid-z.firstgid]) {for (q in z.tileproperties[s.gid-z.firstgid]) {w=parseFloat(z.tileproperties[s.gid-z.firstgid][q]);if (w==0||(!!w)) {j[q]=w}else{if (z.tileproperties[s.gid-z.firstgid][q]=="true") {j[q]=true}else{if (z.tileproperties[s.gid-z.firstgid][q]=="false") {j[q]=false}else{j[q]=z.tileproperties[s.gid-z.firstgid][q]}}}}}for (q in s.properties) {i=s.properties[q];if (typeof i==="string") {w=parseFloat(i);if (w==0||(!!w)) {j[q]=w}else{if (i=="true") {j[q]=true}else{if (i=="false") {j[q]=false}else{if ((i.length>2)&&(((i[0]==="{")&&(i[i.length-1]==="}"))||((i[0]==="[")&&(i[i.length-1]==="]")))) {try{j[q]=JSON.parse(i)}catch(E) {j[q]=i}}else{j[q]=i}}}}}else{j[q]=i}}if (s.polygon||s.polyline) {smallestX=Infinity;largestX=-Infinity;smallestY=Infinity;largestY=-Infinity;t=null;if (s.polygon) {t=s.polygon}else{if (s.polyline) {t=s.polyline}}for (q=0;q<t.length;q++) {if (t[q].x>largestX) {largestX=t[q].x}if (t[q].x<smallestX) {smallestX=t[q].x}if (t[q].y>largestY) {largestY=t[q].y}if (t[q].y<smallestY) {smallestY=t[q].y}}j.width=largestX-smallestX;j.height=largestY-smallestY;j.x=s.x+smallestX;j.y=s.y+smallestY;h=0;v=0;j.width=j.width*this.unitsPerPixel;j.height=j.height*this.unitsPerPixel;j.x=j.x*this.unitsPerPixel;j.y=j.y*this.unitsPerPixel;if (s.polygon) {j.shape={};j.shape.type="polygon";j.shape.points=[];for (var B=0;B<t.length;B++) {j.shape.points.push({x:((t[B].x-smallestX)*this.unitsPerPixel),y:((t[B].y-smallestY)*this.unitsPerPixel)})}}else{if (s.polyline) {j.shape={};j.shape.type="polyline";j.shape.points=[];for (var B=0;B<t.length;B++) {j.shape.points.push({x:((t[B].x-smallestX)*this.unitsPerPixel),y:((t[B].y-smallestY)*this.unitsPerPixel)})}}}}else{n=d*this.unitsPerPixel;c=m*this.unitsPerPixel;h=0;v=0;j.width=(s.width||0)*this.unitsPerPixel;j.height=(s.height||0)*this.unitsPerPixel;if (C&&a.game.settings.entities[C]&&a.game.settings.entities[C].properties) {if (!j.width) {j.width=a.game.settings.entities[C].properties.width||0;h=n}if (!j.height) {j.height=a.game.settings.entities[C].properties.height||0;v=c}}if (!j.width) {j.width=n}if (!j.height) {j.height=c}h=h||j.width;v=v||j.height;j.x=s.x*this.unitsPerPixel;j.y=s.y*this.unitsPerPixel;if (this.entityPositionX==="left") {j.regX=0}else{if (this.entityPositionX==="center") {j.regX=j.width/2;j.x+=h/2}else{if (this.entityPositionX==="right") {j.regX=j.width;j.x+=h}}}if (typeof s.gid==="undefined") {j.y+=j.height}if (this.entityPositionY==="bottom") {j.regY=j.height}else{if (this.entityPositionY==="center") {j.regY=j.height/2;j.y-=v/2}else{if (this.entityPositionY==="top") {j.regY=0;j.y-=v}}}if (s.ellipse) {j.shape={};j.shape.type="ellipse";j.shape.width=j.width*this.unitsPerPixel;j.shape.height=j.height*this.unitsPerPixel}else{if (s.width&&s.height) {j.shape={};j.shape.type="rectangle";j.shape.width=j.width*this.unitsPerPixel;j.shape.height=j.height*this.unitsPerPixel}}}if (a.game.settings.entities[C].properties) {j.scaleX=this.imagesScale*(a.game.settings.entities[C].properties.scaleX||1);j.scaleY=this.imagesScale*(a.game.settings.entities[C].properties.scaleY||1)}else{j.scaleX=this.imagesScale;j.scaleY=this.imagesScale}j.layerZ=this.layerZ;if (j.z) {j.z+=this.layerZ}else{if (C&&a.game.settings.entities[C]&&a.game.settings.entities[C].properties&&a.game.settings.entities[C].properties.z) {j.z=this.layerZ+a.game.settings.entities[C].properties.z}else{j.z=this.layerZ}}j.parent=this.owner;s=this.owner.addEntity(new a.Entity(a.game.settings.entities[C],{properties:j}));if (s) {if (s.camera) {this.followEntity={entity:s,mode:s.camera}}this.owner.triggerEvent("entity-created",s)}}}this.layerZ+=this.layerZStep;return false}}}},destroy:function () {this.entities.length=0}}})}());(function () {return a.createComponentClass({id:"handler-render-dom",constructor:function (d) {this.element=this.owner.element=document.createElement("div");this.owner.rootElement.appendChild(this.element);this.owner.element=this.element;for (var c in d) {if (c==="style") {for (var b in d[c]) {this.element.style[b]=d[c][b]}}else{if (c!=="type") {if (c.indexOf("on")===0) {this.element[c]=createfunction (d[c],this.owner)}else{this.element[c]=d[c]}}}}this.handleChildren=true;this.extraContent=false},events:{load:function () {var b=0,c=null;for (;b<this.owner.components.length;b++) {if ((this.owner.components[b]===this)||(this.owner.components[b].type.substring(0,14)==="handler-render")) {c=this.owner.components[b]}}if (c!==this) {this.handleChildren=false}else{this.addEventListener("handle-render-addition",function (d) {var e="";if (!this.extraContent) {this.extraContent={}}for (e in d) {this.extraContent[e]=d[e]}})}},"child-entity-added":function (c) {var b=this;c.trigger("handle-render-load",{element:b.element})},tick:function (d) {var b="",c={};if (this.handleChildren) {for (b in d) {c[b]=d[b]}if (this.extraContent) {for (b in this.extraContent) {c[b]=this.extraContent[b]}}if (this.owner.triggerEventOnChildren) {this.owner.triggerEventOnChildren("handle-render",c)}if (this.extraContent) {for (b in this.extraContent) {delete this.extraContent[b];delete c[b]}}}else{this.owner.triggerEvent("handle-render-addition",c)}}},methods:{destroy:function () {this.owner.rootElement.removeChild(this.element);this.owner.element=null;this.element=undefined}},publicMethods:{getElementById:function (d) {var b=0,c=this.element.getElementsByTagName("*");for (;b<c.length;b++) {if (c[b].getAttribute("id")===d) {return c[b]}}return document.getElementById(d)}}})}());(function () {var d=function (g) {var e=[document.createElement("canvas"),document.createElement("canvas")],f=0;if (!g.___cache) {g.___cache=g.cache;g.cache=function (i,l,j,h,k) {f=1-f;this.cacheCanvas=e[f];this.___cache(i,l,j,h,k)}}return g},c={x:1,y:1,t:-1,r:0},b=function (h) {var g=+(h.substring(4)),i=c,f=!!(536870912&g),e=!!(1073741824&g),j=!!(2147483648&g);i.t=268435455&g;i.x=1;i.y=1;i.r=0;if (f||e||j) {if (f&&e&&j) {i.x=-1;i.r=90}else{if (f&&j) {i.r=90}else{if (e&&j) {i.r=180}else{if (f&&e) {i.r=270}else{if (f) {i.y=-1;i.r=90}else{if (e) {i.y=-1}else{if (j) {i.x=-1}}}}}}}}return i};return a.createComponentClass({id:"render-tiles",constructor:function (k) {var f=0,e=k.spriteSheet.images.slice(),i=null,j=1,h=1;if (e[0]&&(typeof e[0]==="string")) {e=e.slice();for (f=0;f<e.length;f++) {if (a.assets[e[f]]) {e[f]=a.assets[e[f]]}}}i={images:e,frames:k.spriteSheet.frames,animations:k.spriteSheet.animations};j=i.images[0].scaleX||1;h=i.images[0].scaleY||1;if ((j!==1)||(h!==1)) {i.frames={width:i.frames.width*j,height:i.frames.height*h,regX:i.frames.regX*j,regY:i.frames.regY*h}}this.controllerEvents=undefined;this.spriteSheet=new createjs.SpriteSheet(i);this.imageMap=k.imageMap||[];this.doMap=null;this.tiles={};this.tilesToRender=undefined;this.scaleX=((k.scaleX||1)*(this.owner.scaleX||1))/j;this.scaleY=((k.scaleY||1)*(this.owner.scaleY||1))/h;this.tileWidth=k.tileWidth||(this.owner.tileWidth/this.scaleX)||10;this.tileHeight=k.tileHeight||(this.owner.tileHeight/this.scaleY)||10;this.entityCache=k.entityCache||false;this.worldWidth=this.tilesWidth=this.tileWidth;this.worldHeight=this.tilesHeight=this.tileHeight;var g=(k.buffer||(this.tileWidth*3/4))*this.scaleX;this.camera={x:-g-1,y:-g-1,buffer:g};this.cache={minX:-1,minY:-1,maxX:-1,maxY:-1};this.doubleBuffer=[null,null];this.currentBuffer=0;this.reorderedStage=false},events:{"handle-render-load":function (j) {var e=0,k=0,h=null,g="",f=this.imageMap,i=[];if (j&&j.stage) {h=this.stage=j.stage;if (h&&!this.reorderedStage) {h.reorder=true;this.reorderedStage=true}this.tilesToRender=d(new createjs.Container());this.tilesToRender.name="entity-managed";for (e=0;e<f.length;e++) {i[e]=[];for (k=0;k<f[e].length;k++) {i[e][k]=g=f[e][k];if (!this.tiles[g]) {this.tiles[g]=this.createTile(g)}}}this.imageMap=i;this.tilesWidth=e*this.tileWidth;this.tilesHeight=k*this.tileHeight;this.tilesToRender.scaleX=this.scaleX;this.tilesToRender.scaleY=this.scaleY;this.tilesToRender.z=this.owner.z;h.addChild(this.tilesToRender)}},"peer-entity-added":function (i) {var l=0,j=0,n=this.imageMap,h=i.cacheRender,e=null,k=0,f=0,m=0,g=0;if (this.entityCache&&h) {if (!this.doMap) {this.doMap=[]}e=h.getBounds();k=Math.max(0,Math.floor((i.y-h.y)/this.tileHeight));f=Math.min(n[0].length,Math.ceil((i.y-e.y+e.height)/this.tileHeight));g=Math.max(0,Math.floor((i.x-h.x)/this.tileWidth));m=Math.min(n.length,Math.ceil((i.x-e.x+e.width)/this.tileWidth));for (l=g;l<m;l++) {if (!this.doMap[l]) {this.doMap[l]=[]}for (j=k;j<f;j++) {if (!this.doMap[l][j]) {this.doMap[l][j]=[]}this.doMap[l][j].push(h)}}i.removeComponent("render-sprite")}},"add-tiles":function (h) {var e=0,j=0,i=h.imageMap,f="",g=0;if (i) {for (e=0;e<this.imageMap.length;e++) {for (j=0;j<this.imageMap[e].length;j++) {g=i[e][j];f=this.imageMap[e][j];if (this.tiles[f]) {delete this.tiles[f]}f=this.imageMap[e][j]+=" "+g;if (!this.tiles[f]) {this.tiles[f]=this.createTile(f)}}}}},"camera-loaded":function (e) {this.worldWidth=e.width;this.worldHeight=e.height},"camera-update":function (q) {var i=0,h=0,g=0,p=this.camera.buffer,j=this.cache,e=null,f=null,n=0,l=0,u=0,s=0,v=0,t=0,w=this.convertCamera(q.viewportLeft,this.worldWidth,this.tilesWidth,q.viewportWidth),o=this.convertCamera(q.viewportTop,this.worldHeight,this.tilesHeight,q.viewportHeight),r=Math.floor(w/this.tileWidth)*this.tileWidth,m=Math.floor(o/this.tileHeight)*this.tileHeight,B=null,A=[],k=null;this.tilesToRender.x=q.viewportLeft-w;this.tilesToRender.y=q.viewportTop-o;if (((Math.abs(this.camera.x-r)>p)||(Math.abs(this.camera.y-m)>p))&&(this.imageMap.length>0)) {this.camera.x=r;this.camera.y=m;u=Math.min(Math.ceil((r+q.viewportWidth+p)/(this.tileWidth*this.scaleX)),this.imageMap.length)-1;v=Math.max(Math.floor((r-p)/(this.tileWidth*this.scaleX)),0);s=Math.min(Math.ceil((m+q.viewportHeight+p)/(this.tileHeight*this.scaleY)),this.imageMap[0].length)-1;t=Math.max(Math.floor((m-p)/(this.tileHeight*this.scaleY)),0);if ((s>j.maxY)||(t<j.minY)||(u>j.maxX)||(v<j.minX)) {if (this.tilesToRender.cacheCanvas) {f=this.tilesToRender.cacheCanvas;this.tilesToRender.uncache()}this.tilesToRender.removeChildAt(0);this.tilesToRender.cache(v*this.tileWidth,t*this.tileHeight,(u-v+1)*this.tileWidth,(s-t+1)*this.tileHeight,1);for (i=v;i<=u;i++) {for (h=t;h<=s;h++) {if ((h>j.maxY)||(h<j.minY)||(i>j.maxX)||(i<j.minX)) {B=this.tiles[this.imageMap[i][h]];this.tilesToRender.removeChildAt(0);this.tilesToRender.addChild(B);B.x=(i+0.5)*this.tileWidth;B.y=(h+0.5)*this.tileHeight;this.tilesToRender.updateCache("source-over");if (this.doMap&&this.doMap[i]&&this.doMap[i][h]) {k=this.doMap[i][h];for (g=0;g<k.length;g++) {if (!k[g].drawn) {k[g].drawn=true;A.push(k[g])}}}}}}if (A.length) {for (g=0;g<A.length;g++) {delete A[g].drawn;this.tilesToRender.removeChildAt(0);this.tilesToRender.addChild(A[g]);this.tilesToRender.updateCache("source-over")}}if (f) {e=this.tilesToRender.cacheCanvas.getContext("2d");n=(j.maxX-j.minX+1)*this.tileWidth;l=(j.maxY-j.minY+1)*this.tileHeight;e.drawImage(f,0,0,n,l,(j.minX-v)*this.tileWidth,(j.minY-t)*this.tileHeight,n,l);j.minX=v;j.minY=t;j.maxX=u;j.maxY=s}}}}},methods:{convertCamera:function (h,f,g,e) {if (((f/this.scaleX)===g)||((f/this.scaleX)===e)) {return h}else{return h*(g-e)/((f/this.scaleX)-e)}},createTile:function (j) {var g=1,k=j.split(" "),e=null,h=new createjs.Sprite(this.spriteSheet,0),f=null;h.x=0;h.y=0;h.regX=this.tileWidth/2;h.regY=this.tileHeight/2;if (k[0]!=="tile-1") {f=b(k[0]);h.scaleX=f.x;h.scaleY=f.y;h.rotation=f.r;h.gotoAndStop("tile"+f.t)}else{h.gotoAndStop("tile-1")}for (;g<k.length;g++) {if (k[g]!=="tile-1") {if (!e) {e=new createjs.Container();e.addChild(h);e.cache(-this.tileWidth/2,-this.tileHeight/2,this.tileWidth,this.tileHeight,1)}f=b(k[g]);h.scaleX=f.x;h.scaleY=f.y;h.rotation=f.r;h.gotoAndStop("tile"+f.t);e.updateCache("source-over")}}if (e) {return e}else{h.cache(0,0,this.tileWidth,this.tileHeight,1);return h}},destroy:function () {this.tilesToRender.removeAllChildren();this.stage.removeChild(this.tilesToRender);this.imageMap.length=0;this.tiles=undefined;this.camera=undefined;this.stage=undefined;this.tilesToRender=undefined}}})}());(function () {var b=[],d=0,c=[];return a.createComponentClass({id:"collision-tiles",constructor:function (e) {this.collisionMap=e.collisionMap||[];this.tileWidth=e.tileWidth||this.owner.tileWidth||10;this.tileHeight=e.tileHeight||this.owner.tileHeight||10;this.tileHalfWidth=this.tileWidth/2;this.tileHalfHeight=this.tileHeight/2},methods:{getShape:function (g,e,h) {var f=null;if (d<b.length) {f=b[d];d+=1;f.update(e*this.tileWidth+this.tileHalfWidth,h*this.tileHeight+this.tileHalfHeight)}else{b.push(new a.CollisionShape(null,{x:e*this.tileWidth+this.tileHalfWidth,y:h*this.tileHeight+this.tileHalfHeight,type:"rectangle",width:this.tileWidth,height:this.tileHeight},"tiles"));f=b[d]}return f},addShape:function (f,g,e,h) {if (this.collisionMap[e][h]>-1) {f.push(this.getShape(g,e,h))}else{if (this.collisionMap[e][h]<-1) {switch(this.collisionMap[e][h]) {case -2:if (g.bottom<=h*this.tileHeight) {f.push(this.getShape(g,e,h))}break;case -3:if (g.left>=(e+1)*this.tileWidth) {f.push(this.getShape(g,e,h))}break;case -4:if (g.top>=(h+1)*this.tileHeight) {f.push(this.getShape(g,e,h))}break;case -5:if (g.right<=e*this.tileWidth) {f.push(this.getShape(g,e,h))}break}}}return f}},publicMethods:{getAABB:function () {return{left:0,top:0,right:this.tileWidth*this.collisionMap.length,bottom:this.tileHeight*this.collisionMap.length[0]}},isTile:function (e,f) {return !((e<0)||(f<0)||(e>=this.collisionMap.length)||(f>=this.collisionMap[0].length)||(this.collisionMap[e][f]===-1))},getTileShapes:function (h,l) {var g=Math.max(Math.floor(h.left/this.tileWidth),0),j=Math.max(Math.floor(h.top/this.tileHeight),0),m=Math.min(Math.ceil(h.right/this.tileWidth),this.collisionMap.length),e=Math.min(Math.ceil(h.bottom/this.tileHeight),this.collisionMap[0].length),k=0,i=0,f=c;c.length=0;d=0;for (k=g;k<m;k++) {for (i=j;i<e;i++) {this.addShape(f,l,k,i)}}return f}}})}());(function () {var b=function (d,c) {if (typeof d==="string") {return function (f) {c.trigger(d,f);f.preventDefault()}}else{if (Array.isArray(d)) {return function (g) {for (var f=0;f<d.length;f++) {c.trigger(d[f],g)}g.preventDefault()}}else{return function (f) {c.trigger(d.event,d.message);f.preventDefault()}}}};return a.createComponentClass({id:"dom-element",constructor:function (f) {var c=f.element||"div";this.updateClassName=f.updateClassName||false;this.className="";this.states={};this.stateChange=false;this.potentialParent=f.parent;this.handleRenderLoadMessage=null;this.element=document.createElement(c);if (!this.owner.element) {this.owner.element=this.element}this.element.ondragstart=function () {return false};for (var e in f) {if (e==="style") {for (var d in f[e]) {this.element.style[d]=f[e][d]}}else{if (((e!=="type")||(c==="input"))&&(e!=="element")&&(e!=="parent")&&(e!=="updateClassName")&&(e!=="attributes")&&(e!=="messageMap")) {if (e.indexOf("on")===0) {if (a.game.settings.supports.mobile) {if (e.indexOf("onmouse")==-1) {this.element[e]=b(f[e],this.owner)}}else{this.element[e]=b(f[e],this.owner)}}else{this.element[e]=f[e];if (e=="className") {this.className=f[e]}}}}}if (this.owner.className) {this.className=this.element.className=this.owner.className}if (this.owner.innerHTML) {this.element.innerHTML=this.owner.innerHTML}},events:{"handle-render-load":(function () {var c=function (d,g) {var e=0,f=d.getElementsByTagName("*");for (;e<f.length;e++) {if (f[e].getAttribute("id")===g) {return f[e]}}return document.getElementById(g)};return function (f) {if (f.element) {if (!this.parentElement) {if (this.potentialParent) {this.parentElement=c(f.element,this.potentialParent);this.parentElement.appendChild(this.element)}else{this.parentElement=f.element;this.parentElement.appendChild(this.element)}}if (this.owner.triggerEventOnChildren) {var e=this.handleRenderLoadMessage={};for (var d in f) {e[d]=f[d]}e.element=this.element;this.owner.triggerEventOnChildren("handle-render-load",e)}}}}()),"child-entity-added":function (c) {if (this.handleRenderLoadMessage) {c.trigger("handle-render-load",this.handleRenderLoadMessage)}},"set-parent":function (c) {if (this.parentElement) {this.parentElement.removeChild(this.element)}this.parentElement=c;this.parentElement.appendChild(this.element)},"handle-logic":function (c) {},"handle-render":function (e) {var c=0,d=this.className;if (this.stateChange&&this.updateClassName) {for (c in this.states) {if (this.states[c]) {d+=" "+c}}this.element.className=d;this.stateChange=false}},"set-attribute":function (d) {var c=null;if (d.attribute) {this.element.setAttribute(d.attribute,d.value)}else{for (c in d) {this.element.setAttribute(c,d[c])}}},"set-style":function (d) {var c=null;if (d.attribute) {this.element.style[d.attribute]=d.value}else{for (c in d) {this.element.style[c]=d[c]}}},"update-content":function (d) {var c=d;if (c&&(typeof c.text==="string")) {c=c.text}if ((typeof c==="string")&&(c!==this.element.innerHTML)) {this.element.innerHTML=c}},"logical-state":function (d) {for (var c in d) {if (this.states[c]!==d[c]) {this.stateChange=true;this.states[c]=d[c]}}}},methods:{destroy:function () {if (this.parentElement) {this.parentElement.removeChild(this.element);this.parentElement=undefined}if (this.owner.element===this.element) {this.owner.element=undefined}this.element=undefined}}})}());(function () {var c=false,d=null,b=function () {c=false;d.className=d.className.replace(/ full-screen/g,"");a.game.bindings.resize.callback()},e=function () {if (c) {if (document.webkitExitFullscreen) {document.webkitExitFullscreen()}else{if (document.mozCancelFullScreen) {document.mozCancelFullScreen()}else{if (document.exitFullscreen) {document.exitFullscreen()}}}b()}else{c=true;d.className+=" full-screen";if (d.webkitRequestFullscreen) {if (!a.game.settings.supports.safari||a.game.settings.supports.chrome) {d.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if (d.mozRequestFullScreen) {d.mozRequestFullScreen()}else{if (d.requestFullscreen) {d.requestFullscreen()}}}a.game.bindings.resize.callback()}};document.addEventListener("fullscreenchange",function (f) {if (!document.fullscreenElement) {b()}});document.addEventListener("webkitfullscreenchange",function (f) {if (!document.webkitFullscreenElement) {b()}});document.addEventListener("mozfullscreenchange",function (f) {if (!document.mozFullScreenElement) {b()}});return a.createComponentClass({id:"fullscreen",constructor:function (f) {if (!d) {d=a.game.containerElement}},events:{"toggle-fullscreen":e}})}());(function () {var d=function (e) {return function (g,f) {a.game.currentScene.trigger(e,g,f)}},c=function (e) {return function (g,f) {if (this.owner.parent) {this.owner.parent.trigger(e,g,f)}}},b=function (e) {return function (g,f) {this.owner.trigger(e,g,f)}};return a.createComponentClass({id:"broadcast-events",constructor:function (e) {if (e.events) {for (var f in e.events) {this.addEventListener(f,d(e.events[f]))}}if (e.parentEvents) {for (var f in e.parentEvents) {this.addEventListener(f,c(e.parentEvents[f]))}}if (e.renameEvents) {for (var f in e.renameEvents) {this.addEventListener(f,b(e.renameEvents[f]))}}}})}());(function () {return a.createComponentClass({id:"change-scene",constructor:function (b) {this.scene=this.owner.scene||b.scene;this.transition=this.owner.transition||b.transition||"instant";this.persistentData=b.persistentData||{};this.preload=b.preload||false;if (b.message) {console.warn('"'+this.type+'" components no longer accept "message": "'+b.message+'" as a definition parameter. Use "aliases": {"'+b.message+'": "new-scene"} instead.')}},events:{"scene-live":function () {if (this.preload) {a.game.loadScene(this.scene,this.transition,this.persistentData,true)}},"new-scene":function (b) {var e=b||this,c=e.scene||this.scene,d=e.transition||this.transition;data=e.persistentData||this.persistentData;a.game.loadScene(c,d,data)},"set-scene":function (b) {this.scene=b},"set-persistent-scene-data":function (c) {for (var b in c) {this.persistentData[b]=c[b]}}}})}());(function () {return a.createComponentClass({id:"logic-button",constructor:function (b) {this.state=this.owner.state;this.state.released=true;this.state.pressed=false;this.stateChange="";this.toggle=!!b.toggle;if (b.state==="pressed") {this.stateChange="pressed"}},events:{mousedown:function () {if (!this.toggle) {this.stateChange="pressed"}},pressed:function () {this.stateChange="pressed"},pressup:function () {if (this.toggle) {if (this.state.pressed) {this.owner.triggerEvent("released")}else{this.owner.triggerEvent("pressed")}}else{this.owner.triggerEvent("released")}},mouseup:function () {if (this.toggle) {if (this.state.pressed) {this.owner.triggerEvent("released")}else{this.owner.triggerEvent("pressed")}}else{this.owner.triggerEvent("released")}},released:function () {this.stateChange="released"},"handle-logic":function (b) {if (this.state.released&&(this.stateChange==="pressed")) {this.stateChange="";this.state.pressed=true;this.state.released=false}if (this.state.pressed&&(this.stateChange==="released")) {this.stateChange="";this.state.pressed=false;this.state.released=true}}}})}());(function () {var b={},g={interrupt:createjs.Sound.INTERRUPT_ANY,delay:0,offset:0,loop:0,volume:1,pan:0,mute:false,paused:false,next:false,events:false},f={stop:true,playthrough:true},e=function (k) {var l=b[k];if (!l||!l.length) {return false}for (var j in l) {if (l[j].priorityTrack) {return l[j].priorityTrack}}return false},d=function (j,i) {return j.time-i.time},h=function (n) {var m="",j=undefined;if (typeof n==="string") {m=n;j={}}else{if (Array.isArray(n)) {if (typeof n[0]==="string") {m=n[0];j={next:[]}}else{m=n[0].sound;j={};for (var l in n[0]) {j[l]=n[0][l]}if (j.next) {j.next=j.next.slice()}else{j.next=[]}}for (var k=1;k<n.length;k++) {j.next.push(n[k])}}else{m=n.sound;j={interrupt:n.interrupt,delay:n.delay,offset:n.offset,loop:n.loop,volume:n.volume,pan:n.pan,startTime:n.startTime,duration:n.duration,mute:n.mute,paused:n.paused,next:n.next,events:n.events}}}return function (u) {var p=this,t=undefined,s=false,r=false,o=e(this.channel);if ((this.preventOverlaps!=="ignore")&&o) {if (this.priority>=o.priority) {o.component.stopAudio()}else{if (this.preventOverlaps==="append") {o.next.push(n);return}else{return}}}u=u||j;if (u.stop) {this.stopAudio(m,u.playthrough)}else{t=createjs.Sound.createInstance(m,u.startTime||j.startTime||null,u.duration||j.duration||null);t.options={interrupt:u.interrupt||j.interrupt||g.interrupt,delay:u.delay||j.delay||g.delay,loop:u.loop||j.loop||g.loop,offset:u.offset||j.offset||g.offset,volume:(typeof u.volume!=="undefined")?u.volume:((typeof j.volume!=="undefined")?j.volume:g.volume),pan:u.pan||j.pan||g.pan,mute:u.mute||j.mute||g.mute,paused:u.paused||j.paused||g.paused};s=u.next||j.next||g.next;r=u.events||j.events||g.events;if (!this.mixer.paused&&!this.channelSettings.paused&&!t.options.paused) {t.play(t.options)}else{t.options.unplayed=true}this.setChannelSettings(t);if (this.preventOverlaps&&(this.preventOverlaps!=="ignore")) {this.priorityTrack={audio:t,component:this,priority:this.priority,next:s||[]}}if (r) {t.sequenceEvents=[];for (var q=0;q<r.length;q++) {t.sequenceEvents.push({event:r[q].event,time:r[q].time||0,message:r[q].message})}t.sequenceEvents.sort(d)}t.addEventListener("complete",function () {p.onComplete(t,s)});if (t.playState==="playFailed") {if (this.owner.debug) {console.warn('Unable to play "'+m+'".',t)}this.onComplete(t,s)}else{t.soundId=m;this.activeAudioClips.push(t)}}}},c=function (j,k,l) {var i=j.replace(/ /g,"").split(",");if (j==="default") {return function (m) {l.call(this);return j}}else{return function (n) {for (var m=0;m<i.length;m++) {if (!n[i[m]]) {return false}}l.call(this);return j}}};return a.createComponentClass({id:"audio",constructor:function (j) {var k=null;this.channel=j.channel||"default";this.activeAudioClips=[];this.state={};this.stateChange=false;this.currentState=false;this.forcePlaythrough=this.owner.forcePlaythrough||j.forcePlaythrough;if (typeof this.forcePlaythrough!=="boolean") {this.forcePlaythrough=true}if (j.audioMap) {this.checkStates=[];for (var i in j.audioMap) {k=h(j.audioMap[i]);this.addEventListener(i,k);this.checkStates.push(c(i,j.audioMap[i],k))}}if (j.preventOverlaps) {this.preventOverlaps=j.preventOverlaps;if (this.preventOverlaps!=="ignore") {if (!b[this.channel]) {b[this.channel]=[]}b[this.channel].push(this)}}this.priority=j.priority||0;this.priorityTrack=null;if (!a.game.audioMixer) {a.game.audioMixer={channels:{},paused:false,getChannel:function (l) {if (!this.channels[l]) {this.channels[l]={volume:1,mute:false,paused:false,pan:0,update:0}}return this.channels[l]}}}this.mixer=a.game.audioMixer;this.channelSettings=this.mixer.getChannel(this.channel);this.channelUpdate=this.channelSettings.update;this.paused=this.mixer.paused},events:{"handle-render":function (m) {var k=this,l=0,j=undefined;if (this.paused!==this.mixer.paused) {this.paused=this.mixer.paused;this.getAllClips(function (i) {k.setChannelSettings(i)});this.channelUpdate=this.channelSettings.update}if (this.paused) {return}if (this.channelUpdate!==this.channelSettings.update) {this.channelUpdate=this.channelSettings.update;this.getAllClips(function (i) {k.setChannelSettings(i)})}this.getAllClips(function (i) {k.checkTimeEvents(i)});if (this.stateChange) {if (this.checkStates) {if (this.currentState) {this.stopAudio(this.currentState.soundId,this.forcePlaythrough)}this.currentState=false;for (l=0;l<this.checkStates.length;l++) {j=this.checkStates[l].call(this,this.state);if (j) {this.currentState=j;break}}}this.stateChange=false}},"logical-state":function (k) {for (var j in k) {if (this.state[j]!==k[j]) {this.stateChange=true;this.state[j]=k[j]}}},"toggle-mute":function (i) {var j=this;this.handleClip(i,function (k) {if (k) {k.options.mute=!k.options.mute;j.setChannelSettings(k)}})},"stop-audio":function (i) {if (!i) {this.stopAudio()}else{if (typeof i==="string") {this.stopAudio(i)}else{this.stopAudio(i.audioId||false,i.playthrough||false)}}},"mute-audio":function (i) {var j=this;this.handleClip(i,function (k) {if (k) {k.options.mute=true;j.setChannelSettings(k)}})},"unmute-audio":function (i) {var j=this;this.handleClip(i,function (k) {if (k) {k.options.mute=false;j.setChannelSettings(k)}})},"pause-audio":function (i) {var j=this;this.handleClip(i,function (k) {if (k) {k.options.paused=true;j.setChannelSettings(k)}})},"unpause-audio":function (i) {var j=this;this.handleClip(i,function (k) {if (k) {k.options.paused=false;j.setChannelSettings(k)}})},"set-volume":function (l) {var i=this,j=0,k=function (m) {m.options.volume=j;i.setChannelSettings(m)};if (typeof l==="number") {j=l;this.getAllClips(k)}else{if (l.volume) {j=l.volume;this.handleClip(l.soundId,k)}}},"audio-stop":function () {console.warn(this.owner.type+" - audio component: The 'audio-stop' event has been deprecated. Use 'stop-audio' instead.")},"audio-mute-toggle":function () {console.warn(this.owner.type+" - audio component: The 'audio-mute-toggle' event has been deprecated. Use 'toggle-mute' instead.")},"audio-mute":function () {console.warn(this.owner.type+" - audio component: The 'audio-mute' event has been deprecated. Use 'mute-audio' instead.")},"audio-unmute":function () {console.warn(this.owner.type+" - audio component: The 'audio-unmute' event has been deprecated. Use 'unmute-audio' instead.")},"audio-pause":function () {console.warn(this.owner.type+" - audio component: The 'audio-pause' event has been deprecated. Use 'pause-audio' instead.")},"audio-unpause":function () {console.warn(this.owner.type+" - audio component: The 'audio-unpause' event has been deprecated. Use 'unpause-audio' instead.")}},methods:{handleClip:function (i,j) {if (typeof i==="string") {this.getClipById(i,j)}else{this.getAllClips(j)}},getClipById:function (m,l) {var k=0,j=this.activeAudioClips;for (;k<j.length;k++) {if (j[k].soundId===m) {if (l) {l(j[k])}return j[k]}}if (l) {l(null)}return null},getAllClips:function (l) {var k=0,j=this.activeAudioClips;if (l) {for (;k<j.length;k++) {l(j[k])}}return j},setChannelSettings:function (j) {var i=this.channelSettings,k=(this.mixer.paused||i.paused||j.options.paused);j.setMute(j.options.mute||i.mute);j.setPan((j.options.pan+i.pan)/2);j.setVolume(j.options.volume*i.volume);if (j.paused!==k) {if (k) {j.pause()}else{j.resume()}}else{if (!k&&j.options.unplayed) {delete j.options.unplayed;j.play(j.options)}}},stopAudio:function (j,n) {var m=0,l=this.activeAudioClips,k=this;if (j) {for (m=l.length-1;m>=0;m--) {if (l[m].soundId===j) {if (n) {l[m].addEventListener("loop",function (i) {k.stopAudioInstance(i.currentTarget)})}else{l[m].stop();l.splice(m,1);if (this.priorityTrack&&(l[m]===this.priorityTrack.audio)) {this.priorityTrack=null}}}}}else{if (n) {for (;m<l.length;m++) {l[m].addEventListener("loop",function (i) {k.stopAudioInstance(i.currentTarget)})}}else{for (;m<this.activeAudioClips.length;m++) {l[m].stop()}l.length=0;this.priorityTrack=null}}},stopAudioInstance:function (j) {var l=0,k=this.activeAudioClips;for (l=k.length-1;l>=0;l--) {if (k[l]===j) {k[l].stop();k.splice(l,1);if (this.priorityTrack&&(k[l]===this.priorityTrack.audio)) {this.priorityTrack=null}}}},checkTimeEvents:function (i,l) {var j=i.sequenceEvents,k=0;if (j&&j.length) {k=i.getPosition();while(j.length&&(l||(j[0].time<=k))) {this.owner.trigger(j[0].event,j[0].message);j.splice(0,1)}}},onComplete:function (j,k) {this.removeClip(j);this.checkTimeEvents(j,true);this.owner.triggerEvent("clip-complete");if (this.priorityTrack&&(j===this.priorityTrack.audio)) {k=this.priorityTrack.next;this.priorityTrack=null}if (k&&k.length) {if (typeof k==="string") {(h(k)).call(this)}else{var i=k.slice();i.splice(0,1);if (i.length>0) {(h(k[0])).call(this,{next:i})}else{(h(k[0])).call(this)}}}else{this.owner.triggerEvent("sequence-complete")}},removeClip:function (j) {for (var k=0;k<this.activeAudioClips.length;k++) {if (this.activeAudioClips[k]===j) {this.activeAudioClips.splice(k,1);break}}},destroy:function () {this.stopAudio();if (this.preventOverlaps) {for (var j in b[this.channel]) {if (b[this.channel][j]===this) {b[this.channel].splice(j,1);break}}}}}})}());(function () {var c=function (m,l) {var k=l.x-m.x,n=l.y-m.y;return Math.sqrt(k*k+n*n)},f=function (n,l,q) {var k=l.x-n.x,p=l.y-n.y,m=0,o=Math.PI*2;if (!q) {return m}m=Math.acos(k/q);if (p<0) {m=o-m}return m},i=[null,null,null,null,["east","south","west","north"],null,null,null,["east","southeast","south","southwest","west","northwest","north","northeast"],null,null,null,null,null,null,null,["east","east-southeast","southeast","south-southeast","south","south-southwest","southwest","west-southwest","west","west-northwest","northwest","north-northwest","north","north-northeast","northeast","east-northeast"]],e=["left-button","middle-button","right-button"],d=function (l,k) {this.event=l;this.trigger=k;this.filters=false;this.current=false;this.last=false;this.state=false;this.stateSummary={pressed:false,released:false,triggered:false,over:false}},g=function (k) {if (Array.isArray(k)) {return function (m) {for (var l=0;l<k.length;l++) {k[l].state=false}}}else{return function (l) {k.state=false}}},h=function (k) {if (Array.isArray(k)) {return function (m) {for (var l=0;l<k.length;l++) {k[l].current=true;k[l].state=true;if (m&&(typeof(m.over)!=="undefined")) {k[l].over=m.over}}}}else{return function (l) {k.current=true;k.state=true;if (l&&(typeof(l.over)!=="undefined")) {k.over=l.over}}}},j=function (m,n,l,k) {var o=m[n];if (!o) {o=m[n]=new d(n,l)}if (k) {o.setFilter(k)}return o},b=d.prototype;b.update=function () {var k=0;if (this.current||this.last) {this.stateSummary.pressed=this.current;this.stateSummary.released=!this.current&&this.last;this.stateSummary.triggered=this.current&&!this.last;this.stateSummary.over=this.over;if (this.filters) {for (;k<this.filters.length;k++) {if (this.stateSummary[this.filters[k]]) {this.trigger(this.event,this.stateSummary)}}}else{this.trigger(this.event,this.stateSummary)}}this.last=this.current;this.current=this.state};b.setFilter=function (k) {if (!this.filters) {this.filters=[k]}else{this.filters.push(k)}return this};b.isPressed=function () {return this.current};b.isTriggered=function () {return this.current&&!this.last};b.isReleased=function () {return !this.current&&this.last};return a.createComponentClass({id:"entity-controller",constructor:function (r) {var q=0,o=0,m=0,p="",s=undefined,l=this,n=function (k,t) {if (!l.paused) {l.owner.trigger(k,t)}};this.paused=r.paused||false;if (r&&r.controlMap) {this.owner.controlMap=r.controlMap;this.actions={};for (p in r.controlMap) {if (typeof r.controlMap[p]==="string") {s=j(this.actions,r.controlMap[p],n)}else{s=[];if (Array.isArray(r.controlMap[p])) {for (q=0;q<r.controlMap[p].length;q++) {s[q]=j(this.actions,r.controlMap[p][q],n)}}else{m=0;for (o in r.controlMap[p]) {if (typeof r.controlMap[p][o]==="string") {s[m]=j(this.actions,r.controlMap[p][o],n,o);m+=1}else{for (q=0;q<r.controlMap[p][o].length;q++) {s[m]=j(this.actions,r.controlMap[p][o][q],n,o);m+=1}}}}}this.addEventListener(p+":up",g(s));this.addEventListener(p+":down",h(s))}}if (r.joystick) {this.joystick={};this.joystick.directions=r.joystick.directions||4;this.joystick.handleEdge=r.joystick.handleEdge||false;this.joystick.innerRadius=r.joystick.innerRadius||0;this.joystick.outerRadius=r.joystick.outerRadius||Infinity}},events:{"handle-controller":function () {var k="";if (this.actions) {for (k in this.actions) {this.actions[k].update()}}},mousedown:function (k) {this.owner.trigger("mouse:"+e[k.event.button||0]+":down",k.event);if (this.joystick) {this.owner.trigger("joystick:down",k.event);this.handleJoy(k)}},mouseup:function (k) {this.owner.trigger("mouse:"+e[k.event.button||0]+":up",k.event);if (this.joystick) {this.owner.trigger("joystick:up",k.event);this.handleJoy(k)}},mousemove:function (k) {if (this.actions["mouse:left-button"]&&(this.actions["mouse:left-button"].over!==k.over)) {this.actions["mouse:left-button"].over=k.over}if (this.actions["mouse:middle-button"]&&(this.actions["mouse:middle-button"].over!==k.over)) {this.actions["mouse:middle-button"].over=k.over}if (this.actions["mouse:right-button"]&&(this.actions["mouse:right-button"].over!==k.over)) {this.actions["mouse:right-button"].over=k.over}if (this.joystick) {this.handleJoy(k)}},"pause-controls":function () {this.paused=true},"unpause-controls":function () {this.paused=false}},methods:{handleJoy:function (m) {var l=Math.PI/(this.joystick.directions/2),p=c(this.owner,m),k=0,o="",n="";if ((p>this.joystick.outerRadius)||(p<this.joystick.innerRadius)) {return}else{if (!this.paused) {k=f(this.owner,m,p);o=i[this.joystick.directions][Math.floor(((k+l/2)%(Math.PI*2))/l)];if (this.joystick.handleEdge) {l=Math.PI/this.joystick.directions;n=i[this.joystick.directions*2][Math.floor(((k+l/2)%(Math.PI*2))/l)];if (n!==o) {this.owner.trigger(n.replace(o,"").replace("-",""),m)}}this.owner.trigger(o,m);this.owner.trigger("joystick-orientation",k)}}}}})}());(function () {return a.createComponentClass({id:"logic-gravity",constructor:function (b) {this.vY=b.gravity||b.yGravity;if (typeof this.vY!=="number") {this.vY=0.01}this.vX=b.xGravity||0;this.maxVelocity=b.maxVelocity||0;this.newMaxX=this.maxVelocityX=b.maxVelocityX||this.maxVelocity;this.newMaxY=this.maxVelocityY=b.maxVelocityY||this.maxVelocity;this.accelerationX=0;this.accelerationY=0;this.durationX=0;this.durationY=0;if (typeof this.owner.dx!=="number") {this.owner.dx=0}if (typeof this.owner.dy!=="number") {this.owner.dy=0}this.state=this.owner.state;this.hovering=this.state.hovering=this.state.hovering||false;this.falling=this.state.falling=this.state.falling||false;this.grounded=this.state.grounded=this.state.grounded||!this.falling},events:{"handle-logic":function (b) {var c=b.delta;if (!this.hovering) {if (this.newMaxX!==this.maxVelocityX) {if (this.durationX-c>0) {this.maxVelocityX+=(this.newMaxX-this.maxVelocityX)*(c/this.durationX);this.durationX-=c}else{if (this.accelerationX) {if (this.newMaxX>this.maxVelocityX) {if (this.owner.dx>this.maxVelocityX) {this.maxVelocityX=this.owner.dx}this.maxVelocityX=Math.min(this.maxVelocityX+(this.accelerationX*b.delta),this.newMaxX)}else{if (this.owner.dx<this.maxVelocityX) {this.maxVelocityX=this.owner.dx}this.maxVelocityX=Math.max(this.maxVelocityX-(this.accelerationX*b.delta),this.newMaxX)}}else{this.maxVelocityX=this.newMaxX;this.durationX=0}}}if (this.newMaxY!==this.maxVelocityY) {if (this.durationY-c>0) {this.maxVelocityY+=(this.newMaxY-this.maxVelocityY)*(c/this.durationY);this.durationY-=c}else{if (this.accelerationY) {if (this.newMaxY>this.maxVelocityY) {if (this.owner.dy>this.maxVelocityY) {this.maxVelocityY=this.owner.dy}this.maxVelocityY=Math.min(this.maxVelocityY+(this.accelerationY*b.delta),this.newMaxY)}else{if (this.owner.dy<this.maxVelocityY) {this.maxVelocityY=this.owner.dy}this.maxVelocityY=Math.max(this.maxVelocityY-(this.accelerationY*b.delta),this.newMaxY)}}else{this.maxVelocityY=this.newMaxY;this.durationY=0}}}this.owner.dx+=this.vX*c;this.owner.dy+=this.vY*c;if (this.vX&&this.maxVelocityX) {if ((this.vX>0)&&(this.owner.dx>this.maxVelocityX)) {this.owner.dx=this.maxVelocityX}else{if ((this.vX<0)&&(this.owner.dx<-this.maxVelocityX)) {this.owner.dx=-this.maxVelocityX}}}if (this.vY&&this.maxVelocityY) {if ((this.vY>0)&&(this.owner.dy>this.maxVelocityY)) {this.owner.dy=this.maxVelocityY}else{if ((this.vY<0)&&(this.owner.dy<-this.maxVelocityY)) {this.owner.dy=-this.maxVelocityY}}}}if (this.state.hovering!==this.hovering) {this.state.hovering=this.hovering}if (this.state.falling!==this.falling) {this.state.falling=this.falling}if (this.state.grounded!==this.grounded) {this.state.grounded=this.grounded}this.grounded=false;this.falling=true},"hit-solid":function (b) {if (!this.hovering) {if (((b.y>0)&&(this.vY>0))||((b.y<0)&&(this.vY<0))) {this.owner.dy=0;this.falling=false;this.grounded=true}else{if (((b.x<0)&&(this.vX<0))||((b.x>0)&&(this.vX>0))) {this.owner.dx=0;this.falling=false;this.grounded=true}}}return true},glide:function (e) {var b=e.maxVelocity||this.maxVelocity,d=e.duration||0,c=e.acceleration||0;this.durationX=e.durationX||d;this.durationY=e.durationY||d;this.accelerationX=e.accelerationX||c;this.accelerationY=e.accelerationY||c;this.newMaxX=e.maxVelocityX||b||this.maxVelocityX;this.newMaxY=e.maxVelocityY||b||this.maxVelocityY;if (!this.durationX&&!this.accelerationX) {this.maxVelocityX=this.newMaxX}if (!this.durationY&&!this.accelerationY) {this.maxVelocityY=this.newMaxY}},gravitate:function (b) {this.vY=b.gravity||b.yGravity||0;this.vX=b.xGravity||0},hover:function (b) {this.owner.dx=0;this.owner.dy=0;this.hovering=!b||(b.pressed!==false)},fall:function (b) {this.hovering=!!b&&(b.pressed===false)}},methods:{destroy:function () {this.owner.dx=0;this.owner.dy=0}}})}());(function () {return a.createComponentClass({id:"logic-jump",constructor:function (d) {var b=this.owner.velocityX||d.velocityX||0,e=this.owner.velocityY||d.velocityY||d.velocity,c=d.velocityCapRatio||0.5;if (typeof e!=="number") {e=-1}this.velocity=new a.Vector2D(b,e);this.cap=this.velocity.copy().scale(c);this.capMagnitude=this.cap.magnitude();this.cap.normalize();if (typeof this.owner.dx!=="number") {this.owner.dx=0}if (typeof this.owner.dy!=="number") {this.owner.dy=0}this.jumping=false;this.justJumped=false;this.grounded=true;this.state=this.owner.state;this.state.jumping=false;this.state.justJumped=false;if (d.message) {console.warn('"'+this.type+'" components no longer accept "message": "'+d.message+'" as a definition parameter. Use "aliases": {"'+d.message+'": "jump"} instead.')}},events:{"handle-logic":function (d) {var b=null,c=0;if (this.state.justJumped!==this.justJumped) {this.state.justJumped=this.justJumped}if (this.justJumped) {this.justJumped=false;this.owner.triggerEvent("just-jumped");this.owner.dx=this.velocity.x;this.owner.dy=this.velocity.y}if (this.state.jumping!==this.jumping) {this.state.jumping=this.jumping;if (!this.jumping) {b=new a.Vector2D(this.owner.dx,this.owner.dy);c=b.scalarProjection(this.velocity);if (c>this.capMagnitude) {b.subtractVector(this.cap.copy().scale(c-this.capMagnitude));this.owner.dx=b.x;this.owner.dy=b.y}}}this.grounded=false},jump:function (c) {var b=false;if (c) {b=(c.pressed!==false)}else{b=true}if (!this.jumping&&b&&this.grounded) {if (c) {this.justJumped=(c.triggered!==false)}else{this.justJumped=true}this.jumping=true}else{if (this.jumping&&!b) {this.jumping=false}}},"air-jump":function (c) {var b=false;if (c) {b=(c.pressed!==false)}else{b=true}if (!this.jumping&&b) {this.justJumped=true;this.jumping=true}else{if (this.jumping&&!b) {this.jumping=false}}},"hit-solid":function (b) {if (!this.justJumped) {if (b.y) {this.owner.dy=0;if (((b.y>0)&&(this.velocity.y<0))||((b.y<0)&&(this.velocity.y>0))) {this.jumping=false;this.grounded=true}}else{if (b.x) {this.owner.dx=0;if (((b.x<0)&&(this.velocity.x>0))||((b.x>0)&&(this.velocity.x<0))) {this.jumping=false;this.grounded=true}}}}return true}}})}());(function () {return a.createComponentClass({id:"logic-hero",constructor:function (b) {var c=this.state=this.owner.state;c.swing=false;c.swingHit=false;this.teleportDestination=undefined;this.justTeleported=false},events:{"handle-logic":function () {},"portal-waiting":function (b) {b.trigger("activate-portal")}}})}());(function () {var c=function (d) {return function (e) {if (e) {this[d]=(e.pressed!==false)}else{this[d]=true}}},b=function (e,g) {var d=Math.sqrt(e*e+g*g),f=0;if (d!=0) {f=Math.acos(e/d);if (g<0) {f=(Math.PI*2)-f}}return f};return a.createComponentClass({id:"logic-directional-movement",constructor:function (e) {var d=this;this.speed=e.speed||0.3;this.boost=false;this.paused=false;if (e.pause||e.boost) {if (typeof e.pause==="string") {this.pausers=[e.pause]}else{this.pausers=e.pause}this.addEventListener("logical-state",function (h) {var g=false;if (e.pause) {for (var f=0;f<d.pausers.length;f++) {g=g||h[d.pausers[f]]}this.paused=g}if (e.boost) {if (d.boost) {if (h[e.boost]===false) {d.boost=false}}else{if (h[e.boost]===true) {d.boost=true}}}})}this.state=this.owner.state;this.state.moving=false;this.state.left=false;this.state.right=false;this.state.up=false;this.state.down=false;this.owner.orientation=0;this.moving=false;this.left=false;this.right=false;this.up=false;this.down=false;this.upLeft=false;this.upRight=false;this.downLeft=false;this.downRight=false;this.facing="right"},events:{"handle-logic":function (i) {var f=0,d=0,k=this.up||this.upLeft||this.downLeft,l=this.upLeft||(this.up&&this.left),h=this.left||this.upLeft||this.downLeft,m=this.downLeft||(this.down&&this.left),o=this.down||this.downLeft||this.downRight,g=this.downRight||(this.down&&this.right),n=this.right||this.upRight||this.downRight,j=this.upRight||(this.up&&this.right),e=0;if (k&&o) {this.moving=false}else{if (h&&n) {this.moving=false}else{if (l) {f=-this.speed/1.414;d=-this.speed/1.414;this.moving=true;this.facing="up-left"}else{if (j) {d=-this.speed/1.414;f=this.speed/1.414;this.moving=true;this.facing="up-right"}else{if (m) {d=this.speed/1.414;f=-this.speed/1.414;this.moving=true;this.facing="down-left"}else{if (g) {d=this.speed/1.414;f=this.speed/1.414;this.moving=true;this.facing="down-right"}else{if (h) {f=-this.speed;this.moving=true;this.facing="left"}else{if (n) {f=this.speed;this.moving=true;this.facing="right"}else{if (k) {d=-this.speed;this.moving=true;this.facing="up"}else{if (o) {d=this.speed;this.moving=true;this.facing="down"}else{this.moving=false;switch(this.facing) {case"up":k=true;break;case"down":o=true;break;case"left":h=true;break;case"right":n=true;break;case"up-left":k=true;h=true;break;case"up-right":k=true;n=true;break;case"down-left":o=true;h=true;break;case"down-right":n=true;n=true;break}}}}}}}}}}}if (this.moving) {if (!this.paused) {if (this.boost) {f*=1.5;d*=1.5}this.owner.x+=(f*i.delta);this.owner.y+=(d*i.delta)}e=b(f,d);if (this.owner.orientation!==e) {this.owner.orientation=e}}if (this.state.moving!==this.moving) {this.state.moving=this.moving}if (this.state.up!==k) {this.state.up=k}if (this.state.right!==n) {this.state.right=n}if (this.state.down!==o) {this.state.down=o}if (this.state.left!==h) {this.state.left=h}},"go-down":c("down"),"go-south":c("down"),"go-down-left":c("downLeft"),"go-southwest":c("downLeft"),"go-left":c("left"),"go-west":c("left"),"go-up-left":c("upLeft"),"go-northwest":c("upLeft"),"go-up":c("up"),"go-north":c("up"),"go-up-right":c("upRight"),"go-northeast":c("upRight"),"go-right":c("right"),"go-east":c("right"),"go-down-right":c("downRight"),"go-southeast":c("downRight"),stop:function (d) {if (!d||(d.pressed!==false)) {this.left=false;this.right=false;this.up=false;this.down=false;this.upLeft=false;this.upRight=false;this.downLeft=false;this.downRight=false}},accelerate:function (d) {this.speed=d}}})}());(function () {var b=function (f,d,e) {if (typeof f==="string") {return function (g) {if (g.myType===e) {if (g.hitType===d) {this.owner.triggerEvent(f,g)}}}}else{if (Array.isArray(f)) {return function (g) {if (g.myType===e) {if (g.hitType===d) {for (var h in f) {this.owner.triggerEvent(f[h],g)}}}}}else{return function (i) {var h=i.x,g=i.y;if (i.entity&&!(h||g)) {h=i.entity.x-this.owner.x;g=i.entity.y-this.owner.y}if (i.myType===e) {if (i.hitType===d) {if ((g>0)&&f.bottom) {this.owner.trigger(f.bottom,i)}if ((g<0)&&f.top) {this.owner.trigger(f.top,i)}if ((h>0)&&f.right) {this.owner.trigger(f.right,i)}if ((h<0)&&f.left) {this.owner.trigger(f.left,i)}if (f.all) {this.owner.trigger(f.all,i)}}}}}}},c=function (e,d) {if (!d.collisionFunctions) {d.collisionFunctions={};d.getAABB=function (h) {if (!h) {var f=d.aabb=d.aabb||new a.AABB();f.reset();for (var g in d.collisionFunctions) {f.include(d.collisionFunctions[g].getAABB())}return f}else{if (d.collisionFunctions[h]) {return d.collisionFunctions[h].getAABB()}else{return null}}};d.getPreviousAABB=function (f) {if (d.collisionFunctions[f]) {return d.collisionFunctions[f].getPreviousAABB()}else{return null}};d.getShapes=function (f) {if (d.collisionFunctions[f]) {return d.collisionFunctions[f].getShapes()}else{return null}};d.getPrevShapes=function (f) {if (d.collisionFunctions[f]) {return d.collisionFunctions[f].getPrevShapes()}else{return null}};d.prepareCollision=function (f,h) {for (var g in d.collisionFunctions) {d.collisionFunctions[g].prepareCollision(f,h)}};d.relocateEntity=function (f,g) {d.triggerEvent("relocate-entity",{x:f,y:g})};d.movePreviousX=function (f) {for (var g in d.collisionFunctions) {d.collisionFunctions[g].movePreviousX(f)}};d.getCollisionTypes=function () {return d.collisionTypes};d.getSolidCollisions=function () {return d.solidCollisions}}d.collisionFunctions[e.collisionType]={getAABB:function () {return e.getAABB()},getPreviousAABB:function () {return e.getPreviousAABB()},getShapes:function () {return e.getShapes()},getPrevShapes:function () {return e.getPrevShapes()},prepareCollision:function (f,g) {e.prepareCollision(f,g)},movePreviousX:function (f) {e.movePreviousX(f)}}};return a.createComponentClass({id:"collision-basic",constructor:function (g) {var q=0,f=null,o=g.regX,n=g.regY,e=g.width,r=g.height,p=g.radius,j=g.margin||0,h=g.marginLeft||j,m=g.marginRight||j,d=g.marginTop||j,k=g.marginBottom||j;if (isNaN(e)) {e=this.owner.width;if (isNaN(o)) {o=this.owner.regX}}if (isNaN(r)) {r=this.owner.height;if (isNaN(n)) {n=this.owner.regY}}if (isNaN(p)) {p=this.owner.radius;if (isNaN(o)) {o=this.owner.regX}if (isNaN(n)) {n=this.owner.regY}}this.immobile=this.owner.immobile=this.owner.immobile||g.immobile||false;this.owner.previousX=this.owner.previousX||this.owner.x;this.owner.previousY=this.owner.previousY||this.owner.y;this.aabb=new a.AABB();this.prevAABB=new a.AABB();this.owner.bullet=this.owner.bullet||g.bullet;if (g.shapes) {f=g.shapes}else{if (g.shape) {f=[g.shape]}else{if (g.shapeType==="circle") {p=p||(((e||0)+(r||0))/4);f=[{regX:(isNaN(o)?p:o)-(m-h)/2,regY:(isNaN(n)?p:n)-(k-d)/2,radius:p,width:p*2,height:p*2,type:g.shapeType}]}else{f=[{regX:(isNaN(o)?(e||0)/2:o)-(m-h)/2,regY:(isNaN(n)?(r||0)/2:n)-(k-d)/2,points:g.points,width:(e||0)+h+m,height:(r||0)+d+k,type:g.shapeType}]}}}this.collisionType=g.collisionType||"none";this.owner.collisionTypes=this.owner.collisionTypes||[];this.owner.collisionTypes.push(this.collisionType);this.shapes=[];this.prevShapes=[];this.entities=undefined;for (q in f) {this.shapes.push(new a.CollisionShape(this.owner,f[q],this.collisionType));this.prevShapes.push(new a.CollisionShape(this.owner,f[q],this.collisionType));this.prevAABB.include(this.prevShapes[q].getAABB());this.aabb.include(this.shapes[q].getAABB())}if (g.jumpThrough) {this.owner.jumpThrough=true}c(this,this.owner);this.owner.solidCollisions=this.owner.solidCollisions||{};this.owner.solidCollisions[this.collisionType]=[];if (g.solidCollisions) {for (var l in g.solidCollisions) {this.owner.solidCollisions[this.collisionType].push(l);this.owner.collides=true;if (g.solidCollisions[l]) {this.addEventListener("hit-by-"+l,b(g.solidCollisions[l],"solid",this.collisionType))}}}this.owner.softCollisions=this.owner.softCollisions||{};this.owner.softCollisions[this.collisionType]=[];if (g.softCollisions) {for (var l in g.softCollisions) {this.owner.softCollisions[this.collisionType].push(l);if (g.softCollisions[l]) {this.addEventListener("hit-by-"+l,b(g.softCollisions[l],"soft",this.collisionType))}}}},events:{"collide-on":function () {this.owner.parent.trigger("add-collision-entity",this.owner)},"collide-off":function () {this.owner.parent.trigger("remove-collision-entity",this.owner)},"handle-logic":function () {if (this.owner.movementAbsorbed) {this.owner.movementAbsorbed=false}},"prepare-for-collision":function (e) {var d=this.owner.x,f=this.owner.y;if (!this.owner.movementAbsorbed&&e) {this.owner.movementAbsorbed=true;if (this.owner.dx) {d+=this.owner.dx*(e.delta||0)}if (this.owner.dy) {f+=this.owner.dy*(e.delta||0)}}this.owner.x=d;this.owner.y=f},"relocate-entity":function (e) {if (e.relative) {this.owner.x=this.owner.previousX+e.x;this.owner.y=this.owner.previousY+e.y}else{this.owner.x=e.x;this.owner.y=e.y}this.aabb.reset();for (var d in this.shapes) {this.shapes[d].update(this.owner.x,this.owner.y);this.aabb.include(this.shapes[d].getAABB())}this.owner.previousX=this.owner.x;this.owner.previousY=this.owner.y}},methods:{getAABB:function () {return this.aabb},getPreviousAABB:function () {return this.prevAABB},getShapes:function () {return this.shapes},getPrevShapes:function () {return this.prevShapes},prepareCollision:function (d,f) {var e=this.prevShapes;this.owner.x=d;this.owner.y=f;this.prevShapes=this.shapes;this.shapes=e;this.prevAABB.set(this.aabb);this.aabb.reset();for (var d=0;d<this.shapes.length;d++) {this.shapes[d].update(this.owner.x,this.owner.y);this.aabb.include(this.shapes[d].getAABB())}},movePreviousX:function (d) {this.prevAABB.moveX(d);for (var e=0;e<this.prevShapes.length;e++) {this.prevShapes[e].setXWithEntityX(d)}},destroy:function () {this.owner.parent.trigger("remove-collision-entity",this.owner);this.owner.collides=false;delete this.aabb;delete this.prevAABB;for (var d=0;d<this.owner.collisionTypes.length;d++) {if (this.owner.collisionTypes[d]===this.collisionType) {this.owner.collisionTypes.splice(d,1);break}}if (this.owner.solidCollisions[this.collisionType]) {this.owner.solidCollisions[this.collisionType].length=0;delete this.owner.solidCollisions[this.collisionType]}for (var d in this.owner.solidCollisions) {this.owner.collides=true}if (this.owner.softCollisions[this.collisionType]) {this.owner.softCollisions[this.collisionType].length=0;delete this.owner.softCollisions[this.collisionType]}delete this.owner.collisionFunctions[this.collisionType];this.shapes.length=0;this.prevShapes.length=0;delete this.entities;if (this.owner.collisionTypes.length) {this.owner.parent.trigger("add-collision-entity",this.owner)}}}})}());(function () {var f=window.devicePixelRatio||1,c={},e=function (g) {return function (h) {if (this.animationFinished||(this.lastState>=-1)) {this.currentAnimation=g;this.lastState=-1;this.animationFinished=false;this.sprite.gotoAndPlay(g)}else{this.waitingAnimation=g;this.waitingState=-1}}},b=function (h,i) {var g=h.replace(/ /g,"").split(",");if (h==="default") {return function (j) {return i}}else{return function (k) {for (var j=0;j<g.length;j++) {if (!k[g[j]]) {return false}}return i}}},d=(function () {var g=function (h,l) {var j=l.indexOf("("),k=l.substring(0,j),i=l.substring(j+1,l.indexOf(")"));if (i.length) {h[k].apply(h,i.split(","))}else{h[k]()}};return function (j,l) {var k=0,h=l.split(".");for (;k<h.length;k++) {g(j,h[k])}}}());return a.createComponentClass({id:"render-sprite",constructor:(function () {var h={"default":0},g=function (l,p) {var q=0,r=null,n=null,t=1,s=1,o=false,m=l.spritesheet||l.spriteSheet,u={framerate:0,images:null,frames:null,animations:null},k={definition:u,spritesheet:null};if (!m&&(typeof l.image==="string")) {if (c[l.image]) {return c[l.image]}else{if (a.game.settings.assets[l.image]&&a.game.settings.assets[l.image].data&&a.game.settings.assets[l.image].data.spritesheet) {c[l.image]=k;m=a.game.settings.assets[l.image].data.spritesheet}}}if (m&&!isNaN(m.framerate)) {u.framerate=m.framerate}else{if (!isNaN(l.framerate)) {u.framerate=l.framerate}else{if (!isNaN(p.framerate)) {u.framerate=p.framerate}}}if (m&&Array.isArray(m.images)) {u.images=m.images.slice()}else{if (m&&m.image) {u.images=[m.image]}else{if (l.images) {u.images=l.images.slice()}else{if (l.image) {u.images=[l.image]}else{if (p.images) {u.images=p.images.slice()}else{if (p.image) {u.images=[p.image]}else{console.warn('"'+p.type+'" render component: No source image defined.')}}}}}}for (q=0;q<u.images.length;q++) {if (typeof u.images[q]==="string") {if (a.assets[u.images[q]]) {u.images[q]=a.assets[u.images[q]];if (!o&&((u.images[q].scaleX&&(u.images[q].scaleX!==1))||(u.images[q].scaleY&&(u.images[q].scaleY!==1)))) {o=true}}else{if (a.settings.supports.iOS) {console.warn('"'+p.type+'" render component: "'+u.images[q]+'" is not a loaded asset. Make sure the image is not too large for iOS Safari.')}else{console.warn('"'+p.type+'" render component: "'+u.images[q]+'" is not a loaded asset.')}}}}if (m&&m.frames) {u.frames=m.frames}else{if (l.frames) {u.frames=l.frames}else{if (p.frames) {u.frames=p.frames}else{if (l.source) {u.frames=[[l.source.x||l.x||0,l.source.y||l.y||0,l.source.width||l.width||u.images[0].width||p.width,l.source.height||l.height||u.images[0].height||p.height,0,l.regX||p.regX||0,l.regY||p.regY||0]];console.warn('"'+p.type+'" render component: The original render-image "source" parameter will soon be deprecated in favor of placing source information as individual parameters directly on the render component.')}else{n=u.images[0];if (n) {u.frames=[[l.x||0,l.y||0,l.width||u.images[0].width||p.width,l.height||u.images[0].height||p.height,0,l.regX||p.regX||0,l.regY||p.regY||0]]}}}}}if (o) {if (Array.isArray(u.frames)) {r=u.frames;u.frames=[];for (q=0;q<r.length;q++) {t=u.images[r[q][4]].scaleX||1;s=u.images[r[q][4]].scaleY||1;u.frames.push([r[q][0]*t,r[q][1]*s,r[q][2]*t,r[q][3]*s,r[q][4],r[q][5]*t,r[q][6]*s])}}else{t=u.images[0].scaleX||1;s=u.images[0].scaleY||1;u.frames={width:u.frames.width*t,height:u.frames.height*s,regX:u.frames.regX*t,regY:u.frames.regY*s}}}if (m&&m.animations) {u.animations=m.animations}else{if (l.animations) {u.animations=l.animations}else{if (p.animations) {u.animations=p.animations}else{u.animations=h}}}k.spritesheet=new createjs.SpriteSheet(k.definition);return k},j=function (m,k) {var n=null,l="";if (m.animationMap) {return m.animationMap}else{if (Array.isArray(k.frames)&&(k.frames.length===1)) {return null}else{n={};for (l in k.animations) {n[l]=l}return n}}},i=function (k,n) {var m="",l="";k.followThroughs={};k.checkStates=[];for (m in n) {l=n[m];if (l[l.length-1]==="!") {l=l.substring(0,l.length-1);k.followThroughs[l]=true}else{k.followThroughs[l]=false}if (k.eventBased) {k.addEventListener(m,e(l))}if (k.stateBased) {k.checkStates.push(b(m,l))}}};return function (m) {var k=this,l=g(m,this.owner),n=j(m,l.definition);this.sprite=null;this.stage=null;this.rotate=m.rotate||false;this.mirror=m.mirror||false;this.flip=m.flip||false;this.scale=(m.scale!==false);this.stateBased=n&&(m.stateBased!==false);this.eventBased=n&&(m.eventBased!==false);this.hover=false;this.click=false;this.touch=false;this.forcePlaythrough=this.owner.forcePlaythrough||m.forcePlaythrough||false;this.initialScaleX=m.scaleX||1;this.initialScaleY=m.scaleY||1;if (m.facing==="left") {this.initialScaleX=-this.initialScaleX}this.imageScaleX=l.definition.images[0].scaleX||1;this.imageScaleY=l.definition.images[0].scaleY||1;this.lastOwnerScaleX=this.owner.scaleX=this.owner.scaleX||1;this.lastOwnerScaleY=this.owner.scaleY=this.owner.scaleY||1;if (m.acceptInput) {this.hover=m.acceptInput.hover||false;this.click=m.acceptInput.click||false;this.touch=m.acceptInput.touch||false;this.camera={x:0,y:0};this.addEventListener("camera-update",function (o) {k.camera.x=o.viewportLeft;k.camera.y=o.viewportTop})}if (this.eventBased||this.stateBased) {i(this,n);this.currentAnimation=n["default"]||""}this.sprite=new createjs.Sprite(l.spritesheet,this.currentAnimation||0);this.sprite.addEventListener("animationend",function (o) {k.owner.trigger("animation-ended",o);if (k.waitingAnimation) {k.currentAnimation=k.waitingAnimation;k.waitingAnimation=false;k.lastState=k.waitingState;k.animationFinished=false;k.sprite.gotoAndPlay(k.currentAnimation)}else{k.animationFinished=true}});if (m.pins) {this.container=new createjs.Container();this.container.addChild(this.sprite);this.sprite.z=0;this.addPins(m.pins,l.definition.frames)}else{this.container=this.sprite}if (m.acceptInput&&m.acceptInput.hitArea) {if (typeof m.acceptInput.hitArea==="string") {this.container.hitArea=this.setHitArea(m.acceptInput.hitArea)}else{this.container.hitArea=this.setHitArea("r("+(this.owner.x||0)+","+(this.owner.y||0)+","+(this.owner.width||0)+","+(this.owner.height||0)+")")}}if (m.mask) {this.container.mask=this.setMask(m.mask)}this.pinTo=m.pinTo||false;if (this.pinTo) {this.owner.triggerEvent("pin-me",this.pinTo)}this.container.scaleX=this.initialScaleX*this.owner.scaleX;this.container.scaleY=this.initialScaleY*this.owner.scaleY;this.sprite.scaleX/=this.imageScaleX;this.sprite.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.skewX=this.owner.skewX||m.skewX;this.skewY=this.owner.skewY||m.skewY;this.offsetZ=m.offsetZ||0;this.container.hidden=m.hidden||false;this.state=this.owner.state;this.stateChange=false;this.lastState=-1;this.waitingAnimation=false;this.waitingState=0;this.playWaiting=false;this.animationFinished=false;this.stateChange=true;if (m.cache) {this.updateSprite();this.owner.cacheRender=this.container}}}()),events:{"handle-render-load":function (g) {if (g&&g.stage) {this.addStage(g.stage)}},"handle-render":function (g) {if (!this.stage) {if (!this.pinTo) {if (!this.addStage(g.stage)) {console.warn('No CreateJS Stage, removing render component from "'+this.owner.type+'".');this.owner.removeComponent(this);return}}else{return}}this.updateSprite()},"logical-state":function (g) {this.stateChange=true},"hide-sprite":function () {this.container.hidden=true},"show-sprite":function () {this.container.hidden=false},"pin-me":function (g) {if (this.pins&&this.pins[g]) {this.owner.trigger("attach-pin",this.pins[g])}},"attach-pin":function (g) {if (g.pinId===this.pinTo) {this.stage=g.container;this.stage.addChild(this.container);this.addInputs();this.pinnedTo=g}},"remove-pin":function (g) {if (g.pinId===this.pinTo) {this.stage.removeChild(this.container);this.stage=null;this.pinnedTo=null}},"dispatch-event":function (g) {this.sprite.dispatchEvent(g)}},methods:{addStage:function (g) {if (g&&!this.pinTo) {this.stage=g;this.stage.addChild(this.container);this.addInputs();return g}else{return null}},updateSprite:(function () {var g=function (i,h) {return i.z-h.z};return function (l) {var h=false,j=0,k=null;if (this.pinnedTo) {if (this.pinnedTo.frames&&this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame]) {this.container.x=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].x;this.container.y=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].y;if (this.container.z!==this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z) {if (this.stage) {this.stage.reorder=true}this.container.z=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].z}this.container.rotation=this.pinnedTo.frames[this.pinnedTo.sprite.currentFrame].angle||0;this.container.visible=true}else{if (this.pinnedTo.defaultPin) {this.container.x=this.pinnedTo.defaultPin.x;this.container.y=this.pinnedTo.defaultPin.y;if (this.container.z!==this.pinnedTo.defaultPin.z) {if (this.stage) {this.stage.reorder=true}this.container.z=this.pinnedTo.defaultPin.z}this.container.rotation=this.pinnedTo.defaultPin.angle||0;this.container.visible=true}else{this.container.visible=false}}}else{this.container.x=this.owner.x;this.container.y=this.owner.y;if (this.container.z!==(this.owner.z+this.offsetZ)) {if (this.stage) {this.stage.reorder=true}this.container.z=(this.owner.z+this.offsetZ)}if (this.owner.opacity||(this.owner.opacity===0)) {this.container.alpha=this.owner.opacity}}if (this.container.reorder) {this.container.reorder=false;this.container.sortChildren(g)}if (this.skewX) {this.container.skewX=this.skewX}if (this.skewY) {this.container.skewY=this.skewY}if (this.scale&&(this.owner.scaleX!=this.lastOwnerScaleX||this.owner.scaleY!=this.lastOwnerScaleY)) {this.container.scaleX=this.initialScaleX*this.owner.scaleX;this.container.scaleY=this.initialScaleY*this.owner.scaleY;this.sprite.scaleX/=this.imageScaleX;this.sprite.scaleY/=this.imageScaleY;this.scaleX=this.container.scaleX;this.scaleY=this.container.scaleY;this.lastOwnerScaleX=this.owner.scaleX;this.lastOwnerScaleY=this.owner.scaleY}if (this.rotate||this.mirror||this.flip) {k=((this.owner.orientation*180)/Math.PI+360)%360;if (this.rotate) {this.container.rotation=k}if (this.mirror) {if ((k>90)&&(k<270)) {this.container.scaleX=-this.scaleX}else{this.container.scaleX=this.scaleX}}if (this.flip) {if (k>180) {this.container.scaleY=this.scaleY}else{this.container.scaleY=-this.scaleY}}}if (this.stateBased&&this.stateChange) {if (this.state.hidden!==undefined) {this.container.hidden=this.state.hidden}if (this.checkStates) {for (;j<this.checkStates.length;j++) {h=this.checkStates[j](this.state);if (h) {if (this.currentAnimation!==h) {if (!this.followThroughs[this.currentAnimation]&&(!this.forcePlaythrough||(this.animationFinished||(this.lastState>=+j)))) {this.currentAnimation=h;this.lastState=+j;this.animationFinished=false;this.sprite.gotoAndPlay(h)}else{this.waitingAnimation=h;this.waitingState=+j}}else{if (this.waitingAnimation&&!this.followThroughs[this.currentAnimation]) {this.waitingAnimation=false}}break}}}this.stateChange=false}}}()),addInputs:(function () {var g=function (i,h) {return function (j) {i.owner.trigger(h,{event:j.nativeEvent,cjsEvent:j,x:(j.stageX*f)/i.stage.scaleX+i.camera.x,y:(j.stageY*f)/i.stage.scaleY+i.camera.y,entity:i.owner})}};return function () {var p=this,h=null,n=null,l=null,q=null,m=null,i=null,j=null,o=null,k=null;if (this.click||this.touch) {if (this.touch&&!this.stage.__touch) {createjs.Touch.enable(this.stage)}h=g(this,"mousedown");i=g(this,"pressmove");j=g(this,"pressup");o=g(this,"click");k=g(this,"dblclick");this.sprite.addEventListener("mousedown",h);this.sprite.addEventListener("pressmove",i);this.sprite.addEventListener("pressup",j);this.sprite.addEventListener("click",o);this.sprite.addEventListener("dblclick",k)}if (this.hover) {this.stage.enableMouseOver();n=g(this,"mouseover");l=g(this,"mouseout");q=g(this,"rollover");m=g(this,"rollout");this.sprite.addEventListener("mouseover",n);this.sprite.addEventListener("mouseout",l);this.container.addEventListener("rollover",q);this.container.addEventListener("rollout",m)}this.removeInputListeners=function () {if (this.click||this.touch) {this.sprite.removeEventListener("mousedown",h);this.sprite.removeEventListener("pressmove",i);this.sprite.removeEventListener("pressup",j);this.sprite.removeEventListener("click",o);this.sprite.removeEventListener("dblclick",k)}if (this.hover) {this.sprite.removeEventListener("mouseover",n);this.sprite.removeEventListener("mouseout",l);this.container.removeEventListener("rollover",q);this.container.removeEventListener("rollout",m)}}}}()),addPins:function (n,p) {var l=0,k=0,h=null,o=p.regX||0,m=p.regY||0,g=Array.isArray(p);this.pinsToRemove=this.pinsToRemove||[];this.pins={};for (;l<n.length;l++) {this.pinsToRemove.push(n[l].pinId);if (g) {o=(p[0][5]||0)/this.imageScaleX;m=(p[0][6]||0)/this.imageScaleY}this.pins[n[l].pinId]=h={pinId:n[l].pinId,sprite:this.sprite,container:this.container};if ((typeof n[l].x==="number")&&(typeof n[l].y==="number")) {h.defaultPin={x:(n[l].x-o),y:(n[l].y-m),z:n[l].z||1e-8,angle:(n[l].angle||0)}}if (n[l].frames) {h.frames=[];for (k=0;k<n[l].frames.length;k++) {if (n[l].frames[k]) {if (g) {o=(p[k][5]||0)/this.imageScaleX;m=(p[k][6]||0)/this.imageScaleY}if ((typeof n[l].frames[k].x==="number")&&(typeof n[l].frames[k].y==="number")) {h.frames.push({x:(n[l].frames[k].x-o),y:(n[l].frames[k].y-m),z:n[l].frames[k].z||(h.defaultPin?h.defaultPin.z:1e-8),angle:n[l].frames[k].angle||(h.defaultPin?h.defaultPin.angle:0)})}else{if (h.defaultPin) {if (typeof n[l].frames[k].x==="number") {h.frames.push({x:(n[l].frames[k].x-o),y:h.defaultPin.y,z:n[l].frames[k].z||h.defaultPin.z,angle:n[l].frames[k].angle||h.defaultPin.angle})}else{if (typeof n[l].frames[k].y==="number") {h.frames.push({x:h.defaultPin.x,y:(n[l].frames[k].y-m),z:n[l].frames[k].z||h.defaultPin.z,angle:n[l].frames[k].angle||h.defaultPin.angle})}else{h.frames.push(null)}}}else{h.frames.push(null)}}}else{h.frames.push(null)}}}this.owner.trigger("attach-pin",h)}},removePins:function () {var g=0;if (this.pins&&this.pinsToRemove) {for (;g<this.pinsToRemove.length;g++) {this.owner.trigger("remove-pin",this.pins[this.pinsToRemove[g]].pinId);delete this.pins[this.pinsToRemove[g]]}this.pinsToRemove.length=0}},setMask:function (i) {var h=new createjs.Shape(),g=h.graphics;h.x=0;h.y=0;if (typeof i==="string") {d(g,i)}else{if (i.radius) {g.dc(i.x||0,i.y||0,i.radius)}else{g.r(i.x||0,i.y||0,i.width||this.owner.width||0,i.height||this.owner.height||0)}}return h},setHitArea:(function () {var g={};return function (k) {var i=null,j=null,h="";if (typeof k==="string") {h=k}else{h=JSON.stringify(k)}i=g[h];if (!i) {i=new createjs.Shape();j=i.graphics;i.x=0;i.y=0;j.beginFill("#000");if (typeof k==="string") {d(j,k)}else{if (k.radius) {j.dc(k.x||0,k.y||0,k.radius)}else{j.r(k.x||0,k.y||0,k.width||this.owner.width||0,k.height||this.owner.height||0)}}g[h]=i}return i}}()),destroy:function () {if (this.removeInputListeners) {this.removeInputListeners()}if (this.stage) {this.stage.removeChild(this.container);this.stage=undefined}this.removePins();this.followThroughs=null;this.sprite=undefined;this.container=undefined}}})}());(function () {return a.createComponentClass({id:"logic-portal",constructor:function (c) {var d=c.entrants||c.entrant;this.destination=this.owner.destination||c.destination;this.used=false;this.ready=false;this.wasReady=false;if (d) {this.entrants={};if (Array.isArray(d)) {for (var b=0;b<d.length;b++) {this.entrants[d[b]]=false}}else{this.entrants[d]=false}}},events:{"handle-logic":function () {if (!this.used&&this.activated) {this.owner.trigger("port-"+this.destination);this.used=true}else{if (this.ready&&!this.wasReady) {this.owner.triggerEvent("portal-waiting");this.wasReady=true}else{if (this.wasReady&&!this.ready) {this.owner.triggerEvent("portal-not-waiting");this.wasReady=false}}}this.owner.state.occupied=false;this.owner.state.ready=true;for (var b in this.entrants) {if (this.entrants[b]) {this.owner.state.occupied=true;this.entrants[b]=false}else{this.owner.state.ready=false}}this.ready=false},"occupied-portal":function (c) {this.entrants[c.entity.type]=true;for (var b in this.entrants) {if (!this.entrants[b]) {return}}this.ready=true},"activate-portal":function () {this.activated=true}}})}());(function () {return a.createComponentClass({id:"logic-fps-counter",constructor:function (b) {this.counter={text:""};this.times={};this.timeElapsed=false;this.ticks=b.ticks||30;this.count=this.ticks},events:{"handle-logic":function () {if (!a.game.settings.debug&&this.owner.parent) {this.owner.parent.removeEntity(this.owner)}if (this.timeElapsed) {this.timeElapsed=false;this.count--;if (!this.count) {this.count=this.ticks;var c=Math.floor(createjs.Ticker.getMeasuredFPS())+" FPS<br />";for (var b in this.times) {c+="<br />"+b+": "+Math.round(this.times[b]/this.ticks)+"ms";this.times[b]=0}this.counter.text=c;this.owner.trigger("update-content",this.counter)}}},"time-elapsed":function (b) {if (b) {if (b.name) {if ((b.name==="Engine Total")&&!this.timeElapsed) {this.timeElapsed=true}if (!this.times[b.name]) {this.times[b.name]=0}this.times[b.name]+=b.time}}}},methods:{destroy:function () {this.counter=null;this.times=null}}})}());(function () {return a.createComponentClass({id:"audio-mobile",constructor:function (b) {this.audioId=b.audioId},events:{load:function () {if (a.game.settings.supports.mobile) {this.owner.state.mobile=true;if ((a.game.settings.supports.android||a.game.settings.supports.iOS)&&!a.game.settings.supports.audioAPI) {this.owner.triggerEvent("low-quality-audio")}}else{this.owner.triggerEvent("load-assets")}},"activate-audio":function () {var c=a.game.settings.assets[this.audioId],b=null;if (c&&a.game.settings.supports.iOS&&!a.game.settings.supports.audioAPI) {delete a.game.settings.assets[this.audioId];c.data.channels=1;c.src=c.src.replace("ogg","m4a");createjs.Sound.registerSounds([c]);b=createjs.Sound.play(this.audioId);console.log("Initializing iOS fallback audio.");if (b.playState==="playSucceeded") {b.stop()}}this.owner.state.mobile=false;this.owner.triggerEvent("load-assets")}}})}());(function () {return a.createComponentClass({id:"asset-loader",constructor:function (b) {this.useXHR=(b.useXHR!==false);this.assets=b.assets||a.game.settings.assets;this.crossOrigin=b.crossOrigin||"";this.progressBar=b.progressBar||false;this.automatic=(b.automatic!==false);this.message={complete:false,total:0,progress:0,fraction:0}},events:{load:function () {if (this.automatic) {this.owner.triggerEvent("load-assets")}},"load-assets":function () {var h="",g=0,n=this,c=function (o,q) {var j=0,p=false;for (j in q) {if (q[j].id===o.id) {p=true;break}}if (!p) {q.push(o)}},l=new createjs.LoadQueue(this.useXHR,"",this.crossOrigin),k=[],m=a.game.settings.global.nativeAssetResolution||0,f=a.game.settings.scale=m?Math.min(1,Math.max(window.screen.width,window.screen.height)*(window.devicePixelRatio||1)/m):1,d=function (p,j,v) {var i=v||1,q=j||1,s=Math.ceil((p.width/q)*f)*q,t=Math.ceil((p.height/i)*f)*i,o=document.createElement("canvas"),u=o.getContext("2d");o.width=s;o.height=t;o.scaleX=s/p.width;o.scaleY=t/p.height;u.drawImage(p,0,0,p.width,p.height,0,0,s,t);return o},b=function (o) {var j=o.item,p=j.data,i=o.result;if (o.item.type=="image") {if (m&&(f!==1)) {if (p) {i=d(i,p.columns,p.rows)}else{i=d(i)}}}a.assets[o.item.id]=i;n.message.progress+=1;n.message.fraction=n.message.progress/n.message.total;if (n.message.progress===n.message.total) {n.message.complete=true}n.owner.trigger("fileload",n.message)},e=function (p) {var o="",i=null,j=a.game.settings.manifest;if (j) {i=p.src.split(".");o=i[i.length-1];if (j[o]&&(j[o]!==o)) {i[i.length-1]=j[o];p.src=i.join(".")}}return p};l.addEventListener("fileload",b);l.addEventListener("error",function (i) {if (i.item&&!i.error) {i.item.tag.src=i.item.src;b(i)}});l.addEventListener("complete",function (i) {setTimeout(function () {n.owner.triggerEvent("complete")},10)});for (h in this.assets) {if (typeof this.assets[h].src==="string") {c(e(this.assets[h]),k)}}if (createjs.Sound) {l.installPlugin(createjs.Sound)}n.message.total=k.length;l.loadManifest(k);a.assets=[]},fileload:function (c) {var b=null;if (this.progressBar) {b=document.getElementById(this.progressBar);if (b) {b=b.style;b.width=(c.fraction*100)+"%";b.backgroundSize=((1/c.fraction)*100)+"%"}}}}})}())}());